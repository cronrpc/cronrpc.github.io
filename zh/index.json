[{"content":"é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œç¼–è¾‘å™¨å¼€å‘çš„çŸ¥è¯†è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ­£ç¡®çš„å­¦ä¹ æ–¹å¼è¿˜æ˜¯ä»å®è·µå…¥æ‰‹ï¼Œç”¨æŸ¥å·¥å…·ä¸€æ ·çš„æ–¹å¼å»å­¦ä¹ ä½¿ç”¨ã€‚\n1. Unityç¼–è¾‘å™¨å¼€å‘å‰ç½®çŸ¥è¯† 1.1 ä»€ä¹ˆæ˜¯æ³¨è§£ï¼ˆAttributeï¼‰ï¼Ÿ æ³¨è§£ï¼ˆAttributeï¼‰ æ˜¯ C# æä¾›çš„ä¸€ç§å…ƒæ•°æ®ï¼ˆMetadataï¼‰æœºåˆ¶ï¼Œç”¨äºåœ¨ç±»ã€æ–¹æ³•ã€å­—æ®µã€å±æ€§ç­‰ä¸Šé™„åŠ é¢å¤–çš„ä¿¡æ¯ã€‚\nåœ¨ Unity ç¼–è¾‘å™¨å¼€å‘ä¸­ï¼Œæ³¨è§£å¸¸ç”¨äºå‘Šè¯‰ Unity æˆ–è‡ªå®šä¹‰çš„ç¼–è¾‘å™¨è„šæœ¬å¦‚ä½•å¤„ç†æŸä¸ªå¯¹è±¡æˆ–æ–¹æ³•ã€‚\n[Serializable] public class PlayerData { public int health; public int score; } [SerializeField] private int health = 100; [Range(0, 10)] public float speed = 5f; [MenuItem(\u0026#34;Tools/Run Custom Action\u0026#34;)] public static void Run() { ... } è¿™é‡Œçš„ [Serializable] å‘Šè¯‰ Unity è¿™ä¸ªç±»å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œä»è€Œèƒ½åœ¨ Inspector ä¸­æ˜¾ç¤ºã€‚\n1.2 å¦‚ä½•ç»™ç±»ä¸ç±»çš„æ–¹æ³•åŠ æ³¨è§£ ä½ å¯ä»¥åœ¨ç±»ã€æ–¹æ³•ã€å­—æ®µæˆ–å±æ€§å‰åŠ ä¸Šæ–¹æ‹¬å· [] æ¥å£°æ˜æ³¨è§£ã€‚\n// ç»™ç±»åŠ æ³¨è§£ [MyCustom(\u0026#34;Player Class\u0026#34;)] public class Player { // ç»™å­—æ®µåŠ æ³¨è§£ [Range(0, 100)] public int health; // ç»™æ–¹æ³•åŠ æ³¨è§£ [MyCustom(\u0026#34;Init Method\u0026#34;)] public void Initialize() { Debug.Log(\u0026#34;Player initialized\u0026#34;); } } // è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ç±» [System.AttributeUsage(System.AttributeTargets.Class | System.AttributeTargets.Method)] public class MyCustomAttribute : System.Attribute { public string Description { get; } public MyCustomAttribute(string description) { Description = description; } } ä¸Šä¾‹ä¸­ï¼š\nMyCustomAttribute æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ï¼› [MyCustom(\u0026quot;xxx\u0026quot;)] è¡¨ç¤ºåœ¨ç±»æˆ–æ–¹æ³•ä¸Šé™„åŠ é¢å¤–è¯´æ˜ä¿¡æ¯ã€‚ 1.3 å¦‚ä½•è¯»å–æ³¨è§£ è¯»å–æ³¨è§£é€šå¸¸é€šè¿‡ åå°„ï¼ˆReflectionï¼‰ å®ç°ã€‚\nusing System; using System.Reflection; using UnityEngine; public class AttributeReader { [MyCustom(\u0026#34;Example Method\u0026#34;)] public void Example() { } [ContextMenu(\u0026#34;Test Read Attributes\u0026#34;)] void TestRead() { // è·å–ç±»å‹ Type type = typeof(AttributeReader); // éå†æ–¹æ³• foreach (MethodInfo method in type.GetMethods(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance)) { // è·å–è‡ªå®šä¹‰æ³¨è§£ MyCustomAttribute attr = method.GetCustomAttribute\u0026lt;MyCustomAttribute\u0026gt;(); if (attr != null) { Debug.Log($\u0026#34;æ–¹æ³• {method.Name} çš„æè¿°ä¸º: {attr.Description}\u0026#34;); } } } } è¿è¡Œåä¼šåœ¨ Unity æ§åˆ¶å°è¾“å‡ºæ³¨è§£å†…å®¹ã€‚\nè¿™åœ¨ç¼–è¾‘å™¨å·¥å…·ä¸­éå¸¸å¸¸è§ï¼Œæ¯”å¦‚æ‰«æé¡¹ç›®ä¸­æ‰€æœ‰æ‰“äº†æŸä¸ªæ ‡ç­¾çš„ç±»å¹¶è‡ªåŠ¨æ³¨å†Œã€‚\n2. è‡ªå®šä¹‰ Inspector 2.1 åˆ©ç”¨ Attribute ç›´æ¥æ§åˆ¶ åˆ©ç”¨ Attribute å¯ä»¥ç›´æ¥æ¥è®¾ç½® Inspector è€Œä¸ç”¨å•ç‹¬ç¼–å†™æ•´ä¸ªç•Œé¢ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š\nusing UnityEngine; public class TheAttributeSample : MonoBehaviour { [Header(\u0026#34;åŸºç¡€æ˜¾ç¤º\u0026#34;)] [SerializeField, Tooltip(\u0026#34;ç§»åŠ¨é€Ÿåº¦ (0~10)\u0026#34;)] [Range(0, 10)] private float moveSpeed = 5f; [Space] [Header(\u0026#34;å¤šè¡Œæ–‡æœ¬\u0026#34;)] [TextArea(2, 5)] public string description = \u0026#34;è¯´æ˜æ–‡å­—\u0026#34;; [ContextMenu(\u0026#34;é‡ç½®å‚æ•°\u0026#34;)] private void ResetValues() { moveSpeed = 5f; description = \u0026#34;è¯´æ˜æ–‡å­—\u0026#34;; Debug.Log(\u0026#34;å·²é‡ç½®å‚æ•°\u0026#34;); } [Space] [Header(\u0026#34;ä¸Šä¸‹æ–‡æŒ‰é’®\u0026#34;)] [ContextMenuItem(\u0026#34;éšæœºåŒ–æ•°å€¼\u0026#34;, \u0026#34;RandomizeValue\u0026#34;)] public int score = 10; private void RandomizeValue() =\u0026gt; score = Random.Range(0, 100); [Space] [Header(\u0026#34;é¢œè‰²ä¸æšä¸¾\u0026#34;)] public Color colorValue = Color.green; public Mode currentMode = Mode.Attack; public enum Mode { Idle, Attack, Defend } [Space] [Header(\u0026#34;å¼•ç”¨ä¸æ•°ç»„\u0026#34;)] public Transform target; public GameObject[] enemyList; } åœ¨ä¿®æ”¹åï¼š\nHeader æ·»åŠ ä¸€ä¸ªæ ‡é¢˜ Space æ˜¯ç©ºè¡Œ [Range(0, 100)] å’Œ [TextArea()] æ˜¯å…·ä½“çš„ç•Œé¢æ ·å¼è°ƒæ•´ã€‚ [Tooltip(\u0026quot;xxx\u0026quot;)] æ˜¯é¼ æ ‡ç§»åŠ¨ä¸Šå»çš„æç¤ºã€‚ ContextMenu é‡ç½®å‚æ•°æŒ‰é’®æ§åˆ¶çš„æ˜¯ç»„ä»¶é‚£ä¸ªåœ°æ–¹ã€‚\nContextMenuItem æ˜¯åœ¨å±æ€§çš„å³é”®èœå•ä¸­ã€‚\n2.2 Class Editor / è‡ªå®šä¹‰ç•Œé¢çš„æ–¹æ³• å‰é¢çš„ Attribute ä¸é€»è¾‘ä»£ç è¿˜æ˜¯è´´åœ¨ä¸€èµ·çš„ï¼Œå¾ˆæ–¹ä¾¿ä½†æ˜¯è‡ªå®šä¹‰ç¨‹åº¦è¿˜ä¸å¤Ÿã€‚\næˆ‘ä»¬å¯ä»¥ä¸“é—¨ä¸ºä¸€ä¸ª Component æ¥ç¼–å†™å®ƒçš„ Inspectorï¼Œä¸‹é¢å°±æ¥ä»‹ç»è¿™ç§æ–¹æ³•ã€‚\né¦–å…ˆè¦ç¡®ä¿æˆ‘ä»¬çš„ä»£ç çš„ .cs æ–‡ä»¶éœ€è¦æ”¾åœ¨ä»»æ„çš„åä¸º Editor çš„æ–‡ä»¶å¤¹ä¸‹é¢ã€‚\nusing System; using UnityEngine; using UnityEditor; [CustomEditor(typeof(TheAttributeSample))] // å…³è”è„šæœ¬ç±»å‹ public class TheAttributeSampleEditor : Editor { SerializedProperty moveSpeed; private void OnEnable() { moveSpeed = serializedObject.FindProperty(\u0026#34;moveSpeed\u0026#34;); } public override void OnInspectorGUI() { // 1. æ›´æ–°åºåˆ—åŒ–å¯¹è±¡ serializedObject.Update(); // 2. ç»˜åˆ¶é»˜è®¤å±æ€§ DrawDefaultInspector(); // 3. è‡ªå®šä¹‰æŒ‰é’® if (GUILayout.Button(\u0026#34;æ‰“å°ç§»åŠ¨é€Ÿåº¦\u0026#34;)) { Debug.Log(\u0026#34;MoveSpeed = \u0026#34; + moveSpeed.floatValue); } // 4. åº”ç”¨ä¿®æ”¹ serializedObject.ApplyModifiedProperties(); } } [CustomEditor(typeof(TheAttributeSample))] è¡¨ç¤ºå…³è”çš„ç±»æ˜¯ TheAttributeSample OnInspectorGUI ä¼šåœ¨æ˜¾ç¤ºå’Œè¾“å…¥æ›´æ”¹æ—¶è°ƒç”¨ã€‚ OnInspectorGUI æ˜¯ override æ„å‘³ç€å¯ä»¥é€šè¿‡ base.OnInspectorGUI() æ¥è¡¨ç¤ºé»˜è®¤ç•Œé¢ã€‚ 2.3 ç”Ÿå‘½å‘¨æœŸ åœ¨è¿è¡Œæ—¶ï¼ˆPlay Modeï¼‰æˆ‘ä»¬æœ‰ï¼š\nAwake â†’ OnEnable â†’ Start â†’ Update â†’ OnDisable â†’ OnDestroy åœ¨ç¼–è¾‘å™¨æ‰©å±•ï¼ˆEditor Modeï¼‰ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä½“ç³»ï¼Œåªä¸è¿‡å‘ç”Ÿåœ¨ç¼–è¾‘å™¨å±‚é¢ï¼š\nOnEnable â†’ OnInspectorGUI / OnSceneGUI (é‡å¤æ‰§è¡Œ) â†’ OnDisable è¿™äº›å›è°ƒè¿è¡Œåœ¨ UnityEditor å‘½åç©ºé—´ä¸‹ï¼›Unity ä¼šåœ¨ç¼–è¾‘å™¨çŠ¶æ€å˜åŠ¨ï¼ˆæ¯”å¦‚è„šæœ¬é‡ç¼–è¯‘ã€é€‰ä¸­ç‰©ä½“ã€æ‰“å¼€ Inspector ç­‰ï¼‰æ—¶è‡ªåŠ¨è§¦å‘ã€‚\nEditor ç”Ÿå‘½å‘¨æœŸå®Œæ•´æµç¨‹ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰ï¼š\né˜¶æ®µ å›è°ƒæ–¹æ³• è°ƒç”¨æ—¶æœº å¸¸è§ç”¨é€” åˆå§‹åŒ–é˜¶æ®µ OnEnable() å½“ Inspector æ‰“å¼€ / é€‰ä¸­ç‰©ä½“ / è„šæœ¬é‡ç¼–è¯‘æ—¶ ç¼“å­˜ SerializedPropertyã€æ³¨å†Œäº‹ä»¶ã€åˆå§‹åŒ–èµ„æº æ¿€æ´»é˜¶æ®µ OnInspectorGUI() æ¯æ¬¡ Inspector é‡ç»˜æ—¶è°ƒç”¨ï¼ˆéå¸¸é¢‘ç¹ï¼‰ ç»˜åˆ¶ UIã€æ£€æµ‹ç”¨æˆ·è¾“å…¥ã€ä¿®æ”¹æ•°æ® åœºæ™¯ç»˜åˆ¶é˜¶æ®µ OnSceneGUI() å½“å¯¹è±¡åœ¨ Scene è§†å›¾ä¸­è¢«é€‰ä¸­æˆ– Scene è§†å›¾é‡ç»˜æ—¶ ç»˜åˆ¶ Gizmoã€Handlesã€äº¤äº’æ“ä½œ é¢„è§ˆé˜¶æ®µ HasPreviewGUI() / OnPreviewGUI() åœ¨ Inspector åº•éƒ¨ç»˜åˆ¶é¢„è§ˆï¼ˆæ¨¡å‹ã€éŸ³é¢‘ç­‰ï¼‰ è‡ªå®šä¹‰èµ„æºé¢„è§ˆçª—å£ æ›´æ–°é˜¶æ®µ OnInspectorUpdate() ç¼–è¾‘å™¨å®šæœŸåˆ·æ–°ï¼ˆå¤§çº¦ 10 FPSï¼‰ å®šæ—¶åˆ·æ–°çŠ¶æ€ã€æ£€æµ‹å¼‚æ­¥ä»»åŠ¡ é”€æ¯é˜¶æ®µ OnDisable() å½“ Inspector è¢«å…³é—­ã€åˆ‡æ¢é€‰ä¸­å¯¹è±¡æˆ– Domain Reload æ—¶ æ³¨é”€äº‹ä»¶ã€é‡Šæ”¾å†…å­˜ã€æ¸…ç†å¼•ç”¨ 2.4 Editor.serializedObject åœ¨ Editor è„šæœ¬ä¸­ï¼ŒserializedObject æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒæ˜¯å¯¹ä½ æ­£åœ¨ç¼–è¾‘çš„è„šæœ¬ï¼ˆå³ targetï¼‰çš„ä¸€ä¸ª åºåˆ—åŒ–åŒ…è£…ï¼ˆå°è£…å±‚ï¼‰ã€‚\nå¦‚æœä½ åœ¨ Editor é‡Œç›´æ¥å†™ï¼š\n((MyScript)target).speed = 5; å®ƒä¸æ”¯æŒï¼š\nUndo Prefab æ ‡è®°è¦†ç›– å¤šé€‰å¯¹è±¡ target æ—¶æ— æ³•ç»Ÿä¸€ä¿®æ”¹ Unity çš„åºåˆ—åŒ–ç³»ç»Ÿè§£å†³äº†è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥æä¾›äº† serializedObjectã€‚\nserializedObject = å½“å‰ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰çš„åºåˆ—åŒ–ç‰ˆæœ¬ SerializedProperty = è¯¥å¯¹è±¡ä¸­çš„ä¸€ä¸ªå­—æ®µçš„åºåˆ—åŒ–åŒ…è£… æ¯”å¦‚ï¼š\nSerializedProperty moveSpeed; void OnEnable() { moveSpeed = serializedObject.FindProperty(\u0026#34;moveSpeed\u0026#34;); } public override void OnInspectorGUI() { serializedObject.Update(); EditorGUILayout.PropertyField(speed); serializedObject.ApplyModifiedProperties(); } ä¸Šé¢ä»£ç å¯ä»¥è¿™ä¹ˆç†è§£ï¼šUpdate æ˜¯æŠŠ target çš„æ•°æ®åŒæ­¥åˆ° serializedObjectï¼ŒEditorGUILayout.PropertyField æ˜¯è‡ªåŠ¨æ ¹æ®ç±»å‹æ˜¾ç¤ºåœ¨æ“ä½œç•Œé¢ï¼Œä¿®æ”¹çš„æ—¶å€™ä¼šåŒæ­¥å›ä¼ ã€‚è€Œ ApplyModifiedProperties æ˜¯æŠŠ serializedObject çš„ä¿®æ”¹ï¼Œä¼ é€’å› targetã€‚\n2.5 GUILayout / IMGUI GUILayout å±äº IMGUIï¼ˆImmediate Mode GUIï¼‰ç³»ç»Ÿï¼Œå®ƒæ˜¯æœ€åŸºç¡€çš„ GUI ç»˜åˆ¶ç±»ï¼Œèƒ½åœ¨ï¼š\nMonoBehaviour.OnGUI()ï¼ˆæ¸¸æˆè¿è¡Œæ—¶ï¼‰ Editor.OnInspectorGUI()ï¼ˆç¼–è¾‘å™¨è‡ªå®šä¹‰ Inspectorï¼‰ EditorWindow.OnGUI()ï¼ˆè‡ªå®šä¹‰ç¼–è¾‘å™¨çª—å£ï¼‰ ä¸­ä½¿ç”¨ã€‚\nåœ¨ Editor é‡Œä½¿ç”¨æ—¶ï¼Œä¸€èˆ¬æˆ‘ä»¬è¿™æ ·å†™ï¼š\npublic override void OnInspectorGUI() { GUILayout.Label(\u0026#34;æ ‡é¢˜\u0026#34;); } ç®€è®°ï¼šLabel / Text / Toggle / Slider / Button / Layout\nä¸€ä¸ªç»¼åˆçš„ä¾‹å­ï¼š\nusing UnityEngine; using UnityEditor; [CustomEditor(typeof(TheAttributeSample))] public class TheAttributeSampleEditor : Editor { private bool toggleValue = true; private float sliderValue = 5f; private string inputText = \u0026#34;åˆå§‹æ–‡æœ¬\u0026#34;; private string multiLine = \u0026#34;å¤šè¡Œæ–‡æœ¬\\næ”¯æŒæ¢è¡Œ\u0026#34;; private Vector2 scrollPos; public override void OnInspectorGUI() { // æ ‡é¢˜ GUILayout.Label(\u0026#34;ğŸ‘‹ è‡ªå®šä¹‰ Inspector - GUILayout æ§ä»¶æ¼”ç¤º\u0026#34;, EditorStyles.boldLabel); GUILayout.Space(10); // è¾“å…¥æ¡† GUILayout.Label(\u0026#34;å•è¡Œæ–‡æœ¬è¾“å…¥:\u0026#34;); inputText = GUILayout.TextField(inputText); GUILayout.Space(5); // å¤šè¡Œè¾“å…¥æ¡† GUILayout.Label(\u0026#34;å¤šè¡Œæ–‡æœ¬è¾“å…¥:\u0026#34;); multiLine = GUILayout.TextArea(multiLine, GUILayout.Height(60)); GUILayout.Space(5); // å¼€å…³ toggleValue = GUILayout.Toggle(toggleValue, \u0026#34;å¯ç”¨æŸä¸ªåŠŸèƒ½\u0026#34;); GUILayout.Space(5); // æ»‘æ¡ GUILayout.Label($\u0026#34;ç§»åŠ¨é€Ÿåº¦: {sliderValue:F2}\u0026#34;); sliderValue = GUILayout.HorizontalSlider(sliderValue, 0, 10); GUILayout.Space(10); // æŒ‰é’® if (GUILayout.Button(\u0026#34;æ‰“å°å½“å‰çŠ¶æ€\u0026#34;)) { Debug.Log($\u0026#34;è¾“å…¥: {inputText}, å¼€å…³: {toggleValue}, é€Ÿåº¦: {sliderValue}\u0026#34;); } GUILayout.Space(10); GUILayout.Box(\u0026#34;\u0026#34;, GUILayout.ExpandWidth(true), GUILayout.Height(2)); // åˆ†éš”çº¿ // æ»šåŠ¨åŒºåŸŸ GUILayout.Label(\u0026#34;æ»šåŠ¨åŒºåŸŸç¤ºä¾‹ï¼š\u0026#34;); scrollPos = GUILayout.BeginScrollView(scrollPos, GUILayout.Height(100)); for (int i = 0; i \u0026lt; 20; i++) { GUILayout.Label(\u0026#34;é¡¹ç›® \u0026#34; + i); } GUILayout.EndScrollView(); GUILayout.Space(10); GUILayout.Label(\u0026#34;å¸ƒå±€æ§åˆ¶:\u0026#34;); GUILayout.BeginHorizontal(); if (GUILayout.Button(\u0026#34;å·¦æŒ‰é’®\u0026#34;)) Debug.Log(\u0026#34;å·¦\u0026#34;); if (GUILayout.Button(\u0026#34;å³æŒ‰é’®\u0026#34;)) Debug.Log(\u0026#34;å³\u0026#34;); GUILayout.EndHorizontal(); GUILayout.Space(5); GUILayout.Label(\u0026#34;ç¤ºä¾‹ç»“æŸ ğŸ¯\u0026#34;); } } æ ·å¼ï¼š\n2.6 EditorGUILayout EditorGUILayout æ˜¯ Unity ç¼–è¾‘å™¨è„šæœ¬é‡Œçš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œå®ƒå¯ä»¥å¸®ä½ åœ¨ Inspector æˆ– è‡ªå®šä¹‰çª—å£é‡Œæ˜¾ç¤ºå„ç§æ§ä»¶ï¼Œæ¯”å¦‚æŒ‰é’®ã€æ»‘æ¡ã€é¢œè‰²é€‰æ‹©å™¨ç­‰ã€‚\nè‡ªåŠ¨æ”¯æŒ Undoã€Prefab è¦†ç›–ã€å¤šå¯¹è±¡ç¼–è¾‘ã€‚\nå’Œ GUILayout çš„åŒºåˆ«æ˜¯ï¼Œå®ƒæ”¯æŒå¤šå¯¹è±¡ï¼Œå†™èµ·æ¥æ›´ç®€æ´ï¼Œæ ·å¼ç»Ÿä¸€ã€‚\nå¸¸ç”¨æ§ä»¶ï¼š\næ§ä»¶ ç”¨é€” ç¤ºä¾‹ LabelField æ˜¾ç¤ºæ–‡æœ¬ EditorGUILayout.LabelField(\u0026quot;æ ‡é¢˜\u0026quot;) TextField è¾“å…¥å•è¡Œæ–‡å­— EditorGUILayout.TextField(\u0026quot;åå­—\u0026quot;, name) TextArea å¤šè¡Œæ–‡å­— EditorGUILayout.TextArea(description) Toggle å¼€å…³ EditorGUILayout.Toggle(\u0026quot;æ˜¯å¦å¯ç”¨\u0026quot;, isOn) Slider æ»‘æ¡ EditorGUILayout.Slider(\u0026quot;é€Ÿåº¦\u0026quot;, speed, 0, 10) IntField æ•´æ•°è¾“å…¥ EditorGUILayout.IntField(\u0026quot;ç”Ÿå‘½\u0026quot;, hp) FloatField æµ®ç‚¹è¾“å…¥ EditorGUILayout.FloatField(\u0026quot;é€Ÿåº¦\u0026quot;, speed) Vector3Field ä¸‰ç»´å‘é‡ EditorGUILayout.Vector3Field(\u0026quot;ä½ç½®\u0026quot;, pos) ColorField é¢œè‰²é€‰æ‹© EditorGUILayout.ColorField(\u0026quot;é¢œè‰²\u0026quot;, color) ObjectField æ‹–æ‹½å¯¹è±¡ EditorGUILayout.ObjectField(\u0026quot;ç›®æ ‡\u0026quot;, obj, typeof(GameObject), true) EnumPopup ä¸‹æ‹‰é€‰æ‹©æšä¸¾ EditorGUILayout.EnumPopup(\u0026quot;ç±»å‹\u0026quot;, playerClass) Foldout æŠ˜å é¢æ¿ fold = EditorGUILayout.Foldout(fold, \u0026quot;é«˜çº§\u0026quot;) PropertyField è‡ªåŠ¨ç»˜åˆ¶ SerializedProperty EditorGUILayout.PropertyField(serializedProp) ä¸€ä¸ªæ¡ˆä¾‹ï¼š\nusing UnityEngine; public class PlayerSettings : MonoBehaviour { [SerializeField, Range(0, 10)] private float moveSpeed = 5f; [SerializeField] private string playerName = \u0026#34;Hero\u0026#34;; [SerializeField] private Color playerColor = Color.cyan; [SerializeField] private bool isGodMode = false; } Editor éƒ¨åˆ†ï¼š\nusing UnityEditor; using UnityEngine; [CustomEditor(typeof(PlayerSettings))] public class PlayerSettingsEditor : Editor { // å®šä¹‰ SerializedProperty å¯¹è±¡ SerializedProperty moveSpeed; SerializedProperty playerName; SerializedProperty playerColor; SerializedProperty isGodMode; // åˆå§‹åŒ–ï¼šåœ¨ç¼–è¾‘å™¨åŠ è½½æ—¶ç»‘å®šå­—æ®µ void OnEnable() { moveSpeed = serializedObject.FindProperty(\u0026#34;moveSpeed\u0026#34;); playerName = serializedObject.FindProperty(\u0026#34;playerName\u0026#34;); playerColor = serializedObject.FindProperty(\u0026#34;playerColor\u0026#34;); isGodMode = serializedObject.FindProperty(\u0026#34;isGodMode\u0026#34;); } // è‡ªå®šä¹‰ Inspector ç•Œé¢ public override void OnInspectorGUI() { // åŒæ­¥ç›®æ ‡å¯¹è±¡çš„æœ€æ–°æ•°æ® serializedObject.Update(); GUILayout.Label(\u0026#34;ğŸ® Player Settings\u0026#34;, EditorStyles.boldLabel); EditorGUILayout.Space(); // ç»˜åˆ¶å±æ€§å­—æ®µï¼ˆè‡ªåŠ¨æ”¯æŒæ’¤é”€ / Prefabï¼‰ EditorGUILayout.PropertyField(playerName, new GUIContent(\u0026#34;Player Name\u0026#34;)); EditorGUILayout.PropertyField(moveSpeed, new GUIContent(\u0026#34;Move Speed\u0026#34;)); EditorGUILayout.PropertyField(playerColor, new GUIContent(\u0026#34;Player Color\u0026#34;)); EditorGUILayout.PropertyField(isGodMode, new GUIContent(\u0026#34;God Mode\u0026#34;)); EditorGUILayout.Space(10); // æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰æŒ‰é’® if (GUILayout.Button(\u0026#34;æ‰“å°ç©å®¶ä¿¡æ¯\u0026#34;)) { var player = (PlayerSettings)target; Debug.Log($\u0026#34;ğŸ‘¤ {playerName.stringValue} - é€Ÿåº¦: {moveSpeed.floatValue}, æ— æ•Œ: {isGodMode.boolValue}\u0026#34;); } // æäº¤ä¿®æ”¹å›ç›®æ ‡å¯¹è±¡ serializedObject.ApplyModifiedProperties(); } } æ•ˆæœï¼š\nå®Œå…¨å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªæŠ½è±¡äº†ä¸€ä¸ªä¸­é—´å±‚çš„ IMGUIï¼Œé¿å…æ‰‹åŠ¨ç»‘å®šä¸€äº›å†™æ³•ã€‚å¦‚æœå¤æ‚ç‚¹å†™ï¼Œè¿˜å¯ä»¥å®ç°ä¸‹é¢çš„æ•ˆæœï¼š\n2.6.1 å±•å¼€æŠ˜å çš„ä¾‹å­ è¿™ä¸ªä¾‹å­è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ç”±äºå¤ªè¿‡å¸¸ç”¨ï¼Œè¿™é‡Œä¸“é—¨å†™ä¸€ä¸‹ã€‚\nå±•å¼€æŠ˜å çš„ä¾‹å­ï¼š\nusing UnityEngine; using UnityEditor; [CustomEditor(typeof(PlayerSettings))] public class PlayerSettingsEditor : Editor { // SerializedProperty å¯¹è±¡ SerializedProperty moveSpeed; SerializedProperty playerName; SerializedProperty playerColor; SerializedProperty isGodMode; // æŠ˜å çŠ¶æ€å˜é‡ bool showBasicSettings = true; bool showAdvancedSettings = false; void OnEnable() { moveSpeed = serializedObject.FindProperty(\u0026#34;moveSpeed\u0026#34;); playerName = serializedObject.FindProperty(\u0026#34;playerName\u0026#34;); playerColor = serializedObject.FindProperty(\u0026#34;playerColor\u0026#34;); isGodMode = serializedObject.FindProperty(\u0026#34;isGodMode\u0026#34;); } public override void OnInspectorGUI() { serializedObject.Update(); // æŠ˜å é¢æ¿ï¼šåŸºç¡€è®¾ç½® showBasicSettings = EditorGUILayout.Foldout(showBasicSettings, \u0026#34;åŸºç¡€è®¾ç½®\u0026#34;); if (showBasicSettings) { EditorGUILayout.PropertyField(playerName); EditorGUILayout.PropertyField(moveSpeed); } EditorGUILayout.Space(); // æŠ˜å é¢æ¿ï¼šé«˜çº§è®¾ç½® showAdvancedSettings = EditorGUILayout.Foldout(showAdvancedSettings, \u0026#34;é«˜çº§è®¾ç½®\u0026#34;); if (showAdvancedSettings) { EditorGUILayout.PropertyField(playerColor); EditorGUILayout.PropertyField(isGodMode); } EditorGUILayout.Space(); // æ‰“å°æŒ‰é’® if (GUILayout.Button(\u0026#34;æ‰“å°ç©å®¶ä¿¡æ¯\u0026#34;)) { Debug.Log($\u0026#34;ç©å®¶ {playerName.stringValue}, é€Ÿåº¦ {moveSpeed.floatValue}, \u0026#34; + $\u0026#34;é¢œè‰² {playerColor.colorValue}, æ— æ•Œ: {isGodMode.boolValue}\u0026#34;); } serializedObject.ApplyModifiedProperties(); } } æ•ˆæœå®ç°ï¼š\n2.7 Handles / OnSceneGUI OnSceneGUI æ˜¯ Unity è‡ªå®šä¹‰ç¼–è¾‘å™¨é‡Œçš„ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…è®¸ä½ åœ¨ Scene è§†å›¾ä¸­ç»˜åˆ¶å’Œäº¤äº’ï¼Œæ¯æ¬¡ Scene è§†å›¾åˆ·æ–°æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚\nHandles æ˜¯ Unity æä¾›çš„ä¸€ç»„ Scene è§†å›¾å¯è§†åŒ–æ§ä»¶å’Œç»˜å›¾å·¥å…·ï¼š\næ–¹æ³• ç”¨é€” Handles.PositionHandle å¯æ‹–æ‹½æ§åˆ¶ä½ç½® Handles.RotationHandle å¯æ—‹è½¬æ§åˆ¶ Handles.ScaleHandle å¯ç¼©æ”¾æ§åˆ¶ Handles.Label æ˜¾ç¤ºæ–‡æœ¬æ ‡ç­¾ Handles.SphereHandleCap ç»˜åˆ¶çƒä½“ Handles.DrawLine ç»˜åˆ¶çº¿æ¡ Handles.DrawWireCube ç»˜åˆ¶ç©ºå¿ƒæ–¹å— æˆ‘ä»¬ç›´æ¥ä¸Šä½¿ç”¨æ–¹å¼ã€‚é¦–å…ˆç»™ PlayerSettings å¢åŠ ä¸€ä¸ªä¸‰ç»´åæ ‡ï¼Œåé¢ä¼šç”¨ Handles æ¥å¯è§†åŒ–æ“ä½œè¿™ä¸ªä¸‰ç»´åæ ‡ã€‚\npublic class PlayerSettings : MonoBehaviour { // ... // public Vector3 scenePosition = Vector3.zero; } ç„¶ååœ¨ OnSceneGUI ä¸­é€šè¿‡ Handles æ¥å®ç°æ“ä½œ scenePosition çš„å¯è§†åŒ–ä¿®æ”¹ã€‚\nusing UnityEditor; using UnityEditor.TerrainTools; using UnityEngine; [CustomEditor(typeof(PlayerSettings))] public class PlayerSettingsEditor : Editor { private void OnSceneGUI() { PlayerSettings player = (PlayerSettings)target; // å¼€å§‹ç›‘æµ‹ä¿®æ”¹ EditorGUI.BeginChangeCheck(); // æ‹–æ‹½ PositionHandle æ§åˆ¶ scenePosition Vector3 newPos = Handles.PositionHandle(player.scenePosition, Quaternion.identity); if (EditorGUI.EndChangeCheck()) { Undo.RecordObject(player, \u0026#34;Move Scene Position\u0026#34;); // æ”¯æŒ Undo player.scenePosition = newPos; // æ›´æ–°ä½ç½® EditorUtility.SetDirty(player); // æ ‡è®°å¯¹è±¡å·²ä¿®æ”¹ } // ç»˜åˆ¶ä¸€ä¸ªçƒä½“æ ‡è®° Handles.color = Color.aliceBlue; Handles.SphereHandleCap(0, player.scenePosition, Quaternion.identity, 0.5f, EventType.Repaint); // ç»˜åˆ¶åå­—æ ‡ç­¾ Handles.Label(player.scenePosition + Vector3.up * 0.6f, \u0026#34;Scene Position\u0026#34;); } } æ•ˆæœï¼š\næ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»è¦é€‰æ‹©è¿™ä¸ªç‰©ä½“ï¼Œæ‰ä¼šåœ¨ Scene ä¸­è¿›è¡Œç»˜åˆ¶ï¼Œå’Œä¸‹é¢è¦ä»‹ç»çš„ Gizmo æ˜¯æœ‰åŒºåˆ«çš„ã€‚ è¿™ä¸ªåæ ‡è¿˜æ˜¯å¯ä»¥åœ¨ Inspector ä¸­ç›´æ¥ç¼–è¾‘çš„ï¼Œä¸å½±å“è¿™ä¸€ç‚¹ã€‚\n2.8 Gizmos / OnDrawGizmos Handles åªèƒ½åœ¨ Scene ä¸­è¿›è¡Œç»˜åˆ¶ï¼Œè€Œä¸”å¿…é¡»è¦é€‰ä¸­ã€‚\nGizmos å¯ä»¥åŒæ—¶åœ¨ Scene å’Œ Game ä¸­ç»˜åˆ¶å¹¶æ˜¾ç¤ºï¼Œå‡†ç¡®æ¥è¯´è¿™ä¸ªçŸ¥è¯†æ˜¯ä¸ç®—æ˜¯ Editor å¼€å‘é‡Œé¢çš„ï¼Œè¿™é‡Œåªæ˜¯å¯¹æ¯”è®²è§£ä¸‹ Handlesã€‚\næ–¹æ³• ç”¨é€” Gizmos.DrawLine(start, end) ç»˜åˆ¶ç›´çº¿ Gizmos.DrawRay(origin, direction) ç»˜åˆ¶å°„çº¿ Gizmos.DrawSphere(center, radius) ç»˜åˆ¶çƒä½“ Gizmos.DrawCube(center, size) ç»˜åˆ¶æ–¹å— Gizmos.DrawWireCube(center, size) ç»˜åˆ¶ç©ºå¿ƒæ–¹å— Gizmos.color è®¾ç½®é¢œè‰² Gizmos.DrawIcon(position, iconName, allowScaling) ç»˜åˆ¶å›¾æ ‡ è¿˜æ˜¯å›åˆ° PlayerSettingsï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨ Gizmos æ˜¾ç¤ºå®ƒï¼š\nusing UnityEngine; public class PlayerSettings : MonoBehaviour { [SerializeField, Range(0, 10)] private float moveSpeed = 5f; [SerializeField] private string playerName = \u0026#34;Hero\u0026#34;; [SerializeField] private Color playerColor = Color.cyan; [SerializeField] private bool isGodMode = false; public Vector3 scenePosition = Vector3.zero; private void OnDrawGizmos() { Gizmos.color = playerColor; // ç»˜åˆ¶çƒä½“ Gizmos.DrawSphere(scenePosition, 0.5f); // ç»˜åˆ¶ä¸€æ¡å‘ä¸Šçš„çº¿ Gizmos.DrawLine(scenePosition, scenePosition + Vector3.up); // ç»˜åˆ¶åå­—æ ‡ç­¾ï¼ˆScene ä¸­ä»…æ˜¾ç¤ºï¼‰ UnityEditor.Handles.Label(scenePosition + Vector3.up * 0.6f, playerName); } } å¯ä»¥åœ¨ Game ä¸­ä¹Ÿçœ‹åˆ°ï¼Œæ³¨æ„è¦æŠŠå³ä¸Šè§’çš„ Gizmos ç»™å¯ç”¨æ‰èƒ½çœ‹åˆ°ï¼š\n3. å·¥å…·ç±» 3.1 EditorUtility EditorUtility æ˜¯ Unity ç¼–è¾‘å™¨æä¾›çš„ å®ç”¨å·¥å…·ç±»ï¼Œç”¨æ¥å®Œæˆä¸€äº›é€šç”¨ç¼–è¾‘å™¨æ“ä½œï¼Œæ¯”å¦‚å¼¹çª—ã€æ ‡è®°å¯¹è±¡ä¿®æ”¹ã€ä¿å­˜ç­‰ã€‚\nä¸‹é¢çš„ SetDirty ç»å¸¸ç”¨åˆ°ã€‚\næ–¹æ³• åŠŸèƒ½ EditorUtility.SetDirty(Object obj) æ ‡è®°å¯¹è±¡å·²ä¿®æ”¹ï¼Œç¡®ä¿ç¼–è¾‘å™¨ä¿å­˜æ›´æ”¹ EditorUtility.DisplayDialog(title, message, ok, cancel) å¼¹å‡ºå¯¹è¯æ¡† EditorUtility.DisplayProgressBar(title, info, progress) æ˜¾ç¤ºè¿›åº¦æ¡ EditorUtility.ClearProgressBar() å…³é—­è¿›åº¦æ¡ EditorUtility.FocusProjectWindow() èšç„¦ Project çª—å£ EditorUtility.CopySerialized(Object src, Object dst) å¤åˆ¶å¯¹è±¡æ•°æ® using UnityEditor; using UnityEngine; public class EditorUtilityExample { [MenuItem(\u0026#34;Tools/Mark Dirty Example\u0026#34;)] static void MarkDirtyExample() { GameObject go = Selection.activeGameObject; if (go != null) { Undo.RecordObject(go, \u0026#34;Modify GameObject\u0026#34;); go.transform.position = Vector3.one; EditorUtility.SetDirty(go); // æ ‡è®°ä¿®æ”¹ Debug.Log(\u0026#34;GameObject position changed and marked dirty.\u0026#34;); } } } 3.2 AssetDatabase AssetDatabase æ˜¯ Unity çš„èµ„æºç®¡ç†æ¥å£ï¼Œç”¨äºæ“ä½œé¡¹ç›®ä¸­çš„èµ„æºï¼ˆåˆ›å»ºã€åˆ é™¤ã€å¯¼å…¥ã€æŸ¥æ‰¾ç­‰ï¼‰ã€‚\næ–¹æ³• åŠŸèƒ½ AssetDatabase.CreateAsset(Object asset, string path) åˆ›å»ºèµ„æºæ–‡ä»¶ AssetDatabase.DeleteAsset(string path) åˆ é™¤èµ„æºæ–‡ä»¶ AssetDatabase.MoveAsset(string oldPath, string newPath) ç§»åŠ¨/é‡å‘½åèµ„æº AssetDatabase.LoadAssetAtPath\u0026lt;T\u0026gt;(string path) åŠ è½½èµ„æº AssetDatabase.Refresh() åˆ·æ–°èµ„æºæ•°æ®åº“ AssetDatabase.GetAssetPath(Object obj) è·å–èµ„æºè·¯å¾„ using UnityEditor; using UnityEngine; public class AssetDatabaseExample { [MenuItem(\u0026#34;Tools/Create Material\u0026#34;)] static void CreateMaterial() { Material mat = new Material(Shader.Find(\u0026#34;Standard\u0026#34;)); AssetDatabase.CreateAsset(mat, \u0026#34;Assets/NewMaterial.mat\u0026#34;); AssetDatabase.SaveAssets(); AssetDatabase.Refresh(); Debug.Log(\u0026#34;Material created in Assets folder.\u0026#34;); } } 3.3 Selection Selection ç”¨æ¥ è·å–æˆ–è®¾ç½®ç¼–è¾‘å™¨å½“å‰é€‰ä¸­çš„å¯¹è±¡ï¼Œå¸¸ç”¨åœ¨ç¼–è¾‘å™¨å·¥å…·ä¸­æ“ä½œç”¨æˆ·é€‰æ‹©çš„å¯¹è±¡ã€‚\nå±æ€§ / æ–¹æ³• åŠŸèƒ½ Selection.activeObject å½“å‰é€‰ä¸­çš„å¯¹è±¡ï¼ˆå•é€‰ï¼‰ Selection.activeGameObject å½“å‰é€‰ä¸­çš„ GameObjectï¼ˆå•é€‰ï¼‰ Selection.objects å½“å‰é€‰ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼ˆå¤šé€‰ï¼‰ Selection.gameObjects å½“å‰é€‰ä¸­çš„æ‰€æœ‰ GameObjectï¼ˆå¤šé€‰ï¼‰ Selection.activeTransform å½“å‰é€‰ä¸­å¯¹è±¡çš„ Transform Selection.activeInstanceID å½“å‰é€‰ä¸­å¯¹è±¡çš„å®ä¾‹ ID using UnityEditor; using UnityEngine; public class SelectionExample { [MenuItem(\u0026#34;Tools/Print Selected Objects\u0026#34;)] static void PrintSelectedObjects() { foreach (var obj in Selection.objects) { Debug.Log(\u0026#34;Selected object: \u0026#34; + obj.name); } } } 3.4 EditorWindow.OnGUI æ¯å½“ Unity éœ€è¦ç»˜åˆ¶ç•Œé¢ï¼ˆInspectorã€EditorWindowã€Game GUIç­‰ï¼‰æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨ OnGUI()ï¼Œè®©ä½ ç”¨ä»£ç å³æ—¶ç”»å‡º UI æ§ä»¶ã€‚\nä¸Šä¸‹æ–‡ è§¦å‘æ–¹å¼ ç”¨é€” MonoBehaviour.OnGUI() æ¸¸æˆè¿è¡Œæ—¶è°ƒç”¨ ç»˜åˆ¶ç®€å• HUDã€è°ƒè¯• GUI EditorWindow.OnGUI() ç¼–è¾‘å™¨çª—å£ ç»˜åˆ¶è‡ªå®šä¹‰å·¥å…·çª—å£ Editor.OnInspectorGUI() Inspector é¢æ¿ è‡ªå®šä¹‰ç»„ä»¶çš„ Inspector EditorApplication.projectWindowItemOnGUI Project çª—å£ç»˜åˆ¶ ç»˜åˆ¶èµ„æºèƒŒæ™¯/å›¾æ ‡ EditorApplication.projectWindowItemInstanceOnGUI Project çª—å£ç»˜åˆ¶ ç»˜åˆ¶èµ„æºèƒŒæ™¯/å›¾æ ‡ï¼Œå¯ä»¥å¤„ç†å­èµ„äº§ EditorApplication.hierarchyWindowItemOnGUI Hierarchy ç»˜åˆ¶ ä¿®æ”¹ GameObject æ˜¾ç¤ºæ•ˆæœ åˆ©ç”¨ EditorWindow çš„ GUI åˆ›å»ºä¸€ä¸ªçª—å£ï¼š\nusing UnityEditor; using UnityEngine; public class SimpleWindow : EditorWindow { [MenuItem(\u0026#34;Window/Simple GUI\u0026#34;)] public static void ShowWindow() { GetWindow\u0026lt;SimpleWindow\u0026gt;(\u0026#34;Simple GUI\u0026#34;); } void OnGUI() { GUILayout.Label(\u0026#34;Hello Unity IMGUI!\u0026#34;, EditorStyles.boldLabel); if (GUILayout.Button(\u0026#34;Click Me\u0026#34;)) { Debug.Log(\u0026#34;Button clicked!\u0026#34;); } } } å®ç°æ•ˆæœï¼š\n3.5 projectWindowItemOnGUI projectWindowItemOnGUI æ˜¯ Unity Editor æä¾›çš„ä¸€ä¸ª é™æ€å›è°ƒäº‹ä»¶ï¼Œç”¨äºåœ¨ Project çª—å£çš„æ¯ä¸ªèµ„æºæ¡ç›®ä¸Šç»˜åˆ¶è‡ªå®šä¹‰ GUIã€‚\næ³¨æ„è¿™é‡Œè¦æ³¨é”€ä¸€ä¸‹ä¸Šæ¬¡æ³¨å†Œçš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚\nusing UnityEngine; using UnityEditor; [InitializeOnLoad] public static class ProjectWindowDecorator { static ProjectWindowDecorator() { EditorApplication.projectWindowItemOnGUI -= OnProjectWindowItemGUI; EditorApplication.projectWindowItemOnGUI += OnProjectWindowItemGUI; } private static void OnProjectWindowItemGUI(string guid, Rect rect) { string path = AssetDatabase.GUIDToAssetPath(guid); // åªå¯¹ png æ–‡ä»¶ç”Ÿæ•ˆ if (path.EndsWith(\u0026#34;.png\u0026#34;)) { // åœ¨èµ„æºå³ä¸Šè§’ç”»ä¸€ä¸ªçº¢è‰²å°åœ†ç‚¹ Rect dotRect = new Rect(rect.xMax - 10, rect.y + 2, 8, 8); EditorGUI.DrawRect(dotRect, Color.red); } } } æ•ˆæœï¼š\nè¿˜å¯ä»¥å®ç°ç»™æ¯ä¸ªæ–‡ä»¶ä¸ŠåŠ ä¸€ä¸ªæŒ‰é’®çš„åŠŸèƒ½ï¼š\n3.6 EditorPrefs EditorPrefs æ˜¯ Unity ç¼–è¾‘å™¨ä¸“ç”¨çš„ä¸€ä¸ªç±»ï¼Œç”¨æ¥åœ¨æœ¬åœ°ä¿å­˜ç¼–è¾‘å™¨çº§åˆ«çš„é…ç½®æ•°æ®ï¼ˆç±»ä¼¼äºâ€œç¼–è¾‘å™¨åå¥½è®¾ç½®â€ï¼‰ã€‚\nå®ƒçš„åŠŸèƒ½ç±»ä¼¼äº PlayerPrefsï¼ˆæ¸¸æˆè¿è¡Œæ—¶å­˜å‚¨ï¼‰ï¼Œä½†ç”¨äºç¼–è¾‘å™¨å·¥å…·æˆ–æ’ä»¶çš„è®¾ç½®ã€‚\nå®ƒä¸ä¼šéšç€ â€œé¡¹ç›®ç§»åŠ¨â€ è€Œè¿ç§»ï¼Œä¹Ÿå°±æ˜¯ä»…ä»…æ˜¯ä½ æœ¬æœºç”µè„‘ä¿å­˜çš„ã€‚\né€šå¸¸ä¸ç”¨è¿™ä¸ªï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œåº”è¯¥æ˜¯å†™æˆä¸€ä¸ªå¯ä»¥ä¿å­˜çš„ JSON ä¹‹ç±»çš„ï¼Œè·Ÿç€é¡¹ç›®å¯ä»¥åŒæ­¥ã€‚\nusing UnityEditor; using UnityEngine; public class EditorPrefsExample { [MenuItem(\u0026#34;Tools/EditorPrefs ç¤ºä¾‹\u0026#34;)] public static void Example() { // ä¿å­˜æ•°æ® EditorPrefs.SetString(\u0026#34;MyTool_LastFilePath\u0026#34;, \u0026#34;D:/MyProject/Config.txt\u0026#34;); EditorPrefs.SetInt(\u0026#34;MyTool_UseDarkTheme\u0026#34;, 1); EditorPrefs.SetBool(\u0026#34;MyTool_ShowTips\u0026#34;, true); EditorPrefs.SetFloat(\u0026#34;MyTool_Volume\u0026#34;, 0.8f); // è¯»å–æ•°æ® string path = EditorPrefs.GetString(\u0026#34;MyTool_LastFilePath\u0026#34;, \u0026#34;æœªè®¾ç½®\u0026#34;); bool showTips = EditorPrefs.GetBool(\u0026#34;MyTool_ShowTips\u0026#34;, false); float volume = EditorPrefs.GetFloat(\u0026#34;MyTool_Volume\u0026#34;, 1.0f); Debug.Log($\u0026#34;è·¯å¾„: {path}, æ˜¯å¦æ˜¾ç¤ºæç¤º: {showTips}, éŸ³é‡: {volume}\u0026#34;); // åˆ é™¤æ•°æ® EditorPrefs.DeleteKey(\u0026#34;MyTool_LastFilePath\u0026#34;); // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ if (EditorPrefs.HasKey(\u0026#34;MyTool_UseDarkTheme\u0026#34;)) Debug.Log(\u0026#34;æš—è‰²ä¸»é¢˜è®¾ç½®å­˜åœ¨\u0026#34;); } } 3.7 MonoBehaviour.OnGUI ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¹Ÿä¸ç®— Editor å¼€å‘ï¼Œä½†æ˜¯è¿™ä¸ªå¾ˆé€‚åˆåˆ¶ä½œä¸€äº›æµ‹è¯•ç”¨åªåœ¨ Editor è¿è¡Œæ¸¸æˆæ—¶ä½¿ç”¨çš„æŒ‰é’®ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š\nusing UnityEngine; public class TestMonoOnGUI : MonoBehaviour { #if UNITY_EDITOR void OnGUI() { if (GUI.Button(new Rect(10, 10, 100, 30), \u0026#34;Click Me\u0026#34;)) { Debug.Log(\u0026#34;æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼\u0026#34;); } } #endif } è¿è¡Œåèƒ½å‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”è¿™ä¸ªæŒ‰é’®å› ä¸ºå®é™åˆ¶åœ¨äº†åªèƒ½ç”¨äºç¼–è¾‘å™¨è¿è¡Œçš„æƒ…å†µï¼Œä¸ä¼šå½±å“æ­£å¼æ¸¸æˆã€‚\n4 MenuItem 4.1 é¡¶éƒ¨èœå•æ  MenuItem æ˜¯ Unity æä¾›çš„ä¸€ä¸ª ç¼–è¾‘å™¨æ³¨è§£ï¼Œç”¨äºåœ¨èœå•æ æˆ–å³é”®èœå•ä¸­æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½ã€‚\nå¦‚æœè·¯å¾„æ˜¯ä¸ä»¥ Assets/ æˆ– GameObject/ å¼€å¤´ï¼ŒUnity ä¼šæŠŠå®ƒæ”¾åœ¨é¡¶éƒ¨èœå•æ ã€‚\nusing UnityEditor; using UnityEngine; public class MenuExample { [MenuItem(\u0026#34;Tools/Print Message\u0026#34;)] public static void PrintMessage() { Debug.Log(\u0026#34;Hello from Tools menu!\u0026#34;); } [MenuItem(\u0026#34;Tools/Print Message\u0026#34;, true)] // éªŒè¯å‡½æ•°ï¼ˆç”¨äºå¯ç”¨/ç¦ç”¨èœå•é¡¹ï¼‰ public static bool ValidatePrintMessage() { return Application.isPlaying == false; // ä»…åœ¨éè¿è¡ŒçŠ¶æ€å¯ç”¨ } } åœ¨ä¸Šæ–¹å‡ºç°ï¼š\nè¯´æ˜ï¼š\n[MenuItem(\u0026ldquo;Tools/Print Message\u0026rdquo;)] ä¼šåœ¨ Unity èœå•æ çš„ Tools ä¸‹æ·»åŠ ä¸€ä¸ª â€œPrint Messageâ€ èœå•é¡¹ã€‚ [MenuItem(\u0026quot;è·¯å¾„\u0026quot;, true)] å¸¦æœ‰ true å‚æ•°çš„è¡¨ç¤ºåŒåæ–¹æ³•æ˜¯éªŒè¯å‡½æ•°ï¼Œç”¨æ¥æ§åˆ¶èœå•æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœè¿”å› false é‚£ä¹ˆä¼šæ˜¯ç°è‰² ä¸å¯ç‚¹å‡»çŠ¶æ€ ã€‚ æ–¹æ³•å¿…é¡»æ˜¯ staticã€‚ ç¬¬ä¸‰é¡¹æ˜¯ ä¼˜å…ˆçº§ ï¼Œæ§åˆ¶èœå•åœ¨åŒçº§èœå•ä¸­çš„æ’åºï¼Œæ•°å­—è¶Šå°è¶Šé ä¸Šã€‚\n[MenuItem(\u0026#34;Tools/Print Debug\u0026#34;, false, 10)] 4.2 å³é”®èœå•æ  Assets/ å¼€å¤´å¯ä»¥åœ¨ Project çª—å£ä¸­å³é”®å‡ºç°ï¼Œè€Œ GameObject/ å¼€å¤´å¯ä»¥åœ¨ Hierarchy é‡Œé¢å‡ºç°ã€‚\nè¿™é‡Œå®ç°ä¸‹é¢ä¸€ä¸ªåŠŸèƒ½ï¼š\nåœ¨ Project çª—å£å³é”®æ–‡ä»¶å¤¹æ—¶æ˜¾ç¤ºèœå•ï¼Œå¤šé€‰æ—¶ä¹Ÿèƒ½ç”Ÿæ•ˆï¼Œå¹¶å¯¹æ–‡ä»¶å¤¹åå­—åŠ ä¸Š test- å‰ç¼€ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰ using UnityEngine; using UnityEditor; public class AddTestPrefix { // å³é”®èœå•æ˜¾ç¤ºåœ¨ Project çª—å£æ–‡ä»¶å¤¹ä¸Š [MenuItem(\u0026#34;Assets/Add Test Prefix\u0026#34;, true)] private static bool ValidateAddTestPrefix() { // åªå…è®¸é€‰ä¸­æ–‡ä»¶å¤¹ foreach (var obj in Selection.objects) { string path = AssetDatabase.GetAssetPath(obj); if (!AssetDatabase.IsValidFolder(path)) return false; } return Selection.objects.Length \u0026gt; 0; } [MenuItem(\u0026#34;Assets/Add Test Prefix\u0026#34;)] private static void AddPrefix() { foreach (var obj in Selection.objects) { string path = AssetDatabase.GetAssetPath(obj); if (!AssetDatabase.IsValidFolder(path)) continue; string folderName = System.IO.Path.GetFileName(path); if (!folderName.StartsWith(\u0026#34;test\u0026#34;)) { string newFolderName = \u0026#34;test-\u0026#34; + folderName; string parentPath = System.IO.Path.GetDirectoryName(path).Replace(\u0026#34;\\\\\u0026#34;, \u0026#34;/\u0026#34;); string newPath = parentPath + \u0026#34;/\u0026#34; + newFolderName; AssetDatabase.RenameAsset(path, newFolderName); Debug.Log($\u0026#34;Renamed folder: {folderName} -\u0026gt; {newFolderName}\u0026#34;); } } AssetDatabase.SaveAssets(); AssetDatabase.Refresh(); } } æ¼”ç¤ºï¼š\n4. é£æ ¼ç¾åŒ– 4.1 True/False å˜å¼€å…³æŒ‰é’® å¦‚æœæˆ‘ä»¬æœŸæœ›å®ç°ä¸€ä¸ªå¼€å…³æŒ‰é’®ï¼Œè€Œä¸æ˜¯å‹¾é€‰ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿ\nåŒ…æ‹¬æ°´å¹³å¸ƒå±€ï¼Œæ›´æ”¹æŒ‰é’®çš„èƒŒæ™¯é¢œè‰²ï¼Œ\nä»£ç ï¼š\nusing UnityEditor; using UnityEngine; [CustomEditor(typeof(PlayerSettings))] public class PlayerSettingsEditor : Editor { private SerializedProperty moveSpeed; private SerializedProperty playerName; private SerializedProperty playerColor; private SerializedProperty isGodMode; private void OnEnable() { moveSpeed = serializedObject.FindProperty(\u0026#34;moveSpeed\u0026#34;); playerName = serializedObject.FindProperty(\u0026#34;playerName\u0026#34;); playerColor = serializedObject.FindProperty(\u0026#34;playerColor\u0026#34;); isGodMode = serializedObject.FindProperty(\u0026#34;isGodMode\u0026#34;); } public override void OnInspectorGUI() { serializedObject.Update(); // åŸºç¡€å±æ€§ EditorGUILayout.PropertyField(playerName); EditorGUILayout.PropertyField(moveSpeed); EditorGUILayout.PropertyField(playerColor); EditorGUILayout.Space(); // ----------------- æŒ‰é’®é å³ ----------------- EditorGUILayout.BeginHorizontal(); // å·¦ä¾§æ ‡ç­¾ EditorGUILayout.LabelField(\u0026#34;God Mode\u0026#34;); // ä¸­é—´å ä½ï¼Œä½¿æŒ‰é’®é å³ GUILayout.FlexibleSpace(); // å³ä¾§æŒ‰é’® GUI.backgroundColor = isGodMode.boolValue ? Color.green : Color.red; if (GUILayout.Button(isGodMode.boolValue ? \u0026#34;ON\u0026#34; : \u0026#34;OFF\u0026#34;, GUILayout.Width(50))) { isGodMode.boolValue = !isGodMode.boolValue; EditorUtility.SetDirty(target); } EditorGUILayout.EndHorizontal(); serializedObject.ApplyModifiedProperties(); } } 4.2 å…¨å±€æ ·å¼æ›¿æ¢ ä¹Ÿè®¸ä½ ä¼šæƒ³è¯´ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½æŠŠæ‰€æœ‰åœ°æ–¹çš„ bool éƒ½æ›¿æ¢äº†ï¼Ÿ\nEditor ç¡®å®ç»™äº†æˆ‘ä»¬è¿™ç§æ¥å£ï¼š\nä»£ç ï¼š\nusing UnityEditor; using UnityEngine; // âœ… ä½œç”¨äºæ‰€æœ‰ bool å­—æ®µ [CustomPropertyDrawer(typeof(bool))] public class GlobalBoolButtonDrawer : PropertyDrawer { public override void OnGUI(Rect position, SerializedProperty property, GUIContent label) { // åªå¤„ç† bool if (property.propertyType != SerializedPropertyType.Boolean) { EditorGUI.PropertyField(position, property, label, true); return; } // ---------------- ç»˜åˆ¶å¸ƒå±€ ---------------- var labelRect = new Rect(position.x, position.y, EditorGUIUtility.labelWidth, position.height); var buttonRect = new Rect(position.x + EditorGUIUtility.labelWidth + 5, position.y, 50, position.height); // æ ‡ç­¾ EditorGUI.LabelField(labelRect, label); // æŒ‰é’®é¢œè‰² var oldColor = GUI.backgroundColor; GUI.backgroundColor = property.boolValue ? Color.green : Color.red; // æŒ‰é’®æ ·å¼ if (GUI.Button(buttonRect, property.boolValue ? \u0026#34;ON\u0026#34; : \u0026#34;OFF\u0026#34;)) { property.boolValue = !property.boolValue; } GUI.backgroundColor = oldColor; } public override float GetPropertyHeight(SerializedProperty property, GUIContent label) { return EditorGUIUtility.singleLineHeight + EditorGUIUtility.standardVerticalSpacing; } } å›åˆ°ç•Œé¢ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿ Event System è¿™ç§åœ°æ–¹ï¼Œä¹Ÿç›´æ¥æ”¹äº†ï¼š\n4.3 Hierarchy ç¾åŒ– åˆ©ç”¨ EditorApplication.hierarchyWindowItemOnGUI å¯ä»¥å®ç°ç»˜åˆ¶ Hierarchy çš„æ—¶å€™è¿›è¡Œä¸€äº›è‡ªå®šä¹‰æ“ä½œã€‚\nä¾‹å¦‚å®ç°ä¸‹é¢çš„å˜è‰²åŠŸèƒ½ï¼š\né…åˆæŒä¹…åŒ–å®ç°æ”¹å˜è‰²å½©åŠŸèƒ½ã€‚\nä»£ç ï¼š\nusing UnityEditor; using UnityEngine; [InitializeOnLoad] public class HierarchyCustomDrawer { private const string PrefixName = \u0026#34;:\u0026#34;; // EditorPrefs Key private const string BackgroundColorKey = \u0026#34;HierarchyBackgroundColor\u0026#34;; private const string TextColorKey = \u0026#34;HierarchyTextColor\u0026#34;; // é»˜è®¤é¢œè‰² public static Color BackgroundColor = Color.magenta; public static Color TextColor = Color.white; static HierarchyCustomDrawer() { LoadColors(); EditorApplication.hierarchyWindowItemOnGUI -= OnHierarchyGUI; EditorApplication.hierarchyWindowItemOnGUI += OnHierarchyGUI; } private static void LoadColors() { // è¯»å–èƒŒæ™¯è‰² string bgStr = EditorPrefs.GetString(BackgroundColorKey, \u0026#34;FF00FF\u0026#34;); // é»˜è®¤ç´«è‰² if (!ColorUtility.TryParseHtmlString(\u0026#34;#\u0026#34; + bgStr, out BackgroundColor)) { BackgroundColor = Color.magenta; } // è¯»å–æ–‡å­—è‰² string textStr = EditorPrefs.GetString(TextColorKey, \u0026#34;FFFFFF\u0026#34;); // é»˜è®¤ç™½è‰² if (!ColorUtility.TryParseHtmlString(\u0026#34;#\u0026#34; + textStr, out TextColor)) { TextColor = Color.white; } } static void OnHierarchyGUI(int instanceID, Rect selectionRect) { GameObject obj = EditorUtility.InstanceIDToObject(instanceID) as GameObject; if (obj == null) return; if (obj.name.StartsWith(PrefixName)) { // ç»˜åˆ¶èƒŒæ™¯ Rect backgroundRect = new Rect(0, selectionRect.y, Screen.width, selectionRect.height); EditorGUI.DrawRect(backgroundRect, BackgroundColor); // ç»˜åˆ¶æ–‡å­— string name = obj.name.Substring(PrefixName.Length).Trim(); GUIStyle style = new GUIStyle(EditorStyles.label) { alignment = TextAnchor.MiddleCenter, fontStyle = FontStyle.Bold, wordWrap = true, normal = { textColor = TextColor } }; EditorGUI.LabelField(backgroundRect, name, style); } } // èœå•æ‰“å¼€çª—å£ [MenuItem(\u0026#34;Tools/Hierarchy é«˜äº®è®¾ç½®\u0026#34;)] public static void OpenColorSettings() { HierarchyColorWindow.ShowWindow(); } } public class HierarchyColorWindow : EditorWindow { private Color backgroundColor; private Color textColor; public static void ShowWindow() { var window = GetWindow\u0026lt;HierarchyColorWindow\u0026gt;(\u0026#34;Hierarchy é«˜äº®è®¾ç½®\u0026#34;); window.minSize = new Vector2(250, 100); window.LoadCurrentColors(); } private void LoadCurrentColors() { backgroundColor = HierarchyCustomDrawer.BackgroundColor; textColor = HierarchyCustomDrawer.TextColor; } private void OnGUI() { GUILayout.Label(\u0026#34;è‡ªå®šä¹‰ Hierarchy é«˜äº®é¢œè‰²\u0026#34;, EditorStyles.boldLabel); backgroundColor = EditorGUILayout.ColorField(\u0026#34;èƒŒæ™¯è‰²\u0026#34;, backgroundColor); textColor = EditorGUILayout.ColorField(\u0026#34;æ–‡å­—è‰²\u0026#34;, textColor); if (GUILayout.Button(\u0026#34;åº”ç”¨\u0026#34;)) { // ä¿å­˜åˆ° EditorPrefsï¼ˆå­—ç¬¦ä¸²ï¼‰ EditorPrefs.SetString(\u0026#34;HierarchyBackgroundColor\u0026#34;, ColorUtility.ToHtmlStringRGBA(backgroundColor)); EditorPrefs.SetString(\u0026#34;HierarchyTextColor\u0026#34;, ColorUtility.ToHtmlStringRGBA(textColor)); // æ›´æ–°é™æ€å˜é‡ HierarchyCustomDrawer.BackgroundColor = backgroundColor; HierarchyCustomDrawer.TextColor = textColor; // åˆ·æ–° Hierarchy EditorApplication.RepaintHierarchyWindow(); } } } 4.4 è®¾ç½®ç»„ä»¶å›¾æ ‡ ä½¿ç”¨ EditorGUIUtility.SetIconForObject æ¥ç»™ä¸€ä¸ªèµ„äº§è®¾ç½®å›¾æ ‡ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸´æ—¶çš„ï¼Œé‡æ–°æ‰“å¼€å°±æ²¡äº†ã€‚\næ­£ç¡®çš„æ–¹æ³•æ˜¯ç”¨ MonoImporter.SetIcon å’Œ monoImporter.SaveAndReimport æ¥æŒä¹…åŒ–ï¼Œè¿™æ ·åŒæ—¶ç»„ä»¶å›¾æ ‡ä¹Ÿæ”¹äº†ã€‚\nç»„ä»¶ä¸­æ ·å¼ï¼š\nä»£ç ï¼š\nusing UnityEngine; using UnityEditor; public class AssetIconSelectorWindow : EditorWindow { private Texture2D selectedIcon; [MenuItem(\u0026#34;Tools/Set Asset Icon Window\u0026#34;)] public static void ShowWindow() { GetWindow\u0026lt;AssetIconSelectorWindow\u0026gt;(\u0026#34;Set Asset Icon\u0026#34;); } private void OnGUI() { GUILayout.Label(\u0026#34;æ‰¹é‡è®¾ç½®èµ„äº§å›¾æ ‡\u0026#34;, EditorStyles.boldLabel); // è·å–å½“å‰é€‰ä¸­çš„æ‰€æœ‰èµ„äº§ Object[] selectedAssets = Selection.objects; // æ˜¾ç¤ºé€‰ä¸­çš„èµ„äº§åˆ—è¡¨ if (selectedAssets.Length == 0) { EditorGUILayout.LabelField(\u0026#34;æœªé€‰æ‹©èµ„äº§\u0026#34;); } else { EditorGUILayout.LabelField($\u0026#34;é€‰ä¸­ {selectedAssets.Length} ä¸ªèµ„äº§ï¼š\u0026#34;); foreach (Object asset in selectedAssets) { EditorGUILayout.LabelField(\u0026#34; - \u0026#34; + asset.name); } } // é€‰æ‹©å›¾æ ‡ selectedIcon = (Texture2D)EditorGUILayout.ObjectField(\u0026#34;å›¾æ ‡\u0026#34;, selectedIcon, typeof(Texture2D), false); GUILayout.Space(10); if (GUILayout.Button(\u0026#34;åº”ç”¨å›¾æ ‡åˆ°é€‰ä¸­èµ„äº§\u0026#34;)) { ApplyIcon(selectedAssets); } } private void ApplyIcon(Object[] assets) { if (assets == null || assets.Length == 0) { EditorUtility.DisplayDialog(\u0026#34;é”™è¯¯\u0026#34;, \u0026#34;è¯·å…ˆåœ¨ Project é¢æ¿é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªèµ„äº§\u0026#34;, \u0026#34;ç¡®å®š\u0026#34;); return; } if (selectedIcon == null) { EditorUtility.DisplayDialog(\u0026#34;é”™è¯¯\u0026#34;, \u0026#34;è¯·é€‰æ‹©ä¸€ä¸ªå›¾æ ‡\u0026#34;, \u0026#34;ç¡®å®š\u0026#34;); return; } int appliedCount = 0; foreach (Object asset in assets) { string path = AssetDatabase.GetAssetPath(asset); if (string.IsNullOrEmpty(path)) continue; // æŒä¹…åŒ–è®¾ç½® var importer = AssetImporter.GetAtPath(path) as MonoImporter; if (importer != null) { importer.SetIcon(selectedIcon); importer.SaveAndReimport(); appliedCount++; } } EditorUtility.DisplayDialog(\u0026#34;å®Œæˆ\u0026#34;, $\u0026#34;å›¾æ ‡å·²åº”ç”¨åˆ° {appliedCount} ä¸ªèµ„äº§\u0026#34;, \u0026#34;ç¡®å®š\u0026#34;); } } 5. è‡ªå®šä¹‰ç±»å‹ ä¸€ä¸ªæå…¶å¸¸è§çš„éœ€æ±‚ï¼šå¯¼å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ \u0026ldquo;.vrm\u0026rdquo; ç­‰ã€‚è¿™äº›æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿ\nè¿™é‡Œä»¥ \u0026ldquo;.hhh\u0026rdquo; ä¸ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œåªæœ‰ 2 è¡Œï¼Œç¬¬ä¸€è¡Œè¡¨ç¤º nameï¼Œç¬¬äºŒè¡Œè¡¨ç¤º description ã€‚\n5.1 ScriptableObject å¯¼å…¥çš„æ–‡ä»¶å®é™…ä¸Šä¸Šé¢çš„å¥—äº†ä¸€ä¸ª ScriptableObject æ‰èƒ½æ˜¾ç¤ºï¼Œè¿™é‡Œåˆ›å»º 2 ä¸ª ScriptableObjectï¼Œå°†åˆ†åˆ«ä½œä¸º .hhh çš„ä¸»å¯¹è±¡ï¼Œå’Œéä¸»å¯¹è±¡ã€‚\nusing UnityEngine; [CreateAssetMenu(fileName = \u0026#34;NewHHHFile\u0026#34;, menuName = \u0026#34;Custom/HHH File\u0026#34;)] public class HHHFile : ScriptableObject { public string nameLine; public string descriptionLine; } public class HHHName : ScriptableObject { public string nameLine; } 5.2 AssetImporter è§£æ ç„¶ååœ¨æ–‡ä»¶å¯¼å…¥æ—¶ï¼Œé€šè¿‡å†™ ScriptedImporter å¯ä»¥å®ç°è§£æè¿‡ç¨‹ã€‚\nåˆ›å»ºäº† HHHFile å®ä¾‹å¹¶è¯»å– name å’Œ descriptionï¼Œç„¶åå°†è¿™ä¸ªå®ä¾‹è®¾ç½®ä¸ºä¸»å¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½®äº†å›¾æ ‡ã€‚\nåŒæ—¶åˆ›å»ºäº†ä¸€ä¸ª HHHName å®ä¾‹ï¼Œå¹¶è®¾ç½®ä¸ºéä¸»å¯¹è±¡ã€‚\nusing UnityEngine; using UnityEditor; using UnityEditor.AssetImporters; using System.IO; [ScriptedImporter(1, \u0026#34;hhh\u0026#34;)] public class HHHImporter : ScriptedImporter { public override void OnImportAsset(AssetImportContext ctx) { // è¯»å–æ–‡ä»¶å†…å®¹ string[] lines = File.ReadAllLines(ctx.assetPath); // 1ï¸âƒ£ ä¸»å¯¹è±¡ HHHFile HHHFile mainAsset = ScriptableObject.CreateInstance\u0026lt;HHHFile\u0026gt;(); mainAsset.nameLine = lines.Length \u0026gt; 0 ? lines[0] : \u0026#34;\u0026#34;; mainAsset.descriptionLine = lines.Length \u0026gt; 1 ? lines[1] : \u0026#34;\u0026#34;; ctx.AddObjectToAsset(\u0026#34;HHHFile\u0026#34;, mainAsset); ctx.SetMainObject(mainAsset); // è®¾ç½®ä¸»å¯¹è±¡å›¾æ ‡ Texture2D mainIcon = AssetDatabase.LoadAssetAtPath\u0026lt;Texture2D\u0026gt;(\u0026#34;Assets/Icons/hhh_icon.png\u0026#34;); if (mainIcon != null) { EditorGUIUtility.SetIconForObject(mainAsset, mainIcon); } // 2ï¸âƒ£ éä¸»å¯¹è±¡ HHHName HHHName subAsset = ScriptableObject.CreateInstance\u0026lt;HHHName\u0026gt;(); subAsset.nameLine = mainAsset.nameLine; ctx.AddObjectToAsset(subAsset.nameLine, subAsset); // è®¾ç½®éä¸»å¯¹è±¡å›¾æ ‡ Texture2D subIcon = AssetDatabase.LoadAssetAtPath\u0026lt;Texture2D\u0026gt;(\u0026#34;Assets/Icons/wrench.png\u0026#34;); if (subIcon != null) { EditorGUIUtility.SetIconForObject(subAsset, subIcon); } } } å¯¼å…¥åæ•ˆæœï¼š\nèƒ½å¤Ÿåœ¨å³ä¾§æŸ¥çœ‹ Inspectorï¼š\nè¿™é‡Œæ·»åŠ äº†ä¸€ä¸ª Inspector CustomEditorï¼Œå’Œå‰é¢ä»‹ç»çš„ç¾åŒ–æ–¹å¼æ˜¯ä¸€ä¸ªæ„æ€ï¼Œä½œç”¨åªæ˜¯å‘Šè¯‰ä½ è¿™ä¸ª HHHFile ä¸€æ ·æ˜¯å¯ä»¥è‡ªå®šä¹‰ Inspector çš„ã€‚\nusing UnityEditor; [CustomEditor(typeof(HHHFile))] public class HHHFileInspector : Editor { public override void OnInspectorGUI() { HHHFile hhh = (HHHFile)target; EditorGUILayout.LabelField(\u0026#34;Name\u0026#34;, hhh.nameLine); EditorGUILayout.Space(); EditorGUILayout.LabelField(\u0026#34;Description\u0026#34;, hhh.descriptionLine); } } 5.3 AssetPostprocessor ä»»ä½•èµ„äº§çš„å˜åŠ¨ï¼Œå³å¯¼å…¥ã€åˆ é™¤ã€ç§»åŠ¨ï¼Œéƒ½å¯ä»¥è§¦å‘ OnPostprocessAllAssetsã€‚é€šè¿‡å¯¹è¿™ä¸ªå‡½æ•°çš„ç¼–å†™ï¼Œèƒ½å¤Ÿå®ç°ä¸€äº›åå¤„ç†ï¼Œæ¯”å¦‚è‡ªåŠ¨è®¾ç½®å¯¼å…¥çš„å›¾ç‰‡ä¸º sprite ç­‰ã€‚\nusing UnityEngine; using UnityEditor; using System.IO; public class HHHFilePostprocessor : AssetPostprocessor { static void OnPostprocessAllAssets( string[] importedAssets, string[] deletedAssets, string[] movedAssets, string[] movedFromAssetPaths) { foreach (string path in importedAssets) { // åªå¤„ç† .hhh æ–‡ä»¶ if (Path.GetExtension(path) == \u0026#34;.hhh\u0026#34;) { // è¯»å–æ–‡ä»¶å†…å®¹ string[] lines = File.ReadAllLines(path); string nameLine = lines.Length \u0026gt; 0 ? lines[0] : \u0026#34;\u0026#34;; string descLine = lines.Length \u0026gt; 1 ? lines[1] : \u0026#34;\u0026#34;; // æ‰“å°æ—¥å¿— Debug.Log($\u0026#34;[HHHFilePostprocessor] å¯¼å…¥: {path}\\nName: {nameLine}\\nDescription: {descLine}\u0026#34;); } } } } å¯¼å…¥çš„æ—¶å€™å°±ä¼šæ‰“å°è¿™è¡Œä¿¡æ¯ï¼š\n6. éšæœºé¢œè‰² Just For Fun\nç»™æ–‡ä»¶ä¸€ä¸ªéšæœºçš„é¢œè‰²ï¼Œæ ¹æ®æ–‡ä»¶å Hash å”¯ä¸€ç¡®å®šã€‚\nusing System; using UnityEditor; using UnityEngine; [InitializeOnLoad] public static class ColorProjectWindowDecorator { static ColorProjectWindowDecorator() { EditorApplication.projectWindowItemOnGUI -= OnProjectWindowItemGUI; EditorApplication.projectWindowItemOnGUI += OnProjectWindowItemGUI; } private static void OnProjectWindowItemGUI(string guid, Rect rect) { string path = AssetDatabase.GUIDToAssetPath(guid); // åªé’ˆå¯¹ .cs æ–‡ä»¶ if (!path.EndsWith(\u0026#34;.cs\u0026#34;, StringComparison.OrdinalIgnoreCase)) return; // æå–æ–‡ä»¶å string fileName = System.IO.Path.GetFileNameWithoutExtension(path); // è®¡ç®—ä¸€ä¸ªç¡®å®šæ€§çš„å“ˆå¸Œå€¼ int hash = fileName.GetHashCode(); // å°†å“ˆå¸Œæ˜ å°„åˆ°é¢œè‰²ï¼ˆHSV -\u0026gt; RGBï¼‰ float hue = Mathf.Abs(hash % 360) / 360f; // è‰²ç›¸ float saturation = 0.6f + (Mathf.Abs(hash) % 40) / 100f; // 0.6~1.0 float value = 0.8f; // äº®åº¦å›ºå®š Color color = Color.HSVToRGB(hue, saturation, value); float size = Math.Min(rect.width, rect.height) * 0.7f; Rect dotRect = new Rect( rect.x + rect.width / 2f - size / 2f, rect.y + rect.height / 2f - size / 2f, size, size ); DrawCircle(dotRect, color); } private static void DrawCircle(Rect rect, Color color) { // ç”¨ Handles ç»˜åˆ¶åœ†å½¢ï¼ˆæ¯”æ–¹å½¢æ›´æŸ”å’Œï¼‰ Handles.BeginGUI(); Color oldColor = Handles.color; Handles.color = color; Handles.DrawSolidDisc(rect.center, Vector3.forward, rect.width / 2); Handles.color = oldColor; Handles.EndGUI(); } } ","permalink":"https://cronrpc.github.io/zh/posts/unity-editor-extensions/","summary":"\u003cp\u003eé¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œç¼–è¾‘å™¨å¼€å‘çš„çŸ¥è¯†è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ­£ç¡®çš„å­¦ä¹ æ–¹å¼è¿˜æ˜¯ä»å®è·µå…¥æ‰‹ï¼Œç”¨æŸ¥å·¥å…·ä¸€æ ·çš„æ–¹å¼å»å­¦ä¹ ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003ch2 id=\"1-unityç¼–è¾‘å™¨å¼€å‘å‰ç½®çŸ¥è¯†\"\u003e1. Unityç¼–è¾‘å™¨å¼€å‘å‰ç½®çŸ¥è¯†\u003c/h2\u003e\n\u003ch3 id=\"11-ä»€ä¹ˆæ˜¯æ³¨è§£attribute\"\u003e1.1 ä»€ä¹ˆæ˜¯æ³¨è§£ï¼ˆAttributeï¼‰ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eæ³¨è§£ï¼ˆAttributeï¼‰ æ˜¯ C# æä¾›çš„ä¸€ç§å…ƒæ•°æ®ï¼ˆMetadataï¼‰æœºåˆ¶ï¼Œç”¨äºåœ¨ç±»ã€æ–¹æ³•ã€å­—æ®µã€å±æ€§ç­‰ä¸Šé™„åŠ é¢å¤–çš„ä¿¡æ¯ã€‚\u003c/p\u003e","title":"Unity Editor Extensions"},{"content":"åœ¨ Unity å¼€å‘ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆç®¡ç†å’ŒåŠ è½½æ¸¸æˆèµ„æºï¼Œæ˜¯å†³å®šé¡¹ç›®æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§çš„é‡è¦å› ç´ ã€‚\nUnity è¿™äº›å¹´æ¥å…ˆåæ¨å‡ºäº†ä¸‰ç§ä¸»è¦çš„èµ„æºåŠ è½½æ–¹å¼ï¼š\nResources â†’ AssetBundles â†’ Addressablesã€‚\næ¯ä¸€ä»£ç³»ç»Ÿéƒ½åœ¨è§£å†³ä¸Šä¸€ä»£çš„å±€é™æ€§ã€‚\nä¸‹é¢æˆ‘ä»¬å°±ä»å®ƒä»¬çš„å†å²å’Œç‰¹ç‚¹å‡ºå‘ï¼Œä¸€æ­¥æ­¥è®²æ¸…æ¥šå®ƒä»¬çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯ã€‚\n1. Resources å½“ä½ åº¦è¿‡äº†åŸºæœ¬çš„æ–°æ‰‹æœŸï¼Œå¼€å§‹ç¼–å†™ä»£ç ä¹‹åï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå¸Œæœ›åˆ‡æ¢æ¸¸æˆå¯¹è±¡ï¼Œæˆ–è€…æè´¨ï¼Œéš¾é“æ¯æ¬¡éƒ½è¦å°†å®ƒæ‹–å…¥åˆ°æ¸¸æˆå¯¹è±¡çš„ç»„ä»¶ä¸Šå—ï¼Ÿ\næ¯”å¦‚ï¼Œæš´éœ²ä¸€ä¸ªå‚æ•°ï¼Œç„¶åæ‹–å…¥è¿›å»ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­å®ä¾‹åŒ–ã€‚\npublic class LoadFromPrefab : MonoBehaviour { public GameObject prefab; void Start() { if (prefab != null) { GameObject cubeObject = Instantiate(prefab, new Vector3(0, 0, 0), Quaternion.identity); } } } ä½†æ˜¯æ¯æ¬¡éƒ½è¦æ‹–æ¥æ‹–å»ï¼Œè¿™è‚¯å®šæ˜¯ä¸åˆé€‚çš„ï¼Œå°¤å…¶æ˜¯ä»£ç å¤æ‚ä¹‹åï¼Œæ¸¸æˆå¯¹è±¡çš„é€‰æ‹©ç«Ÿç„¶æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¸Šçš„ç»„ä»¶çš„ä¸´æ—¶ç»‘å®šï¼Œä¸ç¬¦åˆä½è€¦åˆé«˜å†…èšçš„ç‰¹ç‚¹ã€‚\nåœ¨æ—©æœŸ Unity ç‰ˆæœ¬ä¸­ï¼ŒResources æ–‡ä»¶å¤¹æ˜¯æœ€æ–¹ä¾¿çš„åŠ¨æ€åŠ è½½æ–¹å¼ï¼Œä»»ä½•æ”¾åœ¨åä¸º Resources æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºï¼Œéƒ½ä¼šè‡ªåŠ¨è¢«æ‰“åŒ…è¿›æ¸¸æˆä¸»åŒ…ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚\né¦–å…ˆåˆ›å»ºä¸€ä¸ª Prefab ï¼š\nåŠ è½½è¯­æ³•ç›´è§‚æ˜äº†ï¼Œåªéœ€è¦é€šè¿‡å…¶åœ¨ Resources æ–‡ä»¶å¤¹ä¸‹çš„ç›¸å¯¹è·¯å¾„æ¥å†³å®šï¼š\nusing UnityEngine; public class LoadFromResources : MonoBehaviour { void Start() { GameObject prefab = Resources.Load\u0026lt;GameObject\u0026gt;(\u0026#34;Cube\u0026#34;); GameObject cubeObject = Instantiate(prefab, new Vector3(0, 0, 0), Quaternion.identity); } } è¿è¡Œä¹‹åå°±å¯ä»¥åŠ è½½åˆ°æ¸¸æˆä¸­ï¼š\nä½†æ˜¯å®ƒçš„å±€é™æ€§æ˜¯éå¸¸æ˜æ˜¾çš„ï¼š\næ‰€æœ‰èµ„æºéƒ½ä¼šè¢«æ‰“è¿›ä¸»åŒ…ï¼Œæ— æ³•å•ç‹¬æ›´æ–°ã€‚\nä¸æ”¯æŒçƒ­æ›´æ–°æˆ–è¿œç¨‹åŠ è½½ã€‚\næ²¡æœ‰ä¾èµ–è¿½è¸ªä¸å†…å­˜æ§åˆ¶æœºåˆ¶ã€‚\næœ€åä¸€ç‚¹çš„ä¾èµ–ç¼ºå¤±æ˜¯æŒ‡ï¼Œä½ åŠ è½½å¯¹è±¡çš„æ—¶å€™ï¼Œå®ƒçš„æè´¨è´´å›¾éƒ½è¢«åŠ è½½äº†ï¼Œä½†æ˜¯è¿™äº›è´´å›¾æè´¨çš„ç”Ÿå‘½å‘¨æœŸ Resources æ˜¯ä¸ä¼šå¸®ä½ ç®¡ç†çš„ï¼Œæƒ³å¸è½½åªèƒ½é‡‡ç”¨ï¼š\nTexture2D tex = Resources.Load\u0026lt;Texture2D\u0026gt;(\u0026#34;Textures/Explosion\u0026#34;); Resources.UnloadAsset(tex); // å…¨å±€ Resources.UnloadUnusedAssets() å¹¶ä¸”å¦‚æœè´´å›¾è¢«å…¶ä»–åœ°æ–¹ä½¿ç”¨äº†ï¼Œè´´å›¾æ˜¯ä¸ä¼šå¸è½½çš„ã€‚\n2. AssetBundle ä¸ºäº†è®©èµ„æºèƒ½â€œåˆ†åŒ…åŠ è½½ã€è¿œç¨‹æ›´æ–°â€ï¼ŒUnity æ¨å‡ºäº† AssetBundleã€‚ å®ƒå…è®¸ä½ å°†èµ„æºæ‰“æˆç‹¬ç«‹çš„åŒ…ï¼Œå¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚\né¦–å…ˆéœ€è¦æ ‡è®°èµ„æºï¼Œåœ¨èµ„æºçš„ Inspector é¢æ¿åº•éƒ¨æ‰¾åˆ° AssetBundleï¼Œä¾‹å¦‚å‰æ–‡æåˆ°çš„ Cube æ–¹å—ä¸‹æ–¹æ‰¾åˆ°å®ƒã€‚\nè¿™é‡Œæœ‰2ä¸ªé€‰é¡¹å¯ä»¥è®¾ç½®ï¼Œä¸€ä¸ªæ˜¯ Bundle åç§°ï¼Œå¦‚æœé€‰æ‹© Noneï¼Œèµ„æºä¸ä¼šè¢«æ‰“åŒ…åˆ° AssetBundleã€‚\nåé¢çš„é‚£ä¸ªæ˜¯ä¸ºåŒä¸€ä¸ª AssetBundle åˆ›å»ºä¸åŒç‰ˆæœ¬ï¼ˆVariantï¼‰ï¼Œæ¯”å¦‚é«˜æ¸…æè´¨å’Œä½æ¸…æè´¨ï¼Œåˆæ¯”å¦‚ä¸­æ–‡å’Œè‹±æ–‡ã€‚\n2.1 æ‰“åŒ… åœ¨è®¾ç½®å¥½è¿™äº›é€‰é¡¹ä¹‹åï¼Œé€‰æ‹©ä¸€ä¸ªç›®å½•ï¼Œç”¨ä¸‹é¢çš„ä»£ç å°±å¯ä»¥å®ç°æ‰“åŒ…æ‰€æœ‰è¢«è®¾ç½®çš„èµ„æºï¼Œæœ€ç»ˆæ˜¯è¦æ”¾åœ¨ StreamingAssets ä¸‹çš„ï¼Œå› ä¸ºè¿™æ ·æ¸¸æˆæ„å»ºåæ‰èƒ½åœ¨æœ€ç»ˆçš„æ¸¸æˆç›®å½•ä¸­æ‰¾åˆ°ï¼š\nusing UnityEditor; using UnityEngine; public class ABBuilder { [MenuItem(\u0026#34;Build/Build AssetBundles\u0026#34;)] static void BuildAllAssetBundles() { string outputPath = Application.dataPath + \u0026#34;/StreamingAssets/AssetBundles\u0026#34;; if (Directory.Exists(outputPath)) { Directory.Delete(outputPath, true); Debug.Log(\u0026#34;æ¸…ç©ºæ—§çš„ AssetBundles ç›®å½•\u0026#34;); } Directory.CreateDirectory(outputPath); BuildPipeline.BuildAssetBundles( outputPath, BuildAssetBundleOptions.None, // å¯æ ¹æ®éœ€æ±‚é€‰æ‹©å‹ç¼©æ–¹å¼ BuildTarget.StandaloneWindows64 // æ ¹æ®å¹³å°é€‰æ‹© ); Debug.Log(\u0026#34;AssetBundle æ‰“åŒ…å®Œæˆï¼è·¯å¾„ï¼š\u0026#34; + outputPath); } } è¿™é‡Œæä¸€ä¸‹ï¼Œå°±æ˜¯æ‰“åŒ…ç”¨ä»£ç æ‰“åŒ…æ¯”è¾ƒéº»çƒ¦ï¼Œé€šå¸¸ç”¨ AssetBundles Browser æ¥åˆ›å»ºå’Œæµè§ˆ AssetBundleã€‚è¿™ä¸ªå·¥å…·çš„åº•å±‚ä¾ç„¶æ˜¯ä¸Šé¢çš„ä»£ç è¿›è¡Œæ‰“åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨æ­¤è¿‡å¤šä»‹ç»ã€‚\nè¿™ä¸ªå·¥å…·æ¥åŒæ—¶æä¾›äº†é¢„è§ˆåŠŸèƒ½ï¼Œå¸®åŠ©ä½ æŸ¥çœ‹ä¸€ä¸ªå·²ç»æ‰“å¥½çš„åŒ…çš„å†…éƒ¨æœ‰ä»€ä¹ˆã€‚\næ‰“åŒ…å®Œæ¯•åï¼Œå°±æœ‰äº†åŒ…ä½“èµ„æºï¼š\nå…¶ä¸­çš„ AssetBundles æ˜¯æ–‡ä»¶å¤¹çš„åå­—ï¼Œå®ƒåŒ…å«äº†ä¸‹é¢æ‰€æœ‰æ‰“çš„åŒ…çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ä¾èµ–ã€‚\nhome å°±æ˜¯å…·ä½“çš„äºŒè¿›åˆ¶èµ„æºåŒ…ã€‚\nhome.manifest è®°å½•äº†è¯¥ Bundle çš„ä¾èµ–å…³ç³»å’Œæ ¡éªŒä¿¡æ¯ã€‚\nAssetBundles.manifest è®°å½•äº†æ‰€æœ‰ Bundle çš„ä¾èµ–å…³ç³»ã€å˜ä½“ï¼ˆVariantï¼‰ã€å“ˆå¸Œå€¼ã€ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼Œç”¨äºåŠ è½½å’Œç®¡ç†ä¾èµ–ã€‚\nç„¶åå°±æ˜¯åŠ è½½å’Œä½¿ç”¨ï¼Œå› ä¸ºæ‰“å‡ºæ¥çš„åŒ…å« home.cnï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨å®ƒ\nusing System.IO; using UnityEngine; public class LoadFromAssetBundle : MonoBehaviour { private void Start() { string selectedBundle = \u0026#34;home.cn\u0026#34;; AssetBundle ab = AssetBundle.LoadFromFile(Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles\u0026#34;, selectedBundle)); GameObject cubePrefab = ab.LoadAsset\u0026lt;GameObject\u0026gt;(\u0026#34;Cube\u0026#34;); Instantiate(cubePrefab); } } æ•ˆæœï¼š\n2.2 å˜ç§åŒ… å¦‚æœæˆ‘ä»¬å¸Œæœ›æ ¹æ®å‰ç¼€æ¥æ‰¾åˆ°å˜ç§åŒ…ï¼Œå¯ä»¥é€šè¿‡æœç´¢æ‰€æœ‰åŒ¹é…çš„åŒ…çš„åŒ…åæ¥æ‰¾åˆ°ï¼Œå…ˆåŠ è½½æ–‡ä»¶å¤¹åŒåçš„ AssetBundlesï¼Œç„¶ååŠ è½½å…¶ä¸­çš„èµ„äº§ AssetBundleManifestï¼Œè°ƒç”¨ GetAllAssetBundlesWithVariant å°±å¯ä»¥è·å–æ‰€æœ‰å˜ç§ï¼Œç„¶åé€ååŒ¹é…ã€‚\nusing System.IO; using UnityEngine; public class LoadFromAssetBundle : MonoBehaviour { private void Start() { string manifestPath = Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles/AssetBundles\u0026#34;); AssetBundle manifestBundle = AssetBundle.LoadFromFile(manifestPath); AssetBundleManifest manifest = manifestBundle.LoadAsset\u0026lt;AssetBundleManifest\u0026gt;(\u0026#34;AssetBundleManifest\u0026#34;); string[] bundlesWithVariant = manifest.GetAllAssetBundlesWithVariant(); string targetBundleName = \u0026#34;home\u0026#34;; string selectedBundle = targetBundleName; foreach (var bundle in bundlesWithVariant) { if (bundle.StartsWith(targetBundleName + \u0026#34;.\u0026#34;)) { selectedBundle = bundle; // é€‰ä¸­ cn ç‰ˆæœ¬ Debug.Log(\u0026#34;Selected Bundle: \u0026#34; + selectedBundle); break; } } } } å®ƒæ˜¯å¯ä»¥è‡ªåŠ¨æ‰¾åˆ°æ‰€æœ‰ä¾èµ–çš„ï¼š\n2.3 åŒ…ä¾èµ– ç»™ Cube ä¸Šä¸€ä¸ªæè´¨ï¼Œåˆ†é…ç›¸åŒçš„ Bundleï¼š\nåœ¨ home.cn.manifest ä¸­æ˜¯èƒ½å¤Ÿçœ‹åˆ°æ‰“åŒ…äº†æè´¨å’Œ Prefab è¿›å»ã€‚\n- Assets/Resources/CubeMaterial.mat - Assets/Resources/Cube.prefab å¦‚æœåˆ†é…ç»™ä¸åŒçš„ Bundle ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ\nä¼šå‘ç”Ÿæè´¨ä¸¢å¤±çš„æ•ˆæœï¼Œè¡¨ç°ä¸ºç´«è‰²ï¼š\nè¿˜è®°å¾—å‰é¢æˆ‘ä»¬ä»ä¸»åŒ…ä¸­æ‰¾åˆ°æ‰€æœ‰å˜ä½“å—ï¼Ÿå…¶å®é™¤äº†è¿™ä¸ªä¹‹å¤–ï¼Œä¸»åŒ…ä¸­çš„ manifest è¿˜åŒ…å«äº†æ‰€æœ‰çš„ä¾èµ–ï¼Œé€šè¿‡è¯»å–ä¾èµ–ï¼Œå°±èƒ½è‡ªåŠ¨åˆ†æåŒ…çš„ä¾èµ–ï¼Œå®ç°è½½å…¥æè´¨äº†ã€‚\nusing System.IO; using UnityEngine; public class LoadFromAssetBundle : MonoBehaviour { private void Start() { string manifestPath = Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles/AssetBundles\u0026#34;); AssetBundle manifestBundle = AssetBundle.LoadFromFile(manifestPath); AssetBundleManifest manifest = manifestBundle.LoadAsset\u0026lt;AssetBundleManifest\u0026gt;(\u0026#34;AssetBundleManifest\u0026#34;); string targetBundle = \u0026#34;home.cn\u0026#34;; string[] bundlesDependencies = manifest.GetAllDependencies(targetBundle); for (int i = 0; i \u0026lt; bundlesDependencies.Length; i++) { Debug.Log(bundlesDependencies[i]); AssetBundle.LoadFromFile(Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles\u0026#34;, bundlesDependencies[i])); } AssetBundle ab = AssetBundle.LoadFromFile(Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles\u0026#34;, targetBundle)); GameObject cubePrefab = ab.LoadAsset\u0026lt;GameObject\u0026gt;(\u0026#34;Cube\u0026#34;); Instantiate(cubePrefab); } } æ•ˆæœï¼š\n2.4 å¸è½½èµ„æº å‰é¢åªè°ˆäº†è½½å…¥ï¼Œæ²¡æœ‰è°ˆå¦‚ä½•å¸è½½èµ„æºã€‚\nç®€å•æ¥è¯´ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤å¸è½½åŒ…èµ„æºï¼š\nassetBundle.Unload(bool unloadAllLoadedObjects); å…¶ä¸­çš„ true å’Œ false çš„åŒºåˆ«åœ¨äºï¼š\nfalseï¼šåªå¸è½½ AssetBundle æ–‡ä»¶æœ¬èº«ï¼ˆé‡Šæ”¾ç£ç›˜å¥æŸ„ï¼‰ï¼Œä½†ä¸ä¼šæ¸…é™¤å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„å¯¹è±¡ã€‚ trueï¼šä¸ä»…å¸è½½ AssetBundle æ–‡ä»¶ï¼Œè¿˜ä¼š é”€æ¯æ‰€æœ‰é€šè¿‡è¯¥åŒ…åŠ è½½çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬æè´¨ã€è´´å›¾ã€Mesh ç­‰ï¼‰ã€‚ å¯¹äºæè´¨å’Œè´´å›¾æ¥è¯´ï¼Œä½¿ç”¨ true å¸è½½ä¼šå¯¼è‡´è¿™äº›èµ„æºè¢«é”€æ¯ï¼Œä»è€Œå‡ºç°ç²‰è‰²æè´¨ï¼ˆMissing Texture / Shaderï¼‰ çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºåœºæ™¯ä¸­çš„å¯¹è±¡ä»ç„¶å¼•ç”¨è¿™äº›å·²ç»è¢«é‡Šæ”¾çš„èµ„æºã€‚\nä½†æ˜¯å¦‚æœæ˜¯ä½¿ç”¨ Instantiate ç”Ÿæˆçš„ GameObjectï¼Œå¹¶ä¸ä¼šå¯¼è‡´è¿™ä¸ªç‰©ä½“ç«‹å³æ¶ˆå¤±ï¼Œå› ä¸º Instantiate å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ªèµ„æºçš„å‰¯æœ¬ã€‚ åªæ˜¯å‰¯æœ¬å†…éƒ¨å¼•ç”¨çš„æè´¨ã€è´´å›¾ç­‰èµ„æºå·²ç»è¢«å¸è½½ï¼Œå°±ä¼šå‡ºç°æ˜¾ç¤ºå¼‚å¸¸æˆ–å¼•ç”¨ä¸¢å¤±ã€‚\né€šå¸¸çš„åšæ³•æ˜¯ï¼š\n// ä½¿ç”¨å®Œåå¸è½½åŒ…æ–‡ä»¶ï¼Œä½†ä¿ç•™èµ„æº assetBundle.Unload(false); // å½“ç¡®è®¤æ‰€æœ‰èµ„æºéƒ½ä¸å†ä½¿ç”¨æ—¶å†å½»åº•é‡Šæ”¾ assetBundle.Unload(true); Resources.UnloadUnusedAssets(); // å¯è¿›ä¸€æ­¥æ¸…ç†æœªè¢«å¼•ç”¨çš„å¯¹è±¡ 2.5 å¼‚æ­¥åŠ è½½ å¼‚æ­¥åŠ è½½ AssetBundle æ–‡ä»¶ï¼š\nAssetBundleCreateRequest request = AssetBundle.LoadFromFileAsync(path); yield return request; AssetBundle bundle = request.assetBundle; å¼‚æ­¥åŠ è½½ Bundle ä¸­çš„èµ„æºï¼š\nAssetBundleRequest assetRequest = bundle.LoadAssetAsync\u0026lt;GameObject\u0026gt;(\u0026#34;Cube\u0026#34;); yield return assetRequest; GameObject prefab = assetRequest.asset as GameObject; Instantiate(prefab); 2.6 åŒ…ç®¡ç†å·¥å…·å®ä¾‹ æ³¨æ„æ¯ä¸ª bundle éƒ½æ˜¯åªèƒ½åŠ è½½ä¸€æ¬¡çš„ï¼Œé™¤éä½ å¸è½½äº†ã€‚æ‰€ä»¥é€šè¿‡ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·æ¥ç»Ÿä¸€ç®¡ç†è¿™äº›åŒ…æ˜¯æœ‰å¿…è¦çš„ã€‚\næŒ‰ç…§ä»¥ä¸‹åŸåˆ™æ¥ç¼–å†™ï¼š\nä½¿ç”¨ å•ä¾‹æ¨¡å¼ ç®¡ç†å”¯ä¸€å®ä¾‹ ä½¿ç”¨ä¸€ä¸ª å­—å…¸ è®°å½•å·²åŠ è½½çš„æ‰€æœ‰åŒ… æä¾› åŠ è½½ / å¸è½½ / å¸è½½æ‰€æœ‰ åŠŸèƒ½ï¼ˆä¸ºç®€åŒ–ï¼Œæœ¬ä¾‹éƒ½æ˜¯åŒæ­¥ç‰ˆæœ¬ï¼‰ using System.Collections.Generic; using System.IO; using UnityEngine; public class AssetBundleManager { // å•ä¾‹å®ä¾‹ private static AssetBundleManager _instance; public static AssetBundleManager Instance { get { if (_instance == null) _instance = new AssetBundleManager(); return _instance; } } // å·²åŠ è½½çš„æ‰€æœ‰ AssetBundle private Dictionary\u0026lt;string, AssetBundle\u0026gt; _loadedBundles = new Dictionary\u0026lt;string, AssetBundle\u0026gt;(); // åŸºç¡€è·¯å¾„ï¼ˆå¯ä»¥æ”¹æˆ Addressables æˆ–æœåŠ¡å™¨è·¯å¾„ï¼‰ private string _basePath = Path.Combine(Application.streamingAssetsPath, \u0026#34;AssetBundles\u0026#34;); private AssetBundleManager() { } // ç¦æ­¢å¤–éƒ¨æ„é€  /// \u0026lt;summary\u0026gt; /// åŠ è½½ä¸€ä¸ª AssetBundleï¼ˆåŒæ­¥ï¼‰ /// \u0026lt;/summary\u0026gt; public AssetBundle LoadBundle(string bundleName) { // å·²ç»åŠ è½½è¿‡å°±ç›´æ¥è¿”å› if (_loadedBundles.TryGetValue(bundleName, out AssetBundle bundle)) return bundle; string fullPath = Path.Combine(_basePath, bundleName); if (!File.Exists(fullPath)) { Debug.LogError($\u0026#34;AssetBundle ä¸å­˜åœ¨: {fullPath}\u0026#34;); return null; } bundle = AssetBundle.LoadFromFile(fullPath); if (bundle == null) { Debug.LogError($\u0026#34;åŠ è½½ AssetBundle å¤±è´¥: {bundleName}\u0026#34;); return null; } _loadedBundles[bundleName] = bundle; Debug.Log($\u0026#34;åŠ è½½ AssetBundle æˆåŠŸ: {bundleName}\u0026#34;); return bundle; } /// \u0026lt;summary\u0026gt; /// å¸è½½ä¸€ä¸ª AssetBundle /// \u0026lt;/summary\u0026gt; public void UnloadBundle(string bundleName, bool unloadAllObjects = false) { if (_loadedBundles.TryGetValue(bundleName, out AssetBundle bundle)) { bundle.Unload(unloadAllObjects); _loadedBundles.Remove(bundleName); Debug.Log($\u0026#34;å¸è½½ AssetBundle æˆåŠŸ: {bundleName}\u0026#34;); } } /// \u0026lt;summary\u0026gt; /// å¸è½½æ‰€æœ‰å·²åŠ è½½çš„ AssetBundle /// \u0026lt;/summary\u0026gt; public void UnloadAll(bool unloadAllObjects = false) { foreach (var kv in _loadedBundles) { kv.Value.Unload(unloadAllObjects); } _loadedBundles.Clear(); Debug.Log(\u0026#34;å·²å¸è½½æ‰€æœ‰ AssetBundle\u0026#34;); } } ä½¿ç”¨ç¤ºä¾‹\npublic class TestABManager : MonoBehaviour { private void Start() { // åŠ è½½åŒ… var ab = AssetBundleManager.Instance.LoadBundle(\u0026#34;home.cn\u0026#34;); if (ab != null) { GameObject cube = ab.LoadAsset\u0026lt;GameObject\u0026gt;(\u0026#34;Cube\u0026#34;); Instantiate(cube); } // å¸è½½å•ä¸ªåŒ… // AssetBundleManager.Instance.UnloadBundle(\u0026#34;home.cn\u0026#34;); // å¸è½½æ‰€æœ‰åŒ… // AssetBundleManager.Instance.UnloadAll(); } } 2.7 æœ‰ä»€ä¹ˆéº»çƒ¦çš„åœ°æ–¹ï¼Ÿ AssetBundle æ˜¯ä¸€ç§åº•å±‚ã€æ‰‹åŠ¨æ§åˆ¶çš„èµ„æºæ‰“åŒ…ä¸åŠ è½½æœºåˆ¶ï¼ŒåŠŸèƒ½å¼ºå¤§ä½†é™åˆ¶è¾ƒå¤šï¼š\nä¾èµ–éœ€æ‰‹åŠ¨ç®¡ç† éœ€è¦é€šè¿‡ AssetBundleManifest.GetAllDependencies() æ‰‹åŠ¨åŠ è½½ä¾èµ–ï¼Œå¸è½½æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ¤æ–­èµ„æºæ˜¯å¦ä»è¢«ä½¿ç”¨ã€‚Addressables å¼•å…¥äº†è‡ªåŠ¨å¼•ç”¨è®¡æ•°æœºåˆ¶æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚\nç¼ºä¹å¢é‡ä¸å·®åˆ†æ›´æ–° èµ„æºæ”¹åŠ¨åå¿…é¡»é‡æ–°æ‰“æ•´ä¸ª Bundleï¼Œæ²¡æœ‰å†…ç½®çš„å¢é‡æ›´æ–°æˆ–å·®åˆ†æœºåˆ¶ã€‚\næ‰“åŒ…æµç¨‹ç¹ç æ¯ä¸ªèµ„æºéƒ½éœ€æ‰‹åŠ¨è®¾ç½® AssetBundle åç§°ï¼Œæ‰“åŒ…å®¹æ˜“å‡ºé”™ï¼Œæµç¨‹ä¸ç›´è§‚ã€‚\næ— å†…å»ºç‰ˆæœ¬ä¸æ›´æ–°ç®¡ç† ä¸æ”¯æŒç‰ˆæœ¬å·ã€æ ¡éªŒã€æˆ– CDN ç¼“å­˜æ§åˆ¶ï¼Œéœ€è¦è‡ªè¡Œå®ç°æ›´æ–°ä¸æ ¡éªŒé€»è¾‘ã€‚\nå¹³å°ç›¸å…³æ€§å¼º ä¸åŒå¹³å°ï¼ˆWindows / Android / iOSï¼‰éœ€è¦åˆ†åˆ«æ‰“åŒ…ï¼Œæ— æ³•é€šç”¨ã€‚\nAssetBundle åŠŸèƒ½å¼ºå¤§ï¼Œä½†å¼€å‘å’Œç»´æŠ¤æˆæœ¬è¾ƒé«˜ï¼Œå°¤å…¶åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚\nä½†æ˜¯ç›®å‰ä¸ºæ­¢ï¼Œå¤§å¤šæ•°é¡¹ç›®è¿˜æ˜¯é‡‡ç”¨çš„ AssetBundleï¼Œå› ä¸ºè¿™äº›é¡¹ç›®éƒ½æ˜¯è€é¡¹ç›®ï¼Œç¨‹åºå‘˜ä»¬é€šè¿‡æ‰‹åŠ¨ç¼–å†™ä»£ç æŠŠä¸Šé¢çš„é—®é¢˜å·²ç»å¤„ç†å¥½äº†ï¼Œæ‰€ä»¥ä½ å»æ‰¾å·¥ä½œçœ‹åˆ°ç”¨ AssetBundle éå¸¸åˆç†ã€‚\nUnity å®˜æ–¹è€ƒè™‘åˆ°é‡å¤é€ è½®å­çš„é—®é¢˜ï¼Œæ¨å‡ºäº† Addressables ç³»ç»Ÿã€‚\n3. Addressables Unity çš„ Addressables æ˜¯åŸºäº AssetBundle çš„é«˜å±‚å°è£…ã€‚\nå®ƒç»§æ‰¿äº† AssetBundle çš„çµæ´»æ€§ï¼ŒåŒæ—¶è‡ªåŠ¨åŒ–äº†ä¾èµ–ç®¡ç†ã€å¼‚æ­¥åŠ è½½ã€è¿œç¨‹æ›´æ–°ç­‰ç¹çæµç¨‹ã€‚\n3.1 å®‰è£…å’Œåˆ›å»º Addressables åœ¨ Package Manager ä¸­æœç´¢ Addressablesï¼Œé€‰æ‹©å®‰è£…å³å¯è·å¾—è¯¥åŠŸèƒ½ã€‚\nåœ¨ Window ä¸­æ‰¾åˆ° asset manager ä¸­çš„ addressables groupsï¼Œæ‰“å¼€å³å¯åˆ›å»º Addressablesã€‚\nå¦‚æœåŸæœ¬æœ‰ Asset Bundleï¼Œä¼šæç¤ºä½ è½¬æ¢ã€‚\nå®é™…ä¸Šå°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œé¢å°±æ˜¯å„ç§é…ç½®æ–‡ä»¶ï¼Œè¿™äº›é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ ScriptableObjectsã€‚\nåœ¨ Prefab æˆ–è€…å…¶å®ƒèµ„äº§ä¸Šæ”¾å¯ä»¥æ‰¾åˆ°ä¸€ä¸ª Addressable çš„æŒ‰é’®ã€‚\nç‚¹å‡»åè¿™ä¸ªèµ„äº§å°±ä¼šæ·»åŠ åˆ° addressables groups ä¸­ï¼Œç¬¬ä¸€æ¬¡ç‚¹å‡»ä¼šè‡ªåŠ¨ä¹‹ä¸Šä¸Šé¢çš„åˆ›å»º Group çš„å·¥ä½œã€‚\nåœ¨ Group é‡Œé¢å¯ä»¥è¿›è¡Œå„ç§é€‰æ‹©ï¼š\nè¿™é‡Œé¢æœ€å…³é”®çš„æ˜¯ Addressable Nameï¼Œå¯ä»¥ç‚¹å‡»ç®€åŒ–æŒ‰é’®ç®€åŒ–è¿™ä¸ªå¯å¯»å€åï¼Œè¿™ä¸ª Addressable Name æ˜¯å”¯ä¸€çš„ï¼Œæ ¹æ®è¿™ä¸ªå°±å¯ä»¥ç¡®å®šæŒ‡å®šçš„èµ„äº§æ˜¯ä»€ä¹ˆã€‚\n3.2 ä½¿ç”¨ Addressables æ¯ä¸ª Addressables Asset éƒ½æ˜¯å¯ä»¥é€šè¿‡ä¸‹é¢çš„ AssetReference æ¥ç»‘å®šã€‚æœ‰æ³›å‹ç±»å‹å¯ä»¥æ”¯æŒå„ç§èµ„äº§ï¼ŒAssetReference æ˜¯é€šç”¨ä¸åŒºåˆ†å…·ä½“èµ„äº§ï¼Œå¦å¤–è¿˜æœ‰ä¸€äº›æŒ‡å®šç±»å‹çš„å†™æ³•ï¼š\npublic class LoadFromAddressable : MonoBehaviour { public AssetReference assetReference; public AssetReferenceGameObject assetReferenceGameObject; public AssetReferenceT\u0026lt;Material\u0026gt; assetReferenceMaterial; } ç„¶åå°±å¯ä»¥é€‰æ‹©ç±»å‹ï¼š\nä½¿ç”¨éœ€è¦ä½¿ç”¨å¼‚æ­¥åŠ è½½çš„æ–¹å¼ï¼Œç„¶åé€šè¿‡å®Œæˆæ—¶çš„å›è°ƒæ¥è·å–èµ„äº§ï¼Œå…·ä½“èµ„äº§é€šè¿‡ handle.Result è·å–ï¼š\nusing UnityEngine; using UnityEngine.AddressableAssets; using UnityEngine.ResourceManagement.AsyncOperations; public class LoadFromAddressable : MonoBehaviour { public AssetReference assetReference; private void Start() { AsyncOperationHandle\u0026lt;GameObject\u0026gt; handle = assetReference.LoadAssetAsync\u0026lt;GameObject\u0026gt;(); handle.Completed += HandleOnCompleted; } private void HandleOnCompleted(AsyncOperationHandle\u0026lt;GameObject\u0026gt; handle) { if (handle.Status == AsyncOperationStatus.Succeeded) { Instantiate(handle.Result); } } } è¿è¡Œåå°±å¯ä»¥çœ‹åˆ°å¯¹è±¡ï¼š\nå¯ä»¥ç®€å†™ï¼š\nusing UnityEngine; using UnityEngine.AddressableAssets; using UnityEngine.ResourceManagement.AsyncOperations; public class LoadFromAddressable : MonoBehaviour { public AssetReference assetReference; private void Start() { assetReference.LoadAssetAsync\u0026lt;GameObject\u0026gt;().Completed += handle =\u0026gt; { if (handle.Status == AsyncOperationStatus.Succeeded) { Instantiate(handle.Result); } }; } } è¿˜æœ‰ç§å†™æ³•ï¼Œæ˜¯ç›´æ¥é€šè¿‡ AssetReference æ¥åˆ¤æ–­ï¼ŒIsDone çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡ Asset ç›´æ¥è·å–è¿™ä¸ªèµ„æºï¼š\npublic class LoadFromAddressable : MonoBehaviour { public AssetReference assetReference; private void Start() { assetReference.LoadAssetAsync\u0026lt;GameObject\u0026gt;().Completed += handle =\u0026gt; { if (assetReference.IsDone) { Instantiate(assetReference.Asset as GameObject); } }; } } 3.3 ç”¨ Name æ–¹å¼ä½¿ç”¨èµ„äº§ ä¸Šé¢çš„éœ€è¦å¯è§†åŒ–ç»‘å®šï¼Œé€šå¸¸é¡¹ç›®ä¸­æ˜¯ç›´æ¥ç”¨ Addressable Name æ¥è·å–æŒ‡å®šèµ„äº§ï¼š\nusing UnityEngine; using UnityEngine.AddressableAssets; using UnityEngine.ResourceManagement.AsyncOperations; public class LoadFromAddressableByName : MonoBehaviour { [SerializeField] private string address = \u0026#34;MyPrefab\u0026#34;; // å¯¹åº” Addressables ä¸­çš„åœ°å€å private void Start() { // ä½¿ç”¨åœ°å€å­—ç¬¦ä¸²åŠ è½½ GameObject Addressables.LoadAssetAsync\u0026lt;GameObject\u0026gt;(address).Completed += OnAssetLoaded; } private void OnAssetLoaded(AsyncOperationHandle\u0026lt;GameObject\u0026gt; handle) { if (handle.Status == AsyncOperationStatus.Succeeded) { Instantiate(handle.Result); } else { Debug.LogError($\u0026#34;åŠ è½½å¤±è´¥: {address}\u0026#34;); } } } 3.3 Groupã€Addresssable Nameã€Label Group æ˜¯ Addressables çš„æ‰“åŒ…å’ŒåŠ è½½ç®¡ç†å•ä½ã€‚\næ¯ä¸ª Group ä¼šåœ¨æ„å»ºæ—¶ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ª AssetBundle æ–‡ä»¶ã€‚ Group æ§åˆ¶èµ„æºçš„æ‰“åŒ…ç­–ç•¥ï¼ˆå¦‚æœ¬åœ°/è¿œç¨‹ã€å‹ç¼©æ–¹å¼ã€æ„å»ºè·¯å¾„ã€åŠ è½½è·¯å¾„ç­‰ï¼‰ã€‚ ä¸€ä¸ªèµ„æºåªèƒ½å±äºä¸€ä¸ª Groupã€‚ Address æ˜¯èµ„æºçš„å”¯ä¸€è®¿é—®åç§°ã€‚\nAddress åœ¨æ•´ä¸ª Addressables é¡¹ç›®èŒƒå›´å†…å¿…é¡»å”¯ä¸€ã€‚ Groupã€Label éƒ½åªæ˜¯ç»„ç»‡å’Œåˆ†ç±»æ–¹å¼ï¼Œä¸ä¼šå½±å“ Address çš„å”¯ä¸€æ€§çº¦æŸã€‚ Label æ˜¯ä¸€ä¸ªå¯é€‰çš„åˆ†ç»„æ ‡è®°ï¼Œå¯ä»¥ç»™å¤šä¸ªèµ„æºæ‰“ç›¸åŒçš„æ ‡ç­¾ã€‚\nä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ã€‚ æ ‡ç­¾ç”¨äºæ‰¹é‡åŠ è½½æˆ–ç­›é€‰ï¼Œæ¯”å¦‚æˆ‘å°±æƒ³ä¸€å£æ°”åŠ è½½æ‰€æœ‰çš„æ•Œäºº åŠ è½½æ ‡ç­¾å’ŒåŠ è½½ address çš„è¯­æ³•æœ‰ä¸€ç‚¹åŒºåˆ«ï¼š\n// åŠ è½½å•ä¸ª Address Addressables.LoadAssetAsync\u0026lt;GameObject\u0026gt;(\u0026#34;MyCube\u0026#34;).Completed += OnLoaded; // æŒ‰ Label Addressables.LoadAssetsAsync\u0026lt;GameObject\u0026gt;(\u0026#34;Enemy\u0026#34;, obj =\u0026gt; { Instantiate(obj); }); // æŒ‰å¤šä¸ª Address List\u0026lt;string\u0026gt; addresses = new List\u0026lt;string\u0026gt;{\u0026#34;Goblin\u0026#34;, \u0026#34;Orc\u0026#34;}; Addressables.LoadAssetsAsync\u0026lt;GameObject\u0026gt;(addresses, obj =\u0026gt; { Instantiate(obj); }); æ€»ç»“æ¥è¯´ï¼ŒGroup åªæ˜¯æ‰“åŒ…çš„å½¢å¼ä¸Šçš„åˆ†ç»„ï¼ŒLabelå±äºæ ‡ç­¾åˆ†ç»„ï¼ŒçœŸæ­£å†³å®šèµ„æºçš„åªæœ‰ addressã€‚\nè‡³äº AssetBundle ä¸­çš„å˜ç§æ¦‚å¿µå·²ç»æ²¡æœ‰äº†ã€‚å› ä¸ºå˜ç§å®Œå…¨å¯ä»¥ç”¨ä¸åŒçš„ bundle å‘½åæˆ–èµ„äº§å‘½åæ¥ä»£æ›¿ï¼Œå®é™…ä¸Šç”¨ Name å°±å¯ä»¥åŒºåˆ†èµ„æºäº†ã€‚æ¯”å¦‚ image1_hd.png å’Œ image1_low.pngï¼Œä¸éœ€è¦åˆ»æ„å˜ç§ã€‚\n3.4 æœ¬åœ°æ›´æ–° é¦–å…ˆï¼Œæˆ‘ä»¬å°†æè´¨å’Œç”¨åˆ°è¿™ä¸ªæè´¨çš„é¢„åˆ¶ä½“éƒ½æ”¾å…¥ Group ä¸­ï¼š\nåˆæ¬¡å°†æè´¨è®¾ç½®ä¸ºç»¿è‰²ï¼š\nåˆæ¬¡æ„å»º Addressableï¼š\næ„å»ºä¹‹åå¯ä»¥æ‰“åŒ…æ•´ä¸ªæ¸¸æˆï¼Œæ­¤æ—¶æ‰“å¼€æ¸¸æˆæè´¨å°±æ˜¯ç»¿è‰²ã€‚\nç„¶åï¼Œåœ¨ç¼–è¾‘å™¨ä¸­æ›´æ”¹æè´¨çš„é¢œè‰²ï¼š\nä½¿ç”¨ Update a Previous Build æ¥å¢é‡æ„å»ºï¼š\næ›´æ–°ä¹‹ååœ¨ Asset Manager Test\\Library\\com.unity.addressables\\aa\\Windows ä¸‹çš„æ–‡ä»¶ä¼šå‘ç”Ÿæ›´æ”¹ï¼š\nç›´æ¥å…¨éƒ¨ç§»åŠ¨åˆ° StreamingAssets\\aa ä¸­ï¼Œæ³¨æ„è¿™é‡Œé’ˆå¯¹çš„æ˜¯ Windows å¹³å°ï¼Œå…¶ä»–å¹³å°æœ‰ä¸€äº›åŒºåˆ«ã€‚\næœ€åçš„æ•ˆæœï¼Œæ›¿æ¢åæ‰“å¼€æ¸¸æˆï¼Œå°±æ˜¯æ–°çš„æè´¨çš„é¢œè‰²ï¼š\n3.5 è¿œç¨‹æ›´æ–° å’Œ Catalog åœ¨ Addressable Profiles ä¸­ï¼Œè®¾ç½® Remote åœ°å€ï¼Œè¿™è¦æ˜¯ä¸€ä¸ªç½‘å€çš„å‰ç¼€ï¼Œæ¯”å¦‚è¿™é‡Œé‡‡ç”¨çš„æ˜¯æœ¬åœ°çš„ 8888ï¼šhttp://127.0.0.1:8888ã€‚\nç„¶åè¦å¼€å¯ remote çš„ Catalogã€‚\nCatalog æ˜¯ Addressables çš„èµ„æºç´¢å¼•æ–‡ä»¶ï¼Œå®ƒå‘Šè¯‰ç¨‹åºä»å“ªé‡ŒåŠ è½½èµ„æºï¼Œä»¥åŠå½“å‰èµ„æºçš„ç‰ˆæœ¬å’Œä¾èµ–å…³ç³»ã€‚å¯ä»¥å¼€å¯ json æ ¼å¼ï¼Œè¿™æ ·æ–¹ä¾¿äººä¸ºæŸ¥çœ‹ã€‚\nç„¶åç¬¬ä¸€æ¬¡ç¼–è¯‘å¯ä»¥é€‰æ‹©å…ˆæ¸…ç©º buildï¼Œç„¶åç‚¹å‡» New Build æ¥æ„å»ºã€‚\nç¼–è¯‘æ•´ä¸ªæ¸¸æˆï¼Œç„¶åæ‰“å¼€æ¸¸æˆï¼š\næ¥ä¸‹æ¥æ¼”ç¤ºæ›´æ–°ï¼Œé¦–å…ˆï¼Œå¯¹äºå¸Œæœ›è¿œç¨‹æ›´æ–°çš„ Groupï¼Œå…ˆè®¾ç½®ä¸º Remote æ¨¡å¼ï¼š\nç„¶åè®¾ç½®æè´¨ä¸ºå¦ä¸€ä¸ªé¢œè‰²ï¼š\nç„¶åä½¿ç”¨ Update æ›´æ–°ï¼š\nç°åœ¨ remote æ–‡ä»¶å¤¹ ServerData/StandaloneWindows64 é‡Œé¢ï¼Œé¦–å…ˆä¼šå°†åŸæœ¬çš„ Catalog æ›´æ–°ï¼Œå¹¶ä¸”å¤šå‡ºæ›´æ–°çš„ bundle åŒ…ï¼š\nç›´æ¥è¿›å…¥ remote çš„è¾“å‡ºç›®å½•ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥åœ¨è¿™ä¸ªç›®å½•å¯åŠ¨ä¸€ä¸ª http æœåŠ¡æ¥è¿›è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚è¿™é‡Œé‡‡ç”¨ 8888 ç«¯å£ï¼š\ncd ServerData/StandaloneWindows64 python -m http.server 8888 ç„¶åæˆ‘ä»¬å¯åŠ¨æ¸¸æˆï¼Œä¼šå‘ç°æ­¤æ—¶æè´¨å·²ç»å˜åŒ–äº†ï¼š\næŸ¥çœ‹ä¸‹ http server çš„è®¿é—®æ—¥å¿—ï¼Œæ¸¸æˆæ›´æ–°èµ„äº§çš„æµç¨‹æ˜¯ï¼š\nå¯¹æ¯” catalog çš„ hash å¦‚æœ catalog çš„ hash æœ‰å˜åŒ–ï¼Œæ›´æ–° catalog æ ¹æ® catalogï¼Œå¯¹æ–°çš„èµ„æºè¿›è¡Œè®¿é—®ï¼Œå¦‚æœæ˜¯è¿œç¨‹èµ„æºï¼Œå°±ä¸‹è½½ Serving HTTP on :: port 8888 (http://[::]:8888/) ... ::ffff:127.0.0.1 - - [07/Nov/2025 15:25:58] \u0026#34;GET //catalog_0.1.0.hash HTTP/1.1\u0026#34; 200 - ::ffff:127.0.0.1 - - [07/Nov/2025 15:25:58] \u0026#34;GET //catalog_0.1.0.json HTTP/1.1\u0026#34; 200 - ::ffff:127.0.0.1 - - [07/Nov/2025 15:25:58] \u0026#34;GET /r_assets_all_02c27bfe06053568040c18a7d35f8ed6.bundle HTTP/1.1\u0026#34; 200 - å› æ­¤ï¼Œå¦‚æœæœ‰æœªæ¥æ›´æ–°çš„éœ€æ±‚ï¼Œä½¿ç”¨ Addressable çš„è¯ï¼Œåˆæ¬¡å¯ä»¥å…ˆå…¨éƒ¨æœ¬åœ° Build æ‰“åŒ…ï¼Œåªéœ€è¦å…ˆç”Ÿæˆ Remote Catalog å°±å¯ä»¥é¢„ç•™æœªæ¥çš„æ›´æ–°äº†ã€‚\nä¹Ÿå¯ä»¥åˆæ¬¡å°±æ”¾åœ¨è¿œç¨‹æœåŠ¡å™¨ã€‚æ³¨æ„æ‰“åŒ…çš„æ—¶å€™ Remote çš„ Group æ˜¯ä¸ä¼šæ”¾è¿›æ¸¸æˆä¸­çš„ï¼Œå¦‚æœä½ æ„Ÿè§‰æ”¾è¿›å»äº†ï¼Œå¾ˆå¯èƒ½æ˜¯å¿˜è®°æ¸…ç©ºç¼“å­˜äº†ï¼Œå»ä¸‹åˆ—åœ°å€æ¸…ç©ºç¼“å­˜ï¼š\nC:\\Users\\\u0026lt;ç”¨æˆ·å\u0026gt;\\AppData\\LocalLow\\\u0026lt;å…¬å¸å\u0026gt;\\\u0026lt;æ¸¸æˆå\u0026gt;\\com.unity.addressables\n3.6 æ¸¸æˆå¯åŠ¨æ—¶æ‰‹åŠ¨æ›´æ–° Catalogs å‰é¢çš„æ›´æ–°æ˜¯å…¨è‡ªåŠ¨çš„ï¼Œåœ¨é¦–æ¬¡è®¿é—®èµ„æºçš„æ—¶å€™è§¦å‘ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¥ä¸»åŠ¨æ›´æ–° Catalogsï¼š\nAddressables ä¸ä¼šè‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œä½ å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ CheckForCatalogUpdates() ä¸ UpdateCatalogs()ã€‚\né¦–å…ˆåˆ¤æ–­æ˜¯å¦æœ‰éœ€è¦æ›´æ–°çš„ Catalogï¼Œç„¶åå¯ä»¥è¿›è¡Œæ›´æ–°ã€‚\nvar checkHandle = Addressables.CheckForCatalogUpdates(); var catalogsToUpdate = await checkHandle.Task; if (catalogsToUpdate != null \u0026amp;\u0026amp; catalogsToUpdate.Count \u0026gt; 0) { Debug.Log($\u0026#34;æ£€æµ‹åˆ° {catalogsToUpdate.Count} ä¸ª catalog æœ‰æ›´æ–°ã€‚\u0026#34;); var updateHandle = Addressables.UpdateCatalogs(catalogsToUpdate); await updateHandle.Task; Debug.Log(\u0026#34;Catalog æ›´æ–°å®Œæˆã€‚\u0026#34;); } else { Debug.Log(\u0026#34;æ²¡æœ‰æ£€æµ‹åˆ° Catalog æ›´æ–°ã€‚\u0026#34;); } Addressables.Release(checkHandle); Catalog å‡†ç¡®æ¥è¯´æ˜¯ä¸€ä¸ª bundle åˆ—è¡¨ï¼Œå¦‚æœä¸æ›´æ–°å°±è¿˜æ˜¯ä¼šå»æ‰¾ä¹‹å‰ Catalog é‡Œé¢çš„ bundle çš„ä½ç½®ã€‚\nåœ¨æ›´æ–° Catalog ä¹‹åè¿˜éœ€è¦æ›´æ–° Bundleï¼Œæ€»ä½“ä¸Šå¯ä»¥è®¾è®¡åœ¨è½½å…¥é˜¶æ®µçš„ ui ç•Œé¢å¯åŠ¨ä¸€ä¸ªä¸‹è½½æµç¨‹ï¼Œæ›´æ–° Catalogï¼Œç„¶åä¸‹è½½æ‰€æœ‰ç›¸å…³çš„ Bundleï¼Œå†æœ€ç»ˆè¿›å…¥åˆ°æ¸¸æˆçš„æµç¨‹ã€‚\n","permalink":"https://cronrpc.github.io/zh/posts/unity-resources-assetbundles-and-addressables/","summary":"\u003cp\u003eåœ¨ Unity å¼€å‘ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆç®¡ç†å’ŒåŠ è½½æ¸¸æˆèµ„æºï¼Œæ˜¯å†³å®šé¡¹ç›®æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§çš„é‡è¦å› ç´ ã€‚\u003c/p\u003e\n\u003cp\u003eUnity è¿™äº›å¹´æ¥å…ˆåæ¨å‡ºäº†ä¸‰ç§ä¸»è¦çš„èµ„æºåŠ è½½æ–¹å¼ï¼š\u003c/p\u003e\n\u003cp\u003eResources â†’ AssetBundles â†’ Addressablesã€‚\u003c/p\u003e\n\u003cp\u003eæ¯ä¸€ä»£ç³»ç»Ÿéƒ½åœ¨è§£å†³ä¸Šä¸€ä»£çš„å±€é™æ€§ã€‚\u003c/p\u003e","title":"Unity AssetBundles and Addressables"},{"content":"1. Tween System Tweenï¼ˆè¡¥é—´ï¼‰ æ˜¯æŒ‡åœ¨ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´ï¼Œé€šè¿‡æ—¶é—´æ’å€¼è‡ªåŠ¨ç”Ÿæˆä¸­é—´å¸§ï¼ˆin-betweenï¼‰ï¼Œä»è€Œäº§ç”Ÿå¹³æ»‘è¿‡æ¸¡çš„åŠ¨ç”»æˆ–å˜åŒ–ã€‚\nå› ä¸ºåœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™éœ€è¦è¿›è¡Œæ’å€¼æ¥è¡¨ç¤ºè¿‡æ¸¡åŠ¨ç”»ã€‚æ¯”å¦‚ç‰©ä½“ä»ä¸€ä¸ªç‚¹ç§»åŠ¨åˆ°ç›®çš„åœ°ï¼Œåªéœ€è¦è®¾å®šåˆå§‹å€¼å’Œç›®çš„åœ°å€¼ï¼Œè¿˜æœ‰æ‰€ç”¨çš„æ—¶é—´ï¼Œé‚£ä¹ˆä¸­é—´çš„è¿‡ç¨‹ä¹Ÿå°±ç¡®å®šäº†ï¼Œåªéœ€è¦é€šè¿‡è®¡ç®—å»è·å–æ¯ä¸ªæ—¶åˆ»çš„å€¼ã€‚\næœ€ç®€å•çš„æ–¹å¼å¯ä»¥é€šè¿‡ Lerp å‡½æ•°æ¥è¿›è¡Œæ’å€¼ï¼Œåœ¨å½’ä¸€åŒ–æ—¶é—´çš„è¡¨ç¤ºä¸‹ï¼ˆ0è¡¨ç¤ºå¼€å§‹ï¼Œ1è¡¨ç¤ºç»“æŸï¼‰ï¼Œæ¯ä¸ªä¸­é—´æ—¶åˆ»çš„å€¼éƒ½å¯ä»¥é€šè¿‡ Lerp æ’å€¼å‡ºæ¥ã€‚\næœ€ç®€æ˜“çš„å†™æ³•è‚¯å®šæ˜¯æ¯ä¸ªè¿‡ç¨‹éƒ½è‡ªå·±ç¼–å†™ï¼Œåœ¨ Update ä¸­è®¡ç®—ä¸­é—´è¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼š\npublic bool Update(float deltaTime) { if (_isCompleted) return true; _elapsed += deltaTime; float t = Mathf.Clamp01(_elapsed / _duration); float value = Mathf.Lerp(_startValue, _endValue, easedT); _onUpdate?.Invoke(value); _isCompleted = _elapsed \u0026gt;= _duration; return _isCompleted; } 1.1 Tween Manager ä¸è¿‡è¿™ç§å†™æ³•è‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½çš„å†™æ³•ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨â€œåç¨‹â€æ¥è¿›è¡Œå¤„ç†ï¼ŒåŒæ—¶æˆ‘ä»¬æŠŠæ•´ä¸ªç±»æå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªå…¬å…±å•ä¾‹ï¼Œè¿™æ ·æ’å€¼å’Œè°ƒç”¨è¿‡ç¨‹å°±ç®€åŒ–äº†ã€‚åªéœ€è¦é€šè¿‡å›è°ƒå‚æ•° onUpdate å’Œ onComplete æ¥å†³å®šä¸­é—´æ€å’Œç»“æŸæ—¶çš„å›è°ƒã€‚\npublic class TweenManager : MonoBehaviour { private static TweenManager _instance; public static TweenManager Instance { get { if (_instance == null) { var go = new GameObject(\u0026#34;TweenManager\u0026#34;); _instance = go.AddComponent\u0026lt;TweenManager\u0026gt;(); DontDestroyOnLoad(go); } return _instance; } } public Coroutine TweenFloat(float from, float to, float duration, Action\u0026lt;float\u0026gt; onUpdate, Action onComplete = null) { return StartCoroutine(TweenFloatCoroutine(from, to, duration, onUpdate, onComplete)); } private IEnumerator TweenFloatCoroutine(float from, float to, float duration, Action\u0026lt;float\u0026gt; onUpdate, Action onComplete) { float time = 0f; while (time \u0026lt; duration) { time += Time.deltaTime; float t = Mathf.Clamp01(time / duration); float value = Mathf.Lerp(from, to, t); onUpdate?.Invoke(value); yield return null; } onUpdate?.Invoke(to); onComplete?.Invoke(); } public Coroutine TweenColor(Color from, Color to, float duration, Action\u0026lt;Color\u0026gt; onUpdate, Action onComplete = null) { return StartCoroutine(TweenColorCoroutine(from, to, duration, onUpdate, onComplete)); } private IEnumerator TweenColorCoroutine(Color from, Color to, float duration, Action\u0026lt;Color\u0026gt; onUpdate, Action onComplete) { float time = 0f; while (time \u0026lt; duration) { time += Time.deltaTime; float t = Mathf.Clamp01(time / duration); Color value = Color.Lerp(from, to, t); onUpdate?.Invoke(value); yield return null; } onUpdate?.Invoke(to); onComplete?.Invoke(); } } 1.2 æ’å€¼é¢œè‰²å’Œ Float åœ¨å†™å¥½äº† TweenManager ä»¥åï¼Œè°ƒç”¨çš„æ—¶å€™åªéœ€è¦ç¼–å†™å›è°ƒå‚æ•°å³å¯ã€‚\næ¯”å¦‚å¯¹é¢œè‰²è¿›è¡Œæ’å€¼ï¼š\npublic class ColorFadeExample : MonoBehaviour { public Image target; private void OnGUI() { if (GUI.Button(new Rect(10, 10, 100, 30), \u0026#34;TweenColor\u0026#34;)) { Color start = Color.white; Color end = Color.red; float duration = 2f; TweenManager.Instance.TweenColor(start, end, duration, color =\u0026gt; target.color = color, ()=\u0026gt; Debug.Log(\u0026#34;Color Tween Done!\u0026#34;)); } } } å¯¹æµ®ç‚¹æ•°è¿›è¡Œæ’å€¼ï¼Œå®ç°ä¸€ä¸ªè®¡æ—¶å™¨ï¼š\npublic class TextExample : MonoBehaviour { public Text target; private void OnGUI() { if (GUI.Button(new Rect(10, 50, 100, 30), \u0026#34;TweenFloat\u0026#34;)) { float start = 0f; float end = 10f; float duration = 5f; TweenManager.Instance.TweenFloat(start, end, duration, value =\u0026gt; target.text = $\u0026#34;Time: {value:F4}\u0026#34;, ()=\u0026gt; Debug.Log(\u0026#34;Float Tween Done!\u0026#34;)); } } } 2.3 åˆ©ç”¨ C# æ‰©å±•æ–¹æ³•ç®€åŒ–å†™æ³• æ‰©å±•æ–¹æ³•ï¼ˆExtension Methodï¼‰æ˜¯ C# æä¾›çš„ä¸€ç§è¯­æ³•ç³–ï¼Œå®ƒå…è®¸ä½ ç»™ç°æœ‰ç±»å‹æ·»åŠ æ–¹æ³•ï¼Œè€Œæ— éœ€ä¿®æ”¹åŸæ¥çš„ç±»ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥â€œæ‰©å±•â€åˆ«äººçš„ç±»ï¼ŒåŒ…æ‹¬ Unity çš„ Image/string/List\u0026lt;T\u0026gt; ç­‰ã€‚\nè¯­æ³•ç‰¹ç‚¹ï¼š\næ–¹æ³•å¿…é¡»æ˜¯ staticã€‚ ç¬¬ä¸€ä¸ªå‚æ•°è¦ç”¨ this ä¿®é¥°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ‰©å±•çš„æ˜¯å“ªä¸ªç±»å‹ã€‚ å¿…é¡»æ”¾åœ¨ static class ä¸­ã€‚ public static class TweenManagerExtension { public static Coroutine TweenColor(this Image image, Color from, Color to, float duration, Action\u0026lt;Color\u0026gt; onUpdate, Action onComplete = null) { return TweenManager.Instance.TweenColor(from, to, duration, onUpdate, onComplete); } } ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥å½“ä½œä¸€ä¸ªæ–¹æ³•æ¥ä½¿ç”¨ï¼š\npublic class ColorFadeExample : MonoBehaviour { public Image target; private void OnGUI() { if (GUI.Button(new Rect(10, 10, 100, 30), \u0026#34;TweenColor\u0026#34;)) { Color start = Color.white; Color end = Color.aquamarine; float duration = 2f; target.TweenColor(start, end, duration, color =\u0026gt; target.color = color, () =\u0026gt; Debug.Log(\u0026#34;Color Tween Done!!\u0026#34;)); } } } è¿™æ ·å°±ç®€åŒ–çš„è°ƒç”¨æ–¹å¼ï¼Œä½¿å¾—ä»£ç å†™èµ·æ¥æ›´ä¼˜é›…äº†ã€‚\n2. DOTween æ¡†æ¶ åœ¨å‰ä¸€å°èŠ‚çš„æœ€åä¸€æ­¥ï¼Œé€šè¿‡ C# æ‰©å±•æ–¹æ³•ï¼Œå·²ç»å¯ä»¥å®ç°ä¾¿æ·çš„è¡¥é—´æ“ä½œäº†ã€‚\nä½†æ˜¯ä¸€ä¸ªé—®é¢˜åœ¨äºï¼Œå®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šæ¸¸æˆå¼€å‘ä¸­çš„åœºæ™¯éœ€è¦è¿›è¡Œé€‚é…ï¼Œæ¯”å¦‚ï¼š\nå¾ªç¯å¤šæ¬¡åœ°æ’­æ”¾ä¸€æ®µåŠ¨ç”» é€†å‘æ’­æ”¾ä¸€æ®µåŠ¨ç”» å°†å¤šä¸ªåŠ¨ç”»è¿èµ·æ¥æ’­æ”¾ ä¸ä»…ä»…æ˜¯æµ®ç‚¹æ•°å’Œé¢œè‰²ï¼Œè¿˜æœ‰æ–‡å­—ç­‰å„ç§åœºæ™¯ ä¸€ä¸ªå¥½æ¶ˆæ¯æ˜¯ï¼Œå·²ç»æœ‰äººè¿™ä¹ˆåšäº†ï¼Œå¹¶ä¸”æ€§èƒ½ä¸Šä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå®ƒå°±æ˜¯ DOTween ã€‚\nDOTween å®ƒçš„å…¨åæ˜¯ Demigiant DOTweenï¼Œä½œè€…æ˜¯ Daniele Giardiniï¼Œæ˜¯ç›®å‰ Unity æœ€ä¸»æµçš„ Tween System ä¹‹ä¸€ã€‚\nå‚è€ƒæ–‡æ¡£ï¼šDOTween Documentation1\n2.1 DOTween å®‰è£… å®‰è£…å®ƒéå¸¸å®¹æ˜“ï¼Œå°±æŒ‰ç…§æ­£å¸¸çš„æ’ä»¶å®‰è£…æ–¹å¼ï¼Œåœ¨ Unity Asset Store ä¸­æ‰¾åˆ°å®ƒå¹¶å®‰è£…å³å¯ï¼šUnity Asset Store DOTWeen\n2.2 æŒ¯åŠ¨ã€æ–‡å­—ã€ç§»åŠ¨ç¼©æ”¾ DOTween ä¸ä»…ä»…æ˜¯ç®€å•çš„æ’å€¼ï¼Œä¹ŸåŒ…æ‹¬å¾ˆå¤šç‰¹æ•ˆåŠ¨ç”»ã€‚\næ¯”å¦‚ï¼Œå¯ä»¥æŒ¯åŠ¨ä½ç½®æ¥å®ç°æŠ–åŠ¨é•œå¤´çš„æ•ˆæœï¼š\nprivate void OnGUI() { if (GUI.Button(new Rect(10, 10, 100, 30), \u0026#34;Shake\u0026#34;)) { Camera.main.transform.DOShakePosition(2, shakeStrength); } } å¯ä»¥é€ä¸ªè¾“å‡ºä¸€æ®µæ–‡å­—ï¼š\nprivate void OnGUI() { if (GUI.Button(new Rect(10, 50, 100, 30), \u0026#34;TextPrint\u0026#34;)) { outputTextCanvas.gameObject.SetActive(true); outputText.text = \u0026#34;\u0026#34;; outputText.DOText(\u0026#34; Hello world \\n !!!!!!!!!!!!!!!!!!!!!!!!!!\u0026#34;, 4); } } èƒ½å¤Ÿå°†ç‰©ä½“ä»å½“å‰ä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚\nprivate void OnGUI() { if (GUI.Button(new Rect(10, 130, 100, 30), \u0026#34;MoveTo\u0026#34;)) { targetTransform.DOMove(new Vector3(0, 2, 0), 1f); } } 2.3 Sequence ç§»åŠ¨çš„åŒæ—¶è¿›è¡Œç¼©æ”¾ã€‚\nè¿™é‡Œçš„ Sequence å°†ä¼šç­‰å¾…å‰ä¸€ä¸ªåŠ¨ç”»è¿è¡Œå®Œæ¯•å†å¼€å§‹ä¸‹ä¸€ä¸ªåŠ¨ç”»ã€‚\nprivate void OnGUI() { if (GUI.Button(new Rect(10, 170, 100, 30), \u0026#34;MoveToAndScale\u0026#34;)) { var s = DOTween.Sequence(); s.Append(targetTransform.DOMove(new Vector3(0, 2, 0), 1f)); s.Append(targetTransform.DOScale(new Vector3(0.5f, 0.5f, 0.5f), 1f)); s.OnComplete((() =\u0026gt; Debug.Log(\u0026#34;MoveToAndScale Done!\u0026#34;))); } } 2.4 ç›¸å¯¹å€¼ã€OnComplete ä¸ä»…ä»…å¯ä»¥ç§»åŠ¨ç»å¯¹å€¼ï¼Œè¿˜å¯ä»¥ç§»åŠ¨ç›¸å¯¹å€¼ï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹äºåŠ¨ç”»å¯åŠ¨çš„ä½ç½®ï¼š\nif (GUI.Button(new Rect(10, 130, 100, 30), \u0026#34;MoveTo\u0026#34;)) { targetTransform.DOMove(new Vector3(0, 2, 0), 1f).SetRelative(); } é€šè¿‡ç»„åˆåºåˆ—ï¼Œå¯ä»¥å®ç°è¿è´¯çš„åŠ¨ç”»æ•ˆæœï¼Œå¹¶åœ¨ç»“æŸçš„æ—¶å€™æ‰§è¡Œéšè—æ–‡æœ¬çš„æ•ˆæœï¼š\nif (GUI.Button(new Rect(10, 90, 100, 30), \u0026#34;TextColor\u0026#34;)) { outputTextCanvas.gameObject.SetActive(true); outputText.text = \u0026#34;\u0026#34;; var s = DOTween.Sequence(); // æ–‡å­—æ‰“å­—æœºåŠ¨ç”» s.Append(outputText .DOText(\u0026#34;Hello world \\n !!!!!!!!!!!!!!!!!!!!!!!!!!\u0026#34;, 4) .SetEase(Ease.Linear)); // é¢œè‰²å˜åŒ– s.Append(outputText .DOColor(new Color(0.8f, 0.2f, 0.3f), 1f) .SetEase(Ease.InOutSine)); // é—ªçƒï¼šåå¤æ”¹å˜é€æ˜åº¦ s.AppendCallback(() =\u0026gt; { outputText.DOFade(0f, 0.3f) .SetLoops(6, LoopType.Yoyo) // é—ªçƒ3æ¬¡ Yoyoæ˜¯åå¤æ¨¡å¼ .SetEase(Ease.InOutSine).OnComplete(() =\u0026gt; { outputTextCanvas.gameObject.SetActive(false); }); }); } 2.5 å–æ¶ˆã€æš‚åœã€æ¢å¤ ç›´æ¥è°ƒç”¨ Kill()ï¼Œè¿™ä¼šè®©è¡¥é—´ç«‹å³åœæ­¢ï¼Œä¸å†æ›´æ–°ã€‚\nTween tween = transform.DOMove(new Vector3(5, 0, 0), 2f); tween.Kill(); // ç«‹å³å–æ¶ˆå¹¶ç§»é™¤è¡¥é—´ ä½ å¯ä»¥ç”¨ç›®æ ‡å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œæ‰¹é‡å–æ¶ˆï¼š\ntransform.DOMove(...); transform.DOScale(...); DOTween.Kill(transform); // æ€æ‰ä¸è¯¥ transform ç›¸å…³çš„æ‰€æœ‰ Tween å¸¸ç”¨äºç‰©ä½“è¢«é”€æ¯å‰ï¼š\nvoid OnDestroy() { DOTween.Kill(transform); } åŒæ—¶è¿˜å¯ä»¥ä¸´æ—¶æš‚åœåŠ¨ç”»ä¸æ¢å¤åŠ¨ç”»ï¼š\nTween t = transform.DOMove(...); t.Pause(); // æš‚åœ t.Play(); // ç»§ç»­ DOTween.PauseAll(); DOTween.PlayAll(); 2.6 æ›²çº¿ã€å»¶è¿Ÿã€å¾ªç¯ è¡¥é—´æ›²çº¿ï¼ˆEasingï¼‰æ§åˆ¶åŠ¨ç”»éšæ—¶é—´å˜åŒ–çš„é€Ÿåº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹åŠ¨ç”»æ˜¯çº¿æ€§çš„ï¼ˆLinearï¼‰ï¼Œå³é€Ÿåº¦æ’å®šã€‚\nä½†é€šè¿‡è®¾ç½®ä¸åŒçš„ç¼“åŠ¨æ›²çº¿ï¼ˆEaseï¼‰ï¼Œå¯ä»¥è·å¾—æ›´è‡ªç„¶çš„è¿åŠ¨æ•ˆæœã€‚\ntransform.DOMoveY(3f, 1.5f) .SetEase(Ease.OutBack); // å¼¹æ€§ç§»åŠ¨æ•ˆæœ æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›åŠ¨ç”»ç¨åå†æ’­æ”¾ï¼Œè¿™æ—¶å€™é€šè¿‡ SetDelay è®¾ç½®å»¶è¿Ÿæ’­æ”¾æ—¶é—´ï¼š\nimage.DOFade(1f, 1f) .SetDelay(0.5f); // åŠ¨ç”»åœ¨0.5ç§’åå¼€å§‹ å¾ªç¯å®šä¹‰äº†åŠ¨ç”»é‡å¤æ’­æ”¾çš„æ¬¡æ•°ä¸æ¨¡å¼ï¼Œé€šè¿‡ SetLoops(int loops, LoopType type) å®ç°ã€‚\nloopsï¼šå¾ªç¯æ¬¡æ•°ã€‚-1 è¡¨ç¤ºæ— é™å¾ªç¯ã€‚ typeï¼šå¾ªç¯æ–¹å¼ã€‚Restartæ˜¯å¾ªç¯ï¼ŒYoyoæ˜¯ä»èµ·ç‚¹åˆ°ç»ˆç‚¹ï¼Œå†è¿”å›ã€‚Incrementalåœ¨ä¸Šä¸€æ¬¡çš„åŸºç¡€ä¸Šå¢åŠ ã€‚ transform.DOScale(1.5f, 0.8f) .SetEase(Ease.InOutSine) .SetLoops(3, LoopType.Yoyo); demigiant, DOTween Documentation, https://dotween.demigiant.com/documentation.php\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/unity-tween-system/","summary":"\u003ch2 id=\"1-tween-system\"\u003e1. Tween System\u003c/h2\u003e\n\u003cp\u003eTweenï¼ˆè¡¥é—´ï¼‰ æ˜¯æŒ‡åœ¨ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´ï¼Œé€šè¿‡æ—¶é—´æ’å€¼è‡ªåŠ¨ç”Ÿæˆä¸­é—´å¸§ï¼ˆin-betweenï¼‰ï¼Œä»è€Œäº§ç”Ÿå¹³æ»‘è¿‡æ¸¡çš„åŠ¨ç”»æˆ–å˜åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eå› ä¸ºåœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å¾ˆå¤šæ—¶å€™éœ€è¦è¿›è¡Œæ’å€¼æ¥è¡¨ç¤ºè¿‡æ¸¡åŠ¨ç”»ã€‚æ¯”å¦‚ç‰©ä½“ä»ä¸€ä¸ªç‚¹ç§»åŠ¨åˆ°ç›®çš„åœ°ï¼Œåªéœ€è¦è®¾å®šåˆå§‹å€¼å’Œç›®çš„åœ°å€¼ï¼Œè¿˜æœ‰æ‰€ç”¨çš„æ—¶é—´ï¼Œé‚£ä¹ˆä¸­é—´çš„è¿‡ç¨‹ä¹Ÿå°±ç¡®å®šäº†ï¼Œåªéœ€è¦é€šè¿‡è®¡ç®—å»è·å–æ¯ä¸ªæ—¶åˆ»çš„å€¼ã€‚\u003c/p\u003e","title":"Unity Tween System è¡¥é—´åŠ¨ç”»ç³»ç»Ÿ"},{"content":"1. Unity Render Pipelines 1.1 Unity æ¸²æŸ“ç®¡çº¿çš„æµç¨‹ æ¸²æŸ“ç®¡çº¿æ˜¯å¼•æ“çš„æ¸²æŸ“æ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯æ¸¸æˆå¼•æ“æŠŠæ¸¸æˆå¯¹è±¡è½¬åŒ–ä¸ºå›¾åƒæ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„æ­¥éª¤ã€‚\nä¸€ä¸ªæ¸²æŸ“ç®¡çº¿å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‹åˆ—å‡ ä¸ªæ­¥éª¤ï¼š\nå‰”é™¤ï¼šåŒ…æ‹¬è§†é”¥å‰”é™¤å’Œé®æŒ¡å‰”é™¤ï¼ˆè¿™é‡Œçš„é®æŒ¡å‰”é™¤æ˜¯æŒ‡å¦‚æœç‰©ä½“è¢«å¦ä¸€ä¸ªç‰©ä½“é®æŒ¡å°±ç›´æ¥å‰”é™¤ï¼Œä½†æ˜¯é€šå¸¸æ˜¯å›ºå®šåœºæ™¯çš„é®æŒ¡è¿›è¡Œè¿™ç§å‰”é™¤ï¼Œæ¯”å¦‚è¿›å…¥æˆ¿é—´ä¹‹åé®æŒ¡å…¶ä»–æˆ¿é—´ï¼Œå¯å‚è€ƒOcclusionCullingã€‚ æ¸²æŸ“ï¼šç»˜åˆ¶ç‰©ä½“å’Œå®ƒä»¬çš„å…‰ç…§åˆ°ç›¸åº”çš„åƒç´ ç¼“å†²ï¼ˆpixel bufferï¼‰ä¸Šã€‚ åå¤„ç†ï¼šä¿®æ”¹åƒç´ ç¼“å†²ä¸ºæœ€åçš„è¾“å‡ºç»“æœã€‚è¿™ä¸€æ­¥å¯ä»¥åšå‡ºä¸€äº›æ•ˆæœï¼Œæ¯”å¦‚ bloomã€æ™¯æ·±ç­‰ã€‚ æœ‰æ—¶å€™ä¼šæŠŠå®ƒå’Œå›¾å½¢ç®¡çº¿æ··æ·†ï¼Œå®é™…ä¸Š Graphics Pipeline æ˜¯æŒ‡ä¸‹é¢è¿™ä¸ªå›¾ï¼ˆæ¥è‡ªVulkanï¼‰ï¼š\nå®ƒæ˜¯ GPU ä¸­ç»˜åˆ¶å›¾åƒçš„æµç¨‹ï¼Œé¦–å…ˆå˜æ¢é¡¶ç‚¹ï¼Œç„¶åå…‰æ …åŒ–ï¼Œå†è¿›è¡Œç‰‡å…ƒç€è‰²ã€‚å®ƒå®é™…ä¸Šä»…ä»…å¯¹åº”æ¸²æŸ“ç®¡çº¿ä¸­ç”¨åˆ°çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ Rendering è¿™ä¸ªæ­¥éª¤ä¸­çš„ç€è‰²ã€‚å¦‚æœä½ å­¦ä¹ å›¾å½¢å­¦çŸ¥è¯†ï¼Œä¸»è¦æ·±å…¥çš„æ˜¯å›¾å½¢ç®¡çº¿çš„ç¼–å†™ã€‚è€Œ Unity ä¸­æˆ‘ä»¬ä¸ä»…ä»…éœ€è¦å…³æ³¨å›¾å½¢ç®¡çº¿ï¼Œè¿˜éœ€è¦äº†è§£æ•´ä¸ªæ¸²æŸ“ç®¡çº¿ã€‚\n1.2 URP / HDRP / Built-in å®˜æ–¹æœ‰æä¾›ä¸‰ç§æ¸²æŸ“ç®¡çº¿ï¼š\nURPï¼šå±äºå¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿ï¼ˆSRPï¼ŒScriptable Render Pipelinesï¼‰ï¼Œé€‚é…ä¸åŒå¹³å°çš„å¯æ‰©å±•çš„å›¾å½¢ã€‚ HDRPï¼šSRPï¼Œå‰æ²¿çš„é«˜ä¿çœŸçš„æ˜¾ç¤ºæ•ˆæœï¼Œé€šå¸¸ç”¨äºé«˜ç«¯è®¾å¤‡ã€‚ Built-inï¼šé€šç”¨æ¸²æŸ“ç®¡çº¿ï¼Œå®šåˆ¶åŒ–ç¨‹åº¦ç›¸æ¯” SRP æ¯”è¾ƒä½ã€‚ SRP å…è®¸ä½ é€šè¿‡ç¼–å†™ C# ä»£ç æ¥å®šåˆ¶ä¸Šé¢æåˆ°çš„å‰”é™¤ã€æ¸²æŸ“å’Œåå¤„ç†ä¸‰ä¸ªæ­¥éª¤ï¼Œï¼ˆBuilt-In ä¹Ÿå¯ä»¥å®šåˆ¶ä¿®æ”¹ä¸è¿‡ä½ éœ€è¦å…ˆè·å¾—æºä»£ç ï¼‰ã€‚é™¤äº† URP å’Œ HDRPï¼Œä½ è¿˜å¯ä»¥ç¼–å†™è‡ªå·±çš„ SRPã€‚\nBuilt-in æ˜¯æ—§ç‰ˆçš„æ¸²æŸ“ç®¡çº¿ï¼Œç°åœ¨å®Œå…¨ä¸éœ€è¦å»è€ƒè™‘è¿™ä¸ªï¼Œåªæœ‰ä¸€äº›è¿‡å»çš„é¡¹ç›®å¼€å‘è€…ä¼šé€‰æ‹©è¿™ä¸ªã€‚å¦‚æœç°åœ¨å»å­¦ä¹ ä¸€äº›æ•™ç¨‹ï¼Œä¸€äº›2022å¹´ä»¥å‰å†™çš„ä¹¦ç±é€šå¸¸ä¼šä½¿ç”¨è¿™ä¸ªï¼Œè€Œæ–°ç‰ˆçš„æ•™ç¨‹è§†é¢‘é€šå¸¸éƒ½æ˜¯é‡‡ç”¨ URPã€‚\n1.3 Render Target å’Œ MRT æ¸²æŸ“ç›®æ ‡å°±æ˜¯æ¸²æŸ“ç»“æœè¾“å‡ºçš„ç›®æ ‡ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€å—ç”»å¸ƒï¼Œèƒ½å¤Ÿå¾€ä¸Šé¢å†™å…¥ä»»ä½•ä¸œè¥¿ã€‚\næ¸²æŸ“ç›®æ ‡å¯ä»¥æ˜¯å¤šä¸ªï¼Œä¾‹å¦‚åœ¨å‰å‘æ¸²æŸ“ä¸­ï¼Œæœ€åŸºæœ¬çš„æœ‰3ä¸ªï¼Œé¢œè‰²ï¼ˆRGBA 4é€šé“ï¼‰ã€æ·±åº¦ã€æ¨¡æ¿ï¼ˆStencilï¼‰ï¼Œå½“ç„¶æ·±åº¦å’Œæ¨¡æ¿é€šå¸¸éƒ½ä¸æ˜¯4é€šé“çš„ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šåˆå¹¶åœ¨ä¸€å¼ ç”»å¸ƒä¸Šã€‚\nåœ¨æ­£å‘æ¸²æŸ“ä¸­é€šå¸¸åªéœ€è¦ 2 ä¸ªRTï¼Œé¢œè‰²åŠ  Depthï¼Œå…¶ä¸­æ·±åº¦æ˜¯å¯ä»¥é…ç½®ç²¾åº¦çš„ï¼Œæ¯”å¦‚24ä½æˆ–è€…32ä½ï¼Œä»¥åŠæ˜¯å¦æ··åˆ Stencilã€‚\nGPUæ˜¯å¯ä»¥åŒæ—¶è¾“å‡ºå¤šå¼  Render Target çš„ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨å›¾å½¢ API é‡Œå«åš MRTï¼ˆMultiple Render Targetsï¼Œå¤šæ¸²æŸ“ç›®æ ‡ï¼‰ã€‚\nåœ¨å»¶è¿Ÿæ¸²æŸ“ä¸­ï¼ŒGBufferåŒæ—¶è¾“å‡ºäº†å¤šä¸ª RTã€‚\nåœ¨ä¸€æ¬¡å‡ ä½•éå†ä¸­è¾“å‡ºäº†ä¸åŒçš„ä¿¡æ¯ç”¨äºåç»­çš„æ¸²æŸ“ï¼Œä¾‹å¦‚ï¼š\nRT0: æ¼«åå°„é¢œè‰² (Diffuse Color) RT1: æ³•çº¿ (Normal) ç­‰ RT2: é•œé¢åå°„å‚æ•° (Specular, Roughness) RT4: è‡ªå®šä¹‰æ•°æ®ï¼Œæ¯”å¦‚æè´¨IDç­‰ è¿™å°±æ˜¯å»¶è¿Ÿæ¸²æŸ“ (Deferred Rendering) ä½¿ç”¨ MRT çš„åŸå› ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œéœ€è¦å†™å‡ ä¸ª Passï¼Œæ¯æ¬¡ Pass éå†åªæ˜¯ä¸ºäº†è·å–ä¸€å¼  RTï¼Œé‚£æ ·æ•ˆç‡å°±ä½äº†ã€‚\n2. Render Path ä¸­æ–‡å¯ä»¥å«åšæ¸²æŸ“è·¯å¾„ã€‚\næ¸²æŸ“è·¯å¾„æ˜¯æŒ‡ç»˜åˆ¶å’Œç…§äº®ç›¸æœºèƒ½çœ‹åˆ°çš„æ¸¸æˆå¯¹è±¡çš„ç³»åˆ—æ“ä½œã€‚ä¸åŒçš„æ¸²æŸ“è·¯å¾„å…·æœ‰ä¸åŒçš„åŠŸèƒ½å’Œæ€§èƒ½ç‰¹ç‚¹ã€‚å¦‚æœè¯´æ¸²æŸ“ç®¡çº¿æ˜¯åšé¥­çš„ä¸€å¥—æµç¨‹ï¼Œé‚£ä¹ˆæ¸²æŸ“è·¯å¾„å¯ä»¥ç†è§£ä¸ºæ˜¯æ”¾è°ƒå‘³å“çš„é¡ºåºå’Œæ—¶æœºã€‚æ¯”å¦‚è®¡ç®—å…‰ç…§çš„æ—¶æœºåˆ°åº•æ˜¯åœ¨å…¨å±€æ·±åº¦æµ‹è¯•ä¹‹å‰ï¼Œè¿˜æ˜¯å…¨å±€æ·±åº¦æµ‹è¯•ä¹‹åç­‰ã€‚\nUnityæ”¯æŒä¸¤ç§æ–¹å¼ï¼šå‰å‘æ¸²æŸ“ï¼ˆForwardï¼‰å’Œå»¶è¿Ÿæ¸²æŸ“ï¼ˆDeferredï¼‰ä»¥åŠå®ƒä»¬çš„æ”¹è¿›å½¢å¼ã€‚\nè¿™é‡Œæ¨èé˜…è¯»ï¼šæ¯›æ˜Ÿäº‘å…³äºå»¶è¿Ÿæ¸²æŸ“çš„æ€»ç»“1ã€‚\nå› ä¸º URP å¯ä»¥åŒæ—¶è¿è¡Œåœ¨å„ç§å¹³å°ä¸Šï¼ŒåŒ…æ‹¬æ‰‹æœºï¼Œæ‰€ä»¥é€šå¸¸éƒ½æ˜¯é‡‡ç”¨ URP è¿™ä¸ªç®¡çº¿æ¥å¼€å‘ Unity æ¸¸æˆã€‚æ‰€ä»¥è¿™é‡Œä¸å¯¹ HDRP è¿›è¡Œä»‹ç»ï¼ŒHDRP æœ‰æ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œæ”¯æŒå…‰çº¿è¿½è¸ªï¼Œå¦‚æœæƒ³äº†è§£å¯ä»¥å»æŸ¥é˜…æ–‡æ¡£ã€‚\n2.1 Forward Path æ­£å‘æ¸²æŸ“æ˜¯ä¸€ç§ä¼ ç»Ÿçš„å›¾å½¢æ¸²æŸ“ç®¡çº¿æ–¹å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªç‰©ä½“éƒ½ä¼šä¾æ¬¡ç»è¿‡é¡¶ç‚¹ç€è‰²ã€å…‰æ …åŒ–ã€ç‰‡å…ƒç€è‰²ç­‰é˜¶æ®µï¼Œå¹¶ä¸”åœ¨ç‰‡å…ƒç€è‰²å™¨ï¼ˆFragment Shaderï¼‰ä¸­ä¼šç›´æ¥è®¡ç®—å…‰ç…§å’Œæè´¨æ•ˆæœã€‚\næ­£å‘æ¸²æŸ“åœ¨å¤„ç†ç‰©ä½“çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ·±åº¦æµ‹è¯•ä¸ç€è‰²ï¼Œå…ˆæ¸²æŸ“çš„ç‰©ä½“æœ‰å¯èƒ½è¢«åæ¸²æŸ“çš„ç‰©ä½“è¦†ç›–ï¼Œå› ä¸ºåæ¸²æŸ“çš„ç‰©ä½“è·ç¦»å±å¹•æ›´è¿‘ã€‚\nè¿™æ ·åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç‰©ä½“éƒ½ä¼šç»è¿‡ç€è‰²ï¼Œæ­¤æ—¶å¦‚æœæœ‰ n ä¸ªç‰©ä½“ï¼Œm ä¸ªå…‰æºï¼Œé‚£ä¹ˆå¤æ‚åº¦å°±æ˜¯ $O(n * m)$ã€‚\n2.2 PrePass / Early-Z æ³¨æ„ï¼Œä¸Šé¢æåˆ°çš„æ˜¯ç»å…¸çš„æ­£å‘æ¸²æŸ“ï¼Œæ²¡æœ‰è€ƒè™‘ prePass æ¥å…ˆéå†æ·±åº¦ç­‰æ–¹å¼ã€‚å®é™…ä¸Šç°åœ¨çš„ URP ä¸­çš„ Forward Path æ˜¯ä¼šå…ˆç”¨ prePass è·å–æ·±åº¦ï¼Œè¿™ç§æƒ…å†µä¸‹å¤æ‚åº¦å°±ä¸èƒ½è¯´æ˜¯ $O(n * m)$ï¼Œè€Œæ˜¯ $O(n + m)$ã€‚è¿™é‡Œçš„å…‰æºè®¡ç®—æ¬¡æ•°åº”è¯¥æ˜¯åˆ†è¾¨ç‡ä¹˜ä»¥å…‰ç…§æ•°ï¼Œä½†æ˜¯åˆ†è¾¨ç‡é€šå¸¸ä¼šè®¤ä¸ºæ˜¯ä¸ªå¸¸æ•°ã€‚\nå‰å‘æ¸²æŸ“é€šè¿‡ prePass æ–¹å¼æ¥å¤„ç†è¿˜æ˜¯å’Œå»¶è¿Ÿæ¸²æŸ“æœ‰åŒºåˆ«çš„ï¼ŒåŒºåˆ«åœ¨äºå¸¦å®½å’Œéå†æ¬¡æ•°ï¼ŒæŒ‰ç…§ prePass æ–¹å¼æœ‰ 2 æ¬¡éå†ï¼ŒæŒ‰ç…§å»¶è¿Ÿæ¸²æŸ“çš„æ–¹å¼æ²¡æœ‰ 2 æ¬¡éå†ï¼Œä¸è¿‡éœ€è¦å¤šè¾“å‡ºå‡ å¼  RTã€‚\nè¿˜æœ‰ä¸€ç§å«åš Early-Zï¼Œæ˜¯åœ¨å¯¹ç‰‡å…ƒç€è‰²ï¼ˆå…‰ç…§è®¡ç®—ï¼‰ä¹‹å‰å…ˆè¿›è¡Œæ·±åº¦æµ‹è¯•ï¼Œè€Œä¸æ˜¯è®¡ç®—ä¹‹åå†åˆ¤æ–­ã€‚ç°åœ¨çš„ GPU æ™®éæä¾›è¿™ä¸ªæŠ€æœ¯äº†ã€‚ä½†æ˜¯è¿™ä¸ªæŠ€æœ¯æ²¡æœ‰ prePass å½»åº•ï¼Œå®ƒåªæ˜¯é¿å…äº†è¿‘å¤„ç‰©ä½“è®¡ç®—ååˆè®¡ç®—è¿œå¤„ç‰©ä½“ï¼Œä½†æ˜¯æ²¡æœ‰é¿å…å…ˆè®¡ç®—è¿œå¤„ç‰©ä½“å¯¼è‡´çš„å¤šä½™è®¡ç®—ã€‚\n2.3 Deferred Path å»¶è¿Ÿæ¸²æŸ“ï¼Œå¯¹æ¯”ç»å…¸çš„å‰å‘æ¸²æŸ“ï¼Œå¯¹äºå¤šå…‰æºçš„æ€§èƒ½æ•ˆæœéå¸¸å¥½ã€‚\nå»¶è¿Ÿæ¸²æŸ“é¦–å…ˆéå†æ•´ä¸ªåœºæ™¯ï¼Œè¿›è¡Œä¸€æ¬¡ç»˜åˆ¶ï¼Œä½†æ˜¯å®ƒçš„è¾“å‡ºä¸æ˜¯å…‰ç…§åçš„ç»“æœï¼Œè€Œæ˜¯ä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åç…§ç‡ã€æ³•çº¿ã€é«˜å…‰åº¦ç­‰ç­‰ï¼Œè¾“å‡ºå‡ å¼  RTã€‚åœ¨å…¨éƒ¨éå†å®Œæ¯•ä»¥åï¼Œå†å¯¹æ‰€æœ‰åƒç´ è¿›è¡Œä¸€æ¬¡éå†ï¼Œæ ¹æ® RT å¯¹æ¯ä¸ªåƒç´ è¿›è¡Œå…‰ç…§è®¡ç®—ã€‚\næˆ‘ä»¬ç»Ÿç§°è¿™äº› RT ä¸º GBufferï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¸ªåƒç´ çš„ä¿¡æ¯ã€‚\nè¿™ä¹ˆæ¥çœ‹ï¼Œå»¶è¿Ÿæ¸²æŸ“å°±æ˜¯å•çº¯æŠŠå…‰ç…§è®¡ç®—è¿™ä¸ªéƒ¨åˆ†æ‹¿å‡ºæ¥äº†ï¼Œæ³•çº¿é‡‡æ ·ã€è´´å›¾é‡‡ç”¨æ¬¡æ•°ä»€ä¹ˆçš„éƒ½æ²¡æœ‰å‡å°‘ï¼Œåªæ˜¯éƒ½å­˜èµ·æ¥ã€‚\nè€Œå‰å‘æ¸²æŸ“å¦‚æœå•ç‹¬æŠŠæ·±åº¦æµ‹è¯•æå–å‡ºæ¥ï¼Œé‚£ä¹ˆæ•´ä¸ªå…¶å®æœ€åè®¡ç®—çš„å…‰ç…§æ•°é‡åº”è¯¥å’Œå»¶è¿Ÿæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯è¿™æ ·å°±å°‘ç”¨ä¸€äº›å›¾å»å­˜å‚¨GBufferï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¤šä¸€äº›éå†æ¬¡æ•°ã€‚\nå› ä¸ºå»¶è¿Ÿæ¸²æŸ“GBufferç”Ÿæˆä¹‹ååªè¦éå†pixelï¼Œä½†æ˜¯å¦‚æœæ˜¯æ·±åº¦æµ‹è¯•å•ç‹¬æå–å‡ºæ¥ï¼Œä¾ç„¶è¿˜æ˜¯éœ€è¦éå†ä¸€æ¬¡æ‰€æœ‰ç‰©ä½“ã€‚\nä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œå»¶è¿Ÿæ¸²æŸ“é¦–å…ˆæ¸²æŸ“äº† GBufferï¼Œä¹‹ååœ¨ Deferred Pass ä¸­è¿›è¡Œå…‰ç…§è®¡ç®—ï¼Œå…‰ç…§è®¡ç®—ä¹Ÿæ˜¯é€šè¿‡å¤šæ¬¡ç€è‰²æ¥å®ç°çš„ï¼Œæ¯å¤šä¸€ä¸ªå…‰ç…§å°±éœ€è¦å¤šè¿›è¡Œä¸€äº›ç»˜åˆ¶ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œå›¾ä¸­å¤„ç†çš„æ–¹å¼æ˜¯ï¼Œå¯¹äºæ¯ä¸ªå…‰æºï¼Œéå†ä¸€æ¬¡å—å½±å“çš„åƒç´ ï¼Œæ¥è¿›è¡Œé’ˆå¯¹è¯¥å…‰æºçš„é¢œè‰²ç»˜åˆ¶ï¼Œè¿™æ ·ä¸€ä¸ªå…‰æºä¸€ä¸ªå…‰æºåœ°æ·»åŠ é¢œè‰²ã€‚\nå»¶è¿Ÿæ¸²æŸ“è¿˜æ˜¯è¦è€ƒè™‘å¤šæè´¨è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ï¼Œä¸Šå›¾çš„åœ°é¢å’Œæ–¹å—å°±ä¸æ˜¯ä¸€ä¸ªæè´¨ã€‚\nè§£å†³æ–¹æ³•æœ‰ 2 ç§ï¼ŒURP ä¸­é»˜è®¤çš„æ–¹å¼æ˜¯åœ¨ GBuffer é˜¶æ®µé€šè¿‡ Stencil æ ‡è®°æè´¨ã€‚\nç„¶ååœ¨ Deferred Pass é˜¶æ®µæ ¹æ® Stencil æ¥èµ°ä¸åŒçš„ Pass è¿›è¡Œç»˜åˆ¶ã€‚å½“ç„¶ä½ ä¼šçœ‹åˆ° Stencil Ref æœ‰ç‚¹å·®å¼‚æ˜¯å› ä¸ºè¿˜æœ‰ä¸€ä¸ªä¸Šè‰²çš„è¿‡ç¨‹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª Bit ç”¨æ¥æ ‡è®°æ˜¯å¦éœ€è¦ä¸Šè‰²ï¼ˆæ˜¯å¦è¢«æŸä¸ªå…‰ç…§åˆ°ï¼‰ã€‚\nå¦ä¸€ä¸ªæ–¹å¼å°±æ˜¯ä¸éœ€è¦è¿™ä¹ˆå¤šçš„ Passï¼Œé€šè¿‡åœ¨ GBuffer ä¸­ä½¿ç”¨æŸäº›æ¯”ç‰¹ä½æ¥æ ‡è®°æè´¨ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ª Pass ä¸­èµ°ä¸åŒçš„åˆ†æ”¯å°±å¯ä»¥ä»£è¡¨ä¸åŒæè´¨äº†ã€‚\n2.4 Shadow Map è¿™ä¹ˆå¤šå…‰æºï¼Œä¼šä¸ä¼šå½±å“æ€§èƒ½ï¼Ÿé™¤äº†å‰é¢çš„åœ° Deferred Passï¼Œé˜´å½±éƒ¨åˆ†ä¹Ÿæ˜¯å½±å“æ€§èƒ½çš„åœ°æ–¹ã€‚\nå‰é¢è®¨è®ºçš„å»¶è¿Ÿæ¸²æŸ“ä¸­ï¼Œå…‰æºæ˜¯æ²¡æœ‰é˜´å½±çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ„Ÿè§‰æ·»åŠ ä¸€ä¸ªå…‰å°±æ˜¯æ·»åŠ äº† ä¸€ç‚¹ Deferred Passã€‚\nä½†æ˜¯å¦‚æœæ˜¯ä¸‹å›¾è¿™ç§èšå…‰ç¯æ•ˆæœï¼š\nå¯ä»¥ç›´æ¥ç©¿é€ç‰©ä½“ç…§å°„åé¢çš„ç‰©ä½“ã€‚\nåŸå› æ˜¯æˆ‘ä»¬æ²¡æœ‰å¼€å¯å…‰æºçš„é˜´å½±ï¼Œéœ€è¦åœ¨å…‰æºçš„è®¾ç½®ä¸­å¼€å¯å®ƒã€‚\nå¼€å¯ä¹‹åï¼Œå…‰æºå°±ä¼šé€šè¿‡ Shadow Map æŠ€æœ¯ï¼Œæ¥ç”Ÿäº§å…‰æºçš„ Shadow Mapï¼Œ1ä¸ªç‚¹å…‰æºé€šå¸¸ç”Ÿæˆ 6 å¼ å›¾ï¼Œæ¶µç›– 6 ä¸ªæ–¹å‘ã€‚\nè¿™æ—¶å°±äº§ç”Ÿäº†é®æŒ¡å…³ç³»ã€‚\n2.5 åŠé€æ˜ç‰©ä½“ å»¶è¿Ÿæ¸²æŸ“ä¸­å¦‚ä½•æ¸²æŸ“åŠé€æ˜ç‰©ä½“ï¼Ÿç­”æ¡ˆæ˜¯åœ¨å»¶è¿Ÿæ¸²æŸ“å®Œä¸é€æ˜ç‰©ä½“ä¹‹åï¼Œå†ç”¨å‰å‘æ¸²æŸ“çš„æ–¹å¼æ¸²æŸ“åŠé€æ˜ç‰©ä½“ã€‚\n2.6 åœ¨å»¶è¿Ÿæ¸²æŸ“ä¸­ä½¿ç”¨å‰å‘æ¸²æŸ“ å¦‚ä½•åœ¨å»¶è¿Ÿæ¸²æŸ“ä¸­å¢åŠ ä¸€ä¸ªå‰å‘æ¸²æŸ“ï¼Ÿ\nå¯ä»¥é€šè¿‡å¢åŠ  Render Objects è¿™æ ·ä¸€ä¸ª Renderer Featuresï¼Œåœ¨æŸä¸ªäº‹ä»¶åæ’å…¥ã€‚æ¯”å¦‚è¿™é‡Œé€‰æ‹©åœ¨æ¸²æŸ“é€æ˜ç‰©ä½“ä¹‹å‰æ¸²æŸ“ã€‚\nå½“å»¶è¿Ÿæ¸²æŸ“å®Œæ¯•åï¼Œè¿˜æ²¡æœ‰æ¸²æŸ“ç‰©ä½“ã€‚\næ’å…¥äº†ä¸€ä¸ªæ¸²æŸ“ç‰©ä½“çš„ Passã€‚\nä¸ç”¨æ‹…å¿ƒå…‰ç…§é®æŒ¡é—®é¢˜ï¼Œå› ä¸ºå…‰ç…§å¯ä»¥è®¾ç½®å½±å“çš„ Layerï¼Œè®¾ç½®æ­£ç¡®çš„è¯é®æŒ¡å…³ç³»ä¹Ÿæ˜¯ä¼šæ­£ç¡®çš„ã€‚\nå…³äºæ’å…¥çš„ä½ç½®ï¼ŒåŸºæœ¬ä¸Š Opaques ä¹‹åéƒ½æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºå‚è€ƒRender eventï¼ŒDeferred Pass å‘ç”Ÿåœ¨ BeforeRenderingOpaques ä¹‹å‰ã€‚\n2.7 Forward+ Path å‰å‘+æ¸²æŸ“è·¯å¾„ä¸æ ‡å‡†çš„å‰å‘æ¸²æŸ“è·¯å¾„ç±»ä¼¼ï¼Œä½†æ²¡æœ‰é™åˆ¶æ¯ä¸ªæ¸¸æˆå¯¹è±¡å¯ä»¥å—å¤šå°‘ä¸ªå…‰æºå½±å“ã€‚ä¸è¿‡ï¼Œæ¯å°æ‘„åƒæœºå¯è§å…‰æºçš„æ•°é‡ä»ç„¶æœ‰é™åˆ¶ã€‚\nä½¿ç”¨å‰å‘+æ¸²æŸ“è·¯å¾„å‡å°‘äº†Unityä¸ºæ¯ä¸ªæ¸¸æˆå¯¹è±¡è®¡ç®—çš„å…‰æºæ•°é‡ã€‚Unityå°†å±å¹•åˆ’åˆ†ä¸ºå¤šä¸ªç“¦ç‰‡ï¼Œç„¶åç¡®å®šå“ªäº›å…‰æºä¼šå½±å“è¿™äº›ç“¦ç‰‡ã€‚å½“Unityè®¡ç®—æŸä¸ªæ¸¸æˆå¯¹è±¡çš„å…‰ç…§æ—¶ï¼Œå®ƒåªä¼šä½¿ç”¨å½±å“è¯¥æ¸¸æˆå¯¹è±¡æ‰€åœ¨ç“¦ç‰‡çš„å…‰æºã€‚\næ¯ä¸ªç½‘æ ¼æ–¹å—æ˜¯ä¸€ä¸ªç“¦ç‰‡ï¼Œæ¯ä¸ªå€¼è¡¨ç¤ºå½±å“è¯¥ç“¦ç‰‡çš„ç¯å…‰æ•°é‡ã€‚\nUnity åœ¨é€‰æ‹© Forward+ æ¸²æŸ“è·¯å¾„æ—¶ä¼šå¿½ç•¥ä»¥ä¸‹è®¾ç½®ï¼š\nURP èµ„æºä¸­çš„é™„åŠ ç¯å…‰ã€‚ URP èµ„æºä¸­çš„ä¸»ç¯å…‰ã€‚ URP èµ„æºä¸­é™„åŠ ç¯å…‰ \u0026gt; æ¯ä¸ªå¯¹è±¡é™åˆ¶ã€‚ æ¯›æ˜Ÿäº‘, ã€ã€ŠReal-Time Rendering 3rdã€‹ æç‚¼æ€»ç»“ã€‘(ä¸ƒ) ç¬¬ä¸ƒç« ç»­ Â· å»¶è¿Ÿæ¸²æŸ“(Deferred Rendering)çš„å‰ç”Ÿä»Šä¸–, https://zhuanlan.zhihu.com/p/28489928\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/deferred-rendering-path/","summary":"\u003ch2 id=\"1-unity-render-pipelines\"\u003e1. Unity Render Pipelines\u003c/h2\u003e\n\u003ch3 id=\"11-unity-æ¸²æŸ“ç®¡çº¿çš„æµç¨‹\"\u003e1.1 Unity æ¸²æŸ“ç®¡çº¿çš„æµç¨‹\u003c/h3\u003e\n\u003cp\u003eæ¸²æŸ“ç®¡çº¿æ˜¯å¼•æ“çš„æ¸²æŸ“æ­¥éª¤ï¼Œä¹Ÿå°±æ˜¯æ¸¸æˆå¼•æ“æŠŠæ¸¸æˆå¯¹è±¡è½¬åŒ–ä¸ºå›¾åƒæ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„æ­¥éª¤ã€‚\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ªæ¸²æŸ“ç®¡çº¿å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‹åˆ—å‡ ä¸ªæ­¥éª¤ï¼š\u003c/p\u003e","title":"Deferred Rendering Path"},{"content":"ä¸€ä¸ªç³»ç»Ÿçš„è¾“å…¥æœ‰å“ªäº›ï¼Ÿ\nå¦‚æœæ˜¯ç”µè„‘ä¸Šï¼Œæœ‰é¼ æ ‡ã€é”®ç›˜ã€æ‰‹æŸ„ï¼›ä¸»æœºä¸Šä¸»è¦æ˜¯æ‰‹æŸ„ï¼›ç§»åŠ¨è®¾å¤‡ä¸Šåˆ™æ˜¯å±å¹•ã€åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„åé¦ˆï¼Œä¾‹å¦‚PCæ‰‹æŸ„çš„åŸºç¡€æŒ¯åŠ¨ï¼ŒPSå¹³å°çš„æ‰‹æŸ„è¿˜æ”¯æŒåŠ›åé¦ˆå’Œå¹æ°”ï¼Œç§»åŠ¨ç«¯ä¹Ÿå¯ä»¥è§¦å‘æ‰‹æœºçš„æŒ¯åŠ¨ç­‰ã€‚\n1. Input Manager åœ¨å¼€å§‹ä»‹ç» Input System ä¹‹å‰ï¼Œç¨å¾®å›é¡¾ä¸‹ä¹‹å‰çš„è¾“å…¥ç³»ç»Ÿ Input Managerã€‚\né¦–å…ˆï¼Œè¾“å…¥ç³»ç»Ÿè‚¯å®šéœ€è¦æ”¯æŒè¯»å–è¾ƒä¸ºåŸå§‹çš„è¾“å…¥ï¼Œæ¯”å¦‚ä¸€ä¸ªå…·ä½“çš„é”®ç›˜æŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹ï¼Œé¼ æ ‡åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œä¸¤å¸§ä¹‹é—´çš„é¼ æ ‡ç§»åŠ¨çš„å·®å€¼ç­‰ç­‰ã€‚\nåŒæ—¶ï¼Œä½œä¸ºä¸€ä¸ªç³»ç»Ÿï¼Œå®ƒåº”è¯¥ä¹Ÿéœ€è¦æä¾›ä¸€ç‚¹æŠ½è±¡ã€‚Input Manager æä¾›äº†ä¸¤ç§æŠ½è±¡ï¼Œä¸€ç§æ˜¯æŒ‰é”®ï¼ˆButtonï¼‰ï¼Œä¸€ç§æ˜¯è½´å‘ï¼ˆAxisï¼‰ï¼Œåœ¨æœ¬æ–‡åé¢ä¼šæåˆ°ã€‚\n1.1 æ£€æµ‹é”®ç›˜é¼ æ ‡çš„è¾“å…¥ ä¸€ä¸ªç³»ç»Ÿæœ€åŸºæœ¬çš„åŠŸèƒ½å°±æ˜¯è¦èƒ½æ¯”è¾ƒåŸå§‹çš„å»æ£€æµ‹é”®ç›˜é¼ æ ‡çš„è¾“å…¥ï¼ŒInput Manager é‡‡ç”¨çš„æ˜¯è½®è¯¢æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºå‘˜åœ¨æ¯æ¬¡ Update ä¸­å»ä¸»åŠ¨å»è½®è¯¢æ˜¯å¦æœ‰æŒ‰é”®æŒ‰ä¸‹ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨ Update ä¸­è½®è¯¢æ£€æµ‹é”®ç›˜å’Œé¼ æ ‡ï¼š\nvoid Update() { // æŒ‰ä¸‹ä¸€æ¬¡è§¦å‘ï¼ˆå¸§çº§æ£€æµ‹ï¼‰ if (Input.GetKeyDown(KeyCode.Space)) { Debug.Log(\u0026#34;æŒ‰ä¸‹äº†ç©ºæ ¼é”®\u0026#34;); } // æŒ‰ä½æ—¶æŒç»­è§¦å‘ if (Input.GetKey(KeyCode.W)) { Debug.Log(\u0026#34;æ­£åœ¨æŒ‰ä½ W é”®\u0026#34;); } // æ¾å¼€æ—¶è§¦å‘ if (Input.GetKeyUp(KeyCode.Escape)) { Debug.Log(\u0026#34;æ¾å¼€äº† Esc é”®\u0026#34;); } // æ£€æµ‹é¼ æ ‡ä½ç½® Vector3 mousePos = Input.mousePosition; // å·¦é”®æŒ‰ä¸‹ if (Input.GetMouseButtonDown(0)) { Debug.Log(\u0026#34;Left Click at \u0026#34; + mousePos); } } æœ‰äº†é¼ æ ‡å’Œé”®ç›˜çš„åŸºæœ¬è¾“å…¥å°±å®Œå…¨å¤Ÿäº†ï¼Œç°åœ¨åªè¦ä¸æ–­é…åˆå…¶ä»–APIï¼ŒåŠ ä¸Šä¸€äº›ä»£ç ä¸Šçš„ç»„ç»‡ï¼Œå°±å¯ä»¥å®ç°ä»»ä½• PC æ¸¸æˆä¸Šçš„ä»»ä½•åŠŸèƒ½ã€‚\nä¾‹å¦‚åœ¨æ¸¸æˆä¸­ï¼Œæƒ³æ£€æµ‹é¼ æ ‡ç‚¹å‡»çš„ç‰©ä½“ï¼Œå¯ä»¥ç”¨å°„çº¿æŠ•å°„ï¼š\nif (Input.GetMouseButtonDown(0)) { Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition); if (Physics.Raycast(ray, out RaycastHit hit)) { Debug.Log(\u0026#34;Clicked on \u0026#34; + hit.collider.name); } } 1.2 æŒ‰é”®å’Œè½´ åœ¨ Edit â†’ Project Settings â†’ Input Manager ä¸­ï¼ŒUnity é»˜è®¤å·²ç»é…ç½®äº†ä¸€äº›è¾“å…¥ï¼ˆæ¯”å¦‚ Fire1ã€Jumpï¼‰ã€‚\nå¯¹äºæ¯ä¸ªè¾“å…¥ï¼Œå¯ä»¥é‡‡ç”¨æŒ‰é”®æ–¹å¼æˆ–è€…è½´çš„æ–¹å¼å»è¯»å–ï¼Œè¿™é‡Œç›¸å½“äºåšäº†ä¸€å±‚ç®€å•çš„æŠ½è±¡ã€‚å¹¶ä¸”å¤šä¸ªæ¥æºçš„è¾“å…¥ï¼Œæ˜¯å¯ä»¥ç»‘å®šä¸ºåŒä¸€ä¸ª Name çš„ï¼Œè¿™æ ·å°±æ”¯æŒäº†å¤šè®¾å¤‡è¾“å…¥ã€‚\nå®ç°æŒ‰é”®çš„è¯»å–ï¼Œåªéœ€è¦ç”¨ GetButtonDown çš„ API å»è¯»å–è®¾ç½®ä¸­å®šä¹‰çš„ Nameï¼š\n// Fire1 é»˜è®¤ç»‘å®šæ˜¯ Ctrl / é¼ æ ‡å·¦é”® / æ‰‹æŸ„ A é”® if (Input.GetButtonDown(\u0026#34;Fire1\u0026#34;)) { Debug.Log(\u0026#34;æ‰§è¡Œæ”»å‡»ï¼\u0026#34;); } // Jump é»˜è®¤ç»‘å®šæ˜¯ç©ºæ ¼é”® if (Input.GetButtonDown(\u0026#34;Jump\u0026#34;)) { Debug.Log(\u0026#34;è·³è·ƒ\u0026#34;); } åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ GetAxis å»è¯»å– Name å®ç°ä¸€ä¸ªWASDçš„æ“ä½œï¼Œèƒ½ä½œä¸ºä¸€ä¸ªè½´æ¥è¯»å–çš„éœ€è¦è®¾ç½®æ­£å€¼è¡¨ç¤ºçš„æŒ‰é”®å’Œè´Ÿå€¼è¡¨ç¤ºçš„æŒ‰é”®ï¼Œæˆ–è€…ç»‘å®šåˆ°ä¸€ä¸ªæ‘‡æ†è½´ä¸Šï¼š\n// é”®ç›˜ A/D æˆ– å·¦/å³ç®­å¤´ï¼Œé»˜è®¤æ˜ å°„ä¸º Horizontal float horizontal = Input.GetAxis(\u0026#34;Horizontal\u0026#34;); // é”®ç›˜ W/S æˆ– ä¸Š/ä¸‹ç®­å¤´ï¼Œé»˜è®¤æ˜ å°„ä¸º Vertical float vertical = Input.GetAxis(\u0026#34;Vertical\u0026#34;); Vector3 move = new Vector3(horizontal, 0, vertical); Debug.Log(\u0026#34;å½“å‰è¾“å…¥æ–¹å‘ï¼š\u0026#34; + move); 1.3 æ‰‹æœºä¼ æ„Ÿå™¨ ç§»åŠ¨ç«¯å’Œ PC ç«¯çš„å·®å¼‚è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œé€šå¸¸æ‰‹æœºä¸Šæ˜¯æ²¡æœ‰é”®ç›˜è®¾å¤‡çš„ï¼Œåªæœ‰æ‰‹æŒ‡èƒ½ä»£æ›¿é¼ æ ‡è¿›è¡Œä¸€äº›ç‚¹å‡»ï¼Œæ‰€ä»¥ç§»åŠ¨ç«¯è®¾å¤‡ä¼šä½¿ç”¨è™šæ‹Ÿæ‘‡æ†å’Œä¸€äº›è™šæ‹ŸæŒ‰é’®ï¼Œæ¯”å¦‚ç‹è€…è£è€€ã€PUBGã€‚\né™¤äº†æ“ä½œè™šæ‹Ÿæ‘‡æ†å’Œè™šæ‹ŸæŒ‰é’®ï¼Œè¿˜æœ‰ä¸€äº›ä¼ æ„Ÿå™¨æ˜¯ PC ä¸Šæ²¡æœ‰çš„ï¼Œæ¯”å¦‚é™€èºä»ªã€‚\nåŠ é€Ÿåº¦\nVector3 accel = Input.acceleration; Debug.Log(\u0026#34;åŠ é€Ÿåº¦: \u0026#34; + accel); é™€èºä»ª\nInput.gyro.enabled = true; // è®¾å¤‡æ–¹å‘ Quaternion attitude = Input.gyro.attitude; // é‡åŠ›æ–¹å‘ Vector3 gravity = Input.gyro.gravity; // è§’é€Ÿåº¦ Vector3 rotationRate = Input.gyro.rotationRate; æŒ‡å—é’ˆ\nInput.compass.enabled = true; float heading = Input.compass.trueHeading; Debug.Log(\u0026#34;æœå‘è§’åº¦: \u0026#34; + heading); è®¾å¤‡æ–¹å‘\nif (Input.deviceOrientation == DeviceOrientation.LandscapeLeft) { Debug.Log(\u0026#34;æ¨ªå±ï¼ˆå·¦ï¼‰\u0026#34;); } è§¦æ§å±è¿™ä¸ªä½¿ç”¨èµ·æ¥çš„æ—¶å€™ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå»ºè®®é˜…è¯»ä¸‹å®˜æ–¹æ–‡æ¡£ï¼šUnity-TouchPhase\nInput API å¯ä»¥æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæ‰‹æŒ‡è§¦æ‘¸å±å¹•ï¼Œä»¥åŠæ¯ä¸ªæ‰‹æŒ‡æ˜¯ç‚¹å‡»è¿˜æ˜¯ç§»åŠ¨ç­‰ã€‚ä½ å¯ä»¥æƒ³è±¡æ˜¯æœ‰å¾ˆå¤šä¸ªé¼ æ ‡æ”¾åœ¨æ‰‹æœºå±å¹•ä¸Šï¼Œå½“ç„¶å·®åˆ«åœ¨äºè¿˜å¯ä»¥é€šè¿‡åŠå¾„æ¥æ£€æµ‹è§¦æ‘¸åŠå¾„ï¼ˆéƒ¨åˆ†è®¾å¤‡æ”¯æŒï¼‰ã€‚\nif (Input.touchCount \u0026gt; 0) { Touch touch = Input.GetTouch(0); Debug.Log($\u0026#34;è§¦æ‘¸ä½ç½®: {touch.position}, åŠå¾„: {touch.radius}, å‹åŠ›: {touch.pressure}\u0026#34;); if (touch.phase == TouchPhase.Moved) { // æŠŠå±å¹•ç§»åŠ¨é‡è½¬æˆä¸–ç•Œåæ ‡åç§» Vector3 delta = new Vector3(touch.deltaPosition.x, touch.deltaPosition.y, 0); transform.Translate(delta * 0.01f); } } 1.4 å±€é™æ€§ è™½ç„¶ç†è®ºä¸Šå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡ Input Manager å®ç°ï¼Œä½†æ˜¯æœ‰ä¸€äº›å±€é™æ€§ä¾ç„¶å­˜åœ¨ã€‚ç°åœ¨ Unity å®˜æ–¹å·²ç»æ¨èå®Œå…¨ä½¿ç”¨ Input System ç³»ç»Ÿï¼Œä¹Ÿæ¨èåœ¨é¡¹ç›®æ‰“åŒ…çš„æ—¶å€™ï¼Œä»…ä»…ä¿ç•™ Input Systemã€‚\næœ‰å‡ ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„å±€é™æ€§ï¼š\nç»‘å®šæ˜¯å›ºå®šçš„ï¼Œè¿è¡Œæ—¶æ— æ³•ä¿®æ”¹ï¼šæ‰€æœ‰è¾“å…¥æ˜ å°„éƒ½åœ¨ Project Settings â†’ Input Manager é‡Œé…ç½®ã€‚ æ¸¸æˆè¿è¡Œä¸­ä¸èƒ½åŠ¨æ€æ”¹é”®ï¼Œç©å®¶æ— æ³•è‡ªç”±è®¾ç½®æŒ‰é”®ã€‚å¦‚æœè¦åšæ”¹é”®åŠŸèƒ½ï¼Œåªèƒ½è‡ªå·±å†™ä¸€å±‚å°è£…ã€‚ ä¸æ”¯æŒæ–°çš„ç¡¬ä»¶ï¼šVR/ARã€Switch JoyConã€PS5 è‡ªé€‚åº”æ‰³æœºç­‰ã€‚ ä¸æ”¯æŒçƒ­æ’æ‹”ã€‚æ’å…¥æˆ–æ‹”å‡ºæ–°è®¾å¤‡ï¼ˆå¦‚æ‰‹æŸ„ï¼‰ï¼Œæ¸¸æˆä¸­ä¸ä¼šè‡ªåŠ¨è¯†åˆ«ã€‚ Input System å®Œå…¨æ˜¯ Input Manager çš„ä¸Šä½æ›¿ä»£ï¼Œå»ºè®®å¼€å‘çš„æ—¶å€™ç»Ÿä¸€å°±ç”¨ Input Systemï¼Œè¿™é‡Œå†™å‡º Input Manager åªæ˜¯ä¸ºäº†æ–¹ä¾¿é˜…è¯»ä¸€äº›è€ä»£ç ã€‚\n2. Input System 2.1 åˆ‡æ¢è¾“å…¥ç³»ç»Ÿ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Unity 6 ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œå®ƒé»˜è®¤å°±æ˜¯åŒæ—¶å¼€å¯ Input System å’Œ Input Manager ä¸¤ç§æ¨¡å¼ã€‚\nåœ¨é¡¹ç›®è®¾ç½®çš„ Player ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å½“å‰æ¿€æ´»çš„è¾“å…¥ç³»ç»Ÿï¼Œè¿™é‡Œå»ºè®®ä»…ä¿ç•™ Input System å³å¯ã€‚\né€‰æ‹©åéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰èƒ½ç”Ÿæ•ˆã€‚\n2.2 åŸºæœ¬çš„è¾“å…¥ ç›´æ¥æŸ¥è¯¢è®¾å¤‡çš„çŠ¶æ€ï¼Œç±»ä¼¼æ—§çš„ Input.GetKeyã€‚\nusing UnityEngine; using UnityEngine.InputSystem; public class DirectInputExample : MonoBehaviour { void Update() { if (Keyboard.current.spaceKey.wasPressedThisFrame) Debug.Log(\u0026#34;Space pressed!\u0026#34;); if (Mouse.current.leftButton.isPressed) Debug.Log(\u0026#34;Mouse Left Down\u0026#34;); if (Gamepad.current != null \u0026amp;\u0026amp; Gamepad.current.aButton.wasReleasedThisFrame) Debug.Log(\u0026#34;Gamepad A released\u0026#34;); } } è¿˜æœ‰æ›´åº•å±‚çš„ç›´æ¥è¯»å– event ä¿¡æ¯çš„æ–¹æ³•ï¼Œç›´æ¥æ³¨å†Œåˆ°è¾“å…¥äº‹ä»¶æµï¼Œä½†æ˜¯é€šå¸¸ä¸ä¼šç”¨åˆ°ï¼š\nusing UnityEngine; using UnityEngine.InputSystem; using UnityEngine.InputSystem.LowLevel; public class RawEventExample : MonoBehaviour { void OnEnable() { InputSystem.onEvent += OnInputEvent; } void OnDisable() { InputSystem.onEvent -= OnInputEvent; } void OnInputEvent(InputEventPtr eventPtr, InputDevice device) { Debug.Log($\u0026#34;Raw Event: {eventPtr.type}, Device: {device}\u0026#34;); } } 2.3 Input Action Asset åœ¨èµ„äº§çª—å£ä¸­å³é”®ç‚¹å‡» Create -\u0026gt; Input Action å¯ä»¥åˆ›å»ºä¸€ä¸ª Input Action Assetã€‚\næˆ‘ä»¬ä»¥ Unity 6 URP é¡¹ç›®é»˜è®¤çš„ Input Action Asset ä¸ºä¾‹æ¥è®²è§£ä¸€ä¸‹é…ç½®ï¼š\nAction Mapsï¼šè¡¨ç¤ºä¸€ç»„åŠ¨ä½œï¼Œç±»ä¼¼æ§åˆ¶æ¨¡å¼ï¼Œæ¯”å¦‚åœ¨æ¸¸æˆä¸­å¯ä»¥æ˜¯ Playerï¼Œåœ¨ UI ç•Œé¢åˆ™åˆ‡æ¢ä¸º UIã€‚åŒä¸€æ—¶é—´åªæ¿€æ´»ä¸€ç»„ Action Mapsã€‚ Actionsï¼šå…·ä½“çš„æ“ä½œï¼Œå³ä¾§å¯ä»¥é€‰æ‹© Action Typeï¼Œæœ‰æ•°å€¼ Valueï¼ŒæŒ‰é’® Buttonï¼Œè¿˜æœ‰ Pass Through ç›´é€šæ¨¡å¼ã€‚ä¸€ä¸ª Actions å¯ä»¥å¯¹åº”å¤šç§è¾“å…¥ï¼Œæ¯”å¦‚ Move å°±åŒæ—¶å¯¹åº”ï¼š æ‰‹æŸ„å·¦æ‘‡æ† (WASD/ä¸Šä¸‹å·¦å³æ–¹å‘é”®) æ‘‡æ†ç±»è®¾å¤‡ 2.4 ä½¿ç”¨ Player Input ç»„ä»¶ Player Input ç»„ä»¶æ˜¯æœ€ç®€å•çš„ä½¿ç”¨ Action çš„æ–¹æ³•ï¼Œå®ƒæ”¯æŒé€‰æ‹© Map å’Œé€šçŸ¥æ–¹å¼ã€‚\né€šçŸ¥æ–¹å¼æœ‰å››ç§é€‰æ‹©ï¼š\nSend Messages å’Œ Broadcast Messages Send Messages å’Œ Broadcast Messages éƒ½æ˜¯ Unity ä¸­åå°„çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨å¯¹è±¡ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚\nä¸¤ç§ä½¿ç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ Send Messages åªä¼šé€šçŸ¥å½“å‰ gameObject ï¼Œè€Œ Broadcast Messages è¿˜ä¼šé€šçŸ¥å­å¯¹è±¡ã€‚\næŒ‰ç…§ç»„ä»¶ä¸­æç¤ºçš„è¿™äº›åˆ›å»ºä¸€ä¸ªä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥æ¥æ”¶æ¶ˆæ¯äº†ã€‚ç”±äºåªä¼šåœ¨å€¼æ”¹å˜çš„æ—¶å€™å‘é€é€šçŸ¥æ¶ˆæ¯ï¼Œæ‰€ä»¥ OnMove çš„å€¼éœ€è¦ä¿å­˜ä¸‹æ¥ã€‚è€Œ OnJump åªéœ€è¦æ”¹å˜å‚ç›´é€Ÿåº¦ä¸€æ¬¡å°±å¯ä»¥ç›´æ¥å¤„ç†é€»è¾‘ã€‚\nusing UnityEngine; using UnityEngine.InputSystem; public class PlayerMovement : MonoBehaviour { [SerializeField] private float speed = 20; [SerializeField] private float jumpForce = 5; private Vector2 direction; void OnJump(InputValue value) { if (value.isPressed) { GetComponent\u0026lt;Rigidbody\u0026gt;().linearVelocity = new Vector3(0, jumpForce, 0); } } void OnMove(InputValue value) { direction = value.Get\u0026lt;Vector2\u0026gt;(); } private void Update() { transform.Translate(new Vector3(direction.x, 0, direction.y) * (Time.deltaTime * speed)); } } æµ‹è¯•ä¸‹åŸºæœ¬çš„ç§»åŠ¨å’Œè·³è·ƒï¼š\nC Sharp Events ç”¨ C# çš„äº‹ä»¶æœºåˆ¶æ¥è°ƒç”¨ï¼Œè¿™ç§æ–¹æ³•æ›´æ¸…æ™°çš„åŒºåˆ† started/canceled/performed è¿™ä¸‰ä¸ªæ—¶æœºã€‚\nå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå–æ¶ˆçš„æ—¶å€™è®°å¾—å–æ¶ˆæ³¨å†Œé€šçŸ¥ï¼Œå°¤å…¶æ˜¯åœ¨ä¸åŒå…³å¡ä¹‹é—´åˆ‡æ¢çš„æ—¶å€™ï¼Œå¦‚æœç»‘å®šäº†åˆå¿˜è®°å–æ¶ˆå¯èƒ½å°±ä¼šæœ‰ BUG ã€‚\nusing System; using UnityEngine; using UnityEngine.InputSystem; public class PlayerMovementCSharpEvents : MonoBehaviour { [SerializeField] private float speed = 20; [SerializeField] private float jumpForce = 5; private Vector2 direction; private InputAction moveAction; private InputAction jumpAction; private void Start() { PlayerInput playerInput = GetComponent\u0026lt;PlayerInput\u0026gt;(); moveAction = playerInput.actions[\u0026#34;Move\u0026#34;]; jumpAction = playerInput.actions[\u0026#34;Jump\u0026#34;]; moveAction.performed += OnMovePerformed; moveAction.canceled += OnMoveCanceled; jumpAction.started += OnJumpStarted; } void OnDestroy() { moveAction.performed -= OnMovePerformed; moveAction.canceled -= OnMoveCanceled; jumpAction.started -= OnJumpStarted; } private void OnJumpStarted(InputAction.CallbackContext obj) { GetComponent\u0026lt;Rigidbody\u0026gt;().linearVelocity = new Vector3(0, jumpForce, 0); } private void OnMoveCanceled(InputAction.CallbackContext obj) { direction = Vector2.zero; } private void OnMovePerformed(InputAction.CallbackContext obj) { direction = obj.ReadValue\u0026lt;Vector2\u0026gt;(); } private void Update() { transform.Translate(new Vector3(direction.x, 0, direction.y) * (Time.deltaTime * speed)); } } Unity Events Unity Events å±äºå¯è§†åŒ–æ‹–åŠ¨å¼ç»‘å®šï¼Œåªéœ€è¦æŠŠä¸€ä¸ªä¸ªè¢«è°ƒç”¨çš„å‡½æ•°ç»™å†™å¥½ï¼š\nusing UnityEngine; using UnityEngine.InputSystem; public class PlayerMovementUnityEvents : MonoBehaviour { [SerializeField] private float speed = 20; [SerializeField] private float jumpForce = 5; private Vector2 direction; public void Jump(InputAction.CallbackContext action) { if (action.started) { GetComponent\u0026lt;Rigidbody\u0026gt;().linearVelocity = new Vector3(0, jumpForce, 0); } } public void Move(InputAction.CallbackContext action) { direction = action.ReadValue\u0026lt;Vector2\u0026gt;(); } private void Update() { transform.Translate(new Vector3(direction.x, 0, direction.y) * (Time.deltaTime * speed)); } } ç„¶ååœ¨ç»„ä»¶æ£€è§†çª—å£ä¸­ç»‘å®šç›¸å…³çš„æ–¹æ³•å³å¯ï¼š\n2.5 Generate C# Class æœ€åˆé€‚çš„ç”¨æ³•è¿˜æ˜¯å®Œå…¨é€šè¿‡ä»£ç æ¥æ§åˆ¶è¾“å…¥ï¼Œå‰é¢ä½¿ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œè§£è€¦æ€§è¿‡äºå¼ºï¼Œåªæœ‰è¿è¡Œè¿‡ç¨‹ä¸­æ‰èƒ½ç¡®å®šæ˜¯å¦ç»‘å®šæˆåŠŸã€‚è€Œé€šè¿‡ç”Ÿæˆä»£ç çš„æ–¹å¼å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚\né¦–å…ˆæ‰¾åˆ° Input Action Assetï¼Œç„¶åå‹¾é€‰ç”Ÿæˆä»£ç  Generate C# Classï¼Œè¿™é‡Œçš„ç±»åå¯ä»¥æŒ‡å®šä¸€ä¸ªæ–°çš„ã€‚\nç”Ÿæˆä¹‹åï¼Œæœ€å¤§çš„ä¼˜åŠ¿åœ¨äºï¼Œä¹‹å‰éœ€è¦é€šè¿‡å­—ç¬¦ä¸²æ¥è¡¨ç¤ºçš„ Jump ç°åœ¨éƒ½åœ¨ç¼–è¯‘æœŸç¡®å®šäº†ï¼Œä¾‹å¦‚ä¸‹é¢çš„ï¼š\nusing UnityEngine; public class PlayerController : MonoBehaviour { private InputSystem_Actions inputActions; private void Awake() { inputActions = new InputSystem_Actions(); } private void OnEnable() { inputActions.Enable(); } private void OnDisable() { inputActions.Disable(); } private void Update() { Vector2 move = inputActions.Player.Move.ReadValue\u0026lt;Vector2\u0026gt;(); if (inputActions.Player.Jump.triggered) { Debug.Log(\u0026#34;Jump pressed!\u0026#34;); } } } 2.6 Generate C# Class å’Œ äº‹ä»¶ é€šå¸¸ä¸æ¨èåœ¨ Update ä¸­å»è½®è¯¢çš„åšæ³•ï¼Œæ›´å¥½çš„åšæ³•æ˜¯é‡‡ç”¨äº‹ä»¶çš„æœºåˆ¶ï¼Œå½“æŸä¸ªæŒ‰é’®å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œå»è°ƒç”¨ä¸€ä¸ªæŒ‡å®šçš„å‡½æ•°ã€‚\nç„¶å new InputSystem_Actions() å¤šæ¬¡ä¹Ÿæ˜¯ä¸ä¼šæœ‰å†²çªçš„ï¼Œå®ƒä»¬éƒ½èƒ½å¤Ÿæ­£å¸¸åœ¨ä¸åŒç»„ä»¶ä¸­ç‹¬ç«‹ä½¿ç”¨ã€‚ä¸è¿‡é€šå¸¸æˆ‘ä»¬è¿˜æ˜¯ä¼šä½¿ç”¨ä¸€ä¸ªç»„ä»¶æ¥è·å–æ‰€æœ‰çš„è¾“å…¥ï¼Œç„¶åé€šè¿‡äº‹ä»¶æœºåˆ¶ä¼ é€’ç»™å…¶ä»–éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªéƒ¨åˆ†éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªæ–°çš„ InputSystem_Actionsã€‚\nusing UnityEngine; using UnityEngine.InputSystem; public class PlayerController : MonoBehaviour { private InputSystem_Actions inputActions; [SerializeField] private float speed = 20; [SerializeField] private float jumpForce = 5; private Vector2 direction; private void Awake() { inputActions = new InputSystem_Actions(); } private void OnEnable() { inputActions.Player.Jump.started += OnJumpStarted; inputActions.Player.Move.performed += OnMovePerformed; inputActions.Player.Move.canceled += OnMoveCanceled; inputActions.Enable(); } private void OnDisable() { inputActions.Player.Jump.started -= OnJumpStarted; inputActions.Player.Move.performed -= OnMovePerformed; inputActions.Player.Move.canceled -= OnMoveCanceled; inputActions.Disable(); } private void OnJumpStarted(InputAction.CallbackContext ctx) { GetComponent\u0026lt;Rigidbody\u0026gt;().linearVelocity = new Vector3(0, jumpForce, 0); } private void OnMovePerformed(InputAction.CallbackContext ctx) { direction = ctx.ReadValue\u0026lt;Vector2\u0026gt;(); } private void OnMoveCanceled(InputAction.CallbackContext ctx) { direction = Vector2.zero; } private void Update() { transform.Translate(new Vector3(direction.x, 0, direction.y) * (Time.deltaTime * speed)); } } 3. è¡¥å…… 3.1 æ‰‹æŸ„æŒ¯åŠ¨ æˆ‘æ‰‹ä¸Šæœ‰ä¸€ä¸ª XBOX çš„æ‰‹æŸ„ï¼Œå®ƒæ”¯æŒè®¾ç½®ä½é¢‘æŒ¯åŠ¨å’Œé«˜é¢‘æŒ¯åŠ¨ã€‚ä½é¢‘æŒ¯åŠ¨ä¼šæœ‰æ›´å¤§çš„æŠ–åŠ¨æ„Ÿï¼Œé«˜é¢‘æ›´åƒæ˜¯æ‰‹æœºæŒ¯åŠ¨çš„é‚£ç§æé†’æ„Ÿã€‚\næŒ¯åŠ¨é€šè¿‡ Gamepad æ¥è®¾ç½®ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒæŒ‰ä¸‹ A é”®è§¦å‘æŒ¯åŠ¨ï¼ŒæŒ‰ä¸‹ X é”®åœæ­¢æŒ¯åŠ¨ã€‚è¿™é‡Œåœæ­¢å°±æ˜¯æŒ‡è®¾ç½®æŒ¯åŠ¨å€¼ä¸º 0 ã€‚\nusing UnityEngine; using UnityEngine.InputSystem; public class GamepadHaptics : MonoBehaviour { private Gamepad gamepad; private void Update() { gamepad = Gamepad.current; if (gamepad == null) return; if (gamepad.buttonSouth.wasPressedThisFrame) { // è®¾ç½®ä½é¢‘å’Œé«˜é¢‘æŒ¯åŠ¨ï¼ˆ0~1ï¼‰ gamepad.SetMotorSpeeds(0.5f, 0.5f); } if (gamepad.buttonWest.wasPressedThisFrame) { gamepad?.SetMotorSpeeds(0f, 0f); } } } 3.2 é™€èºä»ªç­‰ å’Œæ—§ç‰ˆçš„è¾“å…¥ç³»ç»Ÿä¸€æ ·ï¼ŒInput System ä¹Ÿèƒ½è¯»å–ç§»åŠ¨è®¾å¤‡ï¼ˆæ‰‹æœºã€å¹³æ¿ï¼‰çš„é™€èºä»ªå’ŒåŠ é€Ÿåº¦è®¡ã€‚\nusing UnityEngine; using UnityEngine.InputSystem; public class MobileSensors : MonoBehaviour { private void Update() { // åŠ é€Ÿåº¦ Vector3 accel = Accelerometer.current?.acceleration.ReadValue() ?? Vector3.zero; Debug.Log($\u0026#34;Acceleration: {accel}\u0026#34;); // é™€èºä»ª if (Gyroscope.current != null) { Vector3 gyro = Gyroscope.current.angularVelocity.ReadValue(); Debug.Log($\u0026#34;Gyro: {gyro}\u0026#34;); } } } 3.3 è™šæ‹Ÿæ‘‡æ† å•†åº—ä¸­æœ‰ä¸€äº›å¯ç”¨çš„èµ„æºï¼šJoystick Pack\nè¿™é‡Œè®²è§£ä¸€ä¸ªç®€å•çš„ä¸ä¾èµ–å¤–éƒ¨å®ç°çš„æ–¹å¼ï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ª UI ç•Œé¢ï¼Œç„¶ååˆ›å»ºï¼š\nImage è™šæ‹Ÿæ‘‡æ†èƒŒæ™¯ JoystickBG Image è™šæ‹Ÿæ‘‡æ† JoystickHandleï¼Œæ”¾åœ¨èƒŒæ™¯ JoystickBG çš„æ­£ä¸­é—´ ç„¶åç»™è™šæ‹Ÿæ‘‡æ† JoystickHandle ä¸Šä¸€ä¸ªç»„ä»¶ Event Triggerï¼Œå®ƒåœ¨æŒ‰ä¸‹ã€æ‹–æ‹½ã€æŠ¬èµ·çš„æ—¶å€™ï¼Œéƒ½ä¼šå‘é€äº‹ä»¶ã€‚\nä¹‹å MobileController çš„ä»£ç å¦‚ä¸‹ï¼š\né€šè¿‡ç»‘å®šäº‹ä»¶æ¥è§¦å‘æ‘‡æ†çš„æ•ˆæœ using System; using UnityEngine; using UnityEngine.EventSystems; public class MobileController : MonoBehaviour { [Header(\u0026#34;UI Elements\u0026#34;)] public RectTransform joystickBG; public RectTransform joystickHandle; [Header(\u0026#34;Settings\u0026#34;)] public float joystickMaxRange = 100f; // æ‘‡æ†æœ€å¤§ä½ç§» private Vector2 joystickInput = Vector2.zero; public event Action\u0026lt;Vector2\u0026gt; OnPerformed; private void Update() { // é€šçŸ¥ Debug.Log($\u0026#34;Joystick Input: {joystickInput}\u0026#34;); OnPerformed?.Invoke(joystickInput); } public void OnJoystickDrag(BaseEventData data) { PointerEventData pointerData = data as PointerEventData; Vector2 pos; RectTransformUtility.ScreenPointToLocalPointInRectangle( joystickBG, pointerData.position, pointerData.pressEventCamera, out pos ); // é™åˆ¶æœ€å¤§èŒƒå›´ joystickInput = Vector2.ClampMagnitude(pos / joystickMaxRange, 1f); // æ›´æ–°æ‰‹æŸ„ä½ç½®ï¼ˆUIæ•ˆæœï¼‰ joystickHandle.anchoredPosition = joystickInput * joystickMaxRange; } public void OnJoystickEndDrag(BaseEventData data) { joystickInput = Vector2.zero; joystickHandle.anchoredPosition = Vector2.zero; Debug.Log(\u0026#34;Joystick Released\u0026#34;); } } ä½¿ç”¨çš„æ—¶å€™åªè¦æ³¨å†Œåˆ°è¿™ä¸ª OnPerformed äº‹ä»¶å°±å¯ä»¥äº†ï¼š\nusing UnityEngine; public class PlayerController : MonoBehaviour { [SerializeField] MobileController mobileController; [SerializeField] private float speed = 20; [SerializeField] private float jumpForce = 5; private Vector2 direction; private void OnEnable() { mobileController.OnPerformed += MobileControllerOnOnPerformed; } private void MobileControllerOnOnPerformed(Vector2 mobileInput) { direction = mobileInput; } private void Update() { transform.Translate(new Vector3(direction.x, 0, direction.y) * (Time.deltaTime * speed)); } } çœ‹ä¸€ä¸‹æ¼”ç¤ºæ•ˆæœï¼š\n","permalink":"https://cronrpc.github.io/zh/posts/unity-input-system/","summary":"\u003cp\u003eä¸€ä¸ªç³»ç»Ÿçš„è¾“å…¥æœ‰å“ªäº›ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯ç”µè„‘ä¸Šï¼Œæœ‰é¼ æ ‡ã€é”®ç›˜ã€æ‰‹æŸ„ï¼›ä¸»æœºä¸Šä¸»è¦æ˜¯æ‰‹æŸ„ï¼›ç§»åŠ¨è®¾å¤‡ä¸Šåˆ™æ˜¯å±å¹•ã€åŠ é€Ÿåº¦è®¡ã€é™€èºä»ªã€‚\u003c/p\u003e\n\u003cp\u003eé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹æ®Šçš„åé¦ˆï¼Œä¾‹å¦‚PCæ‰‹æŸ„çš„åŸºç¡€æŒ¯åŠ¨ï¼ŒPSå¹³å°çš„æ‰‹æŸ„è¿˜æ”¯æŒåŠ›åé¦ˆå’Œå¹æ°”ï¼Œç§»åŠ¨ç«¯ä¹Ÿå¯ä»¥è§¦å‘æ‰‹æœºçš„æŒ¯åŠ¨ç­‰ã€‚\u003c/p\u003e","title":"Unity Input System"},{"content":"1. Compute Shader é€šå¸¸æˆ‘ä»¬çš„æ¸¸æˆé€»è¾‘æ˜¯è·‘åœ¨CPUä¸Šçš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›éå¸¸é€‚åˆå¹¶è¡Œè®¡ç®—çš„æ“ä½œï¼Œæ¯”å¦‚å„ç§ç²’å­è¿åŠ¨ã€æµä½“/å¸ƒæ–™æ¨¡æ‹Ÿã€å¤§é‡ AI è¡Œä¸ºç­‰ï¼Œæ›´é€‚åˆè·‘åœ¨ GPU ä¸Šã€‚è¿™æ˜¯å› ä¸º GPU çš„æ ¸å¿ƒæ•°é‡éå¸¸å¤šï¼Œå¤©ç„¶æ›´é€‚åˆå¤„ç†èƒ½å¤Ÿè¿›è¡Œå¹¶è¡Œçš„è®¡ç®—ã€‚\né™¤äº†ä¸Šé¢æ‰€ç¤ºçš„ä¸€äº›è®¡ç®—ï¼Œè¿˜æœ‰æ¯”å¦‚å›¾åƒå¤„ç†ä¹Ÿå¯ä»¥ç”¨ Compute Shaderï¼Œæ¯”å¦‚æŸç§å·ç§¯ï¼ŒæŸç§ä¸Šè‰²ï¼Œå‚…é‡Œå¶å˜æ¢ç­‰ç­‰ã€‚\nè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¼˜åŒ–è¿™ä¸ªä¸œè¥¿ï¼Œé™¤éä½ éå¸¸æ˜ç¡®è¿™ä¸ªåœ°æ–¹æœ‰ä¼˜åŒ–çš„å¿…è¦ï¼Œå¦åˆ™ä¸éœ€è¦è¿›è¡Œè¿‡æ—©ä¼˜åŒ–ã€‚ä¾‹å¦‚ sin/cos è¿™äº›å‡½æ•°åœ¨è®¡ç®—çš„æ—¶å€™ï¼Œæ˜¯å¦ç”¨ CPU è®¡ç®—è¿˜æ˜¯ç”¨ GPU åœ¨ Compute Shader ä¸­è®¡ç®—ï¼Œå¯èƒ½ä¼šæœ‰é‡å¤è®¡ç®—å¯¼è‡´çš„æ•ˆç‡ä¸Šçš„å·®åˆ«ï¼Œä½†æ˜¯é™¤äº†è®¡ç®—è¿˜æœ‰è®¿é—®æ˜¾å­˜å’Œå†…å­˜é€ æˆçš„é€šä¿¡å»¶æ—¶ç­‰ç­‰ï¼Œè€Œä¸”ä¸åŒ GPU çš„ç¡¬ä»¶æ¶æ„ä¹Ÿä¸åŒï¼Œæ‰€ä»¥åœ¨ä¸åŒç±»å‹çš„æœºå™¨ä¸Šæ•ˆæœæœªå¿…ä¸€æ ·ã€‚\n1.1 Compute Shader ä»£ç  é¦–å…ˆï¼Œåœ¨ Unity ä¸­åˆ›å»ºä¸€ä¸ª Red.compute æ–‡ä»¶ï¼Œè¿™ä¸ªåç¼€æ‰€æŒ‡çš„æ–‡ä»¶å°±æ˜¯ Compute Shader\n#pragma kernel CSMain RWTexture2D\u0026lt;float4\u0026gt; Result; [numthreads(8,8,1)] void CSMain (uint3 id : SV_DispatchThreadID) { Result[id.xy] = float4(1,0,0,1); } ä¸‹é¢ç®€å•ä»‹ç»ä¸‹ä»£ç åšäº†ä»€ä¹ˆã€‚\n#pragma kernel CSMain æ˜¯ Compute Shader çš„å…¥å£å£°æ˜ï¼ŒCSMain æ˜¯ kernel çš„åå­—ï¼Œè¡¨ç¤º GPU è°ƒç”¨æ—¶æ‰§è¡Œçš„å‡½æ•°ï¼Œåé¢ä½ ä¼šé€šè¿‡ C# Script æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚\nRWTexture2D\u0026lt;float4\u0026gt; Result; å®šä¹‰äº†ä¸€ä¸ª å¯è¯»å†™çš„ 2D çº¹ç†ï¼ˆRenderTextureï¼‰ä½œä¸ºè¾“å‡ºï¼ŒRWTexture2D\u0026lt;float4\u0026gt; è¡¨ç¤ºæ¯ä¸ªåƒç´ æ˜¯ä¸€ä¸ª float4 å‘é‡ï¼ˆRGBA æµ®ç‚¹æ•°ï¼‰ã€‚\né€šè¿‡ SetTexture å¯ä»¥æŠŠ Unity ä¸­çš„ RenderTexture ç»‘å®šåˆ°è¿™ä¸ªå˜é‡ï¼ŒRW è¡¨ç¤ºå®ƒå¯ä»¥éšæœºå†™ï¼ˆRandom Writeï¼‰ï¼ŒCompute Shader å†…å¯ä»¥éšæ„å†™ä»»æ„åƒç´ ã€‚\n[numthreads(8,8,1)] void CSMain (uint3 id : SV_DispatchThreadID) æŒ‡å®šæ¯ä¸ªçº¿ç¨‹ç»„ï¼ˆthread groupï¼‰é‡ŒåŒ…å«çš„çº¿ç¨‹æ•°ï¼Œæ€»çº¿ç¨‹æ•° = (threadGroupsX * 8, threadGroupsY * 8, threadGroupsZ * 1)ï¼Œè¿™é‡Œçš„å…·ä½“å«ä¹‰åœ¨è°ƒç”¨éƒ¨åˆ†ä¼šæ›´å¥½ç†è§£ã€‚\nid æ˜¯å…¨å±€çº¿ç¨‹ IDï¼ˆä¸æ˜¯ç»„å†…çº¿ç¨‹ IDï¼‰ï¼Œæ¯”å¦‚ (256, 256, 1) å¤§å°çš„æ•°æ®å¦‚æœé€šè¿‡ numthreads(8,8,1) å¤„ç†ï¼Œid.x çš„èŒƒå›´è¿˜æ˜¯ä» 0 åˆ° 255 ã€‚\nResult[id.xy] = float4(1,0,0,1); æŠŠå½“å‰çº¿ç¨‹å¯¹åº”åƒç´ å†™æˆ çº¢è‰²ã€‚\n1.2 è°ƒç”¨ Compute Shader é¦–å…ˆè·å– kernelIDï¼Œç„¶åé€šè¿‡ computeShader.Dispatch è¯­æ³•è¿›è¡Œè°ƒç”¨ã€‚\nè¿™é‡Œçš„ threadsX/Y/Z å¯¹åº”çš„æ˜¯ Compute Shaderé‡Œé¢çš„ [numthreads(8,8,1)]ã€‚\nä½¿ç”¨ computeShader.Dispatch æ—¶éœ€è¦çŸ¥é“æ€»å…±çš„ id èŒƒå›´æ˜¯ groupSize * groupNumberï¼Œè¿™é‡Œæ˜¯ 256/8 x 256/8 ä¸ªçº¿ç¨‹ç»„ã€‚\nusing UnityEngine; namespace Scenes.ComputeShaders.Test { public class RenderRedComputeShader: MonoBehaviour { public ComputeShader computeShader; public RenderTexture target; public Material material; void Start() { target = new RenderTexture(256, 256, 0); target.enableRandomWrite = true; target.Create(); int kernelID = computeShader.FindKernel(\u0026#34;CSMain\u0026#34;); computeShader.SetTexture(kernelID, \u0026#34;Result\u0026#34;, target); material.SetTexture(\u0026#34;_MainTex\u0026#34;, target); // å¯åŠ¨ GPU çº¿ç¨‹ï¼šè¿™é‡Œæ˜¯ 256/8 x 256/8 ä¸ªçº¿ç¨‹ç»„ computeShader.GetKernelThreadGroupSizes(kernelID, out uint threadsX, out uint threadsY, out _); computeShader.Dispatch(kernelID, 256 / (int)threadsX, 256 / (int)threadsY, 1); } } } material.SetTexture åŒæ—¶æŠŠè¿™ä¸ªçº¹ç†ç»™ç»‘å®šåˆ°äº†æè´¨ä¸Šã€‚è¿™é‡Œç”¨åˆ°çš„æè´¨å°±å•çº¯æ¥æ”¶è¿™ä¸ªçº¹ç†å¹¶ä¸”è¾“å‡ºå‡ºæ¥ã€‚\nè„šæœ¬æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼ç»‘å®š Compute Shader å’Œ Materialã€‚\nè¿è¡Œæ¸¸æˆåï¼Œå¾—åˆ°ç»“æœï¼š\nå¦‚æœæˆ‘ä»¬ä¿®æ”¹ Compute Shader æ”¹ä¸ºæ¸å˜ 2 ä¸ªé€šé“ã€‚\n#pragma kernel CSMain RWTexture2D\u0026lt;float4\u0026gt; Result; [numthreads(8,8,1)] void CSMain (uint3 id : SV_DispatchThreadID) { uint width, height; Result.GetDimensions(width, height); float u = id.x / (float)(width - 1); float v = id.y / (float)(height - 1); float4 color = float4(u, v, 0, 1); Result[id.xy] = color; } é‚£ä¹ˆå°±ä¼šå¾—åˆ°ä¸€å¼ æ¸å˜å›¾ï¼š\n1.3 åœ¨ Editor ä¸­ä½¿ç”¨ Compute Shader å¹¶ä¸æ˜¯åªæœ‰åœ¨æ¸¸æˆè¿è¡Œçš„è¿‡ç¨‹ä¸­æ‰å¯ä»¥è°ƒç”¨ Compute Shaderï¼Œåœ¨ Editor ä¸­åŒæ ·å¯ä»¥ã€‚\nä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºè¿™æ ·ä¸€ä¸ªå·¥å…·ï¼š\nä»£ç å¦‚ä¸‹ï¼š\nusing UnityEngine; using UnityEditor; using System.IO; public class CreateGradientPNG : EditorWindow { public ComputeShader computeShader; public int width = 512; public int height = 512; public string fileName = \u0026#34;GeneratedGradient.png\u0026#34;; [MenuItem(\u0026#34;Tools/Create Gradient PNG\u0026#34;)] public static void ShowWindow() { GetWindow\u0026lt;CreateGradientPNG\u0026gt;(\u0026#34;Create Gradient PNG\u0026#34;); } void OnGUI() { computeShader = (ComputeShader)EditorGUILayout.ObjectField(\u0026#34;Compute Shader\u0026#34;, computeShader, typeof(ComputeShader), false); width = EditorGUILayout.IntField(\u0026#34;Width\u0026#34;, width); height = EditorGUILayout.IntField(\u0026#34;Height\u0026#34;, height); fileName = EditorGUILayout.TextField(\u0026#34;File Name\u0026#34;, fileName); if (GUILayout.Button(\u0026#34;Generate PNG\u0026#34;)) { if (computeShader == null) { Debug.LogError(\u0026#34;Please Select Compute Shader\u0026#34;); return; } GeneratePNG(); } } void GeneratePNG() { RenderTexture rt = new RenderTexture(width, height, 0, RenderTextureFormat.ARGBFloat); rt.enableRandomWrite = true; rt.Create(); int kernel = computeShader.FindKernel(\u0026#34;CSMain\u0026#34;); computeShader.SetTexture(kernel, \u0026#34;Result\u0026#34;, rt); int threadX = 8; int threadY = 8; int groupsX = Mathf.CeilToInt(width / (float)threadX); int groupsY = Mathf.CeilToInt(height / (float)threadY); computeShader.Dispatch(kernel, groupsX, groupsY, 1); RenderTexture.active = rt; Texture2D tex = new Texture2D(width, height, TextureFormat.RGBAFloat, false); tex.ReadPixels(new Rect(0, 0, width, height), 0, 0); tex.Apply(); RenderTexture.active = null; // Save to PNG byte[] bytes = tex.EncodeToPNG(); string path = Path.Combine(Application.dataPath, fileName); File.WriteAllBytes(path, bytes); AssetDatabase.Refresh(); Debug.Log(\u0026#34;PNG å·²ç”Ÿæˆï¼š\u0026#34; + path); // Clear RenderTexture rt.Release(); DestroyImmediate(tex); } } ç‚¹å‡»åå°±å¯ä»¥ç”Ÿæˆ Compute Shader æ‰€è®¡ç®—å‡ºçš„å›¾åƒï¼š\n1.4 GPU å›¾å…ƒç±»å‹ å¦‚æœä½ å†™è¿‡ Unity Shader çš„ä»£ç ï¼Œä½ åº”è¯¥ä¼šå¾ˆç†Ÿæ‚‰ Shader çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼šé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨ã€‚\nä½†æ˜¯ï¼Œé€šå¸¸ç»å†è¿‡çš„é¡¶ç‚¹ç€è‰²å™¨æ˜¯æ§åˆ¶çš„ä¸€ä¸ªä¸‰è§’å½¢çš„ä¸‰ä¸ªç‚¹çš„å˜åŒ–ã€‚\nåœ¨è®¡ç®—æœºå›¾å½¢å­¦å’Œ GPU æ¸²æŸ“ç®¡çº¿ä¸­ï¼Œå›¾å…ƒæ˜¯ GPU ç”¨æ¥æè¿°å‡ ä½•å½¢çŠ¶çš„åŸºæœ¬å•å…ƒã€‚GPU ä¼šæ ¹æ®å›¾å…ƒç±»å‹æŠŠé¡¶ç‚¹æ•°æ®ç»„åˆæˆå‡ ä½•å›¾å½¢ï¼Œç„¶åè¿›è¡Œå…‰æ …åŒ–ã€ç€è‰²ç­‰æ“ä½œã€‚ä¸åŒçš„å›¾å…ƒç±»å‹å†³å®šäº†é¡¶ç‚¹å¦‚ä½•ç»„åˆæˆå›¾å½¢ã€‚\nä½¿ç”¨ Graphics.RenderPrimitives å¯ä»¥ç»˜åˆ¶å„ç§å›¾å…ƒï¼ŒåŒ…æ‹¬ç‚¹ã€çº¿ã€é¢ã€ä¸‰è§’å½¢ã€‚\nrp = new RenderParams(material); rp.worldBounds = new Bounds(Vector3.zero, 10000*Vector3.one); Graphics.RenderPrimitives(rp, MeshTopology.Points, 1, particleCount ); // RenderParams The parameters Unity uses to render the primitives. // topology Primitive topology (for example, triangles or lines). // vertexCount\tThe number of vertices per instance. // instanceCount\tThe number of instances to render. åˆ©ç”¨ RenderParams æ¥å®šä¹‰ç»˜åˆ¶çš„å„ç§å‚æ•°ï¼Œæ¯”å¦‚ç”¨å“ªç§æè´¨ï¼Œæ¸²æŸ“çš„èŒƒå›´ï¼Œæ¸²æŸ“çš„æ‘„åƒæœºç­‰ã€‚\nå®ƒç”Ÿæˆçš„æ¯ä¸ªå®ä¾‹çš„ç‚¹çš„ä½ç½®éƒ½æ˜¯é»˜è®¤çš„ï¼Œæ‰€ä»¥è¿™ä¸ª RenderPrimitives ç”Ÿæˆçš„è¿™äº›ç‚¹æˆ‘ä»¬éœ€è¦åœ¨æè´¨ä¸­çš„é¡¶ç‚¹ç€è‰²å™¨å»å®šä¹‰å®ƒä»¬å®é™…çš„ä½ç½®ã€‚\næ¯”å¦‚ä¸‹åˆ—çš„ Shader ç‰‡æ®µï¼Œå®ƒåœ¨é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºä¸­æœ‰ä¸€ä¸ª PSIZE ï¼Œå®ƒå®šä¹‰çš„æ˜¯ç‚¹çš„å¤§å°ã€‚\nstruct Attributes { float4 positionOS : POSITION; uint instanceID : SV_InstanceID; UNITY_VERTEX_INPUT_INSTANCE_ID }; struct Varyings { float4 positionHCS : SV_POSITION; float size: PSIZE; }; Varyings vert(Attributes IN) { Varyings OUT; Particle particle = particleBuffer[IN.instanceID]; OUT.positionHCS = TransformObjectToHClip(particle.position); OUT.size = 1; return OUT; } 2. å¹¶è¡Œè®¡ç®— æœ¬æ–‡çš„é‡ç‚¹ä¸»è¦æ˜¯åœ¨ Compute Shader å¦‚ä½•ä½¿ç”¨ï¼Œå¹¶ä¸æ˜¯æ·±å…¥ç ”ç©¶ç®—æ³•ä¹‹ç±»çš„å†…å®¹ã€‚\næ¡ˆä¾‹éƒ½æ¥è‡ª Unity å®˜æ–¹çš„ \u0026ldquo;Create popular shaders and visual effects with the Universal Render Pipeline\u0026rdquo;1ã€‚\nå¯ä»¥å‚è€ƒè§†é¢‘2å’Œ GitHub3 ä»£ç ã€‚\n2.1 ç™¾ä¸‡ç²’å­ é¦–å…ˆæ˜¯ç™¾ä¸‡ä¸ªç‚¹ï¼Œå®ƒä»¬å°†åœ¨é¼ æ ‡å‘¨å›´çš„ä½ç½®éšæœºäº§ç”Ÿï¼Œç„¶åå€¾å‘äºå¾€é¼ æ ‡æ–¹å‘å¢åŠ ç§»åŠ¨é€Ÿåº¦ã€‚\nåœ¨ Compute Shader å’Œ ç²’å­çš„ Shader ä¸­ï¼Œéƒ½ä¼šæœ‰è¿™ä¹ˆä¸€æ®µï¼š\nstruct Particle { float3 position; float3 velocity; float life; }; // In Compute Shader RWStructuredBuffer\u0026lt;Particle\u0026gt; particleBuffer; // In Shader StructuredBuffer\u0026lt;Particle\u0026gt; particleBuffer; åŒºåˆ«æ˜¯ Compute Shader ä¸­å¼€å¯äº† RW éšæœºå†™å…¥åŠŸèƒ½ï¼Œè€Œ Shader ä¸­åªéœ€è¦è¯»å–ç²’å­çš„ä½ç½®é€Ÿåº¦å’Œå£°æ˜å‘¨æœŸã€‚\nåœ¨è°ƒç”¨çš„ C# è„šæœ¬ä¸­ï¼Œåˆ›å»ºäº† ComputeBufferï¼ŒComputeBuffer æ˜¯ Unity æä¾›çš„ä¸€ç§ GPU ç¼“å†²åŒºå¯¹è±¡ï¼Œä¸»è¦ç”¨äºåœ¨ C# è„šæœ¬å’Œ GPUï¼ˆCompute Shader / Shaderï¼‰ä¹‹é—´ä¼ é€’æ•°æ®ã€‚å®ƒå¯ä»¥ç†è§£ä¸ºä¸€å—åˆ†é…åœ¨ GPU å†…å­˜ä¸Šçš„æ•°ç»„ç¼“å†²åŒºï¼Œæ”¯æŒé«˜æ•ˆåœ°å­˜å–å¤§é‡ç»“æ„åŒ–æ•°æ®ã€‚\nä¸‹é¢é¦–å…ˆåˆ›å»ºå®ƒï¼Œç„¶ååˆ†åˆ«ç»‘å®šç»™ä¸¤è€…ã€‚\nstruct Particle { public Vector3 position; public Vector3 velocity; public float life; } void Init() { // initialize the particles Particle[] particleArray = new Particle[particleCount]; // ... } // ... particleBuffer = new ComputeBuffer(particleCount, SIZE_PARTICLE); particleBuffer.SetData(particleArray); computeShader.SetBuffer(kernelID, \u0026#34;particleBuffer\u0026#34;, particleBuffer); material.SetBuffer(\u0026#34;particleBuffer\u0026#34;, particleBuffer); rp = new RenderParams(material); rp.worldBounds = new Bounds(Vector3.zero, 10000*Vector3.one); Graphics.RenderPrimitives(rp, MeshTopology.Points, 1, particleCount); æœ€åï¼Œè°ƒç”¨ RenderPrimitives ç”¨æŒ‡å®šçš„ Shader æŠŠè¿™äº› ComputeBuffer æ‰€å¯¹åº”çš„ç²’å­ç”»å‡ºæ¥å°±å¯ä»¥äº†ã€‚\nShader ä¸­æ ¹æ® instanceID æå–å‡º particleBuffer çš„å€¼ï¼Œç„¶ååšç›¸å…³å˜æ¢ï¼Œç„¶åç»˜åˆ¶ã€‚è¿™é‡Œå…³è”æœ‰ GPU å®ä¾‹åŒ– çš„ç›¸å…³æ¦‚å¿µï¼Œå»ºè®®æŸ¥é˜…ä¸‹èµ„æ–™ã€‚SV_InstanceID å°±æ˜¯ç”¨äºå°† instanceID è¾“å…¥æ ‡è®°ä¸ºGPUçš„å®ä¾‹IDã€‚UNITY_VERTEX_INPUT_INSTANCE_ID ç›´æ¥ç†è§£ä¸ºä¸€ç§éœ€è¦è®¾ç½®çš„å®å°±å¯ä»¥äº†ï¼Œå®é™…ä¸Šå®ƒå±•å¼€å°±ç­‰ä»·äºè®¾ç½®instanceID : SV_InstanceIDï¼Œè¿™é‡Œå®é™…ä¸Šä¸èµ·æ•ˆæœã€‚\nstruct Attributes { float4 positionOS : POSITION; uint instanceID : SV_InstanceID; UNITY_VERTEX_INPUT_INSTANCE_ID }; Varyings vert(Attributes IN) { Varyings OUT; Particle particle = particleBuffer[IN.instanceID]; float lerpVal = particle.life * 0.25f; OUT.color = half4(1.0f - lerpVal+0.1, lerpVal+0.1, 1.0f, lerpVal); OUT.positionHCS = TransformObjectToHClip(particle.position); OUT.size = _PointSize; return OUT; } half4 frag(Varyings IN) : SV_Target { return IN.color; } 2.2 é¸Ÿç¾¤ç®—æ³• Boids Boidsï¼ˆé¸Ÿç¾¤ç®—æ³•ï¼‰æ˜¯ Craig Reynolds åœ¨ 1986 å¹´æå‡ºçš„ä¸€ç§æ¨¡æ‹Ÿç¾¤ä½“è¡Œä¸ºçš„ç®—æ³•ï¼Œç”¨æ¥å†ç°é¸Ÿç¾¤ã€é±¼ç¾¤ç­‰ç¾¤ä½“è¿åŠ¨ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯åŸºäºä¸ªä½“ï¼ˆBoidï¼‰çš„å±€éƒ¨è§„åˆ™ï¼Œè€Œä¸æ˜¯å…¨å±€æ§åˆ¶ã€‚ä¸»è¦æœ‰ä¸‰æ¡åŸºæœ¬è§„åˆ™ï¼š\nåˆ†ç¦»ï¼ˆSeparationï¼‰ é¿å…å’Œé‚»è¿‘ä¸ªä½“è·ç¦»å¤ªè¿‘ï¼Œé˜²æ­¢ç¢°æ’ã€‚ ä¸ªä½“éå†é™„è¿‘çš„å•ä½ï¼Œæ ¹æ®è·ç¦»è®¡ç®—æ–¥åŠ›ã€‚\nå¯¹é½ï¼ˆAlignmentï¼‰ å°½é‡æœç€é‚»å±…å¹³å‡çš„æ–¹å‘é£è¡Œï¼Œä½¿ç¾¤ä½“ä¿æŒä¸€è‡´çš„ç§»åŠ¨è¶‹åŠ¿ã€‚ ä¸ªä½“éå†é™„è¿‘çš„å•ä½ï¼Œå°†æ–¹å‘æ¸æ¸å¯¹é½é™„è¿‘å•ä½çš„å¹³å‡æ–¹å‘ã€‚\nå‡èšï¼ˆCohesionï¼‰ æœå‘é‚»å±…çš„ä¸­å¿ƒé æ‹¢ï¼Œä¿æŒç¾¤ä½“çš„æ•´ä½“æ€§ã€‚ ä¸ªä½“éå†é™„è¿‘çš„å•ä½è®¡ç®—å®ƒä»¬çš„å‡ ä½•ä¸­å¿ƒï¼Œå°†ä½ç½®æ¸æ¸å¯¹é½è¿™ä¸ªä¸­å¿ƒç‚¹ã€‚\nè¿™ä¸‰æ¡è§„åˆ™ç»“åˆèµ·æ¥ï¼Œå°±èƒ½äº§ç”Ÿå‡ºè‡ªç„¶çš„ç¾¤ä½“è¡Œä¸ºæ•ˆæœï¼Œè€Œæ— éœ€å…¨å±€è§„åˆ’ã€‚å½“ç„¶ï¼Œè¿™ä¸‰æ¡åŸºæœ¬åŸåˆ™å®ç°çš„æ—¶å€™ï¼Œä¸»è¦é€šè¿‡è¿™ä¸‰æ¡è§„åˆ™è°ƒæ•´ä¸€ä¸ªç»¼åˆç›®æ ‡æ–¹å‘ï¼Œç„¶åä¸ªä½“æ¸æ¸æœå‘è¿™ä¸ªç›®æ ‡æ–¹å‘ï¼ŒåŒæ—¶æ ¹æ®æ—¶é—´æ¥è®¡ç®—åœ¨è¿™ä¸ªæ–¹å‘ä¸Šçš„ä½ç§»ã€‚\nåœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ï¼Œå…±äº«çš„æ˜¯ä½ç½®å’Œé€Ÿåº¦ï¼Œåœ¨ Compute Shader ä¸­è®¡ç®—å‡ºè¿™ä¸¤ä¸ªå€¼åï¼Œå†åœ¨ Shader ä¸­é€šè¿‡çŸ©é˜µå˜æ¢é¡¶ç‚¹ï¼Œæ¸²æŸ“å‡ºæ¥ã€‚\nstruct Boid { float3 position; float3 direction; float noise_offset; }; RWStructuredBuffer\u0026lt;Boid\u0026gt; boidsBuffer; ç®—æ³•è®¡ç®—ä¸Šï¼Œå¯¹æ¯ä¸ªç‚¹éƒ½ä¼šéå†å…¶ä»–æ‰€æœ‰ç‚¹ï¼Œç„¶åè®¡ç®— Boids ç®—æ³•å¯¹åº”çš„ä¸‰ä¸ªè§„åˆ™ï¼Œè®¡ç®—å‡ºæ–¹å‘å’Œä½ç§»ã€‚\n[numthreads(256,1,1)] void CSMain (uint3 id : SV_DispatchThreadID) { Boid boid = boidsBuffer[id.x]; float3 separation = 0; float3 alignment = 0; float3 cohesion = flockPosition; uint nearbyCount = 1; // Add self that is ignored in loop for (uint i = 0; i \u0026lt; (uint)boidsCount; i++) { if (i == id.x) continue; Boid tempBoid = boidsBuffer[i]; float dist = distance(boid.position, tempBoid.position); if (dist \u0026lt; neighbourDistance) { float3 offset = boid.position - tempBoid.position; dist = max(dist, 0.000001);//Avoid division by zero separation += offset * (1.0/dist - 1.0/neighbourDistance); alignment += tempBoid.direction; cohesion += tempBoid.position; nearbyCount += 1; } } float avg = 1.0 / nearbyCount; alignment *= avg; cohesion *= avg; cohesion = normalize(cohesion - boid.position); float3 direction = alignment + separation + cohesion; boid.direction = lerp(normalize(boid.direction), direction, 0.01); boid.position += (boid.direction * boidSpeed * deltaTime); boidsBuffer[id.x] = boid; } åœ¨ Shader ä¸­ä¾ç„¶æ˜¯é€šè¿‡è¯»å– ComputeBuffer é‡Œçš„å€¼ï¼Œå»ç§»åŠ¨é¡¶ç‚¹ï¼ˆæˆ–è€…æ„å»ºä¸€ä¸ªæ—‹è½¬ç§»åŠ¨çŸ©é˜µï¼‰ï¼Œä¹‹åå°±éƒ½æ˜¯æ­£å¸¸çš„æ¸²æŸ“è¿‡ç¨‹äº†ã€‚\nfloat4x4 create_matrix(float3 pos, float3 dir, float3 up) { float3 zaxis = normalize(dir); float3 xaxis = normalize(cross(up, zaxis)); float3 yaxis = cross(zaxis, xaxis); return float4x4( xaxis.x, yaxis.x, zaxis.x, pos.x, xaxis.y, yaxis.y, zaxis.y, pos.y, xaxis.z, yaxis.z, zaxis.z, pos.z, 0, 0, 0, 1 ); } Boid boid = boidsBuffer[input.instanceID]; float4x4 mat = create_matrix(boid.position, boid.direction, float3(0.0, 1.0, 0.0)); ç„¶åæ¥ä¸‹æ¥å®è·µä¸Šçš„å…³é”®æ˜¯ï¼Œå¦‚ä½•ç»˜åˆ¶è¿™ä¹ˆå¤š Mesh å‘¢ï¼Ÿ\nåˆ©ç”¨ Graphics.RenderMeshIndirectï¼Œè®¾ç½®å¥½æ¸²æŸ“çš„æ•°é‡å’Œæè´¨å³å¯ã€‚RenderMeshIndirect é€‚åˆå¤§è§„æ¨¡ã€GPU å†³å®šç»˜åˆ¶ï¼Œå¯ä»¥åšçœŸæ­£çš„å¤§é‡ç²’å­ã€è‰ã€GPU LODï¼ŒCPU è´Ÿæ‹…æå°ã€‚ä¸ä¹‹ç›¸å¯¹çš„è¿˜æœ‰ä¸ª DrawMeshInstancedï¼Œæ¯æ¬¡æ¸²æŸ“è¦ä¼ é€’è¿›å»çŸ©é˜µï¼Œä¸å¤ªæ–¹ä¾¿ã€‚\nargsBuffer = new GraphicsBuffer(GraphicsBuffer.Target.IndirectArguments, 1, GraphicsBuffer.IndirectDrawIndexedArgs.size); GraphicsBuffer.IndirectDrawIndexedArgs[] data = new GraphicsBuffer.IndirectDrawIndexedArgs[1]; // The number of vertex indices per instance. data[0].indexCountPerInstance = boidMesh.GetIndexCount(0); // The number of instances to render. data[0].instanceCount = (uint)numOfBoids; argsBuffer.SetData(data); renderParams = new RenderParams(boidMaterial); renderParams.worldBounds = new Bounds(Vector3.zero, Vector3.one * 1000); Graphics.RenderMeshIndirect(renderParams, boidMesh, argsBuffer); 2.3 å¸¦æœ‰åŠ¨ç”»çš„å•ä½ åœ¨ Compute Shader ä¸­ä¾ç„¶è¿˜æ˜¯è®¡ç®—é¡¶ç‚¹ä½ç½®ï¼Œä½†æ˜¯è¿˜å¤šè®¡ç®—ä¸€ä¸ªåŠ¨ç”»å¸§çš„å€¼ï¼Œæ ¹æ®é€Ÿåº¦ã€æ—¶é—´æ¥æ’å€¼ã€‚\nboid.frame = boid.frame + velocity * deltaTime * boidFrameSpeed; if (boid.frame \u0026gt;= numOfFrames) boid.frame -= numOfFrames; åŒæ—¶åœ¨ Shader ä¸­å¤šä¸€ä¸ª vertexAnimation è¡¨ç¤ºé¡¶ç‚¹åŠ¨ç”»ï¼Œå®ƒæ˜¯\nstruct Boid { float3 position; float3 direction; float noise_offset; float frame; float3 padding; }; StructuredBuffer\u0026lt;Boid\u0026gt; boidsBuffer; StructuredBuffer\u0026lt;float4\u0026gt; vertexAnimation; åº”ç”¨çš„æ—¶å€™æ˜¯è¯»å– vertexAnimation æ¥å¾—åˆ°åº”ç”¨åŠ¨ç”»åçš„ä½ç½®ï¼Œä¹‹åå†è¿›è¡Œ MVPã€‚\n#ifdef FRAME_INTERPOLATION uint next = boid.frame + 1; if (next \u0026gt;= numOfFrames) next = 0; float frameInterpolation = frac(boidsBuffer[input.instanceID].frame); input.positionOS.xyz = lerp(vertexAnimation[input.vertexID * numOfFrames + boid.frame], vertexAnimation[input.vertexID * numOfFrames + next], frameInterpolation); #else input.positionOS.xyz = vertexAnimation[input.vertexID * numOfFrames + boid.frame]; #endif è¿™ä¸ªç³»ç»Ÿé‡Œ Animator çš„ä½œç”¨åœ¨åˆå§‹åŒ–é˜¶æ®µå°±ç»“æŸäº†ï¼Œè¿è¡Œæ—¶ Boid å·²ç»ä¸å†ä¾èµ– Unity åŠ¨ç”»ç³»ç»Ÿï¼Œè€Œæ˜¯å®Œå…¨ä¾èµ– GPU Buffer ä¸­çš„çƒ˜ç„™é¡¶ç‚¹åŠ¨ç”» + Boid æ•°æ® æ¥æ§åˆ¶ç§»åŠ¨å’Œæ’­æ”¾åŠ¨ç”»ã€‚\nå°†è’™çš®ç½‘æ ¼ä¸­çš„ç½‘æ ¼æå–å‡ºæ¥ã€‚\nboidSMR = boidObject.GetComponentInChildren\u0026lt;SkinnedMeshRenderer\u0026gt;(); boidMesh = boidSMR.sharedMesh; çƒ˜ç„™ç„¶åå­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚\nanimator.Play(aniStateInfo.shortNameHash, iLayer, sampleTime); animator.Update(0f); boidSMR.BakeMesh(bakedMesh); for(int j = 0; j \u0026lt; vertexCount; j++) { Vector4 vertex = bakedMesh.vertices[j]; vertex.w = 1; vertexAnimationData[(j * numOfFrames) + i] = vertex; } æœ€åä¼ é€’ç»™ Shader è¿™ä¸ªåŠ¨ç”»ç½‘æ ¼çš„å˜åŒ–åæ ‡\nvertexAnimationBuffer.SetData(vertexAnimationData); boidMaterial.SetBuffer(\u0026#34;vertexAnimation\u0026#34;, vertexAnimationBuffer); Unity, Create popular shaders and visual effects with the Universal Render Pipeline, https://unity.com/resources/create-shaders-visual-effects-urp-unity-6\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nUnity, URP Cookbook: Compute shaders - Part 1: Particle fun, https://www.youtube.com/watch?v=omZap7XHxKc\u0026ab_channel=Unity\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nNikLever, GitHub, https://github.com/NikLever/Unity-URP-Cookbook-Unity6\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/unity-compute-shader/","summary":"\u003ch2 id=\"1-compute-shader\"\u003e1. Compute Shader\u003c/h2\u003e\n\u003cp\u003eé€šå¸¸æˆ‘ä»¬çš„æ¸¸æˆé€»è¾‘æ˜¯è·‘åœ¨CPUä¸Šçš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›éå¸¸é€‚åˆå¹¶è¡Œè®¡ç®—çš„æ“ä½œï¼Œæ¯”å¦‚å„ç§ç²’å­è¿åŠ¨ã€æµä½“/å¸ƒæ–™æ¨¡æ‹Ÿã€å¤§é‡ AI è¡Œä¸ºç­‰ï¼Œæ›´é€‚åˆè·‘åœ¨ GPU ä¸Šã€‚è¿™æ˜¯å› ä¸º GPU çš„æ ¸å¿ƒæ•°é‡éå¸¸å¤šï¼Œå¤©ç„¶æ›´é€‚åˆå¤„ç†èƒ½å¤Ÿè¿›è¡Œå¹¶è¡Œçš„è®¡ç®—ã€‚\u003c/p\u003e","title":"Unity Compute Shader"},{"content":"1. ä»å‚…é‡Œå¶å˜æ¢åˆ°æ‹‰æ™®æ‹‰æ–¯å˜æ¢ 1.1 å‚…é‡Œå¶å˜æ¢çš„å±€é™ å‚…é‡Œå¶å˜æ¢çš„å…¬å¼ï¼š\n$$ \\begin{aligned} F(\\omega) \u0026amp;= \\int_{-\\infin}^{\\infin}{f(t) e^{-j\\omega t} dt} \\end{aligned} $$\nå…¶ä¸­çš„æŒ‡æ•°éƒ¨åˆ†å¯ä»¥å†™ä¸ºï¼š\n$$ e^{-jwt}=\\cos{wt}-j\\sin{wt} $$\nä½†æ˜¯å¯¹äºå‡½æ•°æ¯”å¦‚ $f(t) = t^2$ ä¼šå‘ç°æ ¹æœ¬ç§¯åˆ†ä¸äº†ï¼Œå› ä¸ºåœ¨æ— ç©·èŒƒå›´å†…ç§¯åˆ†çš„ç»“æœæ˜¯æ— ç©·ã€‚\nç»å…¸çš„å‚…é‡Œå¶å˜æ¢ï¼ˆéå¹¿ä¹‰å®šä¹‰ï¼‰é€šå¸¸è¦æ±‚ ç»å¯¹å¯ç§¯æ¡ä»¶ï¼š\n$$ \\int_{-\\infin}^{\\infin} |f(t)| dt \u0026lt; \\infin $$\nåœ¨å·¥ç¨‹ä¸­æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å¤„ç†è¿™ç§ä¸æ”¶æ•›çš„å‡½æ•°ï¼š\nåŠ çª—ï¼šåªåœ¨æœ‰é™åŒºé—´å†…è€ƒè™‘å‡½æ•° ä¸“ç”¨æ‹‰æ™®æ‹‰æ–¯å˜æ¢ï¼šæ‹‰æ™®æ‹‰æ–¯å˜æ¢èƒ½å¤„ç†å‘æ•£æƒ…å†µï¼Œæ¡ä»¶æ¯”å‚…é‡Œå¶å˜æ¢å®½æ¾ã€‚ é‚£ä¹ˆå¦‚æœè¿˜æ˜¯å¸Œæœ›èƒ½å¤Ÿåˆ†æè¿™ç§å‡½æ•°ï¼Œä¸€ä¸ªå¯è¡Œçš„æ–¹å¼æ˜¯ä¹˜ä»¥æŸä¸ªæŒ‡æ•°å‡½æ•°ï¼Œè®©å®ƒå¯ä»¥é‡æ–°å˜æˆä¸€ä¸ªå¯ç§¯çš„å‡½æ•°ã€‚\nè¿™é‡Œåªè€ƒè™‘ç§¯åˆ†æ­£åŠéƒ¨åˆ†ï¼Œæ‹‰æ™®æ‹‰æ–¯å˜æ¢é€šå¸¸åªè€ƒè™‘æ­£åŠéƒ¨åˆ†ã€‚\næœ‰ï¼š\n$$ \\int_{0}^{\\infin}{e^{-3 t} t^2 dt} = \\frac{2}{27} $$\næ»¡è¶³ ç»å¯¹å¯ç§¯æ¡ä»¶ ã€‚\nå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªæŒ‡æ•°éƒ¨åˆ†å®šä¹‰ä¸º $\\sigma$ï¼Œå®šä¹‰ $s = \\sigma + j\\omega$ï¼ŒæŒ‡æ•°éƒ¨åˆ†å¯ä»¥è¡¨è¿°ä¸º\n$$ e^{-\\sigma t}e^{-j\\omega t} = e^{-(\\sigma + j\\omega)t} = e^{-st} $$\nè¿™å°±å¼•å‡ºäº†ä¸‹é¢çš„æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€‚\næ¢å¥è¯è¯´ï¼Œå‚…é‡Œå¶å˜æ¢æ˜¯æ‹‰æ™®æ‹‰æ–¯å˜æ¢åœ¨ $\\sigma = 0$ æ—¶çš„ç‰¹æ®Šå½¢å¼ã€‚\n1.2 æ‹‰æ™®æ‹‰æ–¯å˜æ¢ æ‹‰æ™®æ‹‰æ–¯å˜æ¢ï¼ˆåˆç§°ä¸ºæ‹‰å¼å˜æ¢ï¼‰æ˜¯å°†æ—¶é—´åŸŸå‡½æ•° $f(t)$ï¼ˆé€šå¸¸æ˜¯ $t \\ge 0$ çš„ä¿¡å·æˆ–å‡½æ•°ï¼‰æ˜ å°„åˆ°å¤é¢‘åŸŸå‡½æ•° $F(s)$ çš„ä¸€ç§æ–¹æ³•ï¼Œå…¬å¼ä¸ºï¼š\n$$ F(s) = \\mathcal{L}{f(t)} = \\int_{-\\infin}^{\\infin} f(t) e^{-st} dt $$\nå…¶ä¸­ï¼š\n$t$ æ˜¯æ—¶é—´å˜é‡ã€‚ $s$ æ˜¯å¤é¢‘åŸŸå˜é‡ï¼Œé€šå¸¸å†™ä½œ $s = \\sigma + j\\omega$ã€‚ $F(s)$ æ˜¯ $f(t)$ çš„æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€‚ è¿™é‡Œçš„ç¬¦å· $\\mathcal{L}(f(t))$ è¡¨ç¤ºå¯¹ $f(t)$ åšæ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€‚\nå¦‚æœæŠŠ $t^2 (t\u0026gt;0)$ é¢‘åŸŸæ‰“å°å‡ºæ¥ï¼Œé«˜åº¦ç”¨ $F(s)$ çš„å¹…åº¦è¡¨ç¤ºï¼ˆç›¸ä½åœ¨è¿™é‡Œç¡®å®ä¹Ÿä¸å…³é”®ï¼‰ï¼Œå¯ä»¥å¾—åˆ°ä¸€å¼ å¤å¹³é¢ä¸Šæ‹‰æ™®æ‹‰æ–¯å˜æ¢çš„å¹…å€¼å›¾ï¼š\næ‹‰æ™®æ‹‰æ–¯åå˜æ¢ï¼š$F(s) \\to f(t)$\n$$ f(t) = \\frac{1}{2\\pi j} \\int_{\\gamma - j\\infin}^{\\gamma + j\\infin} F(s) e^{st} ds $$\nå…¶ä¸­\n$\\gamma$ æ˜¯å®è½´ä¸Šä¸€ä¸ªå¸¸æ•°ï¼Œä½¿ç§¯åˆ†è·¯å¾„åœ¨ $F(s)$ çš„æ‰€æœ‰å¥‡ç‚¹å³ä¾§ $s = \\sigma + j\\omega$ è¿™é‡Œè¡¥å……è¯´æ˜ä¸‹ï¼Œå¥‡ç‚¹æ˜¯æŒ‡ $F(s)$ ä¸å­˜åœ¨æˆ–è€…å‘æ•£çš„ç‚¹ï¼Œæ¯”å¦‚ $F(s)=\\frac{2}{s^3}$ çš„å¥‡ç‚¹æ˜¯ $s = 0$ã€‚â€œå³ä¾§â€æ„æ€æ˜¯é€‰ä¸€ä¸ªå®æ•° $\\gamma$ï¼Œä½¿å¾—è¿™æ¡å‚ç›´çº¿ $s = \\gamma + j\\omega$ ä½äºæ‰€æœ‰å¥‡ç‚¹çš„å³è¾¹ï¼Œè¿™æ ·ç§¯åˆ†è·¯å¾„ç»è¿‡çš„åœ°æ–¹ï¼Œ$F(s)e^{st}$ åœ¨ç§¯åˆ†æ–¹å‘ä¸Šæ˜¯æ”¶æ•›çš„ï¼ˆå‡å®šåŸæœ¬ç§¯åˆ†æ˜¯ t \u0026gt; 0ï¼‰ï¼Œå¦‚æœè·¯å¾„ç©¿è¿‡å¥‡ç‚¹ï¼Œç§¯åˆ†ä¼šå‘æ•£æˆ–è€…ä¸æ»¡è¶³å…¬å¼è¦æ±‚ã€‚\n1.3 å•è¾¹æ‹‰æ™®æ‹‰æ–¯å˜æ¢ å·¥ç¨‹é¢†åŸŸï¼Œä¸€èˆ¬é»˜è®¤æ‹‰æ°å˜æ¢ä¼šå¯¹åŸå‡½æ•°å…ˆä¹˜ä»¥é˜¶è·ƒå‡½æ•°å†å˜æ¢ï¼Œé˜¶è·ƒå‡½æ•°æ˜¯ï¼š\n$$ u(t)= \\begin{cases} \u0026amp;1, \u0026amp; t \\ge 0\\\\ \u0026amp;0, \u0026amp; t \\lt 0 \\end{cases} $$\næ‰€ä»¥ç§¯åˆ†åªéœ€è¦åœ¨ $[0, +\\infin]$ ä¹‹é—´è¿›è¡Œç§¯åˆ†ï¼Œè¿™è¢«ç§°ä¸º å•è¾¹æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€‚\né¦–å…ˆä»”ç»†æ¨å¯¼ä¸€ä¸‹ $f(x) = 1$ çš„æ‹‰æ™®æ‹‰æ–¯å˜æ¢ã€‚\næ‹‰æ™®æ‹‰æ–¯å˜æ¢çš„å®šä¹‰æ˜¯ï¼š\n$$ \\mathcal{L}{f(t)} = F(s) = \\int_0^{\\infin} f(t) e^{-st} dt $$\nè¿™é‡Œ $f(t) = 1$ï¼Œæ‰€ä»¥ï¼š\n$$ \\mathcal{L}{1} = \\int_0^{\\infin} 1 \\cdot e^{-st} dt = \\int_0^{\\infin} e^{-st} dt $$\nè¿™ä¸ªç§¯åˆ†å¯ä»¥ç›´æ¥è®¡ç®—ï¼š\n$$ \\int_0^{\\infin} e^{-st} dt = \\left[ -\\frac{1}{s} e^{-st} \\right]_0^{\\infin} $$\nå½“ $\\Re(s) \u0026gt; 0$ ä¸” $t \\to \\infin$ æ—¶ï¼Œ$e^{-st} \\to 0$ï¼Œæ‰€ä»¥ï¼š\n$$ \\int_0^{\\infin} e^{-st} dt = lim_{t \\to \\infin}{(-\\frac{1}{s} e^{-st})} - (-\\frac{1}{s} e^{-s \\cdot 0}) = 0 - \\left(-\\frac{1}{s}\\right) = \\frac{1}{s} $$\nç»“è®ºï¼š\n$$ \\boxed{\\mathcal{L}{1} = \\frac{1}{s}, \\quad \\Re(s) \u0026gt; 0} $$\nå®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸€ä¸ªä¸ªç®—ï¼Œå¤šæ•°æƒ…å†µç›´æ¥æŸ¥è¡¨å³å¯ï¼š\næ—¶åŸŸ $f(t)$ é¢‘åŸŸ $F(s)$ $u(t)$ $\\frac{1}{s}$ $u(t)e^{-at}$ $\\frac{1}{s+a}$ $t u(t)$ $\\frac{1}{s^2}$ $u(t) \\sin \\omega t$ $\\frac{\\omega}{s^2 + \\omega^2}$ $u(t) \\cos \\omega t$ $\\frac{s}{s^2 + \\omega^2}$ $u(t)e^{-at} \\sin \\omega t$ $\\frac{\\omega}{(s+a)^2 + \\omega^2}$ $u(t)e^{-at} \\cos \\omega t$ $\\frac{s+a}{(s+a)^2 + \\omega^2}$ ç„¶ååˆ©ç”¨æ‹‰æ™®æ‹‰æ–¯å˜æ¢çš„ä¸€äº›ç‰¹æ€§æ¥æ±‚è§£ã€‚\n1.4 ç§¯åˆ†ç‰¹æ€§ï¼šå˜ä¸Šé™ç§¯åˆ†çš„é¢‘åŸŸ $$ \\mathcal{L} \\left( \\int_0^t{f(\\tau)d\\tau} \\right) = \\frac{F(s)}{s} $$\nè¯æ˜å¦‚ä¸‹ï¼š\nå®šä¹‰\n$$ g(t) = \\int_0^t f(\\tau) d\\tau $$\næ ¹æ®æ‹‰æ™®æ‹‰æ–¯å®šä¹‰ï¼š\n$$ \\mathcal{L}{g(t)} = \\int_0^\\infin g(t) e^{-st} dt = \\int_0^\\infin \\left( \\int_0^t f(\\tau) d\\tau \\right) e^{-st} dt $$\näº¤æ¢ç§¯åˆ†é¡ºåº\n$$ \\int_0^\\infin \\left( \\int_0^t f(\\tau) d\\tau \\right) e^{-st} dt = \\int_0^\\infin f(\\tau) \\left( \\int_\\tau^\\infin e^{-st} dt \\right) d\\tau $$\nè®¡ç®—å†…å±‚ç§¯åˆ†\n$$ \\int_\\tau^\\infin e^{-st} dt = \\left[ \\frac{-1}{s} e^{-st} \\right]_{t=\\tau}^{t=\\infin} = \\frac{e^{-s\\tau}}{s} $$\nå›ä»£å¤–å±‚ç§¯åˆ†\n$$ \\mathcal{L}{g(t)} = \\int_0^\\infin f(\\tau) \\frac{e^{-s\\tau}}{s} d\\tau = \\frac{1}{s} \\int_0^\\infin f(\\tau) e^{-s\\tau} d\\tau = \\frac{F(s)}{s} $$\n1.5 å¾®åˆ†ç‰¹æ€§ï¼šæ‹‰æ°å˜æ¢ n é˜¶å¯¼æ•°å…¬å¼ 1 é˜¶å¯¼æ•° å¯¹äº $f(t)$ çš„å¯¼æ•°ï¼Œè¿›è¡Œæ‹‰å¼å˜æ¢å¯ä»¥å¾—åˆ°ï¼š\n$$ \\mathcal{L}{f{\u0026rsquo;}(t)} = sF(s) - f(0) $$\nè¯æ˜è¿‡ç¨‹ï¼š\nä»å®šä¹‰å‡ºå‘ï¼Œ\n$$ \\mathcal{L}{f\u0026rsquo;(t)}=\\int_0^\\infin f\u0026rsquo;(t)e^{-st} dt. $$\nåšåˆ†éƒ¨ç§¯åˆ†ï¼ˆå– $u=f(t),\\ dv=e^{-st}dt$ï¼‰ï¼Œå¾—åˆ°\n$$ \\int_0^\\infin f\u0026rsquo;(t)e^{-st}dt=\\Big[f(t)e^{-st}\\Big]_0^\\infin + s\\int_0^\\infin f(t)e^{-st}dt. $$\nåœ¨æŒ‡æ•°è¡°å‡æ¡ä»¶ä¸‹ $\\lim_{t\\to\\infin}f(t)e^{-st}=0$ï¼Œå› æ­¤è¾¹ç•Œé¡¹ä¸º $-f(0)$ã€‚äºæ˜¯\n$$ \\mathcal{L}{f\u0026rsquo;(t)}=sF(s)-f(0), $$\næˆç«‹ã€‚\nè¿™é‡Œæ 2 ç‚¹ï¼š\næœ‰çš„æ—¶å€™æŠŠ $f(0)$ å†™æˆ $f(0^{+})$ï¼ŒæŒ‡çš„æ˜¯ å³ä¾§æé™ï¼Œè¿™é‡Œæ˜¯å¼ºè°ƒæ˜¯åœ¨ $ t \u0026gt; 0 $ çš„èŒƒå›´ï¼Œæ‰€ä»¥å–å³ä¾§æé™ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ $f(0)$ åœ¨è¿™é‡Œå®é™…ä¸Šæ˜¯åŸå‡½æ•°ä¸­çš„ç›´æµåˆ†é‡ï¼Œå› ä¸ºæ¯æ±‚ä¸€é˜¶å¯¼æ•°ï¼ŒåŸå‡½æ•°ä¸­çš„å¸¸æ•°é¡¹å°±æ¶ˆå¤±äº†ï¼Œ$F(s)$ æ˜¯åŸå‡½æ•°çš„æ‹‰å¼å˜æ¢ï¼Œå¦‚æœ $sF(s)$ èƒ½è¡¨ç¤ºå¯¼æ•°çš„æ‹‰å¼å˜æ¢ï¼Œå°±è‚¯å®šéœ€è¦æŠŠåŸæ¥çš„ç›´æµåˆ†é‡ç»™å»æ‰ã€‚ n é˜¶å¯¼æ•° å¯¹å› æœå‡½æ•°ï¼ˆå› æœå‡½æ•°åœ¨â€œç³»ç»Ÿå¼€å§‹å“åº”ä¹‹å‰æ²¡æœ‰ä»»ä½•è¾“å‡ºâ€ï¼‰ï¼Œæœ‰\n$$ \\mathcal{L}{f^{(n)}(t)}=s^n F(s)-s^{n-1}f(0)-s^{n-2}f\u0026rsquo;(0)-\\cdots-f^{(n-1)}(0), $$\nå…¶ä¸­ $F(s)=\\mathcal{L}{f(t)}$ï¼Œä¸” $f,f\u0026rsquo;,\\dots,f^{(n-1)}$ åœ¨ $t=0^+$ å­˜åœ¨ï¼Œä¸” $f$ ä¸ºæŒ‡æ•°é˜¶ä½¿ç§¯åˆ†æ”¶æ•›ã€‚\næ¯”å¦‚å¯¹äº 2 é˜¶å¯¼æ•°\n$$ \\mathcal{L}{f\u0026rsquo;\u0026rsquo;(t)} = s^2 F(s) - s f(0) - f\u0026rsquo;(0), $$\nè¿™ä¸ª n é˜¶çš„è¯æ˜è¿‡ç¨‹ä¸åœ¨è¿™é‡Œå†™äº†ï¼Œé€šè¿‡å½’çº³æ³•å¯ä»¥è¯æ˜ã€‚\n1.6 çº¿æ€§æ€§è´¨ æ‹‰æ™®æ‹‰æ–¯å˜æ¢æ˜¯çº¿æ€§çš„ï¼š\n$$ \\mathcal{L}{a f(t) + b g(t)} = a F(s) + b G(s) $$\nå…¶ä¸­ $a, b$ æ˜¯å¸¸æ•°ï¼Œ$F(s) = \\mathcal{L}{f(t)}$ï¼Œ$G(s) = \\mathcal{L}{g(t)}$ã€‚\nè¿™æ„å‘³ç€æˆ‘ä»¬å¯¹æ¯ä¸ªåˆ†é‡å¥—å…¬å¼å†åšçº¿æ€§åŠ å‡æ³•ï¼Œå®Œå…¨æ˜¯å¯è¡Œçš„ã€‚\n2. æ±‚è§£å¸¸å¾®åˆ†æ–¹ç¨‹ è§£å¾®åˆ†æ–¹ç¨‹ï¼š\n$$ y\u0026rsquo;\u0026rsquo; + 3y\u0026rsquo; + 2y = e^{-t}, \\quad y(0) = 0, \\quad y\u0026rsquo;(0) = 0 $$\nå½“ç„¶ä¸æ­¢ä¸€ç§æ–¹æ³•ï¼Œè¿™é‡Œä»‹ç»çš„æ˜¯å¦‚ä½•ç”¨æ‹‰æ™®æ‹‰æ–¯å˜æ¢æ¥è§£ã€‚\næ‹‰æ™®æ‹‰æ–¯å˜æ¢å¯ä»¥æŠŠå¾®åˆ†è¿ç®—è½¬æ¢æˆä»£æ•°è¿ç®—ï¼Œä»è€ŒæŠŠä¸€ä¸ªå¾®åˆ†æ–¹ç¨‹å˜æˆä¸€ä¸ªä»£æ•°æ–¹ç¨‹ã€‚\nå› ä¸ºæ‹‰æ™®æ‹‰æ–¯å˜æ¢æŠŠåŸæ¥çš„å„ç§å¾®åˆ†ï¼Œéƒ½å˜æˆäº† $sF(s)$ æ‰€è¡¨è¾¾è¿™ç§ç±»ä¼¼çš„å½¢å¼ã€‚\n2.1 å¯¹æ–¹ç¨‹è¿›è¡Œæ‹‰æ™®æ‹‰æ–¯å˜æ¢ ä»¤\n$$ \\mathcal{L}\\left[y(t)\\right] = Y(s) $$\næ ¹æ®å¯¹å¯¼æ•°æ±‚æ‹‰æ™®æ‹‰æ–¯å˜æ¢çš„æ€§è´¨ï¼š\n$$ \\mathcal{L}{y\u0026rsquo;} = sY(s) - y(0) $$\n$$ \\mathcal{L}{y\u0026rsquo;\u0026rsquo;} = s^2 Y(s) - s y(0) - y\u0026rsquo;(0) $$\nä»£å…¥åˆå€¼ $y(0)=0, y\u0026rsquo;(0)=0$ï¼š\n$$ \\mathcal{L}{y\u0026rsquo;\u0026rsquo;} = s^2 Y(s) $$\n$$ \\mathcal{L}{3y\u0026rsquo;} = 3s Y(s) $$\n$$ \\mathcal{L}{2y} = 2 Y(s) $$\n$$ \\mathcal{L}{e^{-t}} = \\frac{1}{s+1} $$\næ‰€ä»¥æ–¹ç¨‹å˜ä¸ºï¼š\n$$ s^2 Y(s) + 3s Y(s) + 2 Y(s) = \\frac{1}{s+1} $$\n2.2 æ±‚è§£ä»£æ•°æ–¹ç¨‹ æå– $Y(s)$ï¼š\n$$ Y(s) (s^2 + 3s + 2) = \\frac{1}{s+1} $$\nåˆ†è§£å› å¼ï¼š\n$$ s^2 + 3s + 2 = (s+1)(s+2) $$\næ‰€ä»¥ï¼š\n$$ Y(s) = \\frac{1}{(s+1)^2 (s+2)} $$\n2.3 åæ‹‰æ™®æ‹‰æ–¯å˜æ¢ é¦–å…ˆè¿›è¡Œå› å¼åˆ†è§£ï¼Œå› ä¸ºæ‹†åˆ†åæ‰å¯ä»¥æ–¹ä¾¿å¥—å…¬å¼ç›´æ¥åšåæ‹‰æ™®æ‹‰æ–¯å˜æ¢\n$$ \\frac{1}{(s+1)^2 (s+2)} = \\frac{A}{s+1} + \\frac{B}{(s+1)^2} + \\frac{C}{s+2} $$\nä¸¤è¾¹é€šåˆ†ï¼š\n$$ 1 = A(s+1)(s+2) + B(s+2) + C(s+1)^2 $$\né€šè¿‡ä»£å…¥ $s=-1, -2$ æˆ–ç³»æ•°æ¯”è¾ƒï¼Œæ±‚å‡ºï¼š\n$s=-1$ â†’ $1 = B(1) \\Rightarrow B=1$ $s=-2$ â†’ $1 = C(1) \\Rightarrow C=1$ é€‰æ‹© $s=0$ â†’ $1 = A(2) + B(2) + C(1) = 2A + 2 + 1 \\Rightarrow 2A = -2 \\Rightarrow A=-1$ æ‰€ä»¥åˆ†è§£ä¸ºï¼š\n$$ Y(s) = \\frac{-1}{s+1} + \\frac{1}{(s+1)^2} + \\frac{1}{s+2} $$\nä¹‹åï¼Œåšåæ‹‰æ™®æ‹‰æ–¯å˜æ¢ï¼š\n$$ y(t) = \\mathcal{L}^{-1}{Y(s)} = -e^{-t} + t e^{-t} + e^{-2t} = t e^{-t} - e^{-t} + e^{-2t} $$\næœ€ç»ˆç»“æœï¼š\n$$ y(t) = t e^{-t} - e^{-t} + e^{-2t} $$\n","permalink":"https://cronrpc.github.io/zh/posts/laplace-transform/","summary":"\u003ch2 id=\"1-ä»å‚…é‡Œå¶å˜æ¢åˆ°æ‹‰æ™®æ‹‰æ–¯å˜æ¢\"\u003e1. ä»å‚…é‡Œå¶å˜æ¢åˆ°æ‹‰æ™®æ‹‰æ–¯å˜æ¢\u003c/h2\u003e\n\u003ch3 id=\"11-å‚…é‡Œå¶å˜æ¢çš„å±€é™\"\u003e1.1 å‚…é‡Œå¶å˜æ¢çš„å±€é™\u003c/h3\u003e\n\u003cp\u003eå‚…é‡Œå¶å˜æ¢çš„å…¬å¼ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\begin{aligned}\nF(\\omega) \u0026amp;= \\int_{-\\infin}^{\\infin}{f(t) e^{-j\\omega t} dt}\n\\end{aligned}\n$$\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­çš„æŒ‡æ•°éƒ¨åˆ†å¯ä»¥å†™ä¸ºï¼š\u003c/p\u003e\n\u003cp\u003e$$\ne^{-jwt}=\\cos{wt}-j\\sin{wt}\n$$\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯å¯¹äºå‡½æ•°æ¯”å¦‚ $f(t) = t^2$ ä¼šå‘ç°æ ¹æœ¬ç§¯åˆ†ä¸äº†ï¼Œå› ä¸ºåœ¨æ— ç©·èŒƒå›´å†…ç§¯åˆ†çš„ç»“æœæ˜¯æ— ç©·ã€‚\u003c/p\u003e","title":"Laplace Transform"},{"content":"1. å‚…é‡Œå¶å˜æ¢ å‚…é‡Œå¶å˜æ¢èµ·æºäº18ä¸–çºªç ”ç©¶æŒ¯åŠ¨ä¸çƒ­ä¼ å¯¼çš„é—®é¢˜ã€‚æ¬§æ‹‰ã€è¾¾æœ—è´å°”å’Œä¼¯åŠªåˆ©æå‡ºç”¨æ­£å¼¦æ³¢æè¿°æŒ¯åŠ¨ï¼Œå¥ å®šäº†æ€æƒ³åŸºç¡€ã€‚\n19ä¸–çºªåˆï¼Œæ³•å›½æ•°å­¦å®¶å‚…é‡Œå¶åœ¨ç ”ç©¶çƒ­ä¼ å¯¼æ—¶æå‡ºä»»ä½•å‡½æ•°éƒ½å¯å±•å¼€ä¸ºæ­£å¼¦ä¸ä½™å¼¦çº§æ•°ï¼Œè¿™å°±æ˜¯å‚…é‡Œå¶çº§æ•°ï¼Œå¹¶é€æ¸å‘å±•ä¸ºå‚…é‡Œå¶å˜æ¢ã€‚\n1.1 å‡½æ•°çš„æ­£äº¤ å¦‚æœæ˜¯å‘é‡çš„æ­£äº¤ï¼Œå°±æ˜¯å‘é‡çš„å†…ç§¯ä¸º$0$ã€‚\nè€Œå‡½æ•°çš„æ­£äº¤ï¼Œæˆ‘ä»¬ä»¥åŒºé—´ $[-\\pi,\\pi]$ ä¸ºä¾‹ï¼›åœ¨ $[0,2\\pi]$ æˆ–ä»»æ„é•¿åº¦ä¸º $2\\pi$ çš„åŒºé—´ä¸Šç»“è®ºç›¸åŒ\nå®šä¹‰å®šç§¯åˆ†ï¼š\n$$ \\langle f,g\\rangle:=\\int_{-\\pi}^{\\pi} f(x)g(x) dx $$\nè¡¨ç¤ºå‡½æ•°çš„å†…ç§¯ï¼Œå®ƒçš„å€¼å¦‚æœä¸º$0$ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªå‡½æ•°åœ¨è¿™ä¸ªå‘¨æœŸå†…æ­£äº¤ã€‚\n1.2 ä¸‰è§’å‡½æ•°æ­£äº¤æ€§ æœ‰å¦‚ä¸‹å‡½æ•°\n$$ 1, cosx, sinx, cos2x, sin2x, cos3x, sin3x, \u0026hellip; $$\nå…¶ä¸­ $1$ ä¹Ÿå¯ä»¥çœ‹æˆ $cos0x$ ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä»»ä½•éé›¶æ•´æ•° $k$ï¼Œéƒ½æœ‰\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}\\cos kxdx \u0026amp; =0\\\\ \\int_{-\\pi}^{\\pi}\\sin kxdx \u0026amp; =0 \\end{aligned} $$\nå› ä¸ºå®ƒä»¬åœ¨å®Œæ•´å‘¨æœŸä¸Šçš„ç§¯åˆ†ä¸ºé›¶ã€‚æ‰€ä»¥ $1$ ä¸ä¸Šè¿°å…¶ä»–ä¸‰è§’å‡½æ•°éƒ½æ˜¯æ­£äº¤çš„ã€‚\nç°åœ¨è®¨è®ºä¸‰è§’å‡½æ•°ä¹‹é—´çš„ä¸‰ç§æƒ…å†µï¼š\n$\\cos mx$ ä¸ $\\cos nx$ çš„æ­£äº¤æ€§ è‹¥ $m\\neq n$ å¹¶ä¸” $m\\neq 0, n\\neq 0$\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}\\cos mx\\cos nxdx \u0026amp;=\\tfrac12\\int_{-\\pi}^{\\pi}\\big[\\cos(m-n)x+\\cos(m+n)x\\big]dx \\\\ \u0026amp;=0 \\end{aligned} $$\n$\\sin mx$ ä¸ $\\sin nx$ çš„æ­£äº¤æ€§ è‹¥ $m\\neq n$ å¹¶ä¸” $m\\neq 0, n\\neq 0$\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}\\sin mx\\sin nxdx \u0026amp;=\\tfrac12\\int_{-\\pi}^{\\pi}\\big[\\cos(m-n)x-\\cos(m+n)x\\big]dx\\\\ \u0026amp;=0 \\end{aligned} $$\n$\\sin mx$ ä¸ $\\cos nx$ äº’ç›¸æ­£äº¤ è‹¥ $m\\neq 0, n\\neq 0$\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}\\sin mx\\cos nxdx \u0026amp;=\\tfrac12\\int_{-\\pi}^{\\pi}\\big[\\sin(m+n)x+\\sin(m-n)x\\big]dx\\\\ \u0026amp;=0 \\end{aligned} $$\næ‰€ä»¥ä¸Šè¿°ä»»æ„ä¸‰è§’å‡½æ•°ä¹‹é—´ï¼Œéƒ½æ˜¯æ­£äº¤çš„ã€‚\nç°åœ¨æ¥è®¡ç®—ä¸€ä¸‹ï¼Œä¸è‡ªèº«å†…ç§¯çš„ç»“æœï¼š\n$$ \\int_{-\\pi}^{\\pi}\\cos^2 nxdx =\\tfrac12\\int_{-\\pi}^{\\pi}\\big[1+\\cos(2n x)\\big]dx =\\tfrac12\\big[2\\pi+0\\big]=\\pi. $$\n$$ \\int_{-\\pi}^{\\pi}\\sin^2 nxdx =\\tfrac12\\int_{-\\pi}^{\\pi}\\big[1-\\cos(2n x)\\big]dx =\\tfrac12\\big[2\\pi-0\\big]=\\pi. $$\n$$ \\int_{-\\pi}^{\\pi} 1\\cdot 1,dx=2\\pi $$\næ€»ç»“ï¼š\nä»»æ„$m\\neq n$çš„ä¸‰è§’å‡½æ•°ä¹‹é—´æ­£äº¤ã€‚ ä¸‰è§’å‡½æ•°åœ¨ $[-\\pi,\\pi]$ å‘¨æœŸçš„å†…ç§¯æ˜¯ $\\pi$ $1$ åœ¨ $[-\\pi,\\pi]$ å‘¨æœŸçš„å†…ç§¯æ˜¯ $2\\pi$ 1.3 å‘¨æœŸä¸º $2\\pi$ çš„å‚…é‡Œå¶çº§æ•°å±•å¼€ è€ƒè™‘ä¸€ä¸ªå‘¨æœŸå‡½æ•°ï¼Œå®ƒçš„å‘¨æœŸä¸º$T = 2\\pi$ï¼Œå³æ»¡è¶³$f(x)=f(x+2\\pi)$ã€‚\né‚£ä¹ˆå®ƒå¯ä»¥è¡¨ç¤ºä¸ºä¸‰è§’çº§æ•°çš„å’Œï¼š\n$$ \\begin{aligned} f(x) \u0026amp; = \\sum_{n=0}^{\\infin}{a_n \\cos{nx}}+\\sum_{n=0}^{\\infin}{b_n \\sin{nx}} \\\\ \u0026amp; = a_0 + \\sum_{n=1}^{\\infin}{a_n \\cos{nx}}+\\sum_{n=1}^{\\infin}{b_n \\sin{nx}} \\end{aligned} $$\nå¦‚ä½•æ±‚å‡ºæ¯ä¸ª $a_n$ çš„å€¼ï¼Ÿå¯ä»¥åˆ©ç”¨æ­£äº¤æ€§æ¥æ±‚ã€‚\nåœ¨å‘¨æœŸå†…è¿›è¡Œå†…ç§¯ï¼Œå·¦å³åŒæ—¶ä¹˜ä»¥ $1$ å¹¶ç§¯åˆ†ï¼š\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}{1 \\cdot f(x) dx} \u0026amp;= \\int_{-\\pi}^{\\pi}{a_0 dx} + \\int_{-\\pi}^{\\pi}{\\sum_{n=1}^{\\infin}{a_n \\cos{nx} dx}} + \\int_{-\\pi}^{\\pi}{\\sum_{n=1}^{\\infin}{b_n \\sin{nx} dx}} \\end{aligned} $$\nç”±äºä¸‰è§’å‡½æ•°å‘¨æœŸæ€§ï¼Œåé¢çš„ä¸‰è§’å‡½æ•°éƒ½æ˜¯ç§¯åˆ†ç»“æœéƒ½æ˜¯ $0$ï¼Œæ‰€ä»¥æœ‰ï¼š\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}{f(x) dx} \u0026amp;= 2 \\pi a_0 \\\\ a_0 \u0026amp;= \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi}{f(x) dx} \\end{aligned} $$\næ³¨æ„ï¼Œè¿™é‡Œæœ‰çš„æ•™ç§‘ä¹¦ä¸Šï¼Œæ˜¯ä»¤\n$$ \\begin{aligned} a_0 \u0026amp;= \\frac{1}{\\pi} \\int_{-\\pi}^{\\pi}{f(x) dx} \\end{aligned} $$\nç„¶ååœ¨å…¬å¼é˜¶æ®µä½¿ç”¨çš„æ˜¯ï¼š\n$$ \\begin{aligned} f(x) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{(a_n \\cos{nx}+ b_n \\sin{nx})} \\end{aligned} $$\nå®ƒä»¬åªæ˜¯å®šä¹‰ä¹ æƒ¯ï¼Œå®é™…ä¸Šæ²¡å•¥åŒºåˆ«ã€‚æˆ‘ä»¬åé¢é‡‡ç”¨è¿™ä¸ªå®šä¹‰çš„æ–¹å¼ã€‚\næ¥ä¸‹æ¥æ±‚ $a_n$ï¼Œä¾ç„¶æ˜¯åŒæ—¶ä¹˜ä»¥å¯¹åº”çš„ä¸‰è§’å‡½æ•°ç„¶ååœ¨å‘¨æœŸå†…è¿›è¡Œç§¯åˆ†ï¼Œå‡è®¾æˆ‘ä»¬è¦æ±‚çš„æ˜¯ $n=m$ æ—¶çš„ $a_m$ï¼Œä¾æ®ä¸‰è§’å‡½æ•°æ­£äº¤æ€§ï¼š\n$$ \\begin{aligned} \\int_{-\\pi}^{\\pi}{f(x) \\cos{mx} dx} =\u0026amp; \\int_{-\\pi}^{\\pi}{a_0 \\cos{mx} dx} \\\\ \u0026amp;+ \\int_{-\\pi}^{\\pi}{\\sum_{n=1}^{\\infin}{a_n \\cos{nx} \\cos{mx} dx}} \\\\ \u0026amp;+ \\int_{-\\pi}^{\\pi}{\\sum_{n=1}^{\\infin}{b_n \\sin{nx} \\cos{mx} dx}} \\\\ =\u0026amp; 0 + \\int_{-\\pi}^{\\pi}{a_m \\cos^2{mx}dx} + 0 \\\\ =\u0026amp; a_m \\pi \\end{aligned} $$\næ‰€ä»¥æœ‰ï¼š\n$$ \\begin{aligned} a_n = \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{f(x) \\cos{nx} dx} \\end{aligned} $$\nåŒç† $b_n$ ä¹Ÿå¯ä»¥æ±‚å‡ºï¼š\n$$ \\begin{aligned} b_n = \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{f(x) \\sin{nx} dx} \\end{aligned} $$\næœ€åï¼Œç»“è®ºå¦‚ä¸‹ï¼š\nä¸€ä¸ªå‘¨æœŸä¸º $2\\pi$çš„å‡½æ•° $f(x)$ï¼Œå¯ä»¥é€šè¿‡ä¸‰è§’å‡½æ•°å±•å¼€ï¼š\n$$ \\begin{aligned} f(x) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{a_n \\cos{nx}} + \\sum_{n=1}^{\\infin}{b_n \\sin{nx}} \\end{aligned} $$\nå…¶ä¸­ï¼š\n$$ \\begin{aligned} a_0 \u0026amp;= \\frac{1}{\\pi} \\int_{-\\pi}^{\\pi}{f(x) dx} \\\\ a_n \u0026amp;= \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{f(x) \\cos{nx} dx} \\\\ b_n \u0026amp;= \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{f(x) \\sin{nx} dx} \\end{aligned} $$\n1.4 å‘¨æœŸä¸º $2L$ çš„å‚…é‡Œå¶çº§æ•°å±•å¼€ ä¸Šä¸€å°èŠ‚æ¢è®¨çš„æ˜¯åœ¨ $2\\pi$ ä¸ºå‘¨æœŸçš„å‡½æ•°ä¸Šçš„ä¸‰è§’çº§æ•°å±•å¼€ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥åœ¨ä»»æ„å‘¨æœŸä¸Šè¿›è¡Œå±•å¼€ã€‚\nè®¾åŸå§‹å‡½æ•° $f(t)$ çš„å‘¨æœŸæ˜¯ $[-L, L]$ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªä¸­é—´å˜é‡ $x$ çš„å‘¨æœŸæ˜¯ $[-\\pi, \\pi]$ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä»¤ï¼š\n$$ \\begin{aligned} x \u0026amp;= \\frac{\\pi}{L}t \\\\ t \u0026amp;= \\frac{L}{\\pi}x \\end{aligned} $$\næ­¤æ—¶æœ‰ï¼Œ\n$$ f(t) = f(\\frac{L}{\\pi}x) \\overset{\\triangle}{=} g(x) $$\næ ¹æ®åœ¨å‰é¢çš„æ¨å¯¼ä¸­æœ‰ï¼š\n$$ \\begin{aligned} g(x) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{a_n \\cos{nx}} + \\sum_{n=1}^{\\infin}{b_n \\sin{nx}}\\\\ a_0 \u0026amp;= \\frac{1}{\\pi} \\int_{-\\pi}^{\\pi}{g(x) dx} \\\\ a_n \u0026amp;= \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{g(x) \\cos{nx} dx} \\\\ b_n \u0026amp;= \\frac{1}{\\pi}\\int_{-\\pi}^{\\pi}{g(x) \\sin{nx} dx} \\end{aligned} $$\nç»Ÿç»Ÿåšå¦‚ä¸‹çš„æ›¿æ¢ï¼Œ\n$$ \\begin{aligned} x \u0026amp;= \\frac{\\pi}{L}t\\\\ \\Rightarrow dx \u0026amp;= \\frac{\\pi}{L}dt \\end{aligned} $$\nä»¥åŠ\n$$ nx = n\\frac{\\pi}{L}t = (\\frac{n\\pi}{L})t $$\näºæ˜¯æœ‰ï¼Œ\n$$ \\begin{aligned} f(t) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{a_n \\cos{\\frac{n\\pi}{L}t}} + \\sum_{n=1}^{\\infin}{b_n \\sin{\\frac{n\\pi}{L}t}}\\\\ a_0 \u0026amp;= \\frac{1}{\\pi} \\int_{-\\pi}^{\\pi}{g(x) dx}\\\\ \u0026amp;= \\frac{1}{\\pi} \\int_{-\\pi}^{\\pi}{f(\\frac{L}{\\pi}x) dx}\\\\ \u0026amp;= \\frac{1}{\\pi} \\int_{-L}^{L}{f(t) \\frac{\\pi}{L} dt} \\\\ \u0026amp;= \\frac{1}{L} \\int_{-L}^{L}{f(t) dt} \\end{aligned} $$\nåŒç†ï¼Œ $$ \\begin{aligned} a_n \u0026amp;= \\frac{1}{L}\\int_{-L}^{L}{f(t) \\cos{\\frac{n\\pi}{L}t} dt} \\\\ b_n \u0026amp;= \\frac{1}{L}\\int_{-L}^{L}{f(t) \\sin{\\frac{n\\pi}{L}t} dt} \\end{aligned} $$\nåœ¨å·¥ç¨‹é¢†åŸŸä¸­ï¼Œä¹ æƒ¯ä» $0$ å¼€å§‹ç§¯åˆ†ï¼Œè®°\n$$ T=2L\\\\ \\\\ \\omega = \\frac{\\pi}{L} = \\frac{2\\pi}{T} $$\näºæ˜¯ä¸‰è§’çº§æ•°å±•å¼€åˆå¯ä»¥å†™ä¸ºï¼š\n$$ \\begin{aligned} f(t) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{a_n \\cos{n\\omega t}} + \\sum_{n=1}^{\\infin}{b_n \\sin{n\\omega t}}\\\\ a_0 \u0026amp;= \\frac{2}{T} \\int_{0}^{T}{f(t) dt}\\\\ a_n \u0026amp;= \\frac{2}{T}\\int_{0}^{T}{f(t) \\cos{n\\omega t} dt} \\\\ b_n \u0026amp;= \\frac{2}{T}\\int_{0}^{T}{f(t) \\sin{n\\omega t} dt} \\end{aligned} $$\n1.5 å¤æ•°å½¢å¼çš„å‚…é‡Œå¶çº§æ•°å±•å¼€ æ ¹æ®æ¬§æ‹‰å…¬å¼\n$$ e^{i\\theta}=\\cos\\theta+i\\sin\\theta $$\nå¾—åˆ°\n$$ \\begin{aligned} \\cos\\theta\u0026amp;=\\frac{1}{2}(e^{i\\theta}+e^{-i\\theta})\\\\ \\sin\\theta\u0026amp;=-\\frac{1}{2}i(e^{i\\theta}-e^{-i\\theta}) \\end{aligned} $$\nä»£å…¥åˆ°å…¬å¼ä¸­å¾—åˆ°ï¼š\n$$ \\begin{aligned} f(t) \u0026amp; = \\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{a_n \\cos{n\\omega t}} + \\sum_{n=1}^{\\infin}{b_n \\sin{n\\omega t}}\\\\ \u0026amp;=\\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{[a_n\\frac{1}{2}(e^{in\\omega t}+e^{-in\\omega t}) - \\frac{1}{2}ib_n(e^{in\\omega t}-e^{-in\\omega t})]}\\\\ \u0026amp;=\\frac{a_0}{2} + \\sum_{n=1}^{\\infin}{\\frac{a_n-ib_n}{2}e^{in\\omega t}} + \\sum_{n=1}^{\\infin}{\\frac{a_n+ib_n}{2}e^{-in\\omega t}}\\\\ \u0026amp;=\\frac{a_0}{2}e^{0}+\\sum_{n=1}^{\\infin}{\\frac{a_n-ib_n}{2}e^{in\\omega t}} + \\sum_{n=-\\infin}^{-1}{\\frac{a_{-n}+ib_{-n}}{2}e^{in\\omega t}}\\\\ \u0026amp;=\\sum_{-\\infin}^{\\infin}{c_n e^{in\\omega t}} \\end{aligned} $$\nå…¶ä¸­ $c_n$ å®šä¹‰ä¸ºï¼š\n$$ c_n = \\begin{cases} \\frac{a_0}{2}, \u0026amp; n = 0\\\\ \\frac{a_n-ib_n}{2}, \u0026amp; n = 1,2,3,4,\u0026hellip;\\\\ \\frac{a_{-n}+ib_{-n}}{2}, \u0026amp; n = -1,-2,-3,-4,\u0026hellip; \\end{cases} $$\nç°åœ¨å…·ä½“è®¡ç®—ä¸€ä¸‹ $c_n$ï¼Œ\n$$ \\begin{aligned} \\underset{n=1,2,3,\u0026hellip;}{c_n} \u0026amp;= \\frac{1}{2}[\\frac{2}{T}\\int_{0}^{T}{f(t) \\cos{n\\omega t} dt} -i\\frac{2}{T}\\int_{0}^{T}{f(t) \\sin{n\\omega t} dt}]\\\\ \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) (\\cos{n\\omega t}-i\\sin{n\\omega t}) dt}\\\\ \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) (\\cos{(-n\\omega t)} + i\\sin{(-n\\omega t)}) dt}\\\\ \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) e^{-in\\omega t} dt} \\end{aligned} $$\n$$ \\begin{aligned} \\underset{n=-1,-2,-3,\u0026hellip;}{c_n} \u0026amp;= \\frac{1}{2}[\\frac{2}{T}\\int_{0}^{T}{f(t) \\cos{(-n\\omega t)} dt} +i\\frac{2}{T}\\int_{0}^{T}{f(t) \\sin{(-n\\omega t)} dt}]\\\\ \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) (\\cos{(-n\\omega t)} + i\\sin{(-n\\omega t)}) dt}\\\\ \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) e^{-in\\omega t} dt} \\end{aligned} $$\n$$ \\begin{aligned} \\underset{n=0}{c_n} \u0026amp;= \\frac{1}{2}[\\frac{2}{T} \\int_{0}^{T}{f(t) dt}]\\\\ \u0026amp;= \\frac{1}{T} \\int_{0}^{T}{f(t) dt}\\\\ \u0026amp;= \\frac{1}{T} \\int_{0}^{T}{f(t) e^{-i0\\omega t} dt}\\\\ \u0026amp;= \\frac{1}{T} \\int_{0}^{T}{f(t) e^{-in\\omega t} dt} \\end{aligned} $$\næ‰€ä»¥ $c_n$ éƒ½å¯ä»¥å†™ä¸ºä¸€æ ·çš„å½¢å¼ï¼š\n$$ c_n = \\frac{1}{T} \\int_{0}^{T}{f(t) e^{-in\\omega t} dt} $$\næ€»ç»“ï¼š\nå¤æ•°å½¢å¼çš„å‚…é‡Œå¶å˜æ¢ä¸­ï¼Œå¯¹äºå‘¨æœŸå‡½æ•° $f(t) = f(t+T)$ï¼Œæœ‰\n$$ \\begin{aligned} f(t) \u0026amp;= \\sum_{-\\infin}^{\\infin}{c_n e^{in\\omega t}} \\\\ c_n \u0026amp;= \\frac{1}{T} \\int_{0}^{T}{f(t) e^{-in\\omega t} dt} \\end{aligned} $$\n1.6 å‘¨æœŸä¸º $\\infin$ çš„å‚…é‡Œå¶çº§æ•°å±•å¼€ å‘¨æœŸä¸º $T$ çš„å‡½æ•°\n$$ f_T(t) = f_T(t+T) $$\nå¯ä»¥è¢«è§£æä¸ºä¸‹åˆ—è¡¨ç¤º\nè¿™é‡Œç”¨ $\\omega_0$ è¡¨ç¤ºåŸºé¢‘ç‡ $$ \\begin{aligned} f_T(t) \u0026amp;= \\sum_{-\\infin}^{\\infin}{c_n e^{in\\omega_0 t}} \\\\ c_n \u0026amp;= \\frac{1}{T} \\int_{-\\frac{T}{2}}^{\\frac{T}{2}}{f_T(t) e^{-in\\omega_0 t} dt}\\\\ \\omega_0 \u0026amp;= \\frac{2\\pi}{T} \\end{aligned} $$\nç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä¸€ä¸ªéå‘¨æœŸå‡½æ•°ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ\nä¸æ˜¯å‘¨æœŸå‡½æ•°ï¼Œæ¢ä¸ªè§’åº¦æ¥è¯´ï¼Œå°±æ˜¯å‘¨æœŸæ— ç©·å¤§ï¼Œå°±æ˜¯æ— ç©·å¤§ä¹‹åæ‰ä¼šé‡å¤ã€‚\næˆ‘ä»¬ç›´æ¥æŠŠ $c_n$ ä»£å…¥å›å»ï¼ŒåŒæ—¶ä»¤ $f(t) = \\underset{T \\to \\infin}{f_T}$ï¼Œ\n$$ \\begin{aligned} f(t) \u0026amp;= \\sum_{-\\infin}^{\\infin}{\\frac{1}{T} \\int_{-\\frac{T}{2}}^{\\frac{T}{2}}{f(t) e^{-in\\omega_0 t} dt} e^{in\\omega_0 t}}\\\\ \u0026amp;= \\sum_{-\\infin}^{\\infin}{\\frac{\\omega_0}{2\\pi} \\int_{-\\infin}^{\\infin}{f(t) e^{-in\\omega_0 t} dt} e^{in\\omega_0 t}} \\end{aligned} $$\nä»¤ $\\omega_0 = d\\omega$ï¼Œé‚£ä¹ˆ $n\\omega_0 = \\omega$ï¼Œæ‰€ä»¥\n$$ \\begin{aligned} f(t) \u0026amp;= \\sum_{-\\infin}^{\\infin}{\\frac{\\omega_0}{2\\pi} \\int_{-\\infin}^{\\infin}{f(t) e^{-in\\omega_0 t} dt} e^{in\\omega_0 t}}\\\\ \u0026amp;= \\int_{-\\infin}^{\\infin}{\\frac{1}{2\\pi}\\int_{-\\infin}^{\\infin}{f(t) e^{-iomega t} dt} e^{i\\omega t} d\\omega}\\\\ \u0026amp;= \\int_{-\\infin}^{\\infin}{\\frac{1}{2\\pi} \\left( \\int_{-\\infin}^{\\infin}{f(t) e^{-i\\omega t} dt} \\right) e^{i\\omega t} d\\omega}\\\\ \u0026amp;= \\frac{1}{2\\pi} \\int_{-\\infin}^{\\infin}{\\left( \\int_{-\\infin}^{\\infin}{f(t) e^{-i\\omega t} dt} \\right) e^{i\\omega t} d\\omega} \\end{aligned} $$\nè¿™é‡Œå®šä¹‰ $F(\\omega)$ï¼Œå°±å¾—åˆ°å‚…é‡Œå¶å˜æ¢çš„æœ€ç»ˆå½¢å¼\n$$ \\begin{aligned} F(\\omega) \u0026amp;= \\int_{-\\infin}^{\\infin}{f(t) e^{-i\\omega t} dt} \\end{aligned} $$\nè€Œé€†å˜æ¢æ˜¯\n$$ \\begin{aligned} f(t) \u0026amp;= \\frac{1}{2\\pi} \\int_{-\\infin}^{\\infin}{ F(\\omega) e^{i\\omega t} d\\omega} \\end{aligned} $$\n1.7 å¯¹ç§°å½¢å¼ã€å·¥ç¨‹å­¦æ´¾ã€é¢‘ç‡å½¢å¼ åœ¨ä¸Šé¢çš„å‚…é‡Œå¶å˜æ¢ä¸­ï¼Œæˆ‘ä»¬æŠŠ $2\\pi$ æ”¾åœ¨é€†å˜æ¢ä¸­ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸‹åˆ—çš„å½¢å¼ï¼š\nå¯¹ç§°å½¢å¼ï¼ˆå¸¸ç”¨åœ¨æ•°å­¦é‡Œï¼‰ï¼ŒæŠŠ $2\\pi$ å‡åˆ†åˆ°æ­£å˜æ¢å’Œé€†å˜æ¢ï¼š $$ F(\\omega) = \\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^{\\infty} f(t)e^{-i\\omega t} dt $$\n$$ f(t) = \\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^{\\infty} F(\\omega)e^{i\\omega t} d\\omega $$\nå·¥ç¨‹å­¦æ´¾ï¼ˆå¸¸è§äºç”µæ°”å·¥ç¨‹/ä¿¡å·å¤„ç†ï¼‰ï¼ŒæŠŠ $2\\pi$ æ”¾åœ¨æ­£å˜æ¢ä¸­ï¼Œé€†å˜æ¢æ²¡æœ‰ $2\\pi$ï¼š $$ F(\\omega) = \\frac{1}{2\\pi}\\int_{-\\infty}^{\\infty} f(t)e^{-i\\omega t} dt $$\n$$ f(t) = \\int_{-\\infty}^{\\infty} F(\\omega)e^{i\\omega t} d\\omega $$\nå‘¨æœŸå½¢å¼ï¼ˆç”¨é¢‘ç‡ $f$ è€Œä¸æ˜¯è§’é¢‘ç‡ $\\omega$ï¼‰ï¼Œå¦‚æœä»¤ $\\omega = 2\\pi f$ï¼Œå°±å¯ä»¥å†™æˆï¼š $$ F(f) = \\int_{-\\infty}^{\\infty} f(t)e^{-i 2\\pi f t} dt $$\n$$ f(t) = \\int_{-\\infty}^{\\infty} F(f)e^{i 2\\pi f t} df $$\n2. ç¦»æ•£å‚…é‡Œå¶å˜æ¢ åœ¨å‰é¢çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬æ¶‰åŠåˆ°æ˜¯è¿ç»­å‡½æ•°å’Œæ— ç©·é¢‘ç‡ã€‚\nè™½ç„¶å‰é¢å·²ç»å­¦ä¹ äº†å‚…é‡Œå¶å˜æ¢çš„ç§¯åˆ†å½¢å¼ï¼Œä½†æ˜¯å®é™…å·¥ç¨‹ä¸­çš„æœ€å¤§é—®é¢˜æ˜¯å·¥ç¨‹ä¸­çš„é‡‡æ ·ç‚¹ä¸æ˜¯è¿ç»­å‡½æ•°ã€‚é€šå¸¸æ˜¯ç¦»æ•£çš„ç‚¹ã€‚\n2.1 ç¦»æ•£å‚…ç«‹å¶å˜æ¢ DFT å¯¹äºä¸€ä¸ªç¦»æ•£çš„é‡‡æ ·ç‚¹ï¼Œæ¯”å¦‚ N ä¸ªç‚¹çš„åºåˆ— $x[n]$ï¼Œç›´æ¥è®¤ä¸ºå®ƒçš„å‘¨æœŸå°±æ˜¯ Nã€‚\nå·²çŸ¥å‘¨æœŸä¸º T çš„å‚…é‡Œå¶å˜æ¢å½¢å¼æ˜¯ï¼š\n$$ \\begin{aligned} c_n \u0026amp;= \\frac{1}{T}\\int_{0}^{T}{f(t) e^{-in\\omega t} dt}\\\\ f(t) \u0026amp;= \\sum_{n=-\\infin}^{\\infin}{c_n e^{in\\omega t}} \\end{aligned} $$\nç°åœ¨ä»¤ $\\omega = \\frac{2\\pi}{N}$ï¼Œ$T \\to N$ï¼ŒåŒæ—¶æŠŠ $\\frac{1}{T} \\to \\frac{1}{N}$ è¿™ä¸ªå¸¸é‡ç§»åŠ¨åˆ°é€†å˜æ¢é‡Œé¢ã€‚åŒæ—¶åŸæœ¬çš„ n ç”¨ k è¡¨ç¤ºï¼ŒåŸæœ¬çš„ t ç”¨åºå· n è¡¨ç¤ºã€‚\n$$ \\begin{aligned} X[k] \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot e^{-j\\frac{2\\pi}{N}kn}}\\\\ x[n] \u0026amp;= \\frac{1}{N} \\sum_{k=0}^{N-1}{X[k]\\cdot e^{j\\frac{2\\pi}{N}kn}} \\end{aligned} $$\nå…¶ä¸­ $k=0,1,2,\u0026hellip;,N-1$\n2.2 è¯æ˜ DFT æˆç«‹ æŠŠ $X[k]$ ä»£å…¥é€†å˜æ¢å…¬å¼ï¼š\n$$ \\begin{aligned} x[n] \u0026amp;= \\frac{1}{N}\\sum_{k=0}^{N-1} X[k],e^{j\\frac{2\\pi}{N}kn} \\\\ \u0026amp;= \\frac{1}{N}\\sum_{k=0}^{N-1}\\left(\\sum_{m=0}^{N-1} x[m],e^{-j\\frac{2\\pi}{N}km}\\right)e^{j\\frac{2\\pi}{N}kn} \\\\ \u0026amp;= \\frac{1}{N}\\sum_{m=0}^{N-1} x[m]\\sum_{k=0}^{N-1} e^{j\\frac{2\\pi}{N}k(n-m)} \\end{aligned} $$\nè€ƒè™‘å†…å±‚å’Œ\n$$ S_{n-m}=\\sum_{k=0}^{N-1} e^{j\\frac{2\\pi}{N}k(n-m)} $$\nä»¤ $r=n-m$ï¼ˆæ•´æ•°ï¼‰ã€‚è‹¥ $r\\equiv 0\\pmod N$ï¼ˆå³ $n=m$ï¼‰ï¼Œåˆ™æ¯é¡¹éƒ½æ˜¯ $1$ï¼Œäºæ˜¯\n$$ S_{0}=N $$\nè‹¥ $r\\not\\equiv 0\\pmod N$ï¼Œåˆ™è¿™æ˜¯ä¸€ä¸ªé¦–é¡¹ä¸º $1$ã€å…¬æ¯” $q=e^{j\\frac{2\\pi}{N}r}\\neq1$ çš„å‡ ä½•çº§æ•°ï¼Œ\n$$ S_{r}=\\frac{1-q^{N}}{1-q}=\\frac{1-e^{j2\\pi r}}{1-q}=0 $$\nå› ä¸º $e^{j2\\pi r}=1$ã€‚å› æ­¤\n$$ S_{n-m}= \\begin{cases} N,\u0026amp; n=m,\\\\ 0,\u0026amp; n\\ne m. \\end{cases} $$\næŠŠå®ƒä»£å›å»ï¼š\n$$ x[n]=\\frac{1}{N}\\sum_{m=0}^{N-1} x[m]S_{n-m}=\\frac{1}{N}\\big(x[n]\\cdot N\\big)=x[n]. $$\nè¿™å°±è¯æ˜äº†é€†å˜æ¢ç¡®å®æŠŠç”±å‰å‘å˜æ¢å¾—åˆ°çš„ $X[k]$ æ¢å¤å›åŸåºåˆ— $x[n]$ã€‚æ¢å¥è¯è¯´ï¼Œå¤æŒ‡æ•°åœ¨è¿™ç»„ç¦»æ•£ç‚¹ä¸Šæ˜¯æ­£äº¤çš„ï¼Œä¸”\n$$ \\frac{1}{N}\\sum_{k=0}^{N-1} e^{j\\frac{2\\pi}{N}k(n-m)}=\\delta_{n,m} $$\n2.3 å…±è½­å¯¹ç§°æ€§ $$ \\begin{aligned} X[k] \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot e^{-j\\frac{2\\pi}{N}kn}} \\end{aligned} $$\n$X[k]$ çš„å…±è½­å€¼ä¸ºï¼š\n$$ \\begin{aligned} X^{\\ast}[k] \u0026amp;=\\left( \\sum_{n=0}^{N-1}{x[n] \\cdot e^{-j\\frac{2\\pi}{N}kn}} \\right)^{\\ast} \\end{aligned} $$\nç”±äº $x[n]$ æ˜¯å®æ•°ï¼Œæ‰€ä»¥\n$$ \\begin{aligned} X^{\\ast}[k] \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot (e^{-j\\frac{2\\pi}{N}kn}})^{\\ast}\\\\ \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot (e^{j\\frac{2\\pi}{N}kn}})\\\\ \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot (e^{j\\frac{2\\pi}{N}(kn-Nn)}})\\\\ \u0026amp;=\\sum_{n=0}^{N-1}{x[n] \\cdot (e^{-j\\frac{2\\pi}{N}(N-k)n}})\\\\ \u0026amp;=X[N-k] \\end{aligned} $$\nç»“è®ºï¼š\nå¦‚æœ $x[n]$ æ˜¯å®æ•°åºåˆ—ï¼Œåˆ™æœ‰\n$$ X[k] = X^*[N-k], \\quad k=1,2,\\dots,N-1 $$\nä¹Ÿå°±æ˜¯è¯´ï¼ŒDFT çš„é¢‘è°±æ˜¯å…±è½­å¯¹ç§°çš„ã€‚\nè¿˜æœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ç»“è®ºï¼Œé‚£å°±æ˜¯å½“ N æ˜¯å¶æ•°çš„æ—¶å€™ï¼Œ $k = 0$ å’Œ $k = N/2$ éƒ½åªæœ‰å®æ•°éƒ¨åˆ†çš„ã€‚\n$$ \\begin{aligned} X[N/2] \u0026amp;= X^{\\ast}[N-N/2] = N^{\\ast}[N/2]\\\\ \u0026amp;= \\Re{(X[N/2])} \\end{aligned} $$\n2.4 å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç† å¯¹é•¿åº¦ä¸º $N$ çš„åºåˆ— $x[n]$ï¼Œå…¶ DFT æ˜¯\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j \\frac{2\\pi}{N}kn}, \\quad k = 0,1,\\dots,N-1 $$\nè¿™é‡Œ $k$ å¯¹åº”çš„æ˜¯é¢‘ç‡ç´¢å¼•ï¼Œå®é™…é¢‘ç‡ä¸º\n$$ f_k = \\frac{k}{N} f_s $$\nå…¶ä¸­ $f_s$ æ˜¯é‡‡æ ·ç‡ã€‚\næ ¹æ®å¥ˆå¥æ–¯ç‰¹é‡‡æ ·å®šç†ï¼š\nè¿ç»­ä¿¡å·åœ¨é‡‡æ ·ç‡ $f_s$ ä¸‹ï¼Œæœ€å¤§èƒ½æ— å¤±çœŸæ¢å¤çš„é¢‘ç‡æ˜¯ $f_s/2$ï¼ˆå¥ˆå¥æ–¯ç‰¹é¢‘ç‡ï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œ$0 \\leq f \\leq f_s/2$ æ‰æ˜¯â€œæœ‰æ•ˆâ€åŒºé—´ã€‚ æ‰€ä»¥ï¼ŒDFT ç»™å‡ºçš„é¢‘ç‡èŒƒå›´ $0 \\leq f \u0026lt; f_s$ï¼Œå…¶ä¸­ä¸€åŠå…¶å®æ˜¯é•œåƒé¢‘ç‡ã€‚\nè¿™ä¸ªç»“è®ºå®é™…ä¸Šå’Œå‰é¢çš„å…±è½­å¯¹ç§°æ€§ä¹Ÿæ˜¯ç¬¦åˆçš„ï¼Œæœ‰ä¸€åŠçš„é¢‘ç‡å®é™…ä¸Šæ˜¯å†—ä½™çš„ã€‚\nåŒæ—¶ä»ä¿¡æ¯çš„è§’åº¦æ¥è¯´ï¼Œ$N$ ä¸ªå®æ•°å¯ä»¥é€šè¿‡ $\\frac{N}{2}$ ä¸ªå¤æ•°æ¥æ¢å¤ä¿¡æ¯ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯åˆç†çš„ã€‚\n2.5 å‘¨æœŸæ€§ä¸è´Ÿé¢‘ç‡ ç¦»æ•£å‚…é‡Œå¶å˜æ¢ (DFT) åœ¨é¢‘ç‡åŸŸä¸Šå…·æœ‰ å‘¨æœŸæ€§ã€‚å…¶å®šä¹‰ä¸º\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j\\frac{2\\pi}{N}kn}, \\quad k=0,1,\\dots,N-1 $$\nå¦‚æœå°†é¢‘ç‡ç´¢å¼•æ‰©å±•åˆ°ä»»æ„æ•´æ•° $m$ï¼Œåˆ™æœ‰\n$$ X[k+mN] = \\sum_{n=0}^{N-1} x[n] e^{-j\\frac{2\\pi}{N}(k+mN)n} = \\sum_{n=0}^{N-1} x[n] e^{-j\\frac{2\\pi}{N}kn} e^{-j2\\pi mn} $$\nç”±äº $e^{-j2\\pi mn} = 1$ï¼Œå› æ­¤\n$$ X[k+mN] = X[k] $$\nè¿™è¡¨æ˜ DFT åœ¨é¢‘ç‡ç´¢å¼•ä¸Šä»¥ $N$ ä¸ºå‘¨æœŸã€‚æ¢å¥è¯è¯´ï¼Œé¢‘è°±åœ¨é¢‘ç‡è½´ä¸Šæ˜¯ç¯å½¢çš„ï¼Œè¶…è¿‡èŒƒå›´ä¼šè‡ªåŠ¨æŠ˜è¿”ã€‚\nè™½ç„¶ DFT çš„ç´¢å¼• $k$ åªå®šä¹‰åœ¨ $[0, N-1]$ï¼Œä½†é€šè¿‡å‘¨æœŸæ€§ï¼Œå¯ä»¥è‡ªç„¶å¼•å…¥â€œè´Ÿé¢‘ç‡â€çš„æ¦‚å¿µã€‚å…·ä½“åœ°ï¼š\n$$ X[-k] = X[N-k]\\\\ k=-1,-2,-3,\u0026hellip; $$\nç»“åˆå‰é¢çš„å…±è½­å¯¹ç§°æ€§ï¼Œå¯ä»¥å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š\n$$ X[-k] = X[N-k] = X^{\\ast}[k] $$\nå³æ­£è´Ÿé¢‘ç‡ä¹Ÿå‘ˆç°å…±è½­å¯¹ç§°æ€§ã€‚\nå› æ­¤ï¼ŒåŸæœ¬çš„ç´¢å¼•\n$$ k = 0, 1, 2, \\dots, \\tfrac{N}{2}-1, \\tfrac{N}{2}, \\tfrac{N}{2}+1, \\dots, N-1 $$\nå¯ä»¥ç­‰ä»·åœ°å†™ä½œ\n$$ k = 0, 1, 2, \\dots, \\tfrac{N}{2}-1, \\tfrac{N}{2}, -\\tfrac{N}{2}+1, \\dots, -2, -1 $$\n3. å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰çš„æ€æƒ³æœ€æ—©å¯è¿½æº¯åˆ°19ä¸–çºªåˆã€‚1805å¹´ï¼Œé«˜æ–¯åœ¨ç ”ç©¶å¤©ä½“è½¨é“æ—¶ï¼Œå·²ç»æå‡ºè¿‡ä¸€ç§ç›¸å½“äº FFT çš„é«˜æ•ˆç®—æ³•ï¼Œä½†ä»–çš„å·¥ä½œä»…ä»¥ç¬”è®°å½¢å¼ä¿å­˜ï¼Œå¹¶æœªè¢«å¹¿æ³›ä¼ æ’­ã€‚ä¹‹åä¸€ä¸ªå¤šä¸–çºªé‡Œï¼Œç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDFTï¼‰ä»ä»¥ $O(N^2)$ çš„å¤æ‚åº¦è¢«ç›´æ¥è®¡ç®—ã€‚\nç›´åˆ°1965å¹´ï¼ŒIBM çš„ James Cooley ä¸ Princeton çš„ John Tukey åœ¨ç ”ç©¶æ•°å€¼å¤©æ°”é¢„æŠ¥æ—¶é‡æ–°å‘ç°å¹¶ç³»ç»ŸåŒ–äº†è¿™ä¸€æ–¹æ³•ï¼Œä»–ä»¬æ„è¯†åˆ°å¯ä»¥é€šè¿‡åˆ†æ²»ä¸æ—‹è½¬å› å­å¯¹ç§°æ€§ï¼Œå¤§å¹…å‡å°‘è®¡ç®—é‡ã€‚è®ºæ–‡å‘è¡¨åå¼•èµ·è½°åŠ¨ï¼Œä½¿å¤§è§„æ¨¡é¢‘åŸŸåˆ†æé¦–æ¬¡æˆä¸ºç°å®ã€‚\næœ‰è¶£çš„æ˜¯ï¼ŒFFT å¹¶éâ€œæ–°ç®—æ³•â€ï¼Œè€Œæ˜¯å¯¹å¤è€æ•°å­¦æ€æƒ³çš„å¤å…´ä¸æ¨å¹¿ã€‚æ­£æ˜¯è®¡ç®—æœºç¡¬ä»¶çš„å…´èµ·ä¸å®é™…éœ€æ±‚çš„è¿«åˆ‡ï¼Œæ‰è®©è¿™é¡¹ç®—æ³•èµ°å‡ºå†å²ç¬”è®°ï¼Œæˆä¸ºä¿¡å·å¤„ç†ã€é€šä¿¡ã€å›¾åƒåˆ†æä¸ç§‘å­¦è®¡ç®—ä¸­ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒå·¥å…·ã€‚\n3.1 ç¦»æ•£å‚…é‡Œå¶å˜æ¢çš„å¤æ‚åº¦ ä¾æ®å‰é¢ï¼Œç¦»æ•£å‚…é‡Œå¶å˜æ¢çš„å®šä¹‰ä¸ºï¼š\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] e^{-j \\frac{2\\pi}{N} kn}, \\quad k=0,1,\\dots,N-1 $$\nç›´æ¥è®¡ç®—æ¯ä¸ª $X[k]$ éœ€è¦ $N$ æ¬¡ä¹˜æ³•ä»¥åŠ $N$ é¡¹æ±‚å’Œï¼Œæ€»å…±æœ‰ $N$ ä¸ª $k$ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸ºï¼š\n$$ \\mathcal{O}(N^2) $$\nå½“ $N$ è¾ƒå¤§æ—¶ï¼Œè¿™æ ·çš„å¤æ‚åº¦éš¾ä»¥æ¥å—ã€‚\nå¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰é€šè¿‡åˆ©ç”¨å¯¹ç§°æ€§å’Œé€’å½’åˆ†æ²»æ€æƒ³ï¼Œå°†å¤æ‚åº¦é™åˆ°ï¼š\n$$ \\mathcal{O}(N \\log N) $$\nè¿™ä¹Ÿæ˜¯å…¶åœ¨ä¿¡å·å¤„ç†ã€å›¾åƒå¤„ç†ã€æ•°å€¼è®¡ç®—ç­‰é¢†åŸŸå¹¿æ³›åº”ç”¨çš„åŸå› ã€‚\n3.2 æ—‹è½¬å› å­çš„æ€§è´¨ åœ¨ DFT ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰æŒ‡æ•°éƒ¨åˆ†ï¼š\n$$ W_N = e^{-j \\frac{2\\pi}{N}} $$\nå®ƒè¢«ç§°ä¸º æ—‹è½¬å› å­ (Twiddle Factor)ï¼Œäºæ˜¯\n$$ W_N^{kn} = e^{-j \\frac{2\\pi}{N}kn} $$\næ­¤æ—¶ DFT å…¬å¼å¯å†™ä¸ºï¼š\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] W_N^{kn} $$\næ—‹è½¬å› å­å…·æœ‰ä¸€äº›é‡è¦æ€§è´¨ï¼š\nå‘¨æœŸæ€§ $$ W_N^{a+N} = e^{-j \\frac{2\\pi}{N}(a+N)} = e^{-j \\frac{2\\pi}{N}(a)} e^{-j2\\pi} = e^{-j \\frac{2\\pi}{N}(a)} = W_N^a $$\nå¯¹ç§°æ€§ $$ W_N^{a+\\frac{N}{2}} = e^{-j \\frac{2\\pi}{N}(a+\\frac{N}{2})} = e^{-j \\frac{2\\pi}{N}(a)} e^{-j\\pi} = - e^{-j \\frac{2\\pi}{N}(a)} = - W_N^a $$\nç¼©æ”¾æ€§ $$ W_N^{a} = e^{-j \\frac{2\\pi}{N}(a)} = e^{-j \\frac{2\\pi}{N/m}(a/m)} = W_{N/n}^{a/m} $$\nè¿™äº›æ€§è´¨å¯ä»¥ä½¿å¾—è®¡ç®—é‡å¤§å¤§å‡å°‘ã€‚\n3.3 å¿«é€Ÿå‚…é‡Œå¶å˜æ¢æ¨å¯¼å¼ ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹æ—‹è½¬å› å­çš„è¿™äº›æ€§è´¨æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚\nè®¾åŸå§‹åºåˆ—ä¸º $x[n]$ï¼Œé•¿åº¦ä¸º $N$ï¼ˆå‡è®¾ $N=2^m$ ä¸º 2 çš„å¹‚ï¼‰ã€‚å¦‚æœå®é™…å·¥ç¨‹ä¸­é‡åˆ°ä¸æ»¡è¶³ 2 çš„å¹‚çš„ç‚¹ï¼Œå¯ä»¥ç›´æ¥è¡¥é›¶åˆ° $N=2^m$ é•¿åº¦ï¼Œå¤åŸçš„æ—¶å€™æˆªæ–­åé¢çš„é›¶å³å¯ã€‚\næˆ‘ä»¬è¿˜æ˜¯å…ˆå›åˆ°åŸæ¥çš„å…¬å¼ï¼š\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] W_N^{kn} $$\næ‹†åˆ†æˆå¥‡æ•°éƒ¨åˆ†å’Œå¶æ•°éƒ¨åˆ†\n$$ \\begin{aligned} X[k] \u0026amp;= \\sum_{m=0}^{N/2-1} x[2m] \\cdot W_N^{k \\cdot 2m} + \\sum_{m=0}^{N/2-1} x[2m+1] \\cdot W_N^{k \\cdot (2m+1)} \\\\ \u0026amp; k=1,2,3,\u0026hellip;,N-1 \\end{aligned} $$\nè¿™é‡Œå®šä¹‰ä¸€ä¸ªä¸“é—¨ç”¨æ¥å–å¥‡å¶çš„å‡½æ•°ï¼Œ\n$$ \\begin{aligned} x_{even}(m)\u0026amp;=x(2m) \u0026amp; ,m=0,1,2,\u0026hellip;,N/2 - 1\\\\ x_{odd}(m)\u0026amp;=x(2m+1) \u0026amp; ,m=0,1,2,\u0026hellip;,N/2 - 1 \\end{aligned} $$\nåŒæ—¶æå–å‡ºå¥‡æ•°éƒ¨åˆ†çš„ä¸€ä¸ªå…¬å…±æ—‹è½¬å› å­ï¼š\n$$ \\begin{aligned} X[k] \u0026amp;= \\sum_{m=0}^{N/2-1} x_{even}(m) \\cdot W_N^{k \\cdot 2m} + W_N^k \\sum_{m=0}^{N/2-1} x_{odd}(m) \\cdot W_N^{k \\cdot (2m)}\\\\ \u0026amp;=\\sum_{m=0}^{N/2-1} x_{even}(m) \\cdot W_{N/2}^{k \\cdot m} + W_N^k \\sum_{m=0}^{N/2-1} x_{odd}(m) \\cdot W_{N/2}^{km}\\\\ \u0026amp; k=1,2,3,\u0026hellip;,N-1 \\end{aligned} $$\nå®šä¹‰\n$$ \\begin{aligned} X_{even}[k] \u0026amp;= \\sum_{m=0}^{N/2-1} x_{even}(m) \\cdot W_{N/2}^{k \\cdot m} \\\\ X_{odd}[k] \u0026amp;= \\sum_{m=0}^{N/2-1} x_{odd}(m) \\cdot W_{N/2}^{km} \\end{aligned} $$\né‚£ä¹ˆ\n$$ \\begin{aligned} X[k] = X_{even}[k] + W_N^k X_{odd}[k] \u0026amp; , \u0026amp; k=0,1,2,\u0026hellip;,N-1\\\\ \\end{aligned} $$\nç°åœ¨ $k$ æ¯” $m$ è¦å¤šä¸€å€çš„å–å€¼èŒƒå›´ï¼Œå¦‚æœæŠŠ $k$ ä¹Ÿå–ä¸€åŠï¼Œ\n$$ \\begin{aligned} X[k] \u0026amp;= X_{even}[k] + W_N^k X_{odd}[k] \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/2-1\\\\ X[k+N/2] \u0026amp;= X_{even}[k+N/2] + W_N^{k+N/2} X_{odd}[k+N/2] \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/2-1\\\\ \\end{aligned} $$\nä¾æ®æ—‹è½¬å› å­çš„å‘¨æœŸæ€§å’Œå¯¹ç§°æ€§ï¼ˆè¿™é‡Œå¯ä»¥å±•å¼€ä»£å…¥ä¸€ä¸‹ï¼‰ï¼ŒååŠéƒ¨åˆ†åˆå¯ä»¥å†™ä¸º\n$$ \\begin{aligned} X[k+N/2] \u0026amp;= X_{even}[k] - W_N^{k} X_{odd}[k] \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/2-1 \\end{aligned} $$\næ‰€ä»¥åŸå§‹åºåˆ—å¯ä»¥è¢«åˆ†è§£ä¸º 2 ä¸ªéƒ¨åˆ†ï¼Œå‰ $N/2$ éƒ¨åˆ†æ˜¯å¶æ•°éƒ¨åˆ†åŠ å¥‡æ•°éƒ¨åˆ†ï¼ˆä¹˜ä»¥ä¸€ä¸ªæ—‹è½¬å› å­ï¼‰ï¼Œå $N/2$ éƒ¨åˆ†æ˜¯å¶æ•°éƒ¨åˆ†å‡å»å¥‡æ•°éƒ¨åˆ†ï¼ˆä¹˜ä»¥ä¸€ä¸ªæ—‹è½¬å› å­ï¼‰ã€‚\nè¿˜è®°å¾—å‰é¢å°èŠ‚æåˆ°çš„å…±è½­å¯¹ç§°æ€§å—ï¼Ÿä¹Ÿæ˜¯åªéœ€è¦ç®—ä¸€åŠé¢‘ç‡å°±å¯ä»¥æ±‚å‡ºå¦ä¸€åŠé¢‘ç‡ï¼Œè¿™é‡Œå®é™…ä¸Šä¹Ÿæ˜¯æš—å«äº†è¿™ç§æ€§è´¨ã€‚\nä½†æ˜¯è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­è¿›è¡Œåˆ†è§£ï¼Œæ¯”å¦‚å¶æ•°éƒ¨åˆ†åˆå¯ä»¥æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†çš„å’Œ\n$$ \\begin{aligned} X_{even}[k] \u0026amp;= \\sum_{m=0}^{N/2-1} x_{even}(m) \\cdot W_{N/2}^{k \\cdot m} \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/2-1\\\\ X_{even}[k] \u0026amp;= \\sum_{m=0}^{N/4-1} x_{even-even}(m) \\cdot W_{N/4}^{k \\cdot m} \\\\ \u0026amp;+ W_{N/2}^{k} \\sum_{m=0}^{N/4-1} x_{even-odd}(m) \\cdot W_{N/4}^{k \\cdot m} \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/2-1 \\end{aligned} $$\nä»¥æ­¤ç±»æ¨ï¼š\n$$ \\begin{aligned} X_{even}[k] \u0026amp;= X_{even-even}(k) + W_{N/2}^{k} X_{even-odd}(k) \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/4-1\\\\ X_{even-even}[k] \u0026amp;= X_{even-even-odd}(k) + W_{N/4}^{k} X_{even-even-odd}(k) \u0026amp; \u0026amp; k=0,1,2,\u0026hellip;,N/8-1 \\end{aligned} $$\nå¯ä»¥ä¸æ–­è¿›è¡Œé€’å½’ï¼Œæœ€ç»ˆåœ¨ 2 ä¸ªå€¼çš„æ—¶å€™ï¼Œåªæœ‰ 1 ä¸ªå¶æ•°å’Œ 1 ä¸ªå¥‡æ•°ã€‚\næœ€ååœ¨åªå‰© 1 ä¸ªå€¼çš„è¿™ä¸€å±‚çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›å€¼æœ¬èº«å³å¯ï¼Œå› ä¸ºæ­¤æ—¶æ²¡æœ‰å¥‡æ•°åºåˆ—ï¼š\n$$ X_{\\text{final-even-index}} = x_{\\text{final-even-index}} $$\næœ€ç»ˆçš„ç»“æœå°±ç¬¦åˆä¸Šé¢çš„æ¨å¯¼ã€‚\nå®é™…ä¸Šæˆ‘ä»¬ç®—ä¸€ä¸‹ 2 ç‚¹çš„ DFT å°±çŸ¥é“ï¼Œå°±æ˜¯ä¸€ä¸ªåŠ æ³•å’Œä¸€ä¸ªå‡æ³•ã€‚\næ¯”å¦‚ $[x0, x1]$ ä¸¤ä¸ªç‚¹è¿›è¡Œ DFTï¼Œ\n$$ \\begin{aligned} X_0 \u0026amp;= x_0 \\cdot W_2^{0\\cdot0} + x_1 \\cdot W_2^{0\\cdot1} = x_0 \\cdot 1 + x_1 \\cdot 1 \u0026amp;= x_0 + x_1\\\\ X_1 \u0026amp;= x_0 \\cdot W_2^{1\\cdot0} + x_1 \\cdot W_2^{1\\cdot1} = x_0 \\cdot 1 + x_1 \\cdot (-1) \u0026amp;= x_0 - x_1 \\end{aligned} $$\n3.4 ä½åè½¬é‡æ’ å¯¹äº 8 ä¸ªæ•°çš„ FFTï¼ŒæŒ‰ç…§ä¸‹æ ‡åºå·åˆ†ç»„çš„è¯ï¼š\nç¬¬ä¸€å±‚ï¼š\n0 2 4 6 / 1 3 5 7 ç¬¬äºŒå±‚ï¼š\n0 4 / 2 6 / 1 5 / 3 7 ç¬¬ä¸‰å±‚ï¼š\n0 / 4 / 2 / 6 / 1 / 5 / 3 / 7 8ä¸ªæ•°å¯ä»¥ç”¨ 3 ä¸ª bit æ¥è¡¨ç¤ºï¼Œä»”ç»†è§‚å¯Ÿä¼šå‘ç°ï¼Œç¬¬ä¸€å±‚æ˜¯é€šè¿‡æœ€ä½ä½çš„å¥‡å¶æ€§æ¥åˆ†å±‚çš„ï¼Œç›¸åŒçš„åˆ†åœ¨ä¸€ç»„ï¼›ç¬¬äºŒå±‚æ˜¯ç¬¬äºŒä½çš„å¥‡å¶æ€§æ¥åˆ†ç»„ï¼›æœ€åä¸€å±‚æ˜¯ç¬¬é«˜ä½çš„å¥‡å¶æ€§æ¥åˆ†ç»„ã€‚\nå¦‚æœæˆ‘ä»¬æŠŠä½åè½¬ï¼š\n0 -\u0026gt; 000 -\u0026gt; 000 -\u0026gt; 0 1 -\u0026gt; 001 -\u0026gt; 100 -\u0026gt; 4 2 -\u0026gt; 010 -\u0026gt; 010 -\u0026gt; 2 3 -\u0026gt; 011 -\u0026gt; 110 -\u0026gt; 6 4 -\u0026gt; 100 -\u0026gt; 001 -\u0026gt; 1 5 -\u0026gt; 101 -\u0026gt; 101 -\u0026gt; 5 6 -\u0026gt; 110 -\u0026gt; 011 -\u0026gt; 3 7 -\u0026gt; 111 -\u0026gt; 111 -\u0026gt; 7 é€šè¿‡é‡æ’ bit ï¼Œè·å¾—åœ¨å†…å­˜ä¸­çš„è¿ç»­å—ï¼Œæ­£å¥½æ»¡è¶³è¿­ä»£ FFT çš„è®¡ç®—é¡ºåºã€‚\nä¸è¿‡ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬åç»­çš„ä»£ç ç¼–å†™é‡‡ç”¨é€’å½’æ–¹å¼ç¼–å†™ï¼Œä¸ä¼šè¿›è¡Œè¯¥æ“ä½œã€‚\n3.5 ç®—æ³•å¤æ‚åº¦åˆ†æ åœ¨æ¯ä¸€å±‚åˆå¹¶æ—¶ï¼Œéœ€è¦åš $N$ æ¬¡é¢å¤–çš„â€œè¶å½¢è¿ç®—â€ï¼ˆå¤åŠ æ³• + æ—‹è½¬å› å­ä¹˜æ³•ï¼‰ã€‚\næ¯ä¸€å±‚æ ¹æ®å¥‡å¶æ€§ç»†åˆ†ä¸€åŠï¼Œæ‰€ä»¥æ€»å…±æœ‰ $\\log_{2}{N}$ å±‚ã€‚\nç»¼ä¸Šï¼Œå¤æ‚åº¦ä¸ºï¼š\n$$ \\mathcal{O}(N \\log N) $$\n3.6 IFFT $$ x[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] e^{j \\frac{2\\pi}{N} kn}, \\quad n=0,1,\\dots,N-1 $$\nå¯ä»¥è¡¨ç¤ºä¸ºï¼š\n$$ \\begin{aligned} x[n] \u0026amp;= \\frac{1}{N} (\\sum_{k=0}^{N-1} (X[k])^{\\ast} (e^{j \\frac{2\\pi}{N} kn})^{\\ast})^{\\ast}\\\\ \u0026amp;= \\frac{1}{N} (\\sum_{k=0}^{N-1} (X[k])^{\\ast} e^{ -j \\frac{2\\pi}{N} kn})^{\\ast}\\\\ \u0026amp;= \\frac{1}{N} (\\text{FFT}((X[k])^{\\ast}))^{\\ast} \\end{aligned} $$\nå¦‚æœç”¨ Python å¯ä»¥è¡¨ç¤ºä¸ºï¼š\nx = np.conj(np.fft.fft(np.conj(X))) / N è¿™é‡Œæ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœè¾“å…¥åºåˆ—æ˜¯å®æ•°ï¼Œé‚£ä¹ˆ IFFT è¿”å›åªæœ‰å®éƒ¨ï¼Œæ‰€ä»¥è™šæ•°å¯ä»¥ä¸å–ã€‚\n3.7 FFT Python Code å‡å®šè¾“å…¥åºåˆ—æ˜¯ $N = 2^{m}$ã€‚\næœ‰å¦‚ä¸‹ä»£ç ï¼š\nimport numpy as np def fft(x): N = len(x) if N \u0026lt;= 1: return x X_even = fft(x[0::2]) X_odd = fft(x[1::2]) X = [0] * N for k in range(N//2): t = np.exp(-2j * np.pi * k / N) * X_odd[k] X[k] = X_even[k] + t X[k + N//2] = X_even[k] - t return X def ifft(X): N = len(X) x_time = np.conj(fft(np.conj(X))) / N return x_time if __name__ == \u0026#34;__main__\u0026#34;: x = [1,t(x) print(\u0026#34;FFT:\u0026#34;) for k, v in enumerate(X): print(f\u0026#34;X[{k:2d}] = {v.real:8.2f} + {v.imag:8.2f}j\u0026#34;) # IFFT x_rec = ifft(X) print(\u0026#34;\\nIFFT:\u0026#34;) for n, v in enumerate(x_rec): print(f\u0026#34;x[{n:2d}] = {v.real:8.2f} + {v.imag:8.2f}j\u0026#34;) 2, 3, 4, 5, 6, 7, 8] print(\u0026#34;x[n]: \u0026#34;, x, \u0026#34;\\n\u0026#34;) # FFT X = ff ç»“æœä¸ºï¼š\nx[n]: [1, 2, 3, 4, 5, 6, 7, 8] FFT: X[ 0] = 36.00 + 0.00j X[ 1] = -4.00 + 9.66j X[ 2] = -4.00 + 4.00j X[ 3] = -4.00 + 1.66j X[ 4] = -4.00 + 0.00j X[ 5] = -4.00 + -1.66j X[ 6] = -4.00 + -4.00j X[ 7] = -4.00 + -9.66j IFFT: x[ 0] = 1.00 + -0.00j x[ 1] = 2.00 + 0.00j x[ 2] = 3.00 + -0.00j x[ 3] = 4.00 + 0.00j x[ 4] = 5.00 + -0.00j x[ 5] = 6.00 + -0.00j x[ 6] = 7.00 + 0.00j x[ 7] = 8.00 + -0.00j 3.8 2D FFT IFFT 2D DFT çš„å®šä¹‰\nè®¾è¾“å…¥çŸ©é˜µ $f[m,n]$ å¤§å°ä¸º $M \\times N$ï¼Œ2D DFT å®šä¹‰ä¸ºï¼š\n$$ F[k,l] = \\sum_{m=0}^{M-1}\\sum_{n=0}^{N-1} f[m,n] , e^{-j 2\\pi \\left(\\frac{k m}{M} + \\frac{l n}{N}\\right)} $$\næ³¨æ„æŒ‡æ•°æ˜¯è¡Œæ–¹å‘ + åˆ—æ–¹å‘çš„å’Œã€‚\nå› ä¸ºæŒ‡æ•°æ˜¯å¯åˆ†è§£çš„ï¼š\n$$ e^{-j 2\\pi (\\frac{k m}{M} + \\frac{l n}{N})} = e^{-j 2\\pi \\frac{k m}{M}} \\cdot e^{-j 2\\pi \\frac{l n}{N}} $$\nä»£å…¥åŸå¼ï¼š\n$$ F[k,l] = \\sum_{m=0}^{M-1}\\sum_{n=0}^{N-1} f[m,n] , e^{-j 2\\pi \\frac{k m}{M}} , e^{-j 2\\pi \\frac{l n}{N}} $$\nè¿™å°±æ„å‘³ç€å¯ä»¥å…ˆå¯¹ n åšæ±‚å’Œï¼Œå†å¯¹ m åšæ±‚å’Œï¼š\n$$ F[k,l] = \\sum_{m=0}^{M-1} \\left[ e^{-j 2\\pi \\frac{k m}{M}} \\left( \\sum_{n=0}^{N-1} f[m,n] , e^{-j 2\\pi \\frac{l n}{N}} \\right) \\right] $$\nè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æ‹†åˆ†ä¸ºå…ˆå¯¹è¡Œåš FFTï¼Œå¾—åˆ°ç»“æœåå†åœ¨åˆ—æ–¹å‘åšä¸€æ¬¡ FFTã€‚ï¼ˆä¹Ÿå¯ä»¥å…ˆåˆ—åè¡Œåè¿‡æ¥ï¼Œä¸å½±å“ç»“æœï¼‰\nç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸Šï¼ŒDFT çš„æ—¶é—´å¤æ‚åº¦ä¸ºï¼š\n$$ \\mathcal{O}(M^2 N^2) $$\næ‹†åˆ†ä¸º 2 ä¸ª 1D FFT åä¸ºï¼š\n$$ \\mathcal{O}(M N \\log N + N M \\log M) = \\mathcal{O}(M N (\\log M + \\log N)) $$\nè¿™é‡Œç»™å‡º 2D çš„ FFT ä»£ç ï¼š\nimport numpy as np from fft1d import fft, ifft def fft2d(matrix): temp = np.array([fft(row) for row in matrix]) temp = np.array([fft(col) for col in temp.T]).T return temp def ifft2d(matrix): temp = np.array([ifft(row) for row in matrix]) temp = np.array([ifft(col) for col in temp.T]).T return temp if __name__ == \u0026#34;__main__\u0026#34;: x = np.array([ [1, 2, 3, 4], [5, 6, 7, 8], [9,10,11,12], [13,14,15,16] ], dtype=float) print(\u0026#34;x[i,j]:\u0026#34;) print(x) # 2D FFT X = fft2d(x) print(\u0026#34;\\n2D FFT X:\u0026#34;) print(np.round(X, 2)) # 2D IFFT x_rec = ifft2d(X) print(\u0026#34;\\n2D IFFT x_rec:\u0026#34;) print(np.round(x_rec.real, 2)) ç»“æœå¦‚ä¸‹ï¼š\nx[i,j]: [[ 1. 2. 3. 4.] [ 5. 6. 7. 8.] [ 9. 10. 11. 12.] [13. 14. 15. 16.]] 2D FFT X: [[136. +0.j -8. +8.j -8. +0.j -8. -8.j] [-32.+32.j 0. +0.j 0. +0.j 0. +0.j] [-32. +0.j 0. +0.j 0. +0.j 0. +0.j] [-32.-32.j 0. +0.j 0. +0.j 0. +0.j]] 2D IFFT x_rec: [[ 1. 2. 3. 4.] [ 5. 6. 7. 8.] [ 9. 10. 11. 12.] [13. 14. 15. 16.]] 4. å‚è€ƒè‡´è°¢ èŠ±äº†å‡ å¤©æ—¶é—´ç»ˆäºå†™å®Œäº†ï¼Œæ„Ÿè§‰å¾—åˆ°äº†è¿›åŒ–ã€‚\nä¸ªäººæ„Ÿè§‰å¤§é‡çš„ç§‘æ™®è§†é¢‘å’Œå‚è€ƒæ–‡ç« éƒ½å±€é™äºè¿‡å¤šçš„æ‰“æ¯”æ–¹å’Œä¸¾ä¾‹å­ã€‚å®é™…ä¸Šä»ç¬¬ä¸€æ€§åŸç†ç›´æ¥å½»åº•äº†è§£åè€Œæ˜¯æœ€ç®€å•çš„ã€‚\næŒ‰ç…§æ¨æŒ¯å®çš„è¯è¯´ï¼šâ€œå½“ç›´è§‰ä¸ä¹¦æœ¬çŸ¥è¯†æœ‰å†²çªï¼Œæ˜¯æœ€å¥½çš„å­¦ä¹ æœºä¼šï¼Œå¿…é¡»æŠ“ä½ï¼ŒæŠŠæœ¬æ¥çš„ç›´è§‰é”™è¯¯æƒ³æ¸…æ¥šï¼Œå½¢æˆæ–°çš„ç›´è§‰â€ã€‚\nç‰¹åˆ«æ„Ÿè°¢ä¸‹åˆ—è§†é¢‘ä½œè€…ï¼š\nDR_CAN1çš„å‚…é‡Œå¶å˜æ¢æ¨å¯¼è¿‡ç¨‹ã€‚ nksunmoon2çš„ FFT è¿‡ç¨‹è®²è§£ã€‚ DR_CAN , 2018, çº¯å¹²è´§æ•°å­¦æ¨å¯¼_å‚…é‡Œå¶çº§æ•°ä¸å‚…é‡Œå¶å˜æ¢, https://www.bilibili.com/video/BV1Et411R78v\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nnksunmoon, 2022, å¿«é€Ÿå‚…é‡Œå¶å˜æ¢åŸç†, https://www.bilibili.com/video/BV1Ng411v7Dk\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/fourier-transform/","summary":"\u003ch2 id=\"1-å‚…é‡Œå¶å˜æ¢\"\u003e1. å‚…é‡Œå¶å˜æ¢\u003c/h2\u003e\n\u003cp\u003eå‚…é‡Œå¶å˜æ¢èµ·æºäº18ä¸–çºªç ”ç©¶æŒ¯åŠ¨ä¸çƒ­ä¼ å¯¼çš„é—®é¢˜ã€‚æ¬§æ‹‰ã€è¾¾æœ—è´å°”å’Œä¼¯åŠªåˆ©æå‡ºç”¨æ­£å¼¦æ³¢æè¿°æŒ¯åŠ¨ï¼Œå¥ å®šäº†æ€æƒ³åŸºç¡€ã€‚\u003c/p\u003e\n\u003cp\u003e19ä¸–çºªåˆï¼Œæ³•å›½æ•°å­¦å®¶å‚…é‡Œå¶åœ¨ç ”ç©¶çƒ­ä¼ å¯¼æ—¶æå‡ºä»»ä½•å‡½æ•°éƒ½å¯å±•å¼€ä¸ºæ­£å¼¦ä¸ä½™å¼¦çº§æ•°ï¼Œè¿™å°±æ˜¯å‚…é‡Œå¶çº§æ•°ï¼Œå¹¶é€æ¸å‘å±•ä¸ºå‚…é‡Œå¶å˜æ¢ã€‚\u003c/p\u003e","title":"Fourier Transform"},{"content":"Stencil ä»‹ç» Stencil çš„æ¦‚å¿µå’Œ Stencil Buffer è”ç³»åœ¨ä¸€èµ·ã€‚\næˆ‘ä»¬çŸ¥é“ï¼Œå±å¹•æœ‰æ·±åº¦ç¼“å†²ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ­£åœ¨æ¸²æŸ“çš„ç‚¹çš„è·ç¦»å¤§äºæ·±åº¦ç¼“å†²é‡Œçš„å€¼æ—¶ï¼Œå°±ä¼šç›´æ¥ä¸¢å¼ƒæ­¤æ—¶Passã€‚\nStencil Buffer ä¹Ÿæ˜¯ä¸€ä¸ª Bufferï¼Œä¸åŒäºæ·±åº¦ç¼“å†²æœ‰é»˜è®¤çš„å¤§å°å¯¹æ¯”è¡Œä¸ºï¼ŒStencil Buffer éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çº¦å®šå¤„ç†æ–¹å¼ã€‚\nå®˜æ–¹12æœ‰ä¸€äº›ä»‹ç»ï¼Œä¸è¿‡å¯èƒ½ç¨å¾®æœ‰ç‚¹æŠ½è±¡ä¸å¥½ç†è§£ï¼Œè¿™é‡Œæˆ‘ä»¬ä»ä¸€ä¸ªä¾‹å­å‡ºå‘ï¼Œæ¥è§£é‡Šä¸‹å¯ä»¥åšåˆ°ä»€ä¹ˆã€‚\nStencil Test å‡å¦‚æœ¬æ¥æˆ‘ä»¬æœ‰ä¸€ä¸ªCubeå’Œä¸€ä¸ªæ­£æ–¹å½¢é¢ç‰‡Quadï¼Œå½“Quadåœ¨Cubeçš„å‰é¢çš„æ—¶å€™ï¼ŒCubeä¼šè¢«é®ä½ä¸€äº›éƒ¨åˆ†ã€‚\nç°åœ¨æˆ‘ä»¬å°†Quadæ›¿æ¢ä¸ºä¸‹é¢çš„ Shaderï¼Œè¿™ä¸ª Shader åšäº†ä¸‹åˆ—å‡ ä»¶äº‹ï¼š\nBlend Zero One è¡¨ç¤ºä¿æŒåŸæœ‰çš„é¢œè‰²ï¼Œè¿™æ„å‘³ç€æ¸²æŸ“çš„ç‰©ä½“å°†æ˜¯é€æ˜çš„ã€‚ ZWrite Off è¡¨ç¤ºä¸æ”¹å˜æ·±åº¦ç¼“å†² Stencil å†…çš„å†…å®¹å°±æ˜¯æ¨¡æ¿æµ‹è¯•ï¼Œå…·ä½“å†…å®¹åé¢ä¼šå†è§£é‡Šï¼Œè¿™é‡Œåªéœ€è¦çŸ¥é“Comp Alwaysè¡¨ç¤ºæ°¸è¿œé€šè¿‡ï¼ŒPass Replaceè¡¨ç¤ºPassåå°† Stencil ç¼“å†²åŒºçš„å€¼æ›¿æ¢ä¸ºRefæ‰€è¡¨ç¤ºçš„å€¼ã€‚ Shader \u0026#34;Custom/Stencil/StencilFilter\u0026#34; { Properties { [IntRange] _StencilID (\u0026#34;Stencil ID\u0026#34;, Range(0, 255)) = 1 } SubShader { Tags { \u0026#34;RenderType\u0026#34; = \u0026#34;Opaque\u0026#34; \u0026#34;RenderPipeline\u0026#34; = \u0026#34;UniversalPipeline\u0026#34; \u0026#34;Queue\u0026#34; = \u0026#34;Geometry\u0026#34; } Blend Zero One ZWrite Off Stencil { Ref [_StencilID] Comp Always Pass Replace } Pass { } } } ç°åœ¨Quadå°†æ˜¯é€æ˜çš„ï¼ŒåŒæ—¶ï¼Œå®ƒä¹Ÿæ”¹å†™äº†æ•´ä¸ªåŒºåŸŸçš„Stencil Bufferçš„å€¼ã€‚\nç„¶åï¼Œæˆ‘ä»¬å°†Cubeçš„Shaderä¹Ÿè¿›è¡Œæ›¿æ¢ï¼š\næˆ‘ä»¬åªéœ€è¦å…³æ³¨Stencilå†…çš„å†…å®¹ï¼Œè¿™é‡ŒComp Equalçš„æ„æ€æ˜¯ï¼Œå¦‚æœRefçš„å€¼ç­‰äºStencil Bufferå°±é€šè¿‡æµ‹è¯•ï¼Œç»§ç»­åé¢çš„Passï¼Œå¦åˆ™åœæ­¢æ¸²æŸ“ã€‚ Shader \u0026#34;Custom/Stencil/StencilTest\u0026#34; { Properties { [IntRange] _StencilID (\u0026#34;Stencil ID\u0026#34;, Range(0, 255)) = 0 [MainColor] _BaseColor(\u0026#34;Base Color\u0026#34;, Color) = (1, 1, 1, 1) [MainTexture] _BaseMap(\u0026#34;Base Map\u0026#34;, 2D) = \u0026#34;white\u0026#34; } SubShader { Tags { \u0026#34;RenderType\u0026#34; = \u0026#34;Opaque\u0026#34; \u0026#34;RenderPipeline\u0026#34; = \u0026#34;UniversalPipeline\u0026#34; \u0026#34;Queue\u0026#34; = \u0026#34;Geometry\u0026#34; } Stencil { Ref [_StencilID] Comp Equal } Pass { HLSLPROGRAM #pragma vertex vert #pragma fragment frag #include \u0026#34;Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl\u0026#34; struct Attributes { float4 positionOS : POSITION; float2 uv : TEXCOORD0; }; struct Varyings { float4 positionHCS : SV_POSITION; float2 uv : TEXCOORD0; }; TEXTURE2D(_BaseMap); SAMPLER(sampler_BaseMap); CBUFFER_START(UnityPerMaterial) half4 _BaseColor; float4 _BaseMap_ST; CBUFFER_END Varyings vert(Attributes IN) { Varyings OUT; OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz); OUT.uv = TRANSFORM_TEX(IN.uv, _BaseMap); return OUT; } half4 frag(Varyings IN) : SV_Target { half4 color = SAMPLE_TEXTURE2D(_BaseMap, sampler_BaseMap, IN.uv) * _BaseColor; return color; } ENDHLSL } } } å°†Quadå’ŒCubeçš„_StencilIDçš„å€¼éƒ½æ”¹ä¸ºç›¸åŒçš„å€¼ï¼Œæ¯”å¦‚1ã€‚\nç„¶åæ‹–åŠ¨Quadï¼Œä¼šçœ‹åˆ°éå¸¸æœ‰æ„æ€çš„ä¸€å¹•ã€‚åªæœ‰è¢«Quadé®æŒ¡çš„åŒºåŸŸï¼Œæ‰ä¼šæ¸²æŸ“Cubeã€‚\nå¦‚æœæˆ‘ä»¬æœ‰2ä¸ªä¸åŒ_StencilIDçš„Cubeï¼Œå’Œ2ä¸ªä¸åŒ_StencilIDçš„Quadï¼Œå®ƒä»¬å¯ä»¥å„è‡ªæ˜¾ç¤ºç¬¦åˆè‡ªå·±IDçš„Cubeï¼Œä½†æ˜¯ä¸ä¼šæ˜¾ç¤ºå¦ä¸€ä¸ªCubeã€‚\nè¿™é‡Œç¨å¾®è§£é‡Šä¸‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š\nç”±äºæ•´ä¸ªå±å¹•æ¯æ¬¡æ¸²æŸ“é»˜è®¤çš„Stencil Bufferçš„å€¼æ˜¯0ï¼Œæ‰€ä»¥ä¸¤ä¸ªCubeåœ¨Quadæ²¡æœ‰è¦†ç›–åˆ°çš„åœ°æ–¹éƒ½ä¸ä¼šæ˜¾ç¤ºã€‚ Quadæ¸²æŸ“åæ”¹å˜äº†å½“å‰åƒç´ çš„Stencil Bufferçš„å€¼ï¼Œè€ŒCubeè®¾ç½®äº†Comp Equalï¼Œæ‰€ä»¥å¯ä»¥æ˜¾ç¤ºåœ¨æ”¹å˜äº†Stencil Bufferçš„åŒºåŸŸã€‚ æ¸²æŸ“é¡ºåº åœ¨ä¸Šé¢çš„æ¢è®¨ä¸­ï¼Œå¯ä»¥æ„è¯†åˆ°ä¸€ä¸ªé—®é¢˜ï¼šQuadåªæœ‰åœ¨Cubeä¹‹å‰æ¸²æŸ“ï¼Œæ‰èƒ½å¤Ÿå…ˆæ”¹å˜Stencil Bufferï¼Œç„¶åæ¸²æŸ“Cubeã€‚\nå¦‚æœå®ƒä»¬çš„æ¸²æŸ“é¡ºåºä¹Ÿå°±æ˜¯Queueéƒ½æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‘ç”Ÿé—ªçƒã€‚\nå¯ä»¥å°†Quadçš„Queueè®¾ç½®ä¸ºæ¯”Cubeæ›´å°çš„å€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥ç¡®ä¿Quadåœ¨Cubeä¹‹å‰è¿›è¡Œæ¸²æŸ“ã€‚\nCubeä¸å†ä¼šå‘ç”Ÿé—ªçƒï¼š\nStencil Test è¯­æ³•ä»‹ç» å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£2æˆ–è€…è¿™ç¯‡ä¸­æ–‡æ–‡ç« 3ã€‚\næ ¸å¿ƒè¯­æ³•å¦‚ä¸‹ï¼š\nStencil { Ref \u0026lt;ref\u0026gt; ReadMask \u0026lt;readMask\u0026gt; WriteMask \u0026lt;writeMask\u0026gt; Comp \u0026lt;comparisonOperation\u0026gt; Pass \u0026lt;passOperation\u0026gt; Fail \u0026lt;failOperation\u0026gt; ZFail \u0026lt;zFailOperation\u0026gt; } å…¶ä¸­\u0026lt;ref\u0026gt;æ˜¯å‚è€ƒå€¼ï¼Œå®ƒå¦‚ä½•ä¸Stencil Bufferå¯¹æ¯”å–å†³äºCompã€‚\nReadMask æ˜¯å¯¹æ¯”çš„æ—¶å€™çš„é®ç½©ï¼ŒåŒç† WriteMask æ˜¯å†™å…¥çš„æ—¶å€™çš„é®ç½©ã€‚\nCompå®šä¹‰Refä¸Stencil Buffer Valueå¦‚ä½•å¯¹æ¯”ï¼Œé»˜è®¤æ˜¯Alwaysä¹Ÿå°±æ˜¯æ€»æ˜¯Passï¼ŒEqualè¡¨ç¤ºç›¸ç­‰æ—¶Passï¼Œè¿˜æœ‰Less/LEqual/Grater/NotEqual/GEualç­‰ç­‰ã€‚\nPasså®šä¹‰çš„æ˜¯Compé€šè¿‡åå¯¹Stencil Buffer Valueçš„æ“ä½œï¼Œæ¯”å¦‚Keepè¡¨ç¤ºä¿æŒStencil Bufferçš„å€¼ï¼ŒReplaceè¡¨ç¤ºç”¨Refçš„å€¼æ›¿æ¢æ‰Stencil Bufferçš„å€¼ï¼Œè¿˜æœ‰Zero/IncrSat/DecrSat/Invert/IncrWrap/DecrWrapã€‚\nFailå®šä¹‰çš„æ˜¯Compå¤±è´¥åçš„æ“ä½œï¼Œå†…å®¹å’ŒPassä¸€æ ·ã€‚\nZFailå®šä¹‰çš„æ˜¯Compé€šè¿‡ï¼Œä½†æ˜¯æ·±åº¦ç¼“å†²æµ‹è¯•æœªé€šè¿‡çš„æƒ…å†µï¼Œå†…å®¹è¿˜æ˜¯å’ŒPassä¸€æ ·ã€‚\nè¿˜å¯ä»¥å•ç‹¬å®šä¹‰æ­£é¢å’Œåé¢çš„Pass/Fail/ZFailï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å»äº†è§£ã€‚\nä¸€ä¸ªæœ€ç®€å•çš„ä¿®æ”¹Stencil Bufferçš„ä»£ç ï¼š\nStencil { Ref 1 Comp Always Pass Replace } ä¸€ä¸ªæœ€ç®€å•çš„æµ‹è¯•Stencil Bufferçš„ä»£ç ï¼š\nStencil { Ref 1 Comp Equal } Renderer Objects feature å¦‚æœæ¯å¢åŠ ä¸€ä¸ªShaderï¼Œæˆ‘ä»¬å°±éœ€è¦æ·»åŠ Stencil Bufferï¼Œç„¶åè®¾ç½®_StencilIDï¼Œé‚£æ— ç–‘ä¼šæ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹å¾ˆå¤šæè´¨ã€‚\nä½ ä¹Ÿå¯ä»¥å‚è€ƒ impossible-geom-stencils4 äº†è§£å¦‚ä½•ä½¿ç”¨ Renderer Objects feature æ¥è®¾ç½®Stencilã€‚\nå¦‚å›¾ï¼Œåœºæ™¯ä¸­æœ‰3ä¸ªCubeå’Œ2ä¸ªQuadï¼Œå…¶ä¸­ç´«è‰²çš„Cubeæ˜¯åŠé€æ˜æè´¨ã€‚\nå…ˆå°†2ä¸ªQuadæ›¿æ¢ä¸ºå‰é¢çš„StencilFilterã€‚\nåˆ›å»º2ä¸ªæ–°çš„Layerï¼Œåˆ†åˆ«å‘½åStencil Object 1å’ŒStencil Object 2ï¼Œç»™3ä¸ªCubeåˆ†é…ä¸Šè¿™2ä¸ªLayerä¸­çš„ä»»æ„1ä¸ªã€‚\nç„¶åæ‰¾åˆ°Universal Renderer Dataè®¾ç½®ï¼Œå–æ¶ˆæ‰è¿™ä¸¤å±‚çš„æ¸²æŸ“ã€‚\næ·»åŠ ä¸€ä¸ªRender Objects Featureï¼ŒFiltersä¸­çš„Layer Maské€‰æ‹©Stencil Object 1/2ï¼Œè¿™é‡Œä¸€å…±éœ€è¦æ·»åŠ 4ä¸ªRender Objects Featureï¼Œå¯¹åº”2ç§Queueå’Œ2ä¸ªLayer Maskã€‚\né‡ç‚¹æ˜¯åœ¨Overrideä¸­ï¼Œå‹¾é€‰Stencilï¼Œè¿™æ ·å¯ä»¥è¦†ç›–æ‰åŸæœ‰çš„Stencilè®¾ç½®ï¼Œæ¯”å¦‚è¿™é‡Œæ”¹ä¸ºEqualåŒæ—¶è®¾ç½®Valueä¸ºå¯¹åº”çš„å€¼ã€‚\nè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯Eventæ’å…¥æ—¶æœºï¼Œå¦‚æœæ˜¯Opaqueåº”è¯¥å¯¹åº”é€‰æ‹©After Rendering Opaquesï¼ŒTransparentè¦å¯¹åº”é€‰æ‹©After Rendering Transparentsã€‚\nçœ‹ä¸€ä¸‹æ•ˆæœï¼š\nå¦‚æœä¿®æ”¹ä¸€ä¸‹åœºæ™¯å¸ƒå±€ï¼Œå–æ¶ˆç›¸æœºæ¸²æŸ“å¤©ç©ºç›’ï¼Œç»™StencilFilteråŠ ä¸Šé¢œè‰²ï¼Œå°±å¯ä»¥æœ‰å¦‚ä¸‹çš„Magic Cubeï¼š\nUnity, 2025, writing-shader-set-stencil, https://docs.unity3d.com/6000.2/Documentation/Manual/writing-shader-set-stencil.html\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nUnity, 2025, SL-Stencil, https://docs.unity3d.com/6000.2/Documentation/Manual/SL-Stencil.html\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nlupeng0330, 2015, UnityShaderå®ä¾‹09:Stencil Buffer\u0026amp;Stencil Test , https://blog.csdn.net/u011047171/article/details/46928463\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nDaniel Ilett, 2022, impossible geom stencils, https://danielilett.com/2022-01-05-tut5-22-impossible-geom-stencils/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/stencil-buffer-and-stencil-test/","summary":"\u003ch2 id=\"stencil-ä»‹ç»\"\u003eStencil ä»‹ç»\u003c/h2\u003e\n\u003cp\u003eStencil çš„æ¦‚å¿µå’Œ Stencil Buffer è”ç³»åœ¨ä¸€èµ·ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬çŸ¥é“ï¼Œå±å¹•æœ‰æ·±åº¦ç¼“å†²ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ­£åœ¨æ¸²æŸ“çš„ç‚¹çš„è·ç¦»å¤§äºæ·±åº¦ç¼“å†²é‡Œçš„å€¼æ—¶ï¼Œå°±ä¼šç›´æ¥ä¸¢å¼ƒæ­¤æ—¶Passã€‚\u003c/p\u003e\n\u003cp\u003eStencil Buffer ä¹Ÿæ˜¯ä¸€ä¸ª Bufferï¼Œä¸åŒäºæ·±åº¦ç¼“å†²æœ‰é»˜è®¤çš„å¤§å°å¯¹æ¯”è¡Œä¸ºï¼ŒStencil Buffer éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çº¦å®šå¤„ç†æ–¹å¼ã€‚\u003c/p\u003e","title":"Unity Stencil Buffer \u0026 Stencil Test"},{"content":"Worley Noise Worley Noise1ï¼ˆä¹Ÿç§°ä¸º Voronoi noise å’Œ Cellular noiseï¼‰æ˜¯ç”± Steven Worley2 åœ¨ 1996 å¹´å¼•å…¥çš„ä¸€ç§å™ªå£°å‡½æ•°ã€‚\nå®ƒçš„æ ·å­çœ‹èµ·æ¥å°±æ˜¯ç”Ÿç‰©ç»†èƒçš„æ ·å­ï¼Œç”±ä¸€ä¸ªä¸ª cell æ„æˆï¼Œä½œè€…æœ¬èº«ä¹Ÿæ˜¯å«å®ƒâ€œCellular Textureâ€ã€‚\nWorley Noise çš„ç”Ÿæˆç®—æ³•æ˜¯ï¼šå°†æ•´ä¸ªå›¾åƒåˆ†ä¸ºä¸€ä¸ªä¸ªå°æ–¹æ ¼ï¼Œæ¯ä¸ªå°æ–¹æ ¼ä¸­ä¼šæœ‰1ä¸ªç‰¹å¾ç‚¹ï¼Œæ¯ä¸ªåƒç´ ç‚¹çš„æ•°å€¼ï¼Œæ˜¯å®ƒåˆ°å‘¨å›´å•å…ƒæ ¼ä¸­ç‰¹å¾ç‚¹çš„è·ç¦»çš„æœ€å°å€¼ã€‚\nç”±äºæ¯ä¸ªå°æ–¹æ ¼åªæœ‰1ä¸ªç‰¹å¾ç‚¹ï¼Œæ¯ä¸ªåƒç´ åªéœ€è¦æ£€æŸ¥ä¸´è¿‘çš„9ä¸ªå°æ–¹æ ¼ï¼Œä¸€å…±åªéœ€è¦å¯¹æ¯”9ä¸ªç‚¹æ¥è®¡ç®—å‡ºå®ƒçš„å€¼ã€‚\nè¿™é‡Œæœ‰2ä¸ªåœ¨æ¸¸æˆä¸­çš„åº”ç”¨æ¡ˆä¾‹3ï¼Œåˆ†åˆ«æ˜¯é¾Ÿè£‚çš„å¹²æ—±åœ°é¢å’Œé€ å‹å¤¸å¼ çš„çƒŸæŸ±ã€‚\nShadertoy åœ¨æœ¬æ¬¡ä»£ç å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸»è¦å­¦ä¹ è‡ªSuboptimal Engineer4å’ŒThe Book of Shaders5ï¼Œå¹¶åœ¨Shadertoy6ä¸Šè¿›è¡Œäº†å…·ä½“çš„ä»£ç ç¼–å†™ã€‚\nåŒæ—¶ï¼Œåœ¨iquilezles7è¿™ä¸ªç½‘ç«™æœ‰å¾ˆå¤šå›¾å½¢å­¦ç›¸å…³çš„çŸ¥è¯†å¯ä»¥è¿›è¡Œå‚è€ƒã€‚\nGrid Code è¿›å…¥ Shadertoyï¼Œè¾“å…¥ä¸‹åˆ—çš„ä»£ç ï¼š\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec3 col = vec3(0.0); fragColor = vec4(col,1.0); } æ­¤æ—¶æ˜¾ç¤ºçº¯é»‘è‰²ã€‚\nå°†åæ ‡å˜ä¸ºæ­£æ–¹å½¢æ–¹æ ¼åæ ‡ï¼Œæ¯ä¸ªæ–¹æ ¼çš„èŒƒå›´åœ¨$[-0.5, +0.5]$ä¹‹é—´ã€‚\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; vec3 col = vec3(coord, 0); fragColor = vec4(col,1.0); } æ ¹æ®è·ç¦»æ¯ä¸ªæ–¹æ ¼è¾¹æ¡†çš„è·ç¦»ï¼Œæ¥è¿›è¡Œä¸Šè‰²ã€‚\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; float distanceGrid = 2.0 * max(abs(coord.x), abs(coord.y)); vec3 col = vec3(distanceGrid); fragColor = vec4(col,1.0); } åªåœ¨ä¸´è¿‘è¾¹ç•Œçš„åœ°æ–¹è¿›è¡Œä¸Šè‰²ï¼Œå¹¶æ·»åŠ é¢œè‰²ä¸ºçº¢è‰²ã€‚\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; float distanceGrid = smoothstep(0.9, 1.0, 2.0 * max(abs(coord.x), abs(coord.y))); vec3 girdColor = vec3(1.0, 0, 0) * vec3(distanceGrid); vec3 col = girdColor; fragColor = vec4(col,1.0); } Cell Code æ¥ä¸‹æ¥åšä¸¤ä»¶äº‹ï¼š\næ ¹æ®ä¼ªéšæœºå‡½æ•°ï¼Œç¡®å®šæ¯ä¸ªæ–¹æ ¼çš„ç‚¹çš„ä½ç½® è®¡ç®—å½“å‰åƒç´ åˆ°ä¸´è¿‘9ä¸ªæ–¹æ ¼ç‚¹çš„è·ç¦»ï¼Œå–æœ€å°å€¼ å…ˆç»˜åˆ¶æ‰€æœ‰æ–¹æ ¼ç‚¹ï¼Œæ¯ä¸ªæ–¹æ ¼ä¸­åªæœ‰1ä¸ªç‚¹ã€‚\nvec2 random2( vec2 p ) { // add 0.5 to avoid vec2(0, 0) return (0, 0) return fract(sin(vec2(dot(p + 0.5, vec2(213.1,322.2)),dot(p + 0.5, vec2(513.1,312.2))))*51312.1234); } void mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; // Gird Color float distanceGrid = smoothstep(0.9, 1.0, 2.0 * max(abs(coord.x), abs(coord.y))); vec3 girdColor = vec3(1.0, 0, 0) * vec3(distanceGrid); // Cell Color float distancePoint = 1.0; for (int i=-1; i\u0026lt;=1; i++) { for (int j=-1; j\u0026lt;=1; j++) { vec2 near = vec2(float(i), float(j)); vec2 point = near + 0.5 * sin(iTime + 6.2831 * random2(gird + near)); float currentDistance = length(coord - point); distancePoint = min(currentDistance, distancePoint); } } vec3 pointColor = vec3(smoothstep(0.90, 1.0, 1.0 - distancePoint)); vec3 col = girdColor + pointColor; fragColor = vec4(col,1.0); } åœ¨æœ‰äº†è·ç¦»åï¼Œåªè¦æ ¹æ®è·ç¦»æ˜¾ç¤ºé¢œè‰²å°±å¯ä»¥äº†ã€‚\nvec2 random2( vec2 p ) { // add 0.5 to avoid vec2(0, 0) return (0, 0) return fract(sin(vec2(dot(p + 0.5, vec2(213.1,322.2)),dot(p + 0.5, vec2(513.1,312.2))))*51312.1234); } void mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; // Gird Color float distanceGrid = smoothstep(0.95, 1.0, 2.0 * max(abs(coord.x), abs(coord.y))); vec3 girdColor = vec3(1.0, 0, 0) * vec3(distanceGrid); // Cell Color float distancePoint = 1.0; for (int i=-1; i\u0026lt;=1; i++) { for (int j=-1; j\u0026lt;=1; j++) { vec2 near = vec2(float(i), float(j)); vec2 point = near + 0.5 * sin(iTime + 6.2831 * random2(gird + near)); float currentDistance = length(coord - point); distancePoint = min(currentDistance, distancePoint); } } vec3 pointColor = vec3(smoothstep(0.95, 1.0, 1.0 - distancePoint)); vec3 distanceColor = vec3(smoothstep(0.2, 2.0, 1.7 - distancePoint)); vec3 col = girdColor + pointColor + distanceColor; fragColor = vec4(col,1.0); } æœ€åï¼Œå¦‚æœç§»é™¤è¾…åŠ©ç½‘æ ¼å’Œä¸­ç‚¹ï¼Œå¾—åˆ° Worley Noise çš„å›¾åƒã€‚\nPalettes æœ€åé€šè¿‡æ¸å˜æ’å€¼æ¥ä¸Šä¸€ç‚¹é¢œè‰²8\nvec3 palette( in float t) { vec3 a = vec3(0.5, 0.5, 0.5); vec3 b = vec3(0.5, 0.5, 0.5); vec3 c = vec3(1.0, 1.0, 1.0); vec3 d = vec3(0.0, 0.1, 0.2); return a + b * cos( 6.283185 * ( c * t + d ) ); } vec2 random2( vec2 p ) { // add 0.5 to avoid vec2(0, 0) return (0, 0) return fract(sin(vec2(dot(p + 0.5, vec2(213.1,322.2)),dot(p + 0.5, vec2(513.1,312.2))))*51312.1234); } void mainImage( out vec4 fragColor, in vec2 fragCoord ) { vec2 uv = fragCoord/iResolution.y; uv = uv * 4.0; vec2 gird = floor(uv); vec2 coord = fract(uv) - 0.5; // Gird Color float distanceGrid = smoothstep(0.95, 1.0, 2.0 * max(abs(coord.x), abs(coord.y))); vec3 girdColor = vec3(1.0, 0, 0) * vec3(distanceGrid); // Cell Color float distancePoint = 1.0; for (int i=-1; i\u0026lt;=1; i++) { for (int j=-1; j\u0026lt;=1; j++) { vec2 near = vec2(float(i), float(j)); vec2 point = near + 0.5 * sin(iTime + 6.2831 * random2(gird + near)); float currentDistance = length(coord - point); distancePoint = min(currentDistance, distancePoint); } } vec3 pointColor = vec3(smoothstep(0.95, 1.0, 1.0 - distancePoint)); vec3 distanceColor = vec3(palette(smoothstep(0.2, 2.0, 1.7 - distancePoint))); vec3 col = distanceColor; col += girdColor + pointColor; fragColor = vec4(col,1.0); } wikipedia, Worley noise, https://en.wikipedia.org/wiki/Worley_noise\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nSteven Worley, (1996), A Cellular Texture Basis Function, https://cedric.cnam.fr/~cubaud/PROCEDURAL/worley.pdf\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPor Ryan Brucks, (2016) , Getting the Most Out of Noise in UE4, https://www.unrealengine.com/es-ES/tech-blog/getting-the-most-out-of-noise-in-ue4\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nSuboptimal Engineer, (2023), What is Voronoi Noise? , https://www.youtube.com/watch?v=vcfIJ5Uu6Qw\u0026ab_channel=SuboptimalEngineer\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPatricio Gonzalez Vivo and Jen Lowe, The Book of Shaders, https://thebookofshaders.com/12/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nShadertoy, https://www.shadertoy.com/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\niquilezles, float small and random, https://iquilezles.org/articles/sfrand/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\niquilezles, palettes - 1999, https://iquilezles.org/articles/palettes/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/worley-noise-generator/","summary":"\u003ch2 id=\"worley-noise\"\u003eWorley Noise\u003c/h2\u003e\n\u003cp\u003eWorley Noise\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003eï¼ˆä¹Ÿç§°ä¸º Voronoi noise å’Œ Cellular noiseï¼‰æ˜¯ç”± Steven Worley\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003e åœ¨ 1996 å¹´å¼•å…¥çš„ä¸€ç§å™ªå£°å‡½æ•°ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"worley noise\" loading=\"lazy\" src=\"/zh/posts/worley-noise-generator/worley-noise.png\"\u003e\u003c/p\u003e\n\u003cp\u003eå®ƒçš„æ ·å­çœ‹èµ·æ¥å°±æ˜¯ç”Ÿç‰©ç»†èƒçš„æ ·å­ï¼Œç”±ä¸€ä¸ªä¸ª cell æ„æˆï¼Œä½œè€…æœ¬èº«ä¹Ÿæ˜¯å«å®ƒâ€œCellular Textureâ€ã€‚\u003c/p\u003e","title":"Worley Noise / Voronoi Noise Generator"},{"content":"SDF ä»‹ç» Signed Distance Field (SDF) Signed Distance Fieldï¼ˆæœ‰ç¬¦å·è·ç¦»åœºï¼‰1æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºå½¢çŠ¶çš„æ•°å­¦å‡½æ•°æˆ–æ•°æ®ç»“æ„ã€‚\nå®ƒåœ¨äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­ä¸ºæ¯ä¸ªç‚¹åˆ†é…ä¸€ä¸ªå¸¦ç¬¦å·çš„è·ç¦»å€¼ï¼Œè¡¨ç¤ºè¯¥ç‚¹åˆ°æœ€è¿‘è¡¨é¢ï¼ˆæˆ–è¾¹ç•Œï¼‰çš„è·ç¦»ï¼Œå¹¶ç”¨ç¬¦å·åŒºåˆ†å†…å¤–ï¼š\næ­£å€¼ï¼šç‚¹ä½äºå½¢çŠ¶å¤–éƒ¨ï¼Œæ•°å€¼è¡¨ç¤ºè·ç¦»è¡¨é¢çš„æœ€è¿‘è·ç¦»ã€‚ è´Ÿå€¼ï¼šç‚¹ä½äºå½¢çŠ¶å†…éƒ¨ï¼Œç»å¯¹å€¼è¡¨ç¤ºè·ç¦»è¡¨é¢çš„æœ€è¿‘è·ç¦»ã€‚ é›¶ï¼šç‚¹æ­£å¥½ä½äºå½¢çŠ¶çš„è¡¨é¢ä¸Šã€‚ å½¢å¼åŒ–å®šä¹‰ï¼Œå¯¹äºç©ºé—´ä¸­çš„ç‚¹ $x$ï¼ŒSDF å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n$$ f(x) = \\begin{cases} d(x, \\partial\\Omega), \u0026amp; \\text{if } x \\in \\Omega \\\\ -d(x, \\partial\\Omega), \u0026amp; \\text{if } x \\notin \\Omega \\\\ 0, \u0026amp; \\text{if } x \\in \\partial\\Omega \\end{cases} $$\nå…¶ä¸­çš„$\\Omega$å±äºç‰©ä½“å†…ï¼Œ$\\partial\\Omega$è¡¨ç¤ºè¾¹ç•Œï¼Œ$d(x, \\partial\\Omega)$è¡¨ç¤ºç‚¹$x$åˆ°è¾¹ç•Œçš„æœ€å°è·ç¦»ã€‚\nGitHub ä»“åº“ å¦‚æœä½ æƒ³æŸ¥çœ‹æœ€ç»ˆçš„ç”ŸæˆSDFå›¾ç‰‡çš„ä»£ç ï¼Œå¯ä»¥åœ¨GitHubä»“åº“2è·å–ï¼šcronrpc/Signed-Distance-Field-2D-Generator\nåº”ç”¨ ä¸Šé¢çš„è¯´æ³•å¯èƒ½éå¸¸æŠ½è±¡ï¼Œæˆ‘ä»¬çœ‹ä¸€äº›å…·ä½“çš„åº”ç”¨å®ä¾‹ã€‚\nå­—ä½“æ¸²æŸ“ï¼ˆValve çš„ SDF å­—ä½“æŠ€æœ¯3ï¼‰ï¼ŒUnityçš„TMPå­—ä½“å°±æ˜¯ä½¿ç”¨äº†SDFæŠ€æœ¯ã€‚ å…‰çº¿è¿½è¸ªä¸­çš„è¡¨é¢æ±‚äº¤\né£æ ¼åŒ–é˜´å½±ã€äº‘ç­‰\nå‡¡æ˜¯æŸç§è¿ç»­è¿‡æ¸¡çš„å‚æ•°ï¼Œéƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨SDFæŠ€æœ¯ã€‚\n2D SDF ç”Ÿæˆç®—æ³• å¯¹äºä¸€å¼ ç°åº¦å›¾ï¼Œç™½è‰²éƒ¨åˆ†è¡¨ç¤ºç‰©ä½“ï¼Œé»‘è‰²æ˜¯èƒŒæ™¯ã€‚å¦‚ä½•ç”Ÿæˆå®ƒçš„SDFå›¾å‘¢ï¼Ÿ\næš´åŠ›æ±‚å€¼æ³• ä¸€ä¸ªæœ€ä¸ºç®€å•çš„æ–¹å¼æ˜¯ï¼Œéå†ç®—æ³•ã€‚\né¦–å…ˆæˆ‘ä»¬æ‰¾å‡ºæ‰€æœ‰çš„è¾¹ç•Œé›†åˆã€‚ä¹Ÿå°±æ˜¯å½“å‰åƒç´ æ˜¯ç™½è‰²ï¼Œè€Œå‘¨å›´åƒç´ æœ‰é»‘è‰²çš„ç‚¹ã€‚ éå†æ‰€æœ‰çš„ç‚¹ï¼Œè®¡ç®—è·ç¦»è¾¹ç•Œé›†åˆçš„æœ€è¿‘è·ç¦»ã€‚ æ ¹æ®æœ¬èº«çš„é»‘ç™½ï¼Œæ·»åŠ è·ç¦»çš„æ­£è´Ÿå·ã€‚ å¦‚æœå‡è®¾åƒç´ ç‚¹çš„æ•°ç›®æ˜¯$n$ï¼Œé‚£ä¹ˆå¤æ‚åº¦æ˜¯$O(n^2)$ã€‚\n# generator_sdf.py import sys import math from PIL import Image import numpy as np def generate_sdf(input_path, output_path): # è¯»å–ç°åº¦å›¾ï¼ˆ0-255ï¼‰ img = Image.open(input_path).convert(\u0026#34;L\u0026#34;) w, h = img.size pixels = np.array(img) # Step 1: æ‰¾å‡ºè¾¹ç•Œé›†åˆ boundary_points = [] for y in range(h): for x in range(w): if pixels[y, x] \u0026gt; 127: # ç™½è‰² # æ£€æŸ¥å‘¨å›´åƒç´ æ˜¯å¦æœ‰é»‘è‰² neighbors = [ (nx, ny) for nx in (x - 1, x, x + 1) for ny in (y - 1, y, y + 1) if 0 \u0026lt;= nx \u0026lt; w and 0 \u0026lt;= ny \u0026lt; h and not (nx == x and ny == y) ] for nx, ny in neighbors: if pixels[ny, nx] \u0026lt;= 127: # é»‘è‰² boundary_points.append((x, y)) break # Step 2 \u0026amp; 3: è®¡ç®—SDF sdf = np.zeros((h, w), dtype=np.float32) for y in range(h): for x in range(w): min_dist = float(\u0026#34;inf\u0026#34;) for bx, by in boundary_points: dist = math.sqrt((x - bx) ** 2 + (y - by) ** 2) if dist \u0026lt; min_dist: min_dist = dist # é»‘è‰²å–è´Ÿå€¼ if pixels[y, x] \u0026lt;= 127: min_dist = -min_dist sdf[y, x] = min_dist # å½’ä¸€åŒ–åˆ°0-255 max_dist = np.max(np.abs(sdf)) sdf_normalized = ((sdf / max_dist) + 1) * 127.5 sdf_img = Image.fromarray(np.clip(sdf_normalized, 0, 255).astype(np.uint8)) sdf_img.save(output_path) print(f\u0026#34;SDF saved to {output_path}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: if len(sys.argv) != 3: print(\u0026#34;Example: python generator_sdf.py test.png test_sdf.png\u0026#34;) sys.exit(1) generate_sdf(sys.argv[1], sys.argv[2]) ç”Ÿæˆçš„ç»“æœï¼š\né€šè¿‡åœ¨PSä¸­æ”¹å˜å›¾ç‰‡çš„æ˜¾ç¤ºé˜ˆå€¼ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°åœ†å½¢çš„SDFå˜åŒ–ï¼š\nåŒç†åœ¨æ­£æ–¹å½¢çš„SDFä¸­ï¼Œä¹Ÿå¯ä»¥è§‚å¯Ÿæ•ˆæœã€‚æ­£æ–¹å½¢çš„SDFçš„ç‰¹ç‚¹å°±æ˜¯åœ¨å†…éƒ¨æ—¶ç­‰é«˜çº¿æ˜¯ç›´è§’ï¼Œåœ¨å¤–éƒ¨æ—¶ç­‰é«˜çº¿æ˜¯åœ†å¼§ã€‚\nå…«é‚»åŸŸæ¬§å‡ é‡Œå¾—è¿‘ä¼¼è·ç¦» åº¦é‡ç©ºé—´4ï¼ˆMetric Spaceï¼‰æ˜¯æ•°å­¦ä¸­åˆ»ç”»â€œè·ç¦»â€è¿™ä¸€æ¦‚å¿µçš„æŠ½è±¡æ¡†æ¶ã€‚å®ƒç”±ä¸€ä¸ªé›†åˆ $X$ åŠå…¶ä¸Šçš„è·ç¦»å‡½æ•°\n$$ d : X \\times X \\to \\mathbb{R} $$\næ„æˆï¼Œå¹¶ä¸”è¿™ä¸ªè·ç¦»å‡½æ•°å¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š\néè´Ÿæ€§ï¼šè·ç¦»æ°¸è¿œæ˜¯éè´Ÿæ•°ã€‚\næ’ç­‰æ€§ï¼šè·ç¦»ä¸ºé›¶æ—¶ï¼Œä¸¤ç‚¹å¿…é¡»ç›¸åŒã€‚\nå¯¹ç§°æ€§ï¼šä» $x$ åˆ° $y$ çš„è·ç¦»ç­‰äºä» $y$ åˆ° $x$ çš„è·ç¦»ã€‚\nä¸‰è§’ä¸ç­‰å¼ï¼šç›´æ¥åˆ°è¾¾ä¸åº”æ¯”ç»•è·¯æ›´è¿œã€‚\n$$ d(x, z) \\le d(x, y) + d(y, z) $$\nä¾‹å¦‚ï¼Œåœ¨è¿ç»­çš„äºŒç»´å¹³é¢ä¸­ï¼Œæ¬§å‡ é‡Œå¾—è·ç¦»ï¼š\n$$ d(P, Q) = \\sqrt{(x_P - x_Q)^2 + (y_P - y_Q)^2} $$\næ˜¯ä¸€ä¸ªå…¸å‹çš„åº¦é‡å‡½æ•°ã€‚\nä¸‹å›¾çš„è“è‰²çº¿æ¡ã€çº¢è‰²çº¿æ¡ã€é»„è‰²çº¿æ¡éƒ½æ˜¯è¡¨ç¤ºåŒæ ·çš„é•¿åº¦ï¼Œè€Œç»¿è‰²æ˜¯æ¯”å®ƒä»¬éƒ½çŸ­çš„æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚\nç„¶è€Œåœ¨æ•°å­—å›¾åƒå¤„ç†æˆ–æ …æ ¼åœ°å›¾ä¸­ï¼Œæˆ‘ä»¬çš„ç‚¹æ˜¯ç¦»æ•£çš„åƒç´ æ ¼ï¼Œè·ç¦»è®¡ç®—å¯ä»¥ç›´æ¥ç”¨æ¬§å‡ é‡Œå¾—å…¬å¼ï¼Œä½†è¿™æ ·éœ€è¦å¤§é‡å¹³æ–¹æ ¹è¿ç®—ï¼Œä»£ä»·è¾ƒé«˜ã€‚ ä¸ºæé«˜æ•ˆç‡ï¼Œå¸¸é‡‡ç”¨ å…«é‚»åŸŸæ¬§å‡ é‡Œå¾—è¿‘ä¼¼è·ç¦»ï¼ˆ8-neighborhood Euclidean approximationï¼‰ï¼š\nå…«é‚»åŸŸï¼šæŒ‡æ¯ä¸ªåƒç´ ä¸å…¶æ°´å¹³æ–¹å‘ã€å‚ç›´æ–¹å‘å’Œå¯¹è§’çº¿æ–¹å‘ä¸Šæœ€è¿‘çš„ 8 ä¸ªåƒç´ ç›¸é‚»ã€‚ åœ¨è¿™ç§é‚»æ¥å…³ç³»ä¸‹ï¼Œå¯ä»¥ç”¨ä¸‹å¼è¿‘ä¼¼æ¬§å‡ é‡Œå¾—è·ç¦»ï¼š $$ d_{8}(p, q) \\approx \\max(\\Delta x, \\Delta y) + (\\sqrt{2} - 1) \\cdot \\min(\\Delta x, \\Delta y) $$\nå…¶ä¸­ $\\Delta x = |x_p - x_q|$ï¼Œ$\\Delta y = |y_p - y_q|$ã€‚\nä¾‹å¦‚ä¸‹å›¾ä¸­çš„çº¢è‰²å°±æ˜¯è¡¨ç¤ºå…«é‚»åŸŸæ¬§å‡ é‡Œå¾—è¿‘ä¼¼è·ç¦»ï¼Œè€Œè“è‰²ç›´çº¿å°±æ˜¯æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚\nè¿™ç§æ–¹æ³•é¿å…äº†å¤§é‡å¼€æ–¹è®¡ç®—ï¼ŒåŒæ—¶åœ¨ 8 é‚»åŸŸèŒƒå›´å†…ä¸çœŸå®æ¬§å‡ é‡Œå¾—è·ç¦»çš„è¯¯å·®å¾ˆå°ï¼Œå› æ­¤å¸¸ç”¨äºè·¯å¾„æœç´¢ï¼ˆA*ã€Dijkstraï¼‰ã€è·ç¦»å˜æ¢ã€å›¾åƒå½¢æ€å­¦ç­‰åœºæ™¯ã€‚\n8SSEDT å¯¹è¿™ä¸ªç®—æ³•çš„ä»‹ç»å‚è€ƒè‡ªLisapple 8SSEDT5ã€‚\nåœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†å…«é‚»åŸŸæ¬§å‡ é‡Œå¾—è¿‘ä¼¼è·ç¦»ã€‚å®é™…ä¸Šï¼Œå¯¹äºå›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå…¶è·ç¦»å€¼å¯ä»¥ç”¨å¦‚ä¸‹é€’æ¨å…³ç³»è¡¨ç¤ºï¼š\n$$ f(x, y) = \\min_{\\substack{dx, dy \\in {-1,0,1} \\ (dx, dy) \\neq (0,0)}} \\Big( f(x+dx, y+dy) + d(dx, dy) \\Big) $$\nå…¶ä¸­ï¼Œ$d(dx, dy)$ è¡¨ç¤ºä»é‚»å±…èŠ‚ç‚¹ $(x+dx, y+dy)$ ç§»åŠ¨åˆ°èŠ‚ç‚¹ $(x, y)$ çš„ä»£ä»·ï¼Œé€šå¸¸å–ï¼š\n$$ d(dx, dy) = \\begin{cases} 1, \u0026amp; \\text{è‹¥ } |dx| + |dy| = 1 \\quad (\\text{æ°´å¹³æˆ–å‚ç›´é‚»å±…})\\\\ \\sqrt{2}, \u0026amp; \\text{è‹¥ } |dx| + |dy| = 2 \\quad (\\text{å¯¹è§’é‚»å±…}) \\end{cases} $$\nè¿™é‡Œï¼Œ$dx$ å’Œ $dy$ å¯ä»¥åˆ†åˆ«å– $-1, 0, 1$ï¼Œä½†ä¸èƒ½åŒæ—¶ä¸ºé›¶ï¼Œè¿™æ ·æ‰æ˜¯é‚»å±…èŠ‚ç‚¹ã€‚\nå¦‚æœç»™é‚»å±…èŠ‚ç‚¹è¿›è¡Œæ ‡å·ï¼š\n[#1][#2][#3] [#4][ x][#5] [#6][#7][#8] å¯¹äºä»»æ„ä¸¤ä¸ªç‚¹$x$å’Œ$y$ä¹‹é—´çš„è·ç¦»è·¯å¾„ï¼Œåªå¯èƒ½ç”±ä¸‹é¢4ä¸ªç»„åˆä¸­çš„1ç§æ„æˆï¼Œä¹Ÿå°±æ˜¯è¯´å¿…ç„¶æ˜¯å…¶ä¸­ä¹‹ä¸€çš„çº¿æ€§å åŠ ï¼š\n1,2,4 2,3,5 4,6,7 5,7,8 æ‰€ä»¥ä»å·¦ä¸Šè§’é€’æ¨åˆ°å³ä¸‹è§’ï¼Œå°±å¯ä»¥è¦†ç›–ç¬¬1ç§$1,2,4$çš„å¯èƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤š$4$æ¬¡éå†æ•´ä¸ªå›¾ï¼Œå°±èƒ½ç¡®å®šæ‰€æœ‰ç‚¹çš„å€¼ã€‚\nå½“ç„¶ï¼Œè¿™é‡Œè¿›è¡Œäº†ä¸€ç‚¹ä¼˜åŒ–ï¼Œå‚è€ƒSigned Distance Fields6çš„å®ç°ï¼Œä»–é€‰æ‹©äº†ä¸‹åˆ—$4$ä¸ªéå†è·¯å¾„ï¼š\n- - - \u0026gt; | [?][?][?] | [?][x][ ] v [ ][ ][ ] \u0026lt; - - - | [ ][ ][ ] | [ ][x][?] v [ ][ ][ ] \u0026lt; - - - ^ [ ][ ][ ] | [ ][x][?] | [?][?][?] - - - \u0026gt; ^ [ ][ ][ ] | [?][x][ ] | [ ][ ][ ] è¿™é‡Œç›´æ¥ç»™å‡ºPythonçš„å®ç°ï¼š\nå‡†ç¡®æ¥è¯´ä¸‹åˆ—ä»£ç çš„è·ç¦»å®šä¹‰æ˜¯æ¬§å‡ é‡Œå¾—è·ç¦»ï¼Œå¹¶ä¸æ˜¯å…«é‚»åŸŸæ¬§å‡ é‡Œå¾—è¿‘ä¼¼è·ç¦»ã€‚ åªæ˜¯å€Ÿé‰´äº†ç§»åŠ¨æ–¹å‘ä¸º8ä¸ªæ–¹å‘ import sys import os import numpy as np from PIL import Image INF = 9999 def dist_sq(dx, dy): return dx*dx + dy*dy def compare(grid, p, x, y, ox, oy, width, height): nx = x + ox ny = y + oy if 0 \u0026lt;= nx \u0026lt; width and 0 \u0026lt;= ny \u0026lt; height: other_dx, other_dy = grid[ny, nx] else: other_dx, other_dy = INF, INF other_dx += ox other_dy += oy if dist_sq(other_dx, other_dy) \u0026lt; dist_sq(*p): p = (other_dx, other_dy) return p def generate_sdf(grid): height, width, _ = grid.shape # Pass 0 for y in range(height): for x in range(width): p = tuple(grid[y, x]) p = compare(grid, p, x, y, -1, 0, width, height) p = compare(grid, p, x, y, 0, -1, width, height) p = compare(grid, p, x, y, -1, -1, width, height) p = compare(grid, p, x, y, 1, -1, width, height) grid[y, x] = p for x in range(width-1, -1, -1): p = tuple(grid[y, x]) p = compare(grid, p, x, y, 1, 0, width, height) grid[y, x] = p # Pass 1 for y in range(height-1, -1, -1): for x in range(width-1, -1, -1): p = tuple(grid[y, x]) p = compare(grid, p, x, y, 1, 0, width, height) p = compare(grid, p, x, y, 0, 1, width, height) p = compare(grid, p, x, y, -1, 1, width, height) p = compare(grid, p, x, y, 1, 1, width, height) grid[y, x] = p for x in range(width): p = tuple(grid[y, x]) p = compare(grid, p, x, y, -1, 0, width, height) grid[y, x] = p def load_image_binary(path, threshold=128): im = Image.open(path).convert(\u0026#39;L\u0026#39;) arr = np.array(im, dtype=np.uint8) inside = arr \u0026lt; threshold return inside, im def save_signed_sdf_image(signed, out_path): # å½’ä¸€åŒ–åˆ°0-255ï¼Œ128ä¸ºè¾¹ç•Œ max_dist = np.max(np.abs(signed)) if max_dist == 0: # é˜²æ­¢é™¤ä»¥0 sdf_normalized = np.full_like(signed, 128.0) else: sdf_normalized = ((signed / max_dist) + 1.0) * 128.0 sdf_normalized = np.clip(sdf_normalized, 0, 255).astype(np.uint8) out = Image.fromarray(sdf_normalized, mode=\u0026#39;L\u0026#39;) out.save(out_path) def main(): if len(sys.argv) \u0026lt; 2: print(\u0026#34;Usage: python 8ssedt.py input.png\u0026#34;) sys.exit(1) in_path = sys.argv[1] if not os.path.exists(in_path): print(\u0026#34;File not found:\u0026#34;, in_path) sys.exit(1) inside, im = load_image_binary(in_path) h, w = inside.shape empty = (INF, INF) zero = (0, 0) # two grids: inside distances and outside distances grid1 = np.zeros((h, w, 2), dtype=int) grid2 = np.zeros((h, w, 2), dtype=int) for y in range(h): for x in range(w): if inside[y, x]: grid1[y, x] = zero grid2[y, x] = empty else: grid1[y, x] = empty grid2[y, x] = zero generate_sdf(grid1) generate_sdf(grid2) dist1 = np.sqrt(grid1[:, :, 0]**2 + grid1[:, :, 1]**2) dist2 = np.sqrt(grid2[:, :, 0]**2 + grid2[:, :, 1]**2) signed = dist1 - dist2 base, ext = os.path.splitext(in_path) out_path = base + \u0026#34;_8ssedt.png\u0026#34; save_signed_sdf_image(signed, out_path) print(\u0026#34;Saved:\u0026#34;, out_path) if __name__ == \u0026#34;__main__\u0026#34;: main() æˆ‘ä»¬ç”¨å®ƒå®éªŒçš„è¿™å¼ åŸå›¾æ¥çœ‹çœ‹æ•ˆæœï¼š\nåœ¨è¿è¡Œæˆ‘ä»¬çš„è„šæœ¬åï¼Œå¾—åˆ°ï¼š\næ”¾å…¥PSä¸­ï¼ŒæŸ¥çœ‹ä¸åŒé˜ˆå€¼ä¸‹çš„æ•ˆæœï¼š\nCorrect 8SSEDT å‚è€ƒ7ï¼Œä»–è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¯¹äº2å€¼çš„é»‘ç™½å›¾æ¥è¯´ï¼Œé‚»è¿‘è¾¹ç•Œçš„ç‚¹ï¼Œè·ç¦»è¾¹ç•Œçš„è·ç¦»å®è´¨ä¸Šåº”è¯¥åªæœ‰åŠä¸ªåƒç´ ã€‚\nè€ƒè™‘åˆ°è¿™åŠä¸ªåƒç´ çš„å·®åˆ«ï¼Œä¼šå¯¼è‡´åœ¨æ¥è¿‘è¾¹ç•Œçš„åœ°æ–¹æœ‰ä¸€äº›è¯¯å·®ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯æ—è¾¹çš„ç‚¹æ˜¯è¾¹ç•Œçš„æ—¶å€™ï¼Œè·ç¦»å°±åªåŠ ä¸€åŠçš„å¤§å°ã€‚\nimport sys import os import math import numpy as np from PIL import Image FIX = True INF = 9999 def dist_sq(dx, dy): return dx*dx + dy*dy def compare(grid, p, x, y, ox, oy, width, height): nx = x + ox ny = y + oy if 0 \u0026lt;= nx \u0026lt; width and 0 \u0026lt;= ny \u0026lt; height: other_dx, other_dy = grid[ny, nx] else: other_dx, other_dy = INF, INF if FIX: if other_dx != 0 or other_dy != 0: # å¯¹åº” other.DistSq()!=0 ox *= 2 oy *= 2 other_dx += ox other_dy += oy if dist_sq(other_dx, other_dy) \u0026lt; dist_sq(*p): p = (other_dx, other_dy) return p def generate_sdf(grid): height, width, _ = grid.shape # Pass 0 for y in range(height): for x in range(width): p = tuple(grid[y, x]) p = compare(grid, p, x, y, -1, 0, width, height) p = compare(grid, p, x, y, 0, -1, width, height) p = compare(grid, p, x, y, -1, -1, width, height) p = compare(grid, p, x, y, 1, -1, width, height) grid[y, x] = p for x in range(width-1, -1, -1): p = tuple(grid[y, x]) p = compare(grid, p, x, y, 1, 0, width, height) grid[y, x] = p # Pass 1 for y in range(height-1, -1, -1): for x in range(width-1, -1, -1): p = tuple(grid[y, x]) p = compare(grid, p, x, y, 1, 0, width, height) p = compare(grid, p, x, y, 0, 1, width, height) p = compare(grid, p, x, y, -1, 1, width, height) p = compare(grid, p, x, y, 1, 1, width, height) grid[y, x] = p for x in range(width): p = tuple(grid[y, x]) p = compare(grid, p, x, y, -1, 0, width, height) grid[y, x] = p def load_image_binary(path, threshold=128): im = Image.open(path).convert(\u0026#39;L\u0026#39;) arr = np.array(im, dtype=np.uint8) inside = arr \u0026lt; threshold return inside, im def save_signed_sdf_image(signed, out_path): # å½’ä¸€åŒ–åˆ°0-255ï¼Œ128ä¸ºè¾¹ç•Œ max_dist = np.max(np.abs(signed)) if max_dist == 0: # é˜²æ­¢é™¤ä»¥0 sdf_normalized = np.full_like(signed, 128.0) else: sdf_normalized = ((signed / max_dist) + 1.0) * 128.0 sdf_normalized = np.clip(sdf_normalized, 0, 255).astype(np.uint8) out = Image.fromarray(sdf_normalized, mode=\u0026#39;L\u0026#39;) out.save(out_path) def main(): if len(sys.argv) \u0026lt; 2: print(\u0026#34;Usage: python 8ssedt.py input.png\u0026#34;) sys.exit(1) in_path = sys.argv[1] if not os.path.exists(in_path): print(\u0026#34;File not found:\u0026#34;, in_path) sys.exit(1) inside, im = load_image_binary(in_path) h, w = inside.shape empty = (INF, INF) zero = (0, 0) # two grids: inside distances and outside distances grid1 = np.zeros((h, w, 2), dtype=int) grid2 = np.zeros((h, w, 2), dtype=int) for y in range(h): for x in range(w): if inside[y, x]: grid1[y, x] = zero grid2[y, x] = empty else: grid1[y, x] = empty grid2[y, x] = zero generate_sdf(grid1) generate_sdf(grid2) dist1 = np.sqrt(grid1[:, :, 0]**2 + grid1[:, :, 1]**2) dist2 = np.sqrt(grid2[:, :, 0]**2 + grid2[:, :, 1]**2) if FIX: signed = 0.5 * (dist1 - dist2) else: signed = dist1 - dist2 base, ext = os.path.splitext(in_path) out_path = base + \u0026#34;_8ssedt_correct.png\u0026#34; save_signed_sdf_image(signed, out_path) print(\u0026#34;Saved:\u0026#34;, out_path) if __name__ == \u0026#34;__main__\u0026#34;: main() ä»æ•ˆæœä¸Šçœ‹ï¼Œå‡ ä¹æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼š\nä½†æ˜¯ä»é˜ˆå€¼è§’åº¦æ¥çœ‹ï¼Œä¼šç¨å¾®å¹³æ»‘ä¸€äº›ï¼Œè§‚å¯Ÿæ¥è¿‘åœ°æ–¹çš„å€¼å°±çŸ¥é“äº†ã€‚\nä¿®æ­£åçš„ç»“æœï¼š\nåŸæ¥çš„ç»“æœï¼š\nä¸ºä»€ä¹ˆè¿˜æ˜¯ç”¨æ¬§å‡ é‡Œå¾—è·ç¦»ï¼Ÿ ç”¨å…¬å¼ï¼š\n$$ d_8(p,q) = \\max(\\Delta x,\\Delta y) + (\\sqrt{2} - 1) \\cdot \\min(\\Delta x,\\Delta y) $$\nå¦‚æœå–ä¸¤ä¸ªç‚¹ï¼š$(1,4)$ å’Œ $(3,3)$\nè®¡ç®— $d_8$\n$d_8(1,4) = 4 + (\\sqrt{2} - 1) \\cdot 1 \\approx 4 + 0.4142 = 4.4142$\n$d_8(3,3) = 3 + (\\sqrt{2} - 1) \\cdot 3 \\approx 3 + 1.2426 = 4.2426$\nâ‡’ $d_8(1,4) \u0026gt; d_8(3,3)$\nè®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦»\n$d_E(1,4) = \\sqrt{1^2 + 4^2} = \\sqrt{17} \\approx 4.1231$\n$d_E(3,3) = \\sqrt{3^2 + 3^2} = \\sqrt{18} \\approx 4.2426$\nâ‡’ $d_E(1,4) \u0026lt; d_E(3,3)$\nè¿™ä¸ªåä¾‹è¯´æ˜ï¼š$d_8$ çš„æ’åºä¸ä¸€å®šå’Œæ¬§å‡ é‡Œå¾—è·ç¦»çš„æ’åºä¸€è‡´ï¼Œå› æ­¤è¿™é‡Œåªæ˜¯å€Ÿé‰´äº†å…«é‚»åŸŸçš„ä½ç§»ï¼Œä½†æ˜¯ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»è¿˜æ˜¯æŒ‰ç…§æ¬§å‡ é‡Œå¾—è·ç¦»æ¥è®¡ç®—ã€‚\nscipy.ndimage åº“ å‰é¢ç”¨åˆ°çš„ç®—æ³•ç”¨Pythonå†™çš„è¿˜æ˜¯å¤ªæ…¢äº†ï¼Œå°¤å…¶æ˜¯å¾ªç¯åµŒå¥—ï¼Œåœ¨2048x2048å¼€å§‹é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚\nscipyçš„å›¾åƒå¤„ç†åº•å±‚é‡‡ç”¨C++æ¥ç¼–å†™ï¼Œé€Ÿåº¦ä¼šå¿«éå¸¸å¤šã€‚\nä¸‹é¢ä»£ç çš„scaleé‡‡ç”¨8ï¼ˆåé¢ä¼šè¯´ä¸ºä»€ä¹ˆä¸è¦ä½¿ç”¨normalizeï¼Œè€Œæ˜¯ç”¨å›ºå®šæ¯”ä¾‹çš„ç¼©æ”¾ï¼‰ï¼ŒåŒæ—¶è¾“å‡ºé‡‡ç”¨16bitï¼ˆè€Œä¸æ˜¯8bitï¼‰çš„ç°åº¦å›¾ã€‚\nimport sys import os import numpy as np from PIL import Image from scipy import ndimage scale = 8 def load_image_binary(path, threshold=128): im = Image.open(path).convert(\u0026#39;L\u0026#39;) arr = np.array(im, dtype=np.uint8) inside = arr \u0026lt; threshold return inside def save_sdf_16bit(signed, out_path): # ç›´æ¥è½¬ uint16 ä¿å­˜ï¼Œä¸åšå½’ä¸€åŒ– signed = signed * scale + 32767.5 signed_uint16 = np.clip(signed, 0, 65535).astype(np.uint16) out = Image.fromarray(signed_uint16, mode=\u0026#39;I;16\u0026#39;) out.save(out_path) def fast_signed_sdf(mask): dist_inside = ndimage.distance_transform_edt(mask) dist_outside = ndimage.distance_transform_edt(~mask) return dist_outside - dist_inside # inside æ­£ï¼Œoutside è´Ÿ def main(): if len(sys.argv) \u0026lt; 2: print(\u0026#34;Usage: python fast_sdf.py input1.png [input2.png ...]\u0026#34;) sys.exit(1) for in_path in sys.argv[1:]: if not os.path.exists(in_path): print(\u0026#34;File not found:\u0026#34;, in_path) continue inside = load_image_binary(in_path) signed = fast_signed_sdf(inside) base, _ = os.path.splitext(in_path) out_path = base + \u0026#34;_sdf16.png\u0026#34; save_sdf_16bit(signed, out_path) print(f\u0026#34;Saved SDF to {out_path}\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: main() 16bit å’Œ scale å‰é¢ä½¿ç”¨äº†å½’ä¸€åŒ–è·ç¦»çš„æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœå¸Œæœ›åˆæˆå¤šå¼ å›¾ç‰‡ï¼Œéœ€è¦å°†è·ç¦»çš„å•ä½ç»Ÿä¸€ï¼ˆå› ä¸ºéœ€è¦åœ¨ä¸¤å¼ å›¾ç‰‡ä¹‹é—´è¿›è¡Œæ’å€¼ï¼‰ã€‚\nç¬¬äºŒï¼Œå¦‚æœå›¾ç‰‡å°ºå¯¸éå¸¸å¤§ï¼ˆ2048ï¼‰ï¼Œé‚£ä¹ˆ8bitåªæœ‰256å¤§å°ï¼Œå°±ä¸å¤Ÿè¡¨ç¤ºæ‰€æœ‰è·ç¦»äº†ï¼Œä¸ºäº†é¿å…è·ç¦»æˆªæ–­å¯¼è‡´æ•ˆæœä¸å¥½ï¼Œé‡‡ç”¨16bitçš„pngæ¥å­˜å‚¨è·ç¦»ã€‚\n2048x2048å¤§å°çš„å›¾ç‰‡ï¼Œä¸¤ç‚¹é—´çš„æœ€å¤§è·ç¦»æ˜¯$2048*1.414=2,896$ï¼ŒåŒæ—¶16bitå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§èŒƒå›´æ˜¯+-32767ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©$scale=8$æˆ–è€…$10$æ¥è¡¨ç¤ºã€‚\nscale = 10 # ç¼©æ”¾åˆ° 0â€“65535ï¼Œ32767.5 ä¸ºè¾¹ç•Œ unsigned = signed * scale + 32767.5 unsigned = np.clip(unsigned, 0, 65535).astype(np.uint16) åˆæˆç®—æ³• æ€ä¹ˆåˆæˆå›¾ç‰‡ï¼Œå–å†³äºæˆ‘ä»¬åˆ°åº•æƒ³å®ç°ä»€ä¹ˆæ ·çš„æ•ˆæœã€‚\næ¯”å¦‚å¦‚æœæ˜¯æƒ³å®ç°ä¸€ä¸ª subtraction çš„æ•ˆæœï¼Œæ˜¯ä¸æ˜¯ç›´æ¥æŠŠè·ç¦»åšå‡æ³•å°±å¯ä»¥äº†å‘¢ï¼Ÿ\nè¿™ç§åšæ³•ç¡®å®å¯ä»¥å®ç°åœ¨ä¸­ç‚¹å¤„è¡¨ç°ä¸ºå‡æ³•ï¼Œä½†æ˜¯æœ€å·¦ä¾§å’Œå·¦å³ä¾§çš„å«ä¹‰å®é™…ä¸Šæ˜¯ä¸æ˜ç¡®çš„ã€‚\n# å¸ƒå°”è¿ç®— def sdf_union(d1, d2): return np.minimum(d1, d2) # å¹¶é›† def sdf_intersection(d1, d2): return np.maximum(d1, d2) # äº¤é›† def sdf_subtraction(d1, d2): return np.maximum(d1, -d2) # A å‡ B ç±»ä¼¼ä¸Šé¢ä»£ç çš„åˆå¹¶çš„å®é™…å«ä¹‰æ˜¯ï¼šå½“å¤„åœ¨é˜ˆå€¼ä¸­ç‚¹çš„æ—¶å€™ï¼Œè¡¨ç°ä¸ºå¹¶ã€äº¤æˆ–è€…å‡æ³•ã€‚\næ’å€¼æ€è·¯ åœ¨æ¸¸æˆä¸­ï¼Œå®è´¨ä¸Šè¿½æ±‚çš„æ˜¯è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œå‡å¦‚æœ‰ä¸¤å¼ å›¾ç‰‡aå’Œbï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é˜ˆå€¼æœ€å¤§çš„æ—¶å€™å›¾ç‰‡å°±æ˜¯açš„å›¾æ¡ˆï¼Œé˜ˆå€¼æœ€å°çš„æ—¶å€™å›¾ç‰‡å°±æ˜¯bçš„å›¾æ¡ˆã€‚\nå¦‚æœæ˜¯ä¸‰å¼ å›¾ç‰‡ï¼Œé‚£å°±æ˜¯æœ€å¤§å€¼æ˜¯açš„å›¾æ¡ˆï¼Œä¸­é—´æ—¶å°±æ˜¯bçš„å›¾æ¡ˆï¼Œæœ€å°å€¼æ—¶å°±æ˜¯cçš„å›¾æ¡ˆï¼Œä»¥æ­¤ç±»æ¨ã€‚\nè¿™é‡Œè¿˜éœ€è¦é™åˆ¶ä¸€ä¸ªæ¡ä»¶ï¼Œé‚£å°±æ˜¯å®ƒä»¬å¿…é¡»æ˜¯å®Œå…¨åŒ…å«çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯$c \\supset b \\supset a$ï¼Œåªæœ‰è¿™æ ·æ‰å¯èƒ½å®ç°è¿™ä¸ªè¿‡ç¨‹ã€‚\nå¯¹äºå›¾ç‰‡aå’Œbï¼Œç”±äºåŒ…å«å…³ç³»ï¼Œç‰©ä½“aä¸Šçš„ä»»æ„ä¸€ä¸ªåƒç´ ï¼Œåœ¨aå’Œbä¸­çš„è·ç¦»å€¼éƒ½åº”è¯¥æ˜¯æ­£æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨ç‰©ä½“å†…éƒ¨ã€‚\nå¯¹äº$b-a$ä¸Šçš„ä¸€ä¸ªç‚¹$x$ï¼Œåœ¨aä¸­ä¸€å®šæ˜¯è´Ÿæ•°$x_a$ï¼ˆå¤–ä¾§ï¼‰ï¼Œåœ¨bä¸­æ˜¯æ­£æ•°$x_b$ã€‚æ‰€ä»¥$x$è¿™ä¸ªç‚¹åœ¨æœ€ç»ˆå›¾åƒä¸Šçš„å€¼$x_{final}$ï¼Œå®é™…ä¸Šå°±åº”è¯¥æ˜¯$x$ä»$x_b$æ’å€¼åˆ°$x_a$è¿‡ç¨‹ä¸­ï¼Œ$x=0$æ—¶åˆ»å¯¹åº”çš„é˜ˆå€¼çš„å¤§å°ã€‚\næ¯”å¦‚ï¼Œå¦‚æœ$x$åœ¨${sdf}_a$çš„å€¼æ˜¯$-3$ï¼Œåœ¨${sdf}_b$çš„å€¼æ˜¯$3$ã€‚\né‚£ä¹ˆ${x}_{final}$çš„å¤§å°åœ¨8bitç°åº¦å›¾ä¸‹å°±åº”è¯¥æ˜¯128ï¼Œè¿™æ ·åˆšå¥½åœ¨é˜ˆå€¼128ä»¥ä¸‹éƒ½èƒ½ç‚¹äº®è¿™ä¸ªåƒç´ ã€‚\næ‰€ä»¥ï¼Œæ ¸å¿ƒçš„æ€è·¯å°±æ˜¯æ‰¾å¯¹åº”çš„0ç‚¹ã€‚\nè’™ç‰¹å¡æ´›æ’å€¼æ³• è¿™é‡Œå‚è€ƒäº†è¿™ç¯‡æ–‡ç« 8çš„ç®—æ³•ï¼Œé€šè¿‡é‡‡æ ·æ–¹å¼æ¥å¯»æ‰¾0ç‚¹ã€‚\næ³¨æ„ï¼Œåœ¨Pythonä¸‹è¿™ç§åµŒå¥—å¾ªç¯è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ï¼Œè¶…è¿‡2048å°ºå¯¸çš„å›¾ç‰‡ä¸é€‚åˆç”¨çº¯Pythonæ¥å†™ã€‚\nimport sys import numpy as np from PIL import Image if len(sys.argv) != 3: print(\u0026#34;ç”¨æ³•: python compose2.py a.png b.png\u0026#34;) sys.exit(1) # è¯»å– 16bit ç°åº¦å›¾ def load_16bit_gray(path): img = Image.open(path) arr = np.array(img, dtype=np.uint16) return arr sdf1 = load_16bit_gray(sys.argv[1]) sdf2 = load_16bit_gray(sys.argv[2]) # æ£€æŸ¥å°ºå¯¸ä¸€è‡´ if sdf1.shape != sdf2.shape: raise ValueError(\u0026#34;ä¸¤å¼ è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸å¿…é¡»ç›¸åŒ\u0026#34;) height, width = sdf1.shape output = np.zeros((height, width), dtype=np.uint16) THRESHOLD = 32768 # 16bit å¯¹åº” 0.5 ç°åº¦ MAX_VAL = 65535 STEPS = 16 for y in range(height): for x in range(width): t1 = sdf1[y, x] t2 = sdf2[y, x] if t1 \u0026lt; THRESHOLD and t2 \u0026lt; THRESHOLD: result = 0 elif t1 \u0026gt; THRESHOLD and t2 \u0026gt; THRESHOLD: result = MAX_VAL else: # ä¸¤å¼ å›¾ç‰‡ä¹‹é—´æ’å€¼ result = 0 for i in range(STEPS): weight = i / STEPS interp = (1 - weight) * t1 + weight * t2 result += 0 if interp \u0026lt; THRESHOLD else MAX_VAL result //= STEPS output[y, x] = np.clip(result, 0, MAX_VAL) # ä¿å­˜ 16bit PNG out_img = Image.fromarray(output, mode=\u0026#39;I;16\u0026#39;) out_img.save(\u0026#34;output.png\u0026#34;) print(\u0026#34;åˆæˆå®Œæˆ: output.png\u0026#34;) æœ€ç»ˆçš„ç®—æ³• æ’å€¼è¿™ä¸ªè¿‡ç¨‹å®Œå…¨å¯ä»¥å¹¶è¡Œå¤„ç†ï¼Œé¦–å…ˆæ¯ä¸ªåƒç´ ä¹‹é—´å°±æ¯«æ— å…³è”ï¼Œå…¶æ¬¡æ¯ä¸ªå›¾ç‰‡ä¹‹é—´è¿›è¡Œæ’å€¼å…¶å®ä¹Ÿæ²¡æœ‰å…³è”ã€‚\nä½¿ç”¨numpyæ¥è¿›è¡Œå¹¶è¡ŒåŒ–å¤„ç†ï¼Œnumpyåº•å±‚æ˜¯c++æ¨¡å—ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚\nè¿™é‡Œé‡‡æ ·ç‚¹ä¸º256ä¸ªå¯¹åº”ç°åº¦å›¾èŒƒå›´ï¼Œä¿å­˜ä¸º8bitçš„ç°åº¦å›¾ï¼ˆè¿™é‡Œæ²¡å¿…è¦16bitï¼‰ã€‚\nimport sys import numpy as np from PIL import Image U8 = True if len(sys.argv) \u0026lt; 3: print(\u0026#34;ç”¨æ³•: python compose.py img1.png img2.png [img3.png ...]\u0026#34;) sys.exit(1) def load_16bit_gray(path): img = Image.open(path) arr = np.array(img, dtype=np.uint16) return arr # è¯»å–æ‰€æœ‰å›¾ images = [load_16bit_gray(path) for path in sys.argv[1:]] arr = np.stack(images, axis=0) # shape: (N, H, W) if not np.all([img.shape == arr[0].shape for img in images]): raise ValueError(\u0026#34;æ‰€æœ‰è¾“å…¥å›¾ç‰‡çš„å°ºå¯¸å¿…é¡»ç›¸åŒ\u0026#34;) THRESHOLD = 32768 MAX_VAL = 65535 N, H, W = arr.shape # å…¨å±€ mask all_below = np.all(arr \u0026lt; THRESHOLD, axis=0) all_above = np.all(arr \u0026gt; THRESHOLD, axis=0) output = np.zeros((H, W), dtype=np.float64) output[all_below] = 0 output[all_above] = MAX_VAL # æ··åˆéƒ¨åˆ† mask mix_mask = ~(all_below | all_above) # å–æ··åˆéƒ¨åˆ†åƒç´  mix_pixels = arr[:, mix_mask].astype(np.float64) # shape: (N, M) M = æ··åˆåƒç´ ä¸ªæ•° M = mix_pixels.shape[1] # 256 ä¸ªé‡‡æ ·æƒé‡ samples = 256 weights = np.linspace(0, 1, samples, endpoint=False) # æ¯ä¸ªé‡‡æ ·ç‚¹å±äºå“ªä¸¤ä¸ªå›¾ä¹‹é—´ intervals = np.floor(weights * (N - 1)).astype(int) # shape: (samples,) local_w = (weights * (N - 1)) - intervals # shape: (samples,) # æ’å€¼æ‰¹é‡è®¡ç®— interp_results = np.zeros((samples, M), dtype=np.float64) for k in range(samples): i1 = intervals[k] i2 = i1 + 1 val = (1 - local_w[k]) * mix_pixels[i1] + local_w[k] * mix_pixels[i2] interp_results[k] = (val \u0026gt;= THRESHOLD) * MAX_VAL # å¹³å‡ res = np.mean(interp_results, axis=0) # å›å†™ç»“æœ output[mix_mask] = res if U8: # è½¬ä¸ºæµ®ç‚¹æ•°ï¼Œæ˜ å°„åˆ° 0~255 output_float = output.astype(np.float32) output_scaled = output_float / 65535.0 * 255.0 output_uint8 = np.clip(np.floor(output_scaled + 0.5), 0, 255).astype(np.uint8) # ä¿å­˜ 8 ä½ç°åº¦å›¾ out_img = Image.fromarray(output_uint8, mode=\u0026#39;L\u0026#39;) out_img.save(\u0026#34;output8.png\u0026#34;) print(f\u0026#34;åˆæˆå®Œæˆ: output8.pngï¼Œåˆå¹¶äº† {N} å¼ å›¾ç‰‡\u0026#34;) else: output = np.clip(output, 0, MAX_VAL).astype(np.uint16) out_img = Image.fromarray(output, mode=\u0026#39;I;16\u0026#39;) out_img.save(\u0026#34;output16.png\u0026#34;) print(f\u0026#34;åˆæˆå®Œæˆ: output16.pngï¼Œåˆå¹¶äº† {N} å¼ å›¾ç‰‡\u0026#34;) æ•ˆæœï¼š\nåŸå§‹å›¾ç‰‡ï¼š\nç”Ÿæˆçš„sdfå¦‚å›¾ï¼Œè¿™é‡Œå› ä¸ºscaleçš„å…³ç³»ï¼Œçœ‹èµ·æ¥éƒ½æ¯”è¾ƒæ¥è¿‘ç°è‰²ã€‚\nåˆæˆsdfï¼š\nwikipedia, Signed distance function, https://en.wikipedia.org/wiki/Signed_distance_function\u0026#160;\u0026#x21a9;\u0026#xfe0e;\ncronrpc, (2025), Signed Distance Field 2D Generator, https://github.com/cronrpc/Signed-Distance-Field-2D-Generator\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nChris Green. Valve. (2007). Improved Alpha-Tested Magnification for Vector Textures and Special Effects, https://steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nMetric Space, https://en.wikipedia.org/wiki/Metric_space\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nLisapple, (2017), 8SSEDT , GitHub, https://github.com/Lisapple/8SSEDT\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nRichard Mitton, (2009), Signed Distance Fields, http://www.codersnotes.com/notes/signed-distance-fields/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nfarteryhr, Correct 8SSEDT, https://replit.com/@farteryhr/Correct8SSEDT#main.cpp\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nè›‹ç™½èƒ¨, Unity å¡é€šæ¸²æŸ“ ç¨‹åºåŒ–å¤©ç©ºç›’, https://zhuanlan.zhihu.com/p/540692272\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/signed-distance-field/","summary":"\u003ch2 id=\"sdf-ä»‹ç»\"\u003eSDF ä»‹ç»\u003c/h2\u003e\n\u003ch3 id=\"signed-distance-field-sdf\"\u003eSigned Distance Field (SDF)\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eSigned Distance Field\u003c/strong\u003eï¼ˆæœ‰ç¬¦å·è·ç¦»åœºï¼‰\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003eæ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºå½¢çŠ¶çš„æ•°å­¦å‡½æ•°æˆ–æ•°æ®ç»“æ„ã€‚\u003cbr\u003e\nå®ƒåœ¨äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­ä¸ºæ¯ä¸ªç‚¹åˆ†é…ä¸€ä¸ª\u003cstrong\u003eå¸¦ç¬¦å·çš„è·ç¦»å€¼\u003c/strong\u003eï¼Œè¡¨ç¤ºè¯¥ç‚¹åˆ°æœ€è¿‘è¡¨é¢ï¼ˆæˆ–è¾¹ç•Œï¼‰çš„è·ç¦»ï¼Œå¹¶ç”¨ç¬¦å·åŒºåˆ†å†…å¤–ï¼š\u003c/p\u003e","title":"æœ‰ç¬¦å·è·ç¦»åœº(SDF)"},{"content":"Perlin Noise ä»‹ç» Perlin å™ªå£°ï¼ˆPerlin Noiseï¼‰æ˜¯ç”± Ken Perlin åœ¨ 1983 å¹´ä¸ºç”µå½±ã€ŠTronã€‹å¼€å‘çš„ä¸€ç§å¹³æ»‘ä¼ªéšæœºå™ªå£°ç®—æ³•1ã€‚å®ƒèƒ½å¤Ÿç”Ÿæˆå…·æœ‰è‡ªç„¶çº¹ç†çš„éšæœºæ¨¡å¼ï¼Œå¹¿æ³›ç”¨äºè®¡ç®—æœºå›¾å½¢å­¦ä¸­æ¨¡æ‹Ÿäº‘å½©ã€åœ°å½¢ã€ç«ç„°ã€æœ¨çº¹ã€æ°´æµç­‰è‡ªç„¶ç°è±¡2ã€‚\nä¸æ™®é€šç™½å™ªå£°ä¸åŒï¼ŒPerlin å™ªå£°å…·æœ‰ç©ºé—´ç›¸å…³æ€§ï¼šç›¸é‚»é‡‡æ ·ç‚¹çš„å€¼å˜åŒ–å¹³æ»‘ï¼Œæ²¡æœ‰çªå…€çš„è·³å˜ã€‚è¿™ç§å¹³æ»‘ç‰¹æ€§ä½¿å¾—å®ƒç”Ÿæˆçš„çº¹ç†æ›´åƒè‡ªç„¶ç•Œçš„è¿ç»­å˜åŒ–ã€‚\næˆ‘çš„ä¸–ç•Œå°±é‡‡ç”¨ Perlin Noise æ¥ä½œä¸ºç”Ÿæˆæ— é™ä¸–ç•Œåœ°å›¾çš„åŸºç¡€ç®—æ³•ã€‚\nå™ªå£°ç±»å‹ 1D å‡åŒ€ç™½å™ªå£° 1D å‡åŒ€ç™½å™ªå£° å°±æ˜¯ä¸€ç»´çš„ã€æœä»å‡åŒ€åˆ†å¸ƒçš„ç™½å™ªå£°ä¿¡å·ã€‚\nimport numpy as np import matplotlib.pyplot as plt def sample_random_points(num_points): # é‡‡æ ·å™¨å‡½æ•°ï¼Œè¿”å›num_pointsä¸ª0~1ä¹‹é—´çš„éšæœºæ•° return np.random.rand(num_points) def draw_random_strip_image_from_samples(rand_1d, width, height, filename, thickness=1): num_points = len(rand_1d) cols_per_point = width // num_points rand_pos = (rand_1d * (height - 1)).astype(int) img = np.zeros((height, width)) for i, row in enumerate(rand_pos): start_row = max(row - thickness, 0) end_row = min(row + thickness + 1, height) start_col = i * cols_per_point end_col = start_col + cols_per_point img[start_row:end_row, start_col:end_col] = 1 plt.imshow(img, cmap=\u0026#39;gray\u0026#39;, origin=\u0026#39;lower\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.show() plt.imsave(filename, img, cmap=\u0026#39;gray\u0026#39;) if __name__ == \u0026#34;__main__\u0026#34;: rand_noise = sample_random_points(512) draw_random_strip_image_from_samples(rand_noise, 1024, 512, \u0026#34;random_noise_1d.png\u0026#34;) å¯¹äºä¸€ç»´éšæœºå™ªå£°æ¥è¯´ï¼Œç”Ÿæˆçš„éšæœºç‚¹ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å…³è”çš„ã€‚\nå¦‚æœé‡‡ç”¨Perlin Noiseï¼Œå¾—åˆ°çš„æ˜¯è¿ç»­è€Œå…‰æ»‘çš„æ›²çº¿ã€‚\n2D å‡åŒ€ç™½å™ªå£° å¦‚æœæˆ‘ä»¬éšæœºç”Ÿæˆä¸€å¼ å‡åŒ€åˆ†å¸ƒçš„å™ªå£°å›¾ï¼Œç»“æœå°±æ˜¯å‡åŒ€ç™½å™ªå£°ï¼Œå®ƒä»¬æ¯ä¸ªç‚¹å’Œç›¸é‚»çš„ç‚¹ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•è”ç³»çš„ã€‚\nimport numpy as np import matplotlib.pyplot as plt # ç”Ÿæˆ 512x512 çš„éšæœºæµ®ç‚¹ç°åº¦å›¾ï¼Œå€¼èŒƒå›´0~1 noise = np.random.rand(512, 512) plt.imshow(noise, cmap=\u0026#39;gray\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.imsave(\u0026#39;random_noise.png\u0026#39;, noise, cmap=\u0026#39;gray\u0026#39;) å®Œå…¨éšæœºçš„å™ªå£°ï¼š\nè€Œ Perlin Noise ç›¸é‚»ç‚¹ç›´æ¥æ˜¯æœ‰å…³è”çš„ï¼Œç›¸é‚»ç‚¹çš„æ•°å€¼ä¸Šè¦æ±‚æ¥è¿‘è€Œä¸”å¹³æ»‘ã€‚\né«˜æ–¯ç™½å™ªå£° import numpy as np import matplotlib.pyplot as plt # ç”Ÿæˆ512x512çš„é«˜æ–¯ç™½å™ªå£°ï¼Œå‡å€¼0.5ï¼Œæ ‡å‡†å·®0.1 noise = np.random.normal(loc=0.5, scale=0.1, size=(512, 512)) # å°†å€¼è£å‰ªåˆ°0~1èŒƒå›´å†…ï¼Œé˜²æ­¢æ˜¾ç¤ºå¼‚å¸¸ noise = np.clip(noise, 0, 1) plt.imshow(noise, cmap=\u0026#39;gray\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.imsave(\u0026#39;gaussian_white_noise_2d.png\u0026#39;, noise, cmap=\u0026#39;gray\u0026#39;) plt.show() ç”±äºéå‡åŒ€åˆ†å¸ƒï¼Œçœ‹èµ·æ¥ä¼šæ¯”ç™½å™ªå£°æ›´åŠ æŸ”å’Œä¸€ç‚¹ã€‚\né«˜æ–¯åˆ†å¸ƒåœ¨ä¸€ç»´ä¸Šçœ‹èµ·æ¥ä¼šæ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸­å¿ƒå¸¦ï¼Œé›†ä¸­äº†ç»å¤§å¤šæ•°ç‚¹ã€‚\n1D Perlin Noise å¦‚æœæˆ‘ä»¬éœ€è¦ç†è§£ Perlin Noise ä¸­åˆ†å‹ç›¸å…³çš„æ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€ä¸‹Fadeã€å‘¨æœŸæ€§å’Œé¢‘ç‡å€ç‡çš„æ¦‚å¿µ3ã€‚\nFade åœ¨å·²çŸ¥ä¸€ç³»åˆ—ç‚¹çš„æ•°å€¼çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¸Œæœ›æ±‚ä¸­é—´çš„ç‚¹çš„æ•°å€¼ï¼Œå¯ä»¥é€šè¿‡çº¿æ€§æ’å€¼äº§ç”ŸæŠ˜çº¿ï¼Œé€šè¿‡ Cosine æ’å€¼äº§ç”Ÿå¹³æ»‘çš„æ›²çº¿ã€‚\nä½™å¼¦æ’å€¼å¯ä»¥ç”¨ä¸‹åˆ—å…¬å¼ï¼Œ\n$$ x = x1 + (x2-x1) * (1 - cos(\\pi \\alpha)) / 2 $$\nä¸åŒçš„æ’å€¼æ–¹æ³•çš„ç›®çš„ï¼Œå°±æ˜¯åœ¨è¿‡æ¸¡å¤„äº§ç”Ÿå¹³æ»‘çš„æ›²çº¿è€Œä¸æ˜¯æŠ˜çº¿ã€‚é™¤äº†ä½™å¼¦å‡½æ•°ï¼Œè¿˜å¯ä»¥ç”¨ä¸‰æ¬¡å‡½æ•°ã€äº”æ¬¡å‡½æ•°ç­‰ç­‰æ’å€¼æ–¹æ³•ã€‚\nè¿™ç§æŠŠçº¿æ€§æ’å€¼ï¼Œè½¬åŒ–ä¸ºå¹³æ»‘æ’å€¼ï¼Œå°±å« Fade ã€‚\nPerlin åœ¨æ”¹è¿›å‹çš„å™ªå£°ç”Ÿæˆç®—æ³•ä¸­é‡‡ç”¨çš„ Fade å‡½æ•°æ˜¯ï¼Œ\n$$ t = 6 t^5 - 15 t^4 + 10 t^3 $$\nOctaves å¦‚æœå°†é‡‡æ ·é¢‘ç‡ä¸æ–­ç¿»å€ï¼Œå°±å¯ä»¥è·å¾—ä¸æ–­å‡åŠå‘¨æœŸçš„å‡½æ•°ã€‚ç”±äºéŸ³é˜¶æ¯ä¸ªå…«åº¦ä¹‹é—´å°±æ˜¯é¢‘ç‡ç¿»å€çš„å…³ç³»ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå«åš Octaves ã€‚\nå°†ä¸åŒå‘¨æœŸçš„å™ªå£°æŒ‰ç…§æŸç§æƒé‡è¿›è¡Œæ··åˆï¼Œå°±æ„æˆäº† Perlin Noise ã€‚\né€šå¸¸å°†å‘¨æœŸä¸æ–­ç¿»å€ï¼ŒåŒæ—¶å°†æƒé‡ä¸æ–­å‡åŠã€‚è¿™é‡Œæœ‰ä¸€ç§åˆ†å‹çš„æ¦‚å¿µã€‚\n2D Perlin Noise Generator ç®—æ³• Ken Perlin åœ¨ä»–çš„ç½‘ç«™ä¸Šå…¬å¸ƒäº† Perlin Noise æ”¹è¿›ç‰ˆçš„å®ç°4ã€‚\nPerlin å™ªå£°æ˜¯ä¸€ç§åŸºäºç½‘æ ¼çš„æ¸è¿›å¼å™ªå£°å‡½æ•°ï¼Œå¸¸ç”¨äºç”Ÿæˆè‡ªç„¶æ„Ÿçš„çº¹ç†ã€åœ°å½¢ç­‰ã€‚äºŒç»´ç‰ˆæœ¬çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1. ç½‘æ ¼åˆ’åˆ† å°†äºŒç»´ç©ºé—´åˆ’åˆ†æˆä¸€ä¸ªè§„åˆ™çš„æ•´æ•°æ ¼ç‚¹ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼ç‚¹éƒ½å…³è”ä¸€ä¸ªéšæœºæ¢¯åº¦å‘é‡ï¼ˆé€šå¸¸æ˜¯å•ä½å‘é‡ï¼Œæ–¹å‘å‡åŒ€åˆ†å¸ƒï¼‰ã€‚\n2. è®¡ç®—æ’å€¼ç‚¹çš„ç›¸å¯¹ä½ç½® ç»™å®šé‡‡æ ·ç‚¹ $(x, y)$ï¼Œå…ˆç¡®å®šå®ƒæ‰€åœ¨çš„æ ¼ç‚¹å•å…ƒï¼Œå³è®¡ç®—æ ¼ç‚¹å·¦ä¸‹è§’çš„æ•´æ•°åæ ‡ $(X, Y)$ï¼Œ\n$$ X = \\lfloor x \\rfloor, \\quad Y = \\lfloor y \\rfloor $$\nè®¡ç®—é‡‡æ ·ç‚¹ç›¸å¯¹äºå·¦ä¸‹æ ¼ç‚¹çš„å±€éƒ¨åæ ‡ï¼Œ\n$$ x_{rel} = x - X, \\quad y_{rel} = y - Y $$\n3. è®¡ç®—æ ¼ç‚¹æ¢¯åº¦ä¸è·ç¦»å‘é‡çš„ç‚¹ç§¯ å¯¹äºè¿™ä¸ªå•å…ƒçš„4ä¸ªè§’ï¼ˆæ ¼ç‚¹ï¼‰ï¼Œ\n$$ (X, Y), (X+1, Y), (X, Y+1), (X+1, Y+1) $$\nåˆ†åˆ«å–å‡ºæ¯ä¸ªæ ¼ç‚¹å¯¹åº”çš„æ¢¯åº¦å‘é‡ $\\vec{g}$ï¼Œè®¡ç®—æ¢¯åº¦å‘é‡ä¸é‡‡æ ·ç‚¹åˆ°è¯¥æ ¼ç‚¹çš„è·ç¦»å‘é‡ $\\vec{d}$ çš„ç‚¹ç§¯ï¼Œ\n$$ \\text{dot} = \\vec{g} \\cdot \\vec{d} $$\n4. æ’å€¼å¹³æ»‘ å¯¹ä¸Šè¿°4ä¸ªç‚¹ç§¯ç»“æœï¼Œä½¿ç”¨å¹³æ»‘æ’å€¼å‡½æ•°ï¼ˆå¦‚ Ken Perlin æå‡ºçš„ fade å‡½æ•°ï¼‰æ²¿ x å’Œ y æ–¹å‘è¿›è¡ŒåŒçº¿æ€§æ’å€¼ï¼Œ\n$$ u = \\text{fade}(x_{rel}), \\quad v = \\text{fade}(y_{rel}) $$\n5. è¾“å‡ºå™ªå£°å€¼ æ’å€¼åçš„ç»“æœå°±æ˜¯é‡‡æ ·ç‚¹ $(x,y)$ çš„å™ªå£°å€¼ï¼Œé€šå¸¸èŒƒå›´å¤§çº¦åœ¨ $[-1, 1]$ã€‚\nPython Code è¿™é‡Œç»™å‡ºå®ç° 2D Perlin Noise ç®—æ³•çš„ Python ä»£ç ã€‚\nimport numpy as np import matplotlib.pyplot as plt permutation = np.array([ 151,160,137,91,90,15, 131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23, 190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33, 88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166, 77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244, 102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196, 135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123, 5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42, 223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9, 129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228, 251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107, 49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254, 138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180 ], dtype=np.uint16) p = np.tile(permutation, 2) def grad(hash:int, x:float, y:float)-\u0026gt;float: grad_vectors = np.array([ [1, 1], [-1, 1], [1, -1], [-1, -1], [1, 0], [-1, 0], [0, 1], [0, -1] ]) # å½’ä¸€åŒ–æ¢¯åº¦å‘é‡ grad_vectors = grad_vectors / np.linalg.norm(grad_vectors, axis=1)[:, None] g = grad_vectors[hash % 8] return np.dot(g, [x, y]) def lerp(t: float, a: float, b: float)-\u0026gt;float: return a + t * (b - a) def fade(t: float)-\u0026gt;float: return t * t * t * (t * (t * 6 - 15) + 10) def get_noise(x:float, y:float): X = int(np.floor(x)) \u0026amp; 255 Y = int(np.floor(y)) \u0026amp; 255 x = x % 1 y = y % 1 u = fade(x) v = fade(y) ## è¿™é‡Œå…¶å®åªè¦ä¿è¯hashå”¯ä¸€å°±å¯ä»¥äº† x1 = p[p[X] + Y] x2 = p[p[X+1] + Y] x3 = p[p[X] + Y + 1] x4 = p[p[X+1] + Y + 1] ## x3 x4 ## x1 x2 ## vector æ–¹å‘éƒ½æ˜¯ä»æ•´æ•°ç‚¹ æŒ‡å‘ å™ªå£°é‡‡æ ·ç‚¹ return lerp(v, lerp(u, grad(x1, x, y), grad(x2, x - 1, y)), lerp(u, grad(x3, x, y - 1), grad(x4, x - 1, y - 1))) def get_perlin_noise(width=256, height=256, scale=8.0, octaves=1, persistence=0.5, lacunarity=2.0): noise_arr = np.zeros((height, width), dtype=np.float32) for i in range(height): for j in range(width): for k in range(octaves): x = (j / width) * scale * (lacunarity ** k) y = (i / height) * scale * (lacunarity ** k) noise_arr[i, j] += (persistence ** k) * get_noise(x, y) return noise_arr fig, axs = plt.subplots(2, 2, figsize=(10, 10)) for octave_count, ax in zip(range(1, 5), axs.flatten()): noise_arr = get_perlin_noise(width=256, height=256, scale=8.0, octaves=octave_count) # å¯é€‰å°†èŒƒå›´å˜ä¸º 0~1 noise_arr = (noise_arr - noise_arr.min()) / (noise_arr.max() - noise_arr.min()) ax.imshow(noise_arr, cmap=\u0026#39;gray\u0026#39;) ax.set_title(f\u0026#39;octaves = {octave_count}\u0026#39;, fontsize=14) ax.axis(\u0026#39;off\u0026#39;) plt.tight_layout() plt.savefig(\u0026#39;perlin_noise_octaves_1_to_4.png\u0026#39;) æ¢¯åº¦å€¼å¦‚ä½•æ”¹è¿› ä½¿ç”¨å›ºå®šæ¢¯åº¦å€¼è€Œä¸æ˜¯ Hash å®Œå…¨å‡åŒ€éšæœºäº§ç”Ÿçš„æ¢¯åº¦å€¼ï¼Œæ˜¯é¿å…å¯¼è‡´æ–¹å‘æ€§åå·®ï¼Œå½±å“è§†è§‰è‡ªç„¶åº¦5ã€‚\nåœ¨åŸç‰ˆä¸­ï¼Œæ¢¯åº¦å€¼æ˜¯å‡åŒ€åˆ†å¸ƒåœ¨çƒé¢ä¸Šï¼Œä½†æ˜¯ç«‹æ–¹ä½“å¹¶ä¸æ˜¯çƒé¢å‡åŒ€çš„ï¼Œæ²¿ç€åæ ‡è½´æ–¹å‘ä¼šç¼©çŸ­ï¼Œæ²¿ç€å¯¹è§’çº¿æ–¹å‘ä¼šæ‹‰é•¿ã€‚\nè¿™ç§æ–¹å‘ä¸Šçš„ä¸å¯¹ç§°ï¼Œå®¹æ˜“å¯¼è‡´ä¸€ç§é›¶æ˜Ÿçš„èšé›†æ•ˆåº”ï¼šå½“ä¸€äº›å½¼æ­¤æ¥è¿‘ã€æ–¹å‘å‡ ä¹ä¸åæ ‡è½´å¹³è¡Œçš„æ¢¯åº¦ç¢°å·§æœåŒä¸€ä¸ªæ–¹å‘æ’åˆ—æ—¶ï¼Œå°±ä¼šåœ¨è¿™äº›åŒºåŸŸå‡ºç°å¼‚å¸¸åé«˜çš„æ•°å€¼ã€‚\næ‰€ä»¥ Perlin åœ¨æ”¹è¿›è®ºæ–‡ä¸­å»ºè®®é€‰æ‹©ï¼š\n$$ (1,1,0),(-1,1,0),(1,-1,0),(-1,-1,0), (1,0,1),(-1,0,1),(1,0,-1),(-1,0,-1), (0,1,1),(0,-1,1),(0,1,-1),(0,-1,-1) $$\nåŒæ—¶ä¸ºäº†é¿å…é™¤ä»¥ 12 çš„å¼€é”€ï¼Œä»–å°†æ¢¯åº¦æ–¹å‘è¡¥é½åˆ° 16 ä¸ªï¼Œé¢å¤–æ·»åŠ äº† $(1,1,0),(-1,1,0),(0,-1,1),(0,-1,-1)$ã€‚\næœ¬æ–‡å‚è€ƒäº†è¿™ä¸ªå®ç°æ–¹å¼ï¼Œä½¿ç”¨çš„æ˜¯å¹³é¢8ä¸ªæ–¹å‘çš„æ¢¯åº¦ï¼Œå¹¶ä¸”éƒ½è¿›è¡Œäº†é•¿åº¦çš„å½’ä¸€åŒ–ã€‚\nå¦‚æœæ˜¯ä¸€ç»´çš„ Perlin Noiseï¼Œå¯ä»¥ä¸è¿›è¡Œå½’ä¸€åŒ–æ¥å¢åŠ æ³¢åŠ¨ã€‚ä¸€ç»´çš„ Perlin Noise å¯ä»¥è§†ä½œåœ¨äºŒç»´çš„ Perlin Noise æ²¿ç€æ™¶æ ¼ç”»ä¸€æ¡çº¿ï¼Œæ­¤æ—¶ä¸åœ¨çº¿ä¸Šçš„æ™¶æ ¼çš„æƒé‡éƒ½æ˜¯0ï¼Œå’Œä¸€ç»´çš„ Perlin Noise æ²¡æœ‰åŒºåˆ«ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¢¯åº¦å€¼åœ¨æ°´å¹³æ–¹å‘ä¸Šçš„æŠ•å½±å°±ä¸æ˜¯å”¯ä¸€çš„1ï¼Œ æ–œè¾¹çš„æŠ•å½±å¤§å°æ˜¯ $ \\frac{\\sqrt{2}}{2} $ã€‚\nFade å‡½æ•°çš„æ”¹è¿› Perlin5 åœ¨è®ºæ–‡ä¸­æå‡ºçš„æ”¹è¿›å°±æ˜¯æ›¿æ¢ Fade å‡½æ•°ä¸ºäºŒé˜¶å¹³æ»‘çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šé¢æ‰€ç”¨çš„å‡½æ•°ã€‚\nåŸå› æ˜¯ï¼Œå¦‚æœäºŒé˜¶å¯¼æ•°ä¸æ˜¯å¹³æ»‘çš„è¯ï¼Œå½“å®ƒç”¨äºåšè¡¨é¢æ›¿æ¢çš„æ—¶å€™ï¼Œèƒ½å¤Ÿçœ‹å‡ºéå¸¸æ˜æ˜¾çš„æ–¹å—æ ·å¼ã€‚\næ‰€ä»¥æœ€å¥½éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š\nåœ¨ 0 å’Œ 1 çš„æ—¶å€™ï¼Œå¯¼æ•°åº”è¯¥ä¸º 0ï¼Œä½¿å¾—å…¶å°½å¯èƒ½å¹³æ»‘è¿‡æ¸¡ã€‚ç”šè‡³é«˜é˜¶å¯¼ä¹Ÿå¯ä»¥ä¸º 0ã€‚ $ f(0) = 0 $ $ f(1) = 1 $ åº”ç”¨ä¸¾ä¾‹ Python Noise åº“ å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦ç¼–å†™ Perlin Noise çš„ä»£ç ã€‚è€Œæ˜¯ä½¿ç”¨ Python Noise åº“å°±å¯ä»¥ç›´æ¥ç”Ÿæˆ Perlin Noise ã€‚\nimport numpy as np import matplotlib.pyplot as plt from noise import pnoise2 width, height = 512, 512 scale = 64.0 # æ§åˆ¶å™ªå£°â€œæ‹‰ä¼¸â€ç¨‹åº¦ï¼Œæ•°å€¼è¶Šå¤§å˜åŒ–è¶Šç¼“æ…¢ octaves = 6 persistence = 0.5 lacunarity = 2.0 noise = np.zeros((height, width)) for y in range(height): for x in range(width): nx = x / scale ny = y / scale noise[y][x] = pnoise2(nx, ny, octaves=octaves, persistence=persistence, lacunarity=lacunarity, repeatx=1024, repeaty=1024, base=0) # Perlinå™ªå£°é»˜è®¤èŒƒå›´å¤§è‡´åœ¨[-1,1]ï¼Œå½’ä¸€åŒ–åˆ°[0,1] noise = (noise - noise.min()) / (noise.max() - noise.min()) plt.imshow(noise, cmap=\u0026#39;gray\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.imsave(\u0026#39;perlin_noise_2d_lib.png\u0026#39;, noise, cmap=\u0026#39;gray\u0026#39;) plt.show() ç”±äºè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå®ƒçš„ç”Ÿæˆé€Ÿåº¦éå¸¸å¿«ï¼š\näº‘å±‚ ç”¨ Perlin Noise æ¨¡æ‹Ÿç®€å•äº‘å±‚çº¹ç†ã€‚\næ¨¡æ‹Ÿäº‘å±‚è¾¹ç¼˜çš„æ¶ˆæ•£æ•ˆæœ\næ¨¡æ‹Ÿä¸­å¿ƒçš„é«˜äº®ï¼Œå› æ­¤å¤§äºé˜ˆå€¼éƒ¨åˆ†ä¸åŠ¨ï¼Œåªåœ¨æŸä¸ªèŒƒå›´å†…è¿›è¡Œä¸‹åˆ—çš„æ“ä½œã€‚\n$$ \\text{Intensity} = max(\\text{Intensity} - 40, 0) $$\nimport numpy as np from PIL import Image # è¯»ç°åº¦å›¾ï¼Œä¿æŒ 0~255 æ•´æ•° img = Image.open(\u0026#39;perlin_noise_2d_lib.png\u0026#39;).convert(\u0026#39;L\u0026#39;) arr = np.array(img).astype(np.int32) # 0~255 height, width = arr.shape # åˆ›å»ºRGBå›¾ï¼Œçº¯è“åº• (R,G,B) = (0,0,255) rgb_img = np.zeros((height, width, 3), dtype=np.uint8) for y in range(height): for x in range(width): r, g, b = 0, 0, 255 cloud_intensity = arr[y, x] # 0~255 cloud_intensity = cloud_intensity - 30 if cloud_intensity \u0026lt; 100: cloud_intensity = max(cloud_intensity - 40, 0) # çº¿æ€§æ··åˆï¼Œcloud_intensity ä»£è¡¨ç™½äº‘å¼ºåº¦ (0~255) # å…ˆè®¡ç®—æƒé‡ï¼šcloud_intensity / 255 w = cloud_intensity / 255 r = int(r * (1 - w) + w * 255) g = int(g * (1 - w) + w * 255) b = int(b * (1 - w) + w * 255) rgb_img[y, x, 0] = r rgb_img[y, x, 1] = g rgb_img[y, x, 2] = b # ç›´æ¥ä¿å­˜uint8æ•°ç»„ im = Image.fromarray(rgb_img) im.save(\u0026#39;perlin_cloud.png\u0026#39;) äº‘å±‚æ•ˆæœå¦‚å›¾ï¼š\nUnity Noise Editor åœ¨ Unity ä¸­å®‰è£… Terrain Tools å·¥å…·åï¼Œåœ¨ Window \u0026gt; Terrain \u0026gt; Edit Noise ä¸­å¯ä»¥æ‰¾åˆ°å™ªå£°ç”Ÿæˆå™¨ï¼Œå®ƒå¯ä»¥ç›´æ¥ç”ŸæˆåŒ…å« Perlin Noise åœ¨å†…çš„å„ç§å™ªå£°ï¼Œå¹¶å¯¼å‡ºä¸ºçº¹ç†ã€‚\næˆ–è€…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨Unity Shader Graphé‡Œé¢æ‰¾åˆ°Gradient Noiseã€‚\nPerlin, K. (1985). An image synthesizer. ACM Siggraph Computer Graphics, 19(3), 287-296.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPerlin Noise wiki, https://en.wikipedia.org/wiki/Perlin_noise\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nRoger Eastman. (2019). CMSC425.01 Spring 2019 Lecture 20: Perlin noise I. University of Maryland. https://www.cs.umd.edu/class/spring2019/cmsc425/handouts/CMSC425Day20.pdf\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nKen Perlin. (2022). Improved Noise reference implementation. https://mrl.cs.nyu.edu/~perlin/noise/\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nPerlin, K. (2002, July). Improving noise. In Proceedings of the 29th annual conference on Computer graphics and interactive techniques (pp. 681-682).\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","permalink":"https://cronrpc.github.io/zh/posts/perlin-noise-generator/","summary":"\u003ch2 id=\"perlin-noise-ä»‹ç»\"\u003ePerlin Noise ä»‹ç»\u003c/h2\u003e\n\u003cp\u003ePerlin å™ªå£°ï¼ˆPerlin Noiseï¼‰æ˜¯ç”± Ken Perlin åœ¨ 1983 å¹´ä¸ºç”µå½±ã€ŠTronã€‹å¼€å‘çš„ä¸€ç§å¹³æ»‘ä¼ªéšæœºå™ªå£°ç®—æ³•\u003csup id=\"fnref:1\"\u003e\u003ca href=\"#fn:1\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e1\u003c/a\u003e\u003c/sup\u003eã€‚å®ƒèƒ½å¤Ÿç”Ÿæˆå…·æœ‰è‡ªç„¶çº¹ç†çš„éšæœºæ¨¡å¼ï¼Œå¹¿æ³›ç”¨äºè®¡ç®—æœºå›¾å½¢å­¦ä¸­æ¨¡æ‹Ÿäº‘å½©ã€åœ°å½¢ã€ç«ç„°ã€æœ¨çº¹ã€æ°´æµç­‰è‡ªç„¶ç°è±¡\u003csup id=\"fnref:2\"\u003e\u003ca href=\"#fn:2\" class=\"footnote-ref\" role=\"doc-noteref\"\u003e2\u003c/a\u003e\u003c/sup\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä¸æ™®é€šç™½å™ªå£°ä¸åŒï¼ŒPerlin å™ªå£°å…·æœ‰ç©ºé—´ç›¸å…³æ€§ï¼šç›¸é‚»é‡‡æ ·ç‚¹çš„å€¼å˜åŒ–å¹³æ»‘ï¼Œæ²¡æœ‰çªå…€çš„è·³å˜ã€‚è¿™ç§å¹³æ»‘ç‰¹æ€§ä½¿å¾—å®ƒç”Ÿæˆçš„çº¹ç†æ›´åƒè‡ªç„¶ç•Œçš„è¿ç»­å˜åŒ–ã€‚\u003c/p\u003e","title":"Perlin Noise Generator"},{"content":"æœ¬æ–‡ä»…èšç„¦äºå¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\nä»ä¸‰è§’çº§æ•°å±•å¼€ï¼Œè¿‡æ¸¡åˆ°æ¬§æ‹‰å½¢å¼çš„å‚…é‡Œå¶å˜æ¢ ä»€ä¹ˆæ˜¯ç¦»æ•£å‚…é‡Œå¶å˜æ¢ ä»€ä¹ˆæ˜¯2Då‚…é‡Œå¶å˜æ¢ ä»2Då‚…é‡Œå¶å˜æ¢ï¼Œè§£é‡Šåˆ°2Dç¦»æ•£å‚…é‡Œå¶å˜æ¢ å¦‚ä½•å¯¹å›¾åƒè¿›è¡Œ2Då‚…é‡Œå¶å˜æ¢ 2Då‚…é‡Œå¶å˜æ¢çš„å‘¨æœŸæ€§é—®é¢˜ ä»2Då‚…é‡Œå¶å˜æ¢çš„å‘¨æœŸæ€§ç†è§£å‚…é‡Œå¶2Dé¢‘è°±å›¾çš„ä¸­å¿ƒåŒ– å‚…é‡Œå¶çº§æ•° å‚…é‡Œå¶çº§æ•°æ˜¯ä¸€ç§æ•°å­¦å·¥å…·ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå‘¨æœŸå‡½æ•°ä¸ºä¸€ç»„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„æ— ç©·å’Œã€‚\nä¸‰è§’çº§æ•°å±•å¼€ å‚…é‡Œå¶å˜æ¢æœ€åˆæ˜¯åŸºäºä¸‰è§’çº§æ•°å±•å¼€ï¼Œå³å‘¨æœŸå‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„çº¿æ€§ç»„åˆï¼š\n$$ f(t) = a_0 + \\sum_{n=1}^{\\infty} a_n \\cos(n\\omega_0 t) + b_n \\sin(n\\omega_0 t) $$\nå…¶ä¸­ $\\omega_0 = \\frac{2\\pi}{T}$ æ˜¯åŸºæœ¬é¢‘ç‡ã€‚\nå¤æŒ‡æ•°å½¢å¼ åˆ©ç”¨æ¬§æ‹‰å…¬å¼ï¼š\n$$ \\cos(x) = \\frac{e^{ix} + e^{-ix}}{2}, \\quad \\sin(x) = \\frac{e^{ix} - e^{-ix}}{2i} $$\nå¯ä»¥å°†å‚…é‡Œå¶çº§æ•°æ”¹å†™ä¸ºå¤æŒ‡æ•°å½¢å¼ï¼š\n$$ f(t) = \\sum_{n=-\\infty}^{\\infty} c_n e^{in\\omega_0 t} $$\nå…¶ä¸­ $c_n$ æ˜¯å¤æ•°ç³»æ•°ï¼Œå°è£…äº†æ­£å¼¦å’Œä½™å¼¦éƒ¨åˆ†çš„ä¿¡æ¯ã€‚æ¬§æ‹‰å½¢å¼çš„å‚…é‡Œå¶è¡¨ç¤ºæ›´å¯¹ç§°ã€æ›´æ˜“äºå¤„ç†ï¼Œä¹Ÿä¸ºåç»­æ¨å¹¿åˆ°è¿ç»­å’Œå¤šç»´æƒ…å†µæä¾›äº†åŸºç¡€ã€‚\nåœ¨è¿™é‡Œï¼Œ$n$çš„å–å€¼èŒƒå›´å˜æˆäº†$-\\infty$åˆ°$\\infty$ã€‚\nç¦»æ•£å‚…é‡Œå¶å˜æ¢ DFT ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDiscrete Fourier Transformï¼Œç®€ç§° DFTï¼‰æ˜¯å‚…é‡Œå¶åˆ†æçš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†ç¦»æ•£çš„æœ‰é™é•¿åº¦ä¿¡å·ï¼ˆé€šå¸¸æ˜¯æ•°å­—ä¿¡å·ï¼‰ä»æ—¶é—´åŸŸ/ç©ºé—´åŸŸè½¬æ¢åˆ°é¢‘ç‡åŸŸï¼Œè¡¨ç¤ºæˆä¸€ç»„å¤æ•°é¢‘ç‡åˆ†é‡çš„å åŠ ã€‚\nå®é™…ä¸­æˆ‘ä»¬å¤„ç†çš„æ˜¯æœ‰é™ã€ç¦»æ•£çš„æ•°æ®ã€‚ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆDFTï¼‰å®šä¹‰å¦‚ä¸‹ï¼š\n$$ X[k] = \\sum_{n=0}^{N-1} x[n] \\cdot e^{-i \\frac{2\\pi}{N}kn}, \\quad k = 0, 1, \\dots, N-1 $$\nå¯¹åº”çš„é€†å˜æ¢ä¸ºï¼š\n$$ x[n] = \\frac{1}{N} \\sum_{k=0}^{N-1} X[k] \\cdot e^{i \\frac{2\\pi}{N}kn} $$\nDFT æŠŠæ—¶é—´åŸŸä¿¡å· $x[n]$ æ˜ å°„åˆ°é¢‘åŸŸ $X[k]$ï¼Œæ¯ä¸ª $X[k]$ å¯¹åº”ä¸€ä¸ªé¢‘ç‡åˆ†é‡çš„å¹…åº¦å’Œç›¸ä½ã€‚\nè´Ÿé¢‘ç‡ã€å‘¨æœŸé‡æ’ ç¦»æ•£å‚…é‡Œå¶å˜æ¢ä¸­ï¼Œå¯ä»¥æœ‰è´Ÿé¢‘ç‡ã€‚\nè™½ç„¶ DFT çš„ç´¢å¼• $k$ æ˜¯éè´Ÿæ•´æ•°ï¼Œä½†å‚…é‡Œå¶é¢‘ç‡å…·æœ‰æ¨¡ $N$ çš„å‘¨æœŸæ€§ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼š\n$$ e^{-j \\frac{2\\pi}{N} k n} = e^{-j \\frac{2\\pi}{N} (k + mN) n}, \\quad \\forall m \\in \\mathbb{Z} $$\nå› æ­¤ï¼Œé¢‘ç‡ $k = N - 1$ å®é™…ä¸Šç­‰ä»·äºé¢‘ç‡ $-1$ï¼Œé¢‘ç‡ $k = N - 2$ ç­‰ä»·äº $-2$ï¼Œä»¥æ­¤ç±»æ¨ã€‚\næˆ‘ä»¬å¯ä»¥å°†é¢‘ç‡ç´¢å¼•é‡æ–°è§£é‡Šä¸ºä»è´Ÿé¢‘ç‡åˆ°æ­£é¢‘ç‡ï¼š\n$$ k = -\\frac{N}{2}, \\dots, -1, 0, 1, \\dots, \\frac{N}{2} - 1 \\quad (\\text{å½“ } N \\text{ ä¸ºå¶æ•°æ—¶}) $$\nè¿™ç§æ–¹å¼å¯ä»¥é€šè¿‡é¢‘è°±çš„ä¸­å¿ƒåŒ–é‡æ’ï¼Œä½¿å¾—ç»“æœæ›´ç¬¦åˆé¢‘ç‡å¯¹ç§°ç›´è§‰ã€‚\nåœ¨åé¢çš„å¯¹å›¾åƒçš„2Då‚…é‡Œå¶å˜æ¢åï¼Œé¢‘è°±å›¾é€šè¿‡ä¸­å¿ƒåŒ–é‡æ’åï¼Œå°†ä½é¢‘åŒºåŸŸå…¨éƒ¨å˜æ¢åˆ°ä¸­å¤®ã€‚\n2Då‚…é‡Œå¶å˜æ¢ å‚…é‡Œå¶å˜æ¢å¯ä»¥ä»å°†åŸæœ¬çš„1Då½¢å¼ï¼Œæ‰©å±•åˆ°2Då½¢å¼ã€‚\nä»€ä¹ˆæ˜¯2Då‚…é‡Œå¶å˜æ¢ è¿ç»­2Då‚…é‡Œå¶å˜æ¢çš„å®šä¹‰å¦‚ä¸‹ï¼Œå¯¹äºä¸€ä¸ªè¿ç»­å‡½æ•° $f(x, y)$ï¼š\n$$ F(u, v) = \\iint_{-\\infty}^{\\infty} f(x, y) \\cdot e^{-i2\\pi (ux + vy)} , dx,dy $$\nå…¶é€†å˜æ¢ä¸ºï¼š\n$$ f(x, y) = \\iint_{-\\infty}^{\\infty} F(u, v) \\cdot e^{i2\\pi (ux + vy)} , du,dv $$\nå…¶ä¸­ $(x, y)$ æ˜¯ç©ºé—´åŸŸåæ ‡ï¼Œ$(u, v)$ æ˜¯é¢‘ç‡åŸŸåæ ‡ã€‚å˜æ¢ç»“æœ $F(u, v)$ æè¿°äº†ä¿¡å·ä¸­æ¯ä¸ªé¢‘ç‡åˆ†é‡çš„å¹…å€¼å’Œç›¸ä½ã€‚\n2D ç¦»æ•£å‚…é‡Œå¶å˜æ¢ ç¦»æ•£æƒ…å†µä¸‹ï¼Œå¯¹äºä¸€ä¸ª $M \\times N$ çš„äºŒç»´ç¦»æ•£å‡½æ•° $f[m, n]$ï¼Œå…¶äºŒç»´ç¦»æ•£å‚…é‡Œå¶å˜æ¢ï¼ˆ2D DFTï¼‰å®šä¹‰ä¸ºï¼š\n$$ F[k, l] = \\sum_{m=0}^{M-1} \\sum_{n=0}^{N-1} f[m, n] \\cdot e^{-i 2\\pi \\left( \\frac{km}{M} + \\frac{ln}{N} \\right)} $$\nå…¶é€†å˜æ¢ä¸ºï¼š\n$$ f[m, n] = \\frac{1}{MN} \\sum_{k=0}^{M-1} \\sum_{l=0}^{N-1} F[k, l] \\cdot e^{i 2\\pi \\left( \\frac{km}{M} + \\frac{ln}{N} \\right)} $$\n2Då‚…é‡Œå¶å˜æ¢çš„å‘¨æœŸæ€§ ç±»ä¼¼äº1D DFTï¼Œ2D DFT ä¹Ÿå…·æœ‰å‘¨æœŸæ€§ï¼š\n$$ F[k + M, l] = F[k, l], \\quad F[k, l + N] = F[k, l] $$\nè¿™æ„å‘³ç€é¢‘è°±åœ¨ä¸¤ä¸ªæ–¹å‘ï¼ˆæ°´å¹³å’Œå‚ç›´ï¼‰ä¸Šéƒ½æ˜¯å‘¨æœŸæ€§çš„ã€‚\nDFT ä¸­çš„é¢‘ç‡ç´¢å¼• $k$ å’Œ $l$ å–å€¼èŒƒå›´æ˜¯ $0$ åˆ° $M-1$ å’Œ $N-1$ï¼Œä½†è¿™äº›ç´¢å¼•å¹¶ä¸æ˜¯å•çº¯çš„â€œæ­£é¢‘ç‡â€ï¼Œå®ƒä»¬æ˜¯æ¨¡å‘¨æœŸçš„ã€‚\nå› ä¸ºå‘¨æœŸæ˜¯ $M$ å’Œ $N$ï¼Œæ‰€ä»¥ååŠéƒ¨åˆ†å¯ä»¥çœ‹ä½œå¯¹åº”çš„è´Ÿé¢‘ç‡åˆ†é‡ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ç´¢å¼• $k \u0026gt; \\frac{M}{2}$ æ—¶ï¼Œå®é™…é¢‘ç‡ç­‰ä»·äº $k - M$ å¯¹åº”çš„è´Ÿé¢‘ç‡ï¼›åŒç†ï¼Œå½“ç´¢å¼• $l \u0026gt; \\frac{N}{2}$ æ—¶ï¼Œé¢‘ç‡ç­‰ä»·äº $l - N$ å¯¹åº”çš„è´Ÿé¢‘ç‡ã€‚è¿™æ ·ï¼Œé¢‘ç‡ç´¢å¼•çš„èŒƒå›´åœ¨ $[0, M-1]$ å’Œ $[0, N-1]$ ä¸Šå¾ªç¯ï¼Œå½¢æˆæ­£è´Ÿé¢‘ç‡å¯¹ç§°çš„ç»“æ„ã€‚\nå¦‚ä½•å¯¹å›¾åƒè¿›è¡Œ2Då‚…é‡Œå¶å˜æ¢ Python ä¸­å¯ä»¥ä½¿ç”¨ numpy æˆ– opencv ç­‰åº“æ–¹ä¾¿åœ°è¿›è¡Œ 2D å‚…é‡Œå¶å˜æ¢ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ NumPyï¼š\nimport numpy as np import matplotlib.pyplot as plt from PIL import Image # åŠ è½½å›¾åƒå¹¶è½¬æ¢ä¸ºç°åº¦ img = Image.open(\u0026#39;doge.jpg\u0026#39;).convert(\u0026#39;L\u0026#39;) f = np.array(img) # è®¡ç®—2Då‚…é‡Œå¶å˜æ¢ F = np.fft.fft2(f) # å¹…åº¦è°±ä¸ç›¸ä½è°± magnitude_spectrum = np.abs(F) phase_spectrum = np.angle(F) log_magnitude = np.log(1 + magnitude_spectrum) # åˆ›å»ºå­å›¾ fig, axs = plt.subplots(1, 3, figsize=(15, 5)) # åŸå§‹å›¾åƒ axs[0].imshow(f, cmap=\u0026#39;gray\u0026#39;) axs[0].set_title(\u0026#39;Original Image\u0026#39;) axs[0].axis(\u0026#39;off\u0026#39;) # å¹…åº¦è°± axs[1].imshow(log_magnitude, cmap=\u0026#39;gray\u0026#39;) axs[1].set_title(\u0026#39;Magnitude Spectrum (log)\u0026#39;) axs[1].axis(\u0026#39;off\u0026#39;) # ç›¸ä½è°± im = axs[2].imshow(phase_spectrum, cmap=\u0026#39;gray\u0026#39;) axs[2].set_title(\u0026#39;Phase Spectrum\u0026#39;) axs[2].axis(\u0026#39;off\u0026#39;) # æ·»åŠ  colorbar åˆ°ç›¸ä½è°± fig.colorbar(im, ax=axs[2], shrink=0.7) plt.tight_layout() plt.show() è¿è¡Œåå¯ä»¥çœ‹åˆ°å¹…åº¦è°±å’Œç›¸ä½è°±ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹åœ¨äºï¼Œ\né€†å˜æ¢è¿˜åŸå›¾åƒï¼ˆé¢‘ç‡+ç›¸ä½ï¼‰ å‚…é‡Œå¶å˜æ¢çš„ç»“æœæ˜¯å¤æ•°ï¼ŒåŒ…å«äº†å¹…åº¦ï¼ˆMagnitudeï¼‰å’Œç›¸ä½ï¼ˆPhaseï¼‰ä¿¡æ¯ã€‚åªä¿ç•™å…¶ä¸­ä¹‹ä¸€å°±ä¸èƒ½å®Œæ•´è¿˜åŸå›¾åƒã€‚\nè¿˜åŸå›¾åƒçš„æ–¹å¼å¦‚ä¸‹ï¼š\nimport numpy as np import matplotlib.pyplot as plt from PIL import Image # åŠ è½½å›¾åƒå¹¶è½¬æ¢ä¸ºç°åº¦ img = Image.open(\u0026#39;doge.jpg\u0026#39;).convert(\u0026#39;L\u0026#39;) f = np.array(img) # è®¡ç®—2Då‚…é‡Œå¶å˜æ¢ F = np.fft.fft2(f) # è¿›è¡Œé€†å‚…é‡Œå¶å˜æ¢ recovered = np.fft.ifft2(F) recovered_real = np.real(recovered) plt.imshow(recovered_real, cmap=\u0026#39;gray\u0026#39;) plt.title(\u0026#39;Recovered Image from IFFT\u0026#39;) plt.axis(\u0026#39;off\u0026#39;) plt.show() é€†å˜æ¢ååº”è¯¥å’ŒåŸå›¾ä¸€æ ·ã€‚\né¢‘è°±å›¾ä¸­å¿ƒåŒ– ä¸ºäº†æ›´æ¸…æ™°åœ°è§‚å¯Ÿé¢‘ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬é€šå¸¸å¯¹é¢‘è°±è¿›è¡Œä¸­å¿ƒåŒ–ï¼Œä½¿ä½é¢‘ä½äºä¸­å¿ƒï¼Œé«˜é¢‘åˆ†å¸ƒåœ¨å‘¨å›´ã€‚\nä¸­å¿ƒåŒ–æ“ä½œå¯ä»¥ä½¿ç”¨ np.fft.fftshiftï¼š\nimport cv2 import numpy as np import matplotlib.pyplot as plt img = cv2.imread(\u0026#39;doge.jpg\u0026#39;, cv2.IMREAD_GRAYSCALE) f = np.fft.fft2(img) fshift = np.fft.fftshift(f) magnitude_spectrum = 20 * np.log(np.abs(fshift) + 1) plt.figure(figsize=(12, 6)) plt.subplot(1, 2, 1) plt.title(\u0026#39;Original Image\u0026#39;) plt.imshow(img, cmap=\u0026#39;gray\u0026#39;) plt.subplot(1, 2, 2) plt.title(\u0026#39;Magnitude Spectrum\u0026#39;) plt.imshow(magnitude_spectrum, cmap=\u0026#39;gray\u0026#39;) plt.show() æ­¤æ—¶é¢‘è°±å›¾å°†ä½é¢‘æˆåˆ†ç§»åˆ°äº†ä¸­å¿ƒï¼Œæ›´æ˜“äºè§‚å¯Ÿçº¹ç†å’Œæ–¹å‘æ€§ç­‰ä¿¡æ¯ã€‚\nä¸­å¿ƒå¤§è‡´å¯ä»¥è¡¨ç¤ºè½®å»“ä¿¡æ¯ï¼Œè€Œç»†èŠ‚çº¹ç†æ˜¯é«˜é¢‘ä¿¡æ¯ä½äºè¾¹ç¼˜ã€‚\n","permalink":"https://cronrpc.github.io/zh/posts/2d-fourier-transform/","summary":"\u003cp\u003eæœ¬æ–‡ä»…èšç„¦äºå¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä»ä¸‰è§’çº§æ•°å±•å¼€ï¼Œè¿‡æ¸¡åˆ°æ¬§æ‹‰å½¢å¼çš„å‚…é‡Œå¶å˜æ¢\u003c/li\u003e\n\u003cli\u003eä»€ä¹ˆæ˜¯ç¦»æ•£å‚…é‡Œå¶å˜æ¢\u003c/li\u003e\n\u003cli\u003eä»€ä¹ˆæ˜¯2Då‚…é‡Œå¶å˜æ¢\u003c/li\u003e\n\u003cli\u003eä»2Då‚…é‡Œå¶å˜æ¢ï¼Œè§£é‡Šåˆ°2Dç¦»æ•£å‚…é‡Œå¶å˜æ¢\u003c/li\u003e\n\u003cli\u003eå¦‚ä½•å¯¹å›¾åƒè¿›è¡Œ2Då‚…é‡Œå¶å˜æ¢\u003c/li\u003e\n\u003cli\u003e2Då‚…é‡Œå¶å˜æ¢çš„å‘¨æœŸæ€§é—®é¢˜\u003c/li\u003e\n\u003cli\u003eä»2Då‚…é‡Œå¶å˜æ¢çš„å‘¨æœŸæ€§ç†è§£å‚…é‡Œå¶2Dé¢‘è°±å›¾çš„ä¸­å¿ƒåŒ–\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"å‚…é‡Œå¶çº§æ•°\"\u003eå‚…é‡Œå¶çº§æ•°\u003c/h2\u003e\n\u003cp\u003eå‚…é‡Œå¶çº§æ•°æ˜¯ä¸€ç§æ•°å­¦å·¥å…·ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå‘¨æœŸå‡½æ•°ä¸ºä¸€ç»„æ­£å¼¦å’Œä½™å¼¦å‡½æ•°çš„æ— ç©·å’Œã€‚\u003c/p\u003e","title":"2D Fourier Transform"}]